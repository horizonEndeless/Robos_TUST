
function HTMLMakerController(sys,formID){this.create(sys,formID);}
HTMLMakerController.prototype.name='HTMLMakerController';HTMLMakerController.prototype.toString=function(){return'[HTMLMakerController: '+this.sys+'->'+this.formID+']';};HTMLMakerController.prototype.create=function(sys,formID){this.formID=formID;this.sys=sys;this.propCount=0;this.events=new Array();this.props=new Object();this.propsNames=new Array();this.cachedProps=new Array();this.fullPropList=new Array();};HTMLMakerController.prototype.editMode=function(){this.loadFromDatabase();executeJSRule(this.sys,this.formID,ebfUtilReduceVariable('MK3-Ativar edi√ß√£o',true),[]);this.showInspector();};HTMLMakerController.prototype.cancelChanges=function(){if(this.inspector)this.inspector.close();parent.location.href=parent.location.href.replace('&mode=99','&mode=0');};HTMLMakerController.prototype.saveToDatabase=function(){executeJSRule(this.sys,this.formID,ebfUtilReduceVariable('MK3-Salvar formul√°rio',true),[]);};HTMLMakerController.prototype.loadFromDatabase=function(){executeSyncJavaRule(this.sys,this.formID,'MK3-Inicializar propriedades dos componentes',this.formID);};HTMLMakerController.prototype.showInspector=function(component){var FormInspetorID=executeSyncJavaRule(this.sys,this.formID,'MK3-Obter c√≥digo do formul√°rio pelo GUID',"{8F8B4E5F-AD79-4611-BB45-7AF0B2226566}");if(this.inspector&&this.inspector.closed)return;if(!(this.inspector&&this.inspector.mainform)){this.inspector=openWFRFilterFormXY(this.sys,FormInspetorID,300,700,'',2,10);}else{var lkp=this.inspector.mainform.controller.getElementById('cmbComponentes');if(lkp)lkp.setValue(component?component.getCode():0,true);}};HTMLMakerController.prototype.getProp=function(name){return this.props[name];};HTMLMakerController.prototype.setProp=function(name,value){if(typeof(this.props[name])=="undefined"){this.propsNames[this.propsNames.length]=name;this.propCount++;}
this.props[name]=value;};HTMLMakerController.prototype.getPropCount=function(){return this.propCount;};HTMLMakerController.prototype.setEvent=function(moment,value){this.events[moment]=value;};HTMLMakerController.prototype.getEvent=function(moment){return this.events[moment];};HTMLMakerController.prototype.applyUpdates=function(){document.title=this.props["Descricao"];parent.changeTitle(document.title);};HTMLMakerController.prototype.hasComponent=function(comName){return controller.elemsById[comName]!=null;};HTMLMakerController.prototype.getEventsFromType=function(comType){var events=new Array();var list=this.cachedProps[comType];for(var i=0;i<list.length;i++){if(list[i].event){events.push(list[i]);}}
return events;};HTMLMakerController.prototype.getPropsFromType=function(comType){var props=new Array();var list=this.cachedProps[comType];for(var i=0;i<list.length;i++){if(!list[i].event){props.push(list[i]);}}
return props;};function inArray(list,item){for(var i=0;i<list.length;i++)
if(list[i]==item)return true;return false;};HTMLMakerController.prototype.getDefaultValue=function(comType,propName){var props=this.cachedProps[comType];for(var i=0;i<props.length;i++){if(props[i].name==propName)return props[i].defaultValue;}};HTMLMakerController.prototype.addPropToType=function(comType,propName,propDesc,isEvent,defValue){var prop=new Object();prop.name=propName;prop.description=propDesc;prop.event=isEvent;prop.defaultValue=defValue;if(typeof this.cachedProps[comType]=="undefined")
this.cachedProps[comType]=new Array();this.cachedProps[comType].push(prop);if(!inArray(this.fullPropList,propName))
this.fullPropList.push(propName);};HTMLMakerController.prototype.getFullPropList=function(){return this.fullPropList;};HTMLMakerController.prototype.getNextComponentCode=function(){var components=controller.getTabElements(d.t);var max=0;for(var i=0;i<components.length;i++){max=Math.max(max,components[i].getCode());}
return max+1;};HTMLMakerController.prototype.newHTMLEdit=function(code){var posX=20;var posY=20;var width=100;var height=21;var description='Novo editor';var value='';if(!code)code=this.getNextComponentCode();var componente=new HTMLEdit(this.sys,this.formID,code,posX,posY,width,height,description,value);componente.maxlength=50;componente.zindex=1;componente.field='PALAVRA';componente.id='MakerEdit'+code;componente.design(d.t.getSelectedTab().div,true);document['c_'+code]=componente;return componente;};HTMLMakerController.prototype.newHTMLButton=function(code){if(!code)code=this.getNextComponentCode();var posX=20;var posY=20;var width=125;var height=25;var name='NovoBotao'+code;var label='Novo bot√£o';var componente=new HTMLButton(this.sys,this.formID,code,posX,posY,width,height,name,label);componente.id=name;componente.design(d.t.getSelectedTab().div,true);document['c_'+code]=componente;return componente;};HTMLMakerController.prototype.newHTMLRadioGroup=function(code){if(!code)code=this.getNextComponentCode();var posX=20;var posY=20;var width=200;var height=150;var name='NovoRadio'+code;var label='Novo seletor';var componente=new HTMLRadioGroup(this.sys,this.formID,code,posX,posY,width,height,name,label,[],[]);componente.columns=1;componente.id=name;componente.design(d.t.getSelectedTab().div,true);document['c_'+code]=componente;return componente;};HTMLMakerController.prototype.newHTMLLabel=function(code){if(!code)code=this.getNextComponentCode();var posX=20;var posY=20;var width=80;var height=25;var name='Novo'+code;var label='Novo';var componente=new HTMLLabel(this.sys,this.formID,code,posX,posY,width,height,label);componente.id=name;componente.design(d.t.getSelectedTab().div,true);document['c_'+code]=componente;return componente;};HTMLMakerController.prototype.newHTMLCheckbox=function(code){if(!code)code=this.getNextComponentCode();var posX=20;var posY=20;var width=80;var height=25;var name='Novo'+code;var label='Novo';var componente=new HTMLCheckbox(this.sys,this.formID,code,posX,posY,width,height,name,label,'Verdadeiro','Falso');componente.id=name;componente.design(d.t.getSelectedTab().div,true);document['c_'+code]=componente;return componente;};HTMLMakerController.prototype.newHTMLLookup=function(code){if(!code)code=this.getNextComponentCode();var posX=20;var posY=20;var width=200;var height=25;var name='Novo'+code;var label='Novo';var componente=new HTMLLookup(this.sys,this.formID,code,posX,posY,width,height,name,label,'');componente.id=name;componente.style=0;componente.dependent=true;componente.field='CAMPO';componente.bgColor='#FFFFFF';componente.design(d.t.getSelectedTab().div,true);document['c_'+code]=componente;return componente;};HTMLMakerController.prototype.newHTMLImage=function(code){if(!code)code=this.getNextComponentCode();var posX=20;var posY=20;var width=200;var height=150;var name='Novo'+code;var label='Novo';var componente=new HTMLImage(this.sys,this.formID,code,posX,posY,width,height,name,label,'CAMPO',1,false);componente.id=name;componente.style=0;componente.dependent=true;componente.field='CAMPO';componente.hasImage=false;componente.design(d.t.getSelectedTab().div,true);document['c_'+code]=componente;return componente;};HTMLMakerController.prototype.newHTMLComboBox=function(code){if(!code)code=this.getNextComponentCode();var posX=20;var posY=20;var width=200;var height=25;var name='Novo'+code;var label='Novo';var componente=new HTMLComboBox(this.sys,this.formID,code,posX,posY,width,height,name,label,'');componente.id=name;componente.dependent=true;componente.field='CAMPO';componente.design(d.t.getSelectedTab().div,true);document['c_'+code]=componente;return componente;};HTMLMakerController.prototype.newHTMLMemo=function(code){if(!code)code=this.getNextComponentCode();var posX=20;var posY=20;var width=200;var height=75;var name='Novo'+code;var label='Novo';var componente=new HTMLMemo(this.sys,this.formID,code,posX,posY,width,height,name,label);componente.id=name;componente.design(d.t.getSelectedTab().div,true);document['c_'+code]=componente;return componente;};HTMLMakerController.prototype.newHTMLGroupBox=function(code){if(!code)code=this.getNextComponentCode();var posX=20;var posY=20;var width=200;var height=150;var name='Novo'+code;var label='Novo';var componente=new HTMLGroupBox(this.sys,this.formID,code,posX,posY,width,height,name,label);componente.style=0;componente.id=name;componente.design(d.t.getSelectedTab().div,true);document['c_'+code]=componente;return componente;};HTMLMakerController.prototype.newHTMLDetailPanel=function(code){if(!code)code=this.getNextComponentCode();var posX=20;var posY=20;var width=200;var height=150;var name='Novo'+code;var label='Novo';var componente=new HTMLDetailPanel(this.sys,this.formID,code,posX,posY,width,height,name,label);componente.design(d.t.getSelectedTab().div,true);document['c_'+code]=componente;return componente;};HTMLMakerController.prototype.newHTMLGrid=function(code){if(!code)code=this.getNextComponentCode();var posX=20;var posY=20;var width=200;var height=150;var name='Novo'+code;var label='Novo';var formID=6341;var componente=new HTMLGrid(this.sys,this.formID,code,posX,posY,width,height,formID);componente.formWidth=569;componente.formHeight=446;componente.editable=false;componente.callForm=false;componente.setMainImages(1,1,1,1);componente.setEditImages(1,1);componente.setIncludeImages(1,1,1);componente.gridini=0;componente.parentHasData=true;componente.hasdata=false;componente.gridend=0;componente.setData([]);componente.setColumns(['PARAMETRO','VALOR'],[233,289],[40169,40170]);componente.dependent=true;componente.id=name;componente.design(d.t.getSelectedTab().div,true);componente.enableNavigation(false,false,false,false);document['c_'+code]=componente;return componente;};function HTMLMakerForm(maker){this.create(maker);}
HTMLMakerForm.prototype.name='HTMLMakerForm';HTMLMakerForm.prototype.create=function(maker){this.fmaker=maker;};HTMLMakerForm.prototype.getMaker=function(){if(!this.maker){this.maker=new HTMLMakerInfo(this);this.maker.events=this.fmaker.events;}
return this.maker;};function HTMLMakerInfo(component){this.create(component);}
HTMLMakerInfo.prototype.name='HTMLMakerInfo';HTMLMakerInfo.prototype.create=function(component){this.component=component;this.modified=false;this.inserted=false;this.props=new Object();this.propsNames=new Array();this.events=new Array();};HTMLMakerInfo.prototype.getComponentType=function(){var cname=this.component.name;if(cname=='HTMLButton')return'B';if(cname=='HTMLImage')return'I';if(cname=='HTMLRadioGroup')return'R';if(cname=='HTMLEdit')return'E';if(cname=='HTMLMemo')return'M';if(cname=='HTMLLabel')return'L';if(cname=='HTMLLookup')return'K';if(cname=='HTMLComboBox')return'C';if(cname=='HTMLCheckBox')return'H';if(cname=='HTMLGrid')return'G';if(cname=='HTMLDetailPanel')return'D';if(cname=='HTMLGroupBox')return'V';if(cname=='HTMLMakerForm')return'F';alert("Tipo desconhecido: "+cname+' '+this.component);};HTMLMakerInfo.prototype.showInspector=function(){d.n.getMaker().showInspector(this.component);};HTMLMakerInfo.prototype.setProp=function(name,value){if(typeof(this.props[name])=="undefined")
this.propsNames[this.propsNames.length]=name;this.props[name]=value;this.modified=true;};HTMLMakerInfo.prototype.getProp=function(name){if(name=='PosicaoX')return this.component.getX();if(name=='PosicaoY')return this.component.getY();if(name=='Altura')return this.component.getHeight();if(name=='Tamanho')return this.component.getWidth();return this.props[name];};HTMLMakerInfo.prototype.toString=function(){return'[HTMLMakerInfo: '+this.component+']';};HTMLMakerInfo.prototype.getPropCount=function(){return this.propsNames?this.propsNames.length:0;};HTMLMakerInfo.prototype.getPropName=function(index){return this.propsNames[index];};HTMLMakerInfo.prototype.getTabName=function(){tabIndex=d.t.tabs.indexOf(d.t.getTabByName(this.component.getTabName()))+1;tabIndex=(tabIndex<10)?'0'+tabIndex:tabIndex;return tabIndex+'-'+this.component.getTabName();};HTMLMakerInfo.prototype.applyUpdates=function(){this.component.updateComponent({x:this.props["PosicaoX"],y:this.props["PosicaoY"],width:this.props["Tamanho"],height:this.props["Altura"],description:this.props["Descricao"]});if((typeof this.props["Cor"]!="undefined")&&(trim(this.props["Cor"])!='')){this.component.setBGColor(ebfDelphiColorToRGB(this.props["Cor"]));}};HTMLMakerInfo.prototype.setEvent=function(moment,value){this.events[moment]=value;this.modified=true;};HTMLMakerInfo.prototype.getEvent=function(moment){return this.events[moment];};HTMLMakerInfo.prototype.getEventCount=function(){return this.events?this.events.length:0;};var WIDTH_WINDOW=getWindowDimensions().width;var DIMENSION_LAY=true;var LIST_RESIZE_TABLE=[];Function.prototype.method=function(name,func){this.prototype[name]=func;return this;};Function.method('inherits',function(parent){var sc=parent;var d=0,p=(this.prototype=new parent());this.method('callMethod',function importMethod(sc,name){if(arguments.length>2){return sc.prototype[name].apply(this,arguments[2]);}else{return sc.prototype[name].apply(this,[]);}});this.method('superclass',function superclass(name){var f,r,t=d,v=parent.prototype;if(t){while(t){v=v.constructor.prototype;t-=1;}
f=v[name];}else{f=p[name];if(f==this[name]){f=v[name];}}
d+=1;r=f.apply(this,Array.prototype.slice.apply(arguments,[1]));d-=1;return r;});return this;});Function.method('swiss',function(parent){for(var i=1;i<arguments.length;i+=1){var name=arguments[i];this.prototype[name]=parent.prototype[name];}
return this;});String.prototype.trim=function(){return this.replace(/^\s*/,"").replace(/\s*$/,"");};function HTMLAction(func,owner,params){this.func=func;this.owner=owner;this.params=params;this.isHTMLAction=true;if(!this.params)this.params=new Array();}
HTMLAction.prototype.isEvent=function(){return true;};HTMLAction.prototype.getFunction=function(){return this.func;};HTMLAction.prototype.getOwner=function(){return this.owner;};HTMLAction.prototype.getParams=function(){return this.params;};HTMLAction.prototype.callAction=function(){this.func.apply(this.owner,Array.prototype.slice.apply(arguments,[1]));};HTMLAction.prototype.call=function(){var args=arrayConcat(arguments,this.params);return this.func.apply(this.owner,args);};HTMLAction.prototype.apply=function(o,p){var args=arrayConcat(arrayConcat([o],p),this.params);return this.func.apply(this.owner,args);};HTMLAction.prototype.toString=function(){return'[HTMLAction]';};HTMLObject.prototype.getMaker=function(){return this.maker?this.maker:this.maker=new HTMLMakerInfo(this);};function HTMLObject(sys,formID,code){this.sys=sys;this.formID=formID;this.code=code;}
HTMLObject.prototype.isObject=true;HTMLObject.prototype.getSystem=function(){return this.sys;};HTMLObject.prototype.getForm=function(){return this.formID;};HTMLObject.prototype.getCode=function(){return this.code;};HTMLObject.prototype.attachEvent=function(obj,type,fn,owner,params){if(type.length>2&&type.substring(0,2)=='on')
type=type.substring(2,type.length);if(fn.isHTMLAction){owner=fn.getOwner();if(fn.getParams().length>0)
params=fn.getParams();fn=fn.getFunction();}
obj['event_on'+type]=fn;if(owner&&owner.isRule)obj['on'+type]=associateRuleWithEvent(obj,'event_on'+type,owner?owner:this);else obj['on'+type]=associateObjWithEvent(obj,'event_on'+type,owner?owner:this,params);EventCache.add(obj,type,fn);};HTMLObject.prototype.removeEvent=function(obj,type){obj['event_'+type]=null;obj['on'+type]=null;};HTMLObject.prototype.toString=function(){return'[HTMLObject]';};HTMLObject.prototype.checkPost=function(){return true;};HTMLObject.prototype.timeout=function(handler,delay,fparams){var self=this;var params=fparams;var wrapper=function(){if(params)handler.apply(self,params);else handler.apply(self);};return window.setTimeout(wrapper,delay?delay:0);};HTMLObject.prototype.getAction=function(fun,params){var f=typeof(fun)=="string"?this[fun]:fun;return new HTMLAction(f,this,params);};HTMLObject.prototype.getActionFunction=function(fun,params){var context=params;var owner=this;return function(e){var paramscopy=new Array();paramscopy.push(e);if(params)paramscopy=paramscopy.concat(params);return fun.apply(owner,paramscopy);}};HTMLObject.prototype.flush=function(){this.doc=null;this.div=null;};HTMLObject.prototype.free=function(){if(this.doc&&this.div)
this.doc.removeChild(this.div);return this;};HTMLObject.prototype.loadScripts=function(){};function getKey(evt){if(!evt)evt=event;return evt.keyCode;}
function checkKey(evt,o,keys){if(!evt)evt=event;var altKey=false;var ctrlKey=false;var shiftKey=false;var target=evt.target||evt.srcElement;var r=true;if(w3c){if(document.layers){altKey=((evt.modifiers&Event.ALT_MASK)>0);ctrlKey=((evt.modifiers&Event.CONTROL_MASK)>0);shiftKey=((evt.modifiers&Event.SHIFT_MASK)>0);}else{altKey=evt.altKey;ctrlKey=evt.ctrlKey;shiftKey=evt.shiftKey;}}else{altKey=evt.altKey;ctrlKey=evt.ctrlKey;shiftKey=evt.shiftKey;}
if(!altKey&&!ctrlKey&&o.enabled&&!o.readonly&&o.visible&&evt.keyCode==116){if(o.onF5press)o.onF5press.call(o,evt);r=false;}
if(!keys)keys=[13,10,9];if(!ctrlKey&&!altKey&&arrayIndexOf(keys,evt.keyCode)!=-1){if(!shiftKey)controller.next(o);else controller.next(o,true);r=false;}else{if(ctrlKey&&(evt.keyCode==10||evt.keyCode==13)&&o.name=='HTMLMemo'){o.input.value+='\n';}}
if(!r){if(evt.preventDefault){evt.preventDefault();evt.stopPropagation();}else{evt.keyCode=0;evt.returnValue=false;evt.cancelBubble=true;}
return false;}else return true;}
function markField(obj,type,canSelectOnFocus){if(obj&&obj.style&&type!='a'){backaux=obj.style.backgroundColor;obj.style.backgroundColor="";if(obj.select&&canSelectOnFocus)obj.select();}}
function unmarkField(obj,type,canSelectOnFocus){if(obj&&obj.style&&type!='a'){if(backaux!="")obj.style.backgroundColor=backaux;if(obj.unselect&&canSelectOnFocus)obj.unselect();}}
function findNode(node,name){var r=null;var id=node.id||node.name;if(id==name)r=node;if(!r){for(var i=0;i<node.childNodes.length;i++){r=findNode(node.childNodes.item(i),name);if(r)break;}}
return r;}
var TABLE=0;var CELLS=1;var ROWS=2;function getTable(rows,cols,width,height){var start=new Date().getTime();var lines=new Array(rows);var cells=new Array(rows);var table=document.createElement("table");var tbody=document.createElement("tbody");table.appendChild(tbody);table.setAttribute('border',0);table.setAttribute('cellSpacing',0);table.setAttribute('cellPadding',0);if(width)table.setAttribute('width',width);if(height)table.setAttribute('height',height);for(var i=0;i<rows;i++){cells[i]=new Array(cols);var tr=document.createElement("tr");tbody.appendChild(tr);lines[i]=tr;for(var j=0;j<cols;j++){cells[i][j]=document.createElement("td");tr.appendChild(cells[i][j]);}}
return[table,cells,lines];}
function getInnerTable(rows,cols,width,height){var store=new Array();store.push('<table border=0 cellspacing=0 cellpadding=0');if(width)store.push(' width='+width);if(height)store.push(' height='+height);store.push('>');for(var i=0;i<50;i++){store.push('<tr>');for(var j=0;j<50;j++){store.push('<td>');store.push('</td>');}
store.push('</tr>');}
store.push('</table>');return store.join('');}
function getSetTable(e1,e2,width,height){var table=getTable(1,2,width,height);table[CELLS][0][0].appendChild(e1);table[CELLS][0][1].appendChild(e2);return table[TABLE];}
function getLabel(description,wordWrap){var label=document.createElement("label");label.className='label';label.innerHTML=!wordWrap?description.replace(/\s/g,'&nbsp;'):description;return label;}
function pt(v){if(isNumeric(v))
return v;else{var r=parseInt(v.replace('px','').replace('pt',''));if(isNaN(r))
return document.body.scrollHeight;else
return r;}}
function getDiv(id,x,y,width,height,zindex,visibility){var div=document.createElement("div");if(x!==null&&x!==undefined)div.style.left=x+"px";if(y!==null&&y!==undefined)div.style.top=y+"px";if(width!==null&&width!==undefined)div.style.width=parseInt(width)+"px";if(height!==null&&height!==undefined){div.style.height=parseInt(height)+"px";div.style.minHeight=div.style.height;}
if(zindex!==null&&zindex!==undefined)div.style.zIndex=zindex;if(id)div.name=id;if(visibility){if(visibility==false||visibility=='hide'||visibility=='none'){div.style.display='none';}else{div.style.display='block';}}
return div;}
function visibleDiv(div,v){if(div){if(v){div.style.display='block';}else{div.style.display='none';}}}
function visibilityDiv(div,v){if(div){if(v){div.style.visibility='visible';}else{div.style.visibility='hidden';}}}
function isVisibleDiv(div){return div&&!!(div.offsetWidth||div.offsetHeight||div.getClientRects().length);}
function findPosX(obj){var curleft=0;if(obj.offsetParent){while(obj.offsetParent){curleft+=obj.offsetLeft-obj.scrollLeft;obj=obj.offsetParent;}}else if(obj.x)curleft+=obj.x;return curleft;}
function findPosY(obj){var curtop=0;if(obj.offsetParent){while(obj.offsetParent){curtop+=obj.offsetTop-obj.scrollTop;obj=obj.offsetParent;}}else if(obj.y)
curtop+=obj.y;return curtop;}
var preloaded=new Array();function preload(url){if(url&&url.length>0&&!preloaded[url]){var img=new Image(100,100);img.src=url;preloaded[url]=img;}}
var preloadedscripts;function loadScript(url,withAjax){if(!preloadedscripts)
preloadedscripts=new Array();if(url&&url.length>0&&!preloadedscripts[url]){if(!withAjax)doLoadScript(url);else doLoadScriptAjax(url);preloadedscripts[url]=true;}}
function loadDojo(url){if(!preloadedscripts)preloadedscripts=new Array();if(url&&url.length>0&&!preloadedscripts[url]){try{dojo.require(url);}catch(e){}
preloadedscripts[url]=true;}}
function doLoadScript(url){var oScript=document.createElement('script');oScript.setAttribute("type",'text/javascript');oScript.setAttribute("language",'JavaScript1.2');oScript.setAttribute("src",url);document.getElementsByTagName('head')[0].appendChild(oScript);}
var wfr_global=this;function wfr_eval(scriptFragment){return wfr_global.eval?wfr_global.eval(scriptFragment):eval(scriptFragment);}
function doLoadScriptAjax(u){var content=getContent(u);lastReceivedContent=content;wfr_eval(content);}
function getTextDiv(text,x,y,color,bgColor,wordWrap){var divText=this.getDiv('',x,y,0,0,6,true);divText.style.cursor='pointer';divText.style.backgroundColor=bgColor;var table=getTable(1,1,'0','0');var label=getLabel(text,wordWrap);label.style.color=color;table[CELLS][0][0].setAttribute('align','center');table[CELLS][0][0].setAttribute('valign','middle');table[CELLS][0][0].appendChild(label);divText.appendChild(table[TABLE]);return divText;}
function detectIE(){var ua=window.navigator.userAgent;var msie=ua.indexOf('MSIE ');if(msie>0){return parseInt(ua.substring(msie+5,ua.indexOf('.',msie)),10);}
var trident=ua.indexOf('Trident/');if(trident>0){var rv=ua.indexOf('rv:');return parseInt(ua.substring(rv+3,ua.indexOf('.',rv)),10);}
var edge=ua.indexOf('Edge/');if(edge>0){return parseInt(ua.substring(edge+5,ua.indexOf('.',edge)),10);}
return false;}
function cumulativeOffset(element){var top=0,left=0;do{top+=element.offsetTop||0;left+=element.offsetLeft||0;element=element.offsetParent;}while(element);return{top:top,left:left};};function isNumeric(sText){if(typeof sText=='number')return true;sText=""+sText;var ValidChars="0123456789.";var IsNumber=true;var Char;for(i=0;i<sText.length&&IsNumber==true;i++){Char=sText.charAt(i);if(ValidChars.indexOf(Char)==-1){IsNumber=false;}}
return IsNumber;}
function isMobile(){if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)||navigator.userAgent.match(/Windows Phone/i))return true;return false;}
function capitalizeFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1);}
function arrayConcat(arr1,arr2){var r=new Array();if(arr1){for(var i=0;i<arr1.length;i++)
r.push(arr1[i]);}
if(arr2){for(var i=0;i<arr2.length;i++)
r.push(arr2[i]);}
return r;}
(function(){function ScrollBar(barParent,viewport,totalSize,rowHeight,position,nameTable){var bar;var fluxo;var formCode=(window.$mainform().d.WFRForm?window.$mainform().d.WFRForm.formID.value:null);var getRowNumber=function(){return 0;};var mouseDrag=false;var originalOffset;var params=[];var positionSize;var positionXY;var scroll=0;var scrollIntervalID;var sysCode=(window.$mainform().d.WFRForm?window.$mainform().d.WFRForm.sys.value:window.$mainform().sysCode);var thumb;var thumbRange=0;var viewportSize=0;nomeTabela=nameTable;if(position==="top"){positionSize="height";positionXY="Y";}else{positionSize="width";positionXY="X";}
bar=document.createElement("div");bar.object=this;bar.className="HTMLScrollBar";barParent.appendChild(bar);thumb=document.createElement("div");thumb.className="HTMLScrollThumb"+positionXY;thumb.style[position]="0px";bar.appendChild(thumb);if(position==="top"){getRowNumber=function(){var linha=scroll/thumbRange*(totalSize-viewportSize)/rowHeight;linha=Math.round(linha*10)/10;return linha;};this.setVerticalScroll=function(pixels){scroll=Math.min(Math.max(pixels,0),thumbRange);thumb.style.top=scroll+"px";if(fluxo!==undefined){window.executeJSRuleNoField(sysCode,formCode,fluxo,[getRowNumber()].concat(params),true);}};this.setNewSQL=function(pixels,SQL){params[3]=SQL;};this.moveVerticalScroll=function(pixels){var novaposition=thumbRange/((totalSize-viewportSize)/pixels)+scroll;scroll=Math.min(Math.max(novaposition,0),thumbRange);thumb.style.top=scroll+"px";if(fluxo!==undefined){window.executeJSRuleNoField(sysCode,formCode,fluxo,[getRowNumber()].concat(params),true);}};}
this.reloadThumb=function(){var thumbSize;viewportSize=parseFloat(window.getComputedStyle(viewport)[positionSize]);thumbSize=parseFloat(window.getComputedStyle(barParent)[positionSize])*viewportSize/totalSize;thumb.style[positionSize]=Math.min(thumbSize,parseFloat(window.getComputedStyle(barParent)[positionSize]))+"px";thumbRange=parseFloat(window.getComputedStyle(barParent)[positionSize])-
parseFloat(window.getComputedStyle(thumb)[positionSize]);if(position==="left"){thumb.style.left=(viewport.scrollLeft*thumbRange/(totalSize-viewportSize))+"px";}};this.reloadThumb();this.getTotalSize=function(){return totalSize;};this.setTotalSize=function(pixels){if(totalSize!==pixels){totalSize=pixels;this.reloadThumb();}};this.getTotalRows=function(){return totalSize/rowHeight;};this.setMoveFlow=function(pFluxo,pParams){fluxo=pFluxo;if(pParams instanceof Array){params=pParams;}};this.runMoveFlow=function(){if(typeof fluxo==="string"){window.executeJSRuleNoField(sysCode,formCode,fluxo,[getRowNumber()].concat(params),true);}};var fmousemove=function(event){var e=event||window.event;if(mouseDrag){var novoValorPosition=e["client"+positionXY]-bar.getBoundingClientRect()[position]-originalOffset;thumb.style[position]=Math.min(Math.max(novoValorPosition,0),thumbRange)+"px";scroll=parseFloat(thumb.style[position]);if(position==="top"){if(fluxo!==undefined){window.executeJSRuleNoField(sysCode,formCode,fluxo,[getRowNumber()].concat(params),true);}}else{viewport.scrollLeft=(totalSize-parseFloat(window.getComputedStyle(viewport)[positionSize]))*parseFloat(thumb.style[position])/thumbRange;}}else if(e["offset"+positionXY]!==undefined||typeof e.target.getBoundingClientRect==="function"){originalOffset=e["offset"+positionXY]||e["page"+positionXY]-e.target.getBoundingClientRect()[position];}};var fmousedown=function(event){var e=event||window.event;if(e.which===1){originalOffset=e["offset"+positionXY]||e["page"+positionXY]-e.target.getBoundingClientRect()[position];if(e.target===thumb){document.body.style.webkitUserSelect="none";document.body.style.MozUserSelect="none";document.body.style.msUserSelect="none";document.body.style.userSelect="none";mouseDrag=true;}else if(e.target===bar){var acima=(originalOffset<parseFloat(thumb.style[position]))?-1:1;scrollIntervalID=window.setInterval(function(){if((acima<0&&originalOffset>parseFloat(thumb.style[position]))||(acima>0&&originalOffset<(parseFloat(thumb.style[position])+
parseFloat(window.getComputedStyle(thumb)[positionSize])))){window.clearInterval(scrollIntervalID);}else if(position==="top"){bar.object.moveVerticalScroll(acima*parseFloat(window.getComputedStyle(viewport)[positionSize]));}else{viewport.scrollLeft+=acima*parseFloat(window.getComputedStyle(viewport)[positionSize]);thumb.style[position]=viewport.scrollLeft*(parseFloat(window.getComputedStyle(barParent)[positionSize])-parseFloat(window.getComputedStyle(thumb)[positionSize]))/(totalSize-parseFloat(window.getComputedStyle(viewport)[positionSize]))+"px";}},50);}}};var fmouseup=function(){document.body.style.removeProperty("-webkit-user-select");document.body.style.removeProperty("-moz-user-select");document.body.style.removeProperty("-ms-user-select");document.body.style.removeProperty("user-select");window.clearInterval(scrollIntervalID);mouseDrag=false;};document.addEventListener("mousemove",fmousemove,false);bar.addEventListener("mousedown",fmousedown,false);document.addEventListener("mouseup",fmouseup,false);var touchStartBarY=0;bar.addEventListener("touchstart",function(e){if(e.touches&&e.touches.length>0){touchStartBarY=e.touches[0].screenY;}},false);bar.addEventListener("touchmove",function(e){if(e.touches&&e.touches.length>0){if(Math.abs(e.touches[0].screenY-touchStartY)>=20){if(e.cancelable)
e.preventDefault();}
fwheel({deltaY:(touchStartBarY-e.touches[0].screenY)*-0.06});}},false);if(position==="top"){var fwheel=function(event){var e=event||window.event,deltaY;if(e.deltaMode===e.DOM_DELTA_PIXEL){deltaY=e.deltaY;}else if(e.deltaMode===e.DOM_DELTA_LINE){deltaY=e.deltaY*rowHeight;}else{deltaY=e.deltaY*parseFloat(window.getComputedStyle(viewport).height);}
bar.object.moveVerticalScroll(deltaY);if(e&&e.preventDefault)
e.preventDefault();};viewport.addEventListener("wheel",fwheel,false);var touchStartY=0;viewport.addEventListener("touchstart",function(e){if(e.touches&&e.touches.length>0){touchStartY=e.touches[0].screenY;}},false);viewport.addEventListener("touchmove",function(e){if(e.touches&&e.touches.length>0){if(Math.abs(e.touches[0].screenY-touchStartY)>=20){if(e.cancelable)
e.preventDefault();}
fwheel({deltaY:(touchStartY-e.touches[0].screenY)*0.06});}},false);}else{var fscroll=function(){thumb.style.left=thumbRange*viewport.scrollLeft/(totalSize-parseFloat(window.getComputedStyle(viewport).width))+"px";};viewport.addEventListener("scroll",fscroll,false);}}
window.$mainform().newScrollBar=function(barParent,viewport,totalSize,rowHeight,position,nameTable){return new ScrollBar(barParent,viewport,totalSize,rowHeight,position,nameTable);};}());function resizeComponentTable(){if(typeof d.n==="object"&&d.n.responsive){var activeSearchTab=true;var winDocument=window.$mainform().document;var newWidthIntermediateTwo=0;var newWidthColHeader=0;var currentComponent=[];var currentWindowWidth=window.innerWidth;var searchTab=window.parent.parent.document.getElementsByClassName('HTMLPage');if(searchTab.length>0){var i=1;while(i<=searchTab.length){if(searchTab[i-1].src){activeSearchTab=searchTab[i-1].src.indexOf('basic_query')>=0?true:false;i=searchTab.length;}
i++;}}else{activeSearchTab=false;}
if(!activeSearchTab)
getWidthLay();var percentResize=(currentWindowWidth*100/WIDTH_WINDOW)/100;var widthHeaderCellSeparador=0;WIDTH_WINDOW=currentWindowWidth;if(LIST_RESIZE_TABLE.length>0){for(t=0;t<LIST_RESIZE_TABLE.length;t++){var componentList=winDocument.getElementById(LIST_RESIZE_TABLE[t]);if(componentList){currentComponent.push(componentList);}}}else{currentComponent=winDocument.getElementsByClassName('HTMLTable');}
for(i=0;i<currentComponent.length;i++){currentComponent[i].style.width=Math.round(parseInt(currentComponent[i].style.width)*percentResize)+'px';var headerTable=winDocument.getElementById(currentComponent[i].id+'_cabecalho');var tableIntermediateTwo=winDocument.getElementById(currentComponent[i].id+'_intermediaria_2');var headerCells=headerTable.getElementsByClassName("HTMLTableHeaderCell");var headerCellSeparator=headerTable.getElementsByClassName("HTMLTableHeaderCellSeparator");for(j=0;j<headerCells.length;j++){if(headerCells[j].style.width){newWidthColHeader=Math.round(parseInt(window.getComputedStyle(headerCells[j]).width)*percentResize);widthHeaderCellSeparador=parseInt(window.getComputedStyle(headerCellSeparator[j]).width);newWidthIntermediateTwo=newWidthIntermediateTwo+newWidthColHeader+widthHeaderCellSeparador;var sheetStyle='#'+headerCells[j].id+', '+'#'+currentComponent[i].id+' .HTMLTableBodyCell:nth-child('+(j+1)+'), '+'#'+currentComponent[i].id+' .HTMLTableBodyCell:nth-child('+(j+1)+') [webrun-type="HTMLLookup"], '+'#'+currentComponent[i].id+' .HTMLTableBodyCell:nth-child('+(j+1)+') [webrun-type="HTMLComboBox"], '+'#'+currentComponent[i].id+' .HTMLTableBodyCell:nth-child('+(j+1)+') [webrun-type="HTMLEdit"] '+'{ width:'+newWidthColHeader+'px !important; height: 100% !important; padding: 0; border-radius: 0; }\n'+'#'+currentComponent[i].id+' .HTMLTableHeaderSearch [webrun-type="HTMLEdit"]:nth-child('+(j+1)+'), '+'#'+currentComponent[i].id+' .HTMLTableHeaderSearch [webrun-type="HTMLEdit"]:nth-child('+(j+1)+') > input, '+'#'+currentComponent[i].id+' .HTMLTableHeaderSearch [webrun-type="HTMLEdit"]:nth-child('+(j+1)+') > .input-group, '+'#'+currentComponent[i].id+' .HTMLTableHeaderSearch [webrun-type="HTMLEdit"]:nth-child('+(j+1)+') > .input-group > input '+'{ width:'+(newWidthColHeader+2)+'px !important; height: 100% !important; padding: 0; border-radius: 0; }';var resizeColHeader=winDocument.getElementById(currentComponent[i].id+"RedimensionarLarguraColuna"+(j+1));if(resizeColHeader){resizeColHeader.innerHTML=sheetStyle;}else{var elementStyle=winDocument.createElement('style');elementStyle.id=currentComponent[i].id+"RedimensionarLarguraColuna"+(j+1);elementStyle.innerHTML=sheetStyle;winDocument.head.appendChild(elementStyle);}}}
tableIntermediateTwo.style.width=newWidthIntermediateTwo+'px';newWidthIntermediateTwo=0;if(window.$mainform().__storage[currentComponent[i].id+'autoajuste_conteudo']){var objectVerticalScroll=winDocument.getElementById(currentComponent[i].id+'_rolagem_vertical').childNodes[0].object;var heightBodyTwo=parseInt(window.getComputedStyle(winDocument.getElementById(currentComponent[i].id+'_corpo_2')).height);objectVerticalScroll.setVerticalScroll(0);objectVerticalScroll.setTotalSize(heightBodyTwo);}}
LIST_RESIZE_TABLE=[];}}
function getWidthLay(){if(DIMENSION_LAY){var widthLay=parseInt(document.getElementById("lay").style.width);if(widthLay!==WIDTH_WINDOW)WIDTH_WINDOW=widthLay;DIMENSION_LAY=false;}}
function clearStyleTable(){};function webrunCloseAllForms(){try{closeFormHierarchy(mainform.idForm);if(!mainform.isPrincipal){ebfCloseForm();}}catch(e){console.error(e);}}
function verifyObjectType(object,clazz){if(object&&object instanceof HTMLElementBase)return object.name===clazz;return false;}
function webrunLoadOnmessage(){if(webrunBroadcast){webrunBroadcast.onmessage=function(event){if(mainform&&event.data&&(decodeURI(mainform.formGUID)===event.data.formGUID||decodeURI(mainform.idForm)===event.data.idForm)&&event.data.action){switch(event.data.action.toLowerCase()){case'wef':webrunExecuteFlow(event);break;case'wcc':webrunChangeComponent(event);break;case'wrc':webrunRefreshComponent(event);break;case'wgc':webrunGetComponentValue(event);break;case'wea':webrunExecuteAction(event);break;case'wex':handleException(event.data.msg);break;case'wle':if(mainSystemFrame&&mainSystemFrame.SESSION_ID&&event.data.sessionId&&mainSystemFrame.SESSION_ID!=event.data.sessionId){webrunBroadcast.postMessage({action:"wcf"});webrunCloseAllForms();showSessionMismatchModal();}
break;}}else if(mainform&&event.data&&event.data.action){switch(event.data.action.toLowerCase()){case'wcf':webrunCloseAllForms();break;}}}}};function webrunCloseChannel(){if(webrunBroadcast)webrunBroadcast.close();};function webrunExecuteFlow(event){let flow=event.data.flow;if(flow){let params=event.data.params?event.data.params:new Array();let response=executeJSRuleNoField(mainform.sysCode,mainform.idForm,flow,params);if(event.data.callback){let jsonResponse=webrunGetJSONCallback(event,response);webrunBroadcast.postMessage(jsonResponse);}}};function webrunChangeComponent(event){let comp=$c(event.data.component);if(comp)comp.setValue(event.data.value);else{let msg=getLocaleMessage('ERROR.COMPONENT_FIELD_NOT_FOUND',event.data.component);let jsonResponse=webrunGetJSONException(event.data.formTarget,msg);webrunBroadcast.postMessage(jsonResponse);}};function webrunGetComponentValue(event){let comp=$c(event.data.component);if(comp){if(event.data.callback){let response=comp.getValue();let jsonResponse=webrunGetJSONCallback(event,response);webrunBroadcast.postMessage(jsonResponse);}}else{let msg=getLocaleMessage('ERROR.COMPONENT_FIELD_NOT_FOUND',event.data.component);let jsonResponse=webrunGetJSONException(event.data.formTarget,msg);webrunBroadcast.postMessage(jsonResponse);}};function webrunRefreshComponent(event){let comp=$c(event.data.component);if(comp)comp.refresh();else{let msg=getLocaleMessage('ERROR.COMPONENT_FIELD_NOT_FOUND',event.data.component);let jsonResponse=webrunGetJSONException(event.data.formTarget,msg);webrunBroadcast.postMessage(jsonResponse);}};function webrunGetJSONException(form,msg){let jsonException={};jsonException.formGUID=form;jsonException.action="wex";jsonException.msg=msg;return jsonException;};function webrunExecuteAction(event){try{let comp=$c(event.data.component);let method=event.data.method;if(comp&&method){let params=event.data.params?event.data.params:new Array();comp.callMethod(comp.instance,method,params);}}catch(e){console.error("WebrunBroadcast: uma exceÁ„o ocorreu ao executar a aÁ„o.\nDetalhes:"+e)}};function webrunGetJSONCallback(event,response){let params=event.data.callbackParams?event.data.callbackParams:new Array();params[0]=response;let jsonCallback={};jsonCallback.formGUID=event.data.formTarget;jsonCallback.action="wef";jsonCallback.flow=event.data.callback;jsonCallback.params=params;return jsonCallback;}
function ImageObject(){}
ImageObject.inherits(HTMLObject);ImageObject.prototype.name='Image';ImageObject.prototype.getImage=function(src,alt,oc,h,w){var img=document.createElement("img");img.setAttribute('src',src);img.setAttribute('border','0');if(alt){img.setAttribute('alt',alt);img.setAttribute('title',alt);}
if(oc){this.attachEvent(img,'click',oc);img.className='cur';}
if(h)img.setAttribute('height',h);if(w)img.setAttribute('width',w);return img;};ImageObject.prototype.toString=function(){return'[object '+this.name+']';};document.write("<script type=\"text/javascript\" src=\"wfr_masks.js\"></script>");let resize_grid,initContainer=false;var containerComponentsDesign=[];function HTMLElementBase(sys,formID,code,posX,posY,width,height,description,value){this.create(sys,formID,code,posX,posY,width,height,description,value);}
HTMLElementBase.inherits(HTMLObject);HTMLElementBase.prototype.name='HTMLElementBase';HTMLElementBase.prototype.tabKeys=[9,10,13];HTMLElementBase.prototype.tabable=true;HTMLElementBase.prototype.zindex=1;HTMLElementBase.prototype.tagName='input';HTMLElementBase.prototype.canSelectOnFocus=true;HTMLElementBase.prototype.canCheckRegularExpression=false;HTMLElementBase.prototype.create=function(sys,formID,code,posX,posY,width,height,description,value){this.loadScripts();this.sys=sys;this.formID=formID;this.code=code;this.posX=posX;this.posY=posY;this.width=parseInt(width);this.height=parseInt(height);this.value=normalizeRuleParam(value,true);this.font=null;this.size=null;this.description=description;this.enabled=true;this.visible=true;this.readonly=false;this.required=false;this.focuzed=false;this.dependent=false;this.tabindex=0;this.maskSuport=false;this.componentDependences=[];this.decorationChanged=false;this.remainNotDBAwareValue=true;};HTMLElementBase.prototype.getBaseDiv=function(root,x,y,width,height){var div=getDiv("WFRComponent"+this.code,x,y,width,height,this.zindex);div.className="form-group";if(root)div.setAttribute("webrun-type",this.name);return div;};HTMLElementBase.prototype.beforeSubmit=function(){};HTMLElementBase.prototype.afterSubmit=function(){};HTMLElementBase.prototype.setX=function(posX){this.posX=parseInt(posX);if(this.div)this.div.style.left=this.posX+"px";};HTMLElementBase.prototype.setY=function(posY){this.posY=parseInt(posY);if(this.div)this.div.style.top=this.posY+"px";};HTMLElementBase.prototype.setWidth=function(width){this.width=parseInt(width);if(this.div){this.div.style.width=this.width+"px";if(this.div!=this.context)this.context.style.width=this.div.style.width;if(this.input)this.input.style.width=this.div.style.width;}};HTMLElementBase.prototype.setHeight=function(height){this.height=parseInt(height);if(this.div){this.div.style.height=this.height+"px";if(this.div!=this.context)this.context.style.height=this.div.style.height;if(this.input)this.input.style.height=this.div.style.height;}};HTMLElementBase.prototype.setStyleCss=function(styleCss){this.setAttribute("style",styleCss);};HTMLElementBase.prototype.setValue=function(value,checkDependences){value=normalizeRuleParam(value,true);var temp=this.getValue();this.value=value;if(this.input)this.input.value=value;if(trim(this.value)!=trim(temp))this.changeAction(null,this,!checkDependences);};HTMLElementBase.prototype.setDescription=function(description){this.description=description;if(this.label&&this.label.setDescription){this.label.setDescription(description.replace(/\s/g,'&nbsp;'));}else if(this.label)this.label.innerHTML=description.replace(/\s/g,'&nbsp;');};HTMLElementBase.prototype.setColor=function(color){this.color=color;if(this.div)this.div.style.color=color;};HTMLElementBase.prototype.setBGColor=function(color){this.bgColor=color;if(this.div)this.div.style.backgroundColor=color;};HTMLElementBase.prototype.setEnabled=function(v){this.enabled=parseBoolean(v);if(this.input)this.input.disabled=!this.enabled||this.readonly;if(this.div){if(this.enabled)this.div.style.removeProperty("pointer-events");else this.div.style.setProperty("pointer-events","none");}};HTMLElementBase.prototype.setVisible=function(v){this.visible=parseBoolean(v);if(this.div){if(this.visible)this.div.style.display=null;else this.div.style.setProperty("display","none","important");}};HTMLElementBase.prototype.isTrueVisible=function(){return this.div&&(this.visible||isVisibleDiv(this.div));};HTMLElementBase.prototype.setReadOnly=function(v){this.readonly=parseBoolean(v);if(this.input)this.input.readOnly=v;};HTMLElementBase.prototype.focus=function(){var r=this.tabable&&this.enabled&&this.isTrueVisible()&&!this.readonly&&!this.resizable&&!this.draggable;if(this.doc)r=r&&isVisibleDiv(this.doc);if(r&&this.input){this.input.focus();this.focuzed=true;}
return r;};HTMLElementBase.prototype.getTabName=function(){return this.doc.tabName;};HTMLElementBase.prototype.getFocus=function(fromKeyBoard){try{if(this.tabable&&this.enabled&&this.isTrueVisible()&&!this.readonly&&!this.resizable&&!this.draggable){if(this.doc&&this.doc.focus&&this.doc.canFocus!=null&&!this.doc.canFocus.call(this))return false;this.fromKeyBoard=fromKeyBoard;try{if(!this.doc.focus.isHTMLAction)this.doc.focus();else this.doc.focus.call(this);}catch(e){}
return this.focus();}else return false;}catch(e){return false;}};HTMLElementBase.prototype.blur=function(){var r=this.enabled&&this.isTrueVisible()&&!this.readonly;if(r&&this.input){this.input.blur();this.focuzed=false;}
return r;};HTMLElementBase.prototype.updateLabel=function(){};HTMLElementBase.prototype.setFont=function(f){this.font=f;if(this.input)this.input.style.fontFamily=f;if(this.label){if(this.label.setFont)this.label.setFont(f);else this.label.style.fontFamily=f;this.updateLabel();}};HTMLElementBase.prototype.setSize=function(s){if(s.toString().indexOf("pt")==-1)s+="pt";this.size=s;if(this.input)this.input.style.fontSize=s;if(this.label){if(this.label.setSize)this.label.setSize(s);else this.label.style.fontSize=s;this.updateLabel();}};HTMLElementBase.prototype.setWeight=function(w){this.weight=w;if(this.input){if(w)this.input.style.fontWeight="bold";else this.input.style.fontWeight="normal";}
if(this.label){if(w)this.label.style.fontWeight="bold";else this.label.style.fontWeight="normal";}};HTMLElementBase.prototype.setItalic=function(w){this.italic=w;if(this.input){if(w)this.input.style.fontStyle="italic";else this.input.style.fontStyle="normal";}
if(this.label){if(w)this.label.style.fontStyle="italic";else this.label.style.fontStyle="normal";}};HTMLElementBase.prototype.setUnderline=function(u){this.underline=u;this.setTextDecoration();};HTMLElementBase.prototype.setStrikeout=function(st){this.strikeout=st;this.setTextDecoration();};HTMLElementBase.prototype.setTextDecoration=function(){var textDecoration="";if(this.underline||this.strikeout){if(this.underline)textDecoration+="underline";if(this.strikeout)textDecoration+=" line-through";}else textDecoration="none";if(this.input)this.input.style.textDecoration=textDecoration;if(this.label)this.label.style.textDecoration=textDecoration;};HTMLElementBase.prototype.hasEmptyValue=function(){return(this.getValue()=='');};HTMLElementBase.prototype.setDecoration=function(f,s,w,i,u,st,bc,c){this.decorationChanged=true;this.font=f;this.size=s;this.weight=w;this.italic=i;this.underline=u;this.strikeout=st;this.bgColor=bc;this.color=c;};HTMLElementBase.prototype.getHint=function(){return this.hint;};HTMLElementBase.prototype.setHint=function(hint,element){this.hint=hint;let target=element?element:this.input;if(target){let init=target.hint?false:true;if(target.getAttribute("data-original-title")){target.setAttribute("data-original-title",hint.replace(/(?:\r\n|\r|\n)/g,'<br />'));}else{target.setAttribute("data-toggle","tooltip");target.setAttribute("data-html","true");target.hint=hint;target.title=hint.replace(/(?:\r\n|\r|\n)/g,'<br />');if(init)bootstrapInitTooltip(target);}}};HTMLElementBase.prototype.getSystem=function(){return this.sys;};HTMLElementBase.prototype.getForm=function(){return this.formID;};HTMLElementBase.prototype.getCode=function(){return this.code;};HTMLElementBase.prototype.getX=function(){return this.posX;};HTMLElementBase.prototype.getY=function(){return this.posY;};HTMLElementBase.prototype.getWidth=function(){return this.width;};HTMLElementBase.prototype.getHeight=function(){return this.height;};HTMLElementBase.prototype.getValue=function(){return this.value;};HTMLElementBase.prototype.getShowValue=function(){return this.getValue();};HTMLElementBase.prototype.getGridShowValue=function(element,row,index,oldValue,dataArray){return dataArray[index];};HTMLElementBase.prototype.getDescription=function(){return this.description;};HTMLElementBase.prototype.getColor=function(){return this.color?this.color:'';};HTMLElementBase.prototype.getBGColor=function(){return this.bgColor;};HTMLElementBase.prototype.getStyle=function(){return this.input.style;};HTMLElementBase.prototype.getFont=function(){return this.font?this.font:'';};HTMLElementBase.prototype.getSize=function(){return this.size;};HTMLElementBase.prototype.isRequired=function(){return this.required;};HTMLElementBase.prototype.getVisible=function(){return this.visible;};HTMLElementBase.prototype.getEnabled=function(){return this.enabled;};HTMLElementBase.prototype.getReadOnly=function(){return this.readonly;};HTMLElementBase.prototype.canRemainNotDBAwareValue=function(){return!this.isDBAware()&&this.remainNotDBAwareValue;};HTMLElementBase.prototype.ensureVisibility=function(){if(!this.getVisible()){this.setVisible(true);this.setVisible(false);}};HTMLElementBase.prototype.toString=function(){if(this.description&&this.description.length>0)return'[object '+this.name+': '+this.description+']';else return'[object '+this.name+']';};HTMLElementBase.prototype.decorateRequired=function(text,required){if(required)return text+'<span class="text-danger">&nbsp;*</span>';else return text;};HTMLElementBase.prototype.getDiv=function(id,x,y,w,h,zindex,visibility){return getDiv(id,x,y,w,h,zindex,visibility);};HTMLElementBase.prototype.setReadOnlyDiv=function(v){if(!this.readOnlyDiv){this.readOnlyDiv=this.getDiv("ReadOnlyDiv"+this.code,0,0,"100%","100%",100005,true);this.readOnlyDiv.style.position="absolute";this.readOnlyDiv.style.top="0px";this.readOnlyDiv.style.left="0px";this.readOnlyDiv.style.right="0px";this.readOnlyDiv.style.bottom="0px";}
if(!v){if(containsNode(this.div,this.readOnlyDiv)){this.div.removeChild(this.readOnlyDiv);}}else{if(!containsNode(this.div,this.readOnlyDiv)){this.div.appendChild(this.readOnlyDiv);}}};HTMLElementBase.prototype.design=function(doc,tabControl){this.doc=doc;this.div=this.getBaseDiv(true,this.posX,this.posY,this.width,this.height);this.divClass=this.div.className;if(verifyObjectType(this,'HTMLContainer')&&this.container){if(doc){doc.appendChild(this.div);}else{let elem=this;initContainer=true;containerComponentsDesign.push(function(){document.getElementById(elem.container).appendChild(elem.div);elem.afterInit();});doc=d.t.getDiv();doc.appendChild(this.div);}}else{doc.appendChild(this.div);}
this.context=this.div;this.designComponent(doc,tabControl);this.init(tabControl);if(initContainer&&!verifyObjectType(this,'HTMLContainer')){if(window.containerComponentsDesign){while(containerComponentsDesign.length>0){containerComponentsDesign.shift()();}}
initContainer=false;}};HTMLElementBase.prototype.getPermissionDescription=function(){if(!isNullable(this.description))return this.description;return this.code+" - "+this.id;};HTMLElementBase.prototype.toPermissionMode=function(){this.divPermission=document.createElement("div");this.divPermission.className="position-absolute";this.divPermission.style.top=this.div.style.top;this.divPermission.style.left=this.div.style.left;this.divPermission.style.width=this.div.style.width;this.divPermission.style.height=this.div.style.height;this.divPermission.style.cursor="pointer";this.divPermission.style.zIndex=this.div.style.zIndex?(parseInt(this.div.style.zIndex)+1).toString():"100000";this.divPermission.setAttribute("data-toggle","popover");this.divPermission.setAttribute("title",this.name);this.divPermission.setAttribute("data-content",'<ul class="list-group list-group-flush p-0">'+'<li class="list-group-item py-1"><b>'+getLocaleMessage("LABEL.FORM")+':</b> '+this.formID+'</li>'+'<li class="list-group-item py-1"><b>'+getLocaleMessage("LABEL.CODE")+':</b> '+this.code+'</li>'+'<li class="list-group-item py-1"><b>ID:</b> '+this.id+'</li>'+'<li class="list-group-item py-1"><b>'+getLocaleMessage("LABEL.DESCRIPTION")+':</b> '+this.description+'</li>'+'</ul>');this.doc.appendChild(this.divPermission);$(this.divPermission).popover({template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body p-0"></div></div>',html:true,trigger:"hover",delay:200});this.attachEvent(this.divPermission,'click',this.permissionClick);};HTMLElementBase.prototype.permissionClick=function(doc){try{$(this.divPermission).popover("hide");}catch(e){}
openComAccess(this.sys,this.formID,this.code,document.title,this.getPermissionDescription());};HTMLElementBase.prototype.designComponent=function(doc){this.context.innerHTML=this.value;};HTMLElementBase.prototype.reDesign=function(){this.free(true);this.div.innerHTML='';this.designComponent(this.doc);};HTMLElementBase.prototype.freeComponent=function(){};HTMLElementBase.prototype.free=function(dontRemoveFromDoc,dontCallEvents){controller.remove(this);arrayRemove(orderTab,this);if(!dontCallEvents&&this.ondelete){this.ondelete.call(this,null);}
this.freeComponent();if(!dontRemoveFromDoc&&this.doc&&this.div){this.doc.removeChild(this.div);this.div=null;}
if(this.divDragComponent){this.doc.removeChild(this.divDragComponent);this.divDragComponent=null;}
return this;};HTMLElementBase.prototype.setEvent=function(evt,func){this[evt.replace('on','')]=func;};HTMLElementBase.prototype.init=function(tabControl){if(this.hint)this.setHint(this.hint);if(this.Acessivel=="1"){this.zindex=1000000;if(this.div)this.div.style.zIndex=this.zindex;}
if(this.bgColor)this.setBGColor(this.bgColor);if(this.color)this.setColor(this.color);if(this.font)this.setFont(this.font);if(this.size)this.setSize(this.size);if(this.weight)this.setWeight(this.weight);if(this.italic)this.setItalic(this.italic);this.setTextDecoration();if(!this.enabled)this.setEnabled(this.enabled,true);if(this.readonly)this.setReadOnly(this.readonly,true);if(!this.visible)this.setVisible(this.visible,true);if(this.designDragComponent&&(this.draggable||this.resizable)){this.designDragComponent(this.doc);}
if(this.mobileInput){this.attachEvent(this.mobileInput,'focus',this.focusAction);this.attachEvent(this.mobileInput,'blur',this.blurAction);this.attachEvent(this.mobileInput,'keydown',this.keydownAction);this.attachEvent(this.mobileInput,'click',this.clickAction);if(this.onkeypress){var idxEnter=this.tabKeys.indexOf(13);if(idxEnter!=-1)this.tabKeys=arrayIndexRemove(this.tabKeys,idxEnter);}
this.attachEvent(this.mobileInput,'keypress',this.keypressAction);this.attachEvent(this.mobileInput,'keyup',this.keyupAction);}else if(this.input){this.attachEvent(this.input,'focus',this.focusAction);this.attachEvent(this.input,'blur',this.blurAction);this.attachEvent(this.input,'keydown',this.keydownAction);this.attachEvent(this.input,'click',this.clickAction);if(!(verifyObjectType(this,'HTMLLookup'))&&!(verifyObjectType(this,'HTMLCheckBox'))){this.attachEvent(this.input,'change',this.changeAction);}
if(this.onkeypress){var idxEnter=this.tabKeys.indexOf(13);if(idxEnter!=-1)this.tabKeys=arrayIndexRemove(this.tabKeys,idxEnter);}
this.attachEvent(this.input,'keypress',this.keypressAction);this.attachEvent(this.input,'keyup',this.keyupAction);}
if(verifyObjectType(this,'HTMLGrid')){this.attachEvent(this.div,'keydown',this.keydownAction);}
if(tabControl)controller.addTabable(this);else controller.addNotTabable(this);this.designMask();if(!(verifyObjectType(this,'HTMLContainer')&&this.container&&this.doc==null)){this.afterInit();}
if(this.permissionMode){this.toPermissionMode();}};HTMLElementBase.prototype.afterInit=function(){if(!this.tab&&this.doc&&this.doc.tab){this.tab=this.doc.tab;try{if(this.onFormEditMode&&this.tab.editMode){this.onFormEditMode();}else if(this.onFormViewMode&&!this.tab.editMode){this.onFormViewMode();}}catch(e){}}
if(this.div&&this.id!=undefined)this.div.id=this.id;if(this.div&&document.n&&document.n.responsive){var isNavigationFormElement=this.name.indexOf("HTMLNavigationForm")!==-1;var isPagingElement=this.name.indexOf("HTMLPaging")!==-1;var isNavigationGridButton=this.name.indexOf("HTMLNavigationButton")!==-1;var isRadioGroupOption=this.name.indexOf("HTMLRadioGroupOption")!==-1;var isGridElement=this.name.indexOf("HTMLGrid")!==-1;var isGridChild=!isGridElement&&(function(elem,grids){for(var cont=0;cont<grids.length;cont+=1){if(grids[cont].contains(elem))return true;}
return false;}(this.div,document.getElementsByClassName("grid")));if(!isNavigationFormElement&&!isGridChild&&!isPagingElement&&!isNavigationGridButton&&!isRadioGroupOption&&!this.fullscreen){var pscreen=this.container?parseInt($c(this.container)?$c(this.container).width:window.getComputedStyle(document.getElementById(this.container)).width):parseInt(document.getElementById("lay").style.width,10);this.div.style.width=(this.width*100/pscreen)+"%";this.div.style.left=(this.posX*100/pscreen)+"%";}}
if(this.styleCss&&this.styleCss.length>0){this.styleCss=this.styleCss.trim();if(this.styleCss.indexOf(".")==0||this.styleCss.indexOf("#")==0){var style=document.createElement("style");style.innerHTML=this.styleCss;document.body.appendChild(style);}else{this.div.setAttribute("style",this.styleCss);}}
if(this.classCss&&this.classCss.trim().length>0&&!this.classCssDefined){this.div.className=this.classCss.trim();this.divClass=this.div.className;}};HTMLElementBase.prototype.clickAction=function(e,o){if(this.enabled&&this.isTrueVisible()){controller.activeElement=this;if(this.onclick)return this.onclick.call(this,e);}
return true;};HTMLElementBase.prototype.keydownAction=function(e){if(this.enabled&&this.isTrueVisible()&&!this.readonly){var r=checkKey(e,this,this.tabKeys);if(this.onkeydown)r=this.onkeydown(e);return r;}
return true;};HTMLElementBase.prototype.keyupAction=function(e){if(this.enabled&&this.isTrueVisible()&&!this.readonly){var r=true;if(this.mask)r=this.mask.getKeyPress(e,this.input,null,this);if(this.onkeyup)r=this.onkeyup(e);return r;}else return true;};HTMLElementBase.prototype.keypressAction=function(e){if(this.enabled&&this.isTrueVisible()&&!this.readonly){var keyCode=e.keyCode||e.which;var r=true;if(this.onkeypress){var altKey=false;var ctrlKey=false;var shiftKey=false;var target=e.target||e.srcElement;var targtype=target.type;var chr=String.fromCharCode(keyCode);if(w3c){if(document.layers){altKey=((e.modifiers&Event.ALT_MASK)>0);ctrlKey=((e.modifiers&Event.CONTROL_MASK)>0);shiftKey=((e.modifiers&Event.SHIFT_MASK)>0);}else{altKey=e.altKey;ctrlKey=e.ctrlKey;shiftKey=e.shiftKey;}}else{altKey=e.altKey;ctrlKey=e.ctrlKey;shiftKey=e.shiftKey;}
var checkSpecialKey=!(isChrome||IE);if(checkSpecialKey&&currentBrowser.SpecialKeys[e.keyCode]){chr=currentBrowser.SpecialKeys[e.keyCode].toUpperCase();}
r=this.onkeypress(altKey,ctrlKey,shiftKey,keyCode,chr);if((!isNullable(r)&&r.toString&&r.toString()=="CANCELEVENT")||(keyCode==13&&this.name=='HTMLEdit')){if(e.preventDefault){e.preventDefault();e.stopPropagation();}else{window.onhelp=function(){e.returnValue=false;};try{e.keyCode=0;}catch(e){}
e.returnValue=false;e.cancelBubble=true;}
return false;}}else{if(!ctrlKey&&!altKey&&arrayIndexOf(this.tabKeys,keyCode)!=-1){if(!e.shiftKey)controller.next(this);else controller.next(this,true);}}
return r;}
return true;};HTMLElementBase.prototype.focusAction=function(e){if(this.enabled&&this.isTrueVisible()&&!this.readonly){controller.activeElement=this;markField(this.input,this.tagName,this.canSelectOnFocus);e.fromKeyBoard=this.fromKeyBoard;if(this.onfocus)this.onfocus.call(this,e);this.fromKeyBoard=null;}};HTMLElementBase.prototype.getValidDescription=function(){var description=this.getDescription();if(!description)description='';if(description.length==0&&this._description)return this._description;else return description;};HTMLElementBase.prototype.validateDataType=function(focus){if(!this.ignoreValidate&&(this.typeName=='datetime'||this.typeName=='date')&&!isDateTime(this.getValue())){interactionError(getLocaleMessage("ERROR.INVALID_FIELD_DATE_FORMAT",this.getValidDescription()),focus?(function(e){e.getFocus(true);}):null,focus?[this]:null);return false;}
else if(this.typeName=='time'&&!isTime(this.getValue())){interactionError(getLocaleMessage("ERROR.INVALID_FIELD_HOUR_FORMAT",this.getValidDescription()),focus?(function(e){e.getFocus(true);}):null,focus?[this]:null);return false;}
return true;};HTMLElementBase.prototype.blurAction=function(e){if(this.enabled&&this.isTrueVisible()&&!this.readonly){controller.activeElement=null;this.focuzed=false;if(this.input||this.button){if(this.button)bootstrapCloseTooltip(this.button);else bootstrapCloseTooltip(this.input);}
unmarkField(this.input,this.tagName,this.canSelectOnFocus);if(this.mask&&this.input){this.mask.getOnblur(e,this.input,this);if(trim(this.value)!=trim(this.getValue()))
this.changeAction(e,this);}
if(this.onblur)this.onblur(e);}};HTMLElementBase.prototype.changeAction=function(e,o,dontCheckDependences){this.value=this.getValue();if(this.validateDataType(true)){if(this.dependent&&!dontCheckDependences)this.getDependeces();if(this.onchange)this.onchange.call(this,e);this.refreshComponentDependeces();}};HTMLElementBase.prototype.designMask=function(){if(this.maskSuport&&this.input){if(this.textMask){this.mask=new Mask(this.textMask);}else if(this.dateMask){this.mask=new Mask(this.dateMask,'date');}else if(this.numberMask){this.mask=new Mask(this.numberMask,'number');}else if(this.canCheckRegularExpression&&!isNullable(this.regularExpression)){this.mask=new Mask("");this.mask.regularExpression=this.regularExpression;}}};HTMLElementBase.prototype.designEnableControl=function(v){this.setEnabled(v);this.ec=new HTMLCheckbox(this.sys,this.formID,this.code,0,this.height+3,this.width,20,getLocaleMessage("LABEL.ALL"),!v?'true':'false','true','false');this.ec.inputname='WFRInput'+this.code+'EnableControl';this.ec.id='WFRInput'+this.code;this.ec.onchange=this.getAction(this.clickEnableControlAction);this.ec.design(this.div);if(this.ec.div){this.ec.div.className+=" mt-2";this.ec.divClass=this.ec.div.className;}};HTMLElementBase.prototype.clickEnableControlAction=function(e){this.setEnabled(!this.ec.getChecked());};HTMLElementBase.prototype.actionOnFocus=function(e,src){document.write(src);};HTMLElementBase.prototype.setOnClick=function(evt){try{this.input.onclick=evt;}catch(e){}};HTMLElementBase.prototype.setOnKeyPress=function(evt){this.input.onkeypress=evt;};HTMLElementBase.prototype.refresh=function(){var url="refresh.do?sys="+this.sys+"&formID="+this.formID+"&comID="+this.code+"&action=refresh&goto="+formrow+"&value="+URLEncode(this.getValue(),"GET")+'&toGrid='+(this.toGrid?'true':'false');if(d.t&&d.t.dependences){var components=d.t.dependences[this.code];if(components&&components.length>0){for(var code in components){if(isNumeric(code)){var component=eval("$mainform().d.c_"+components[code]);if(component){url+=("&WFRInput"+component.getCode()+"="+URLEncode(component.getValue(),"GET"));}}}}}
eval(getContent(url,false,true));};HTMLElementBase.prototype.getDependeces=function(refreshSource){refreshSource=true;var gt=-1;try{gt=formrow;}catch(e){}
var url="GetDependences?componentName=WFRInput"+this.code+"&componentValue="+URLEncode(this.getValue(),"GET")+"&sys="+this.sys+"&formID="+this.formID+"&codFormComp="+this.formID+("&refreshSource="+(refreshSource?"true":"false")+"&goto="+gt)+'&toGrid='+(this.toGrid?'true':'false');if(d.t&&d.t.dependences){var components=d.t.dependences[this.code];if(components&&components.length>0){for(var code in components){if(isNumeric(code)){var component=eval("$mainform().d.c_"+components[code]);if(component){url+=("&WFRInput"+component.getCode()+"="+URLEncode(component.getValue(),"GET"));}}}}}
this.timeout(function(){eval(getContent(url));},0);};HTMLElementBase.prototype.refreshComponentDependeces=function(){if(this.componentDependences&&this.componentDependences.length>0){for(var index in this.componentDependences){if(isNumeric(index)){var component=this.componentDependences[index];if(component){component.refresh();}}}}};HTMLElementBase.prototype.setDraggable=function(draggable,elementToAppend){this.draggable=draggable;if(this.draggable){if(elementToAppend){this.designDragComponent(elementToAppend);}else{this.designDragComponent(this.doc);}}else{if(this.divDragComponent)this.doc.removeChild(this.divDragComponent);}};HTMLElementBase.prototype.setResizable=function(resizable){this.resizable=resizable;if(this.resizable){if(!this.divDragComponent||!this.divDragComponent.draggable)
this.designDragComponent(this.doc);this.divDragComponent.resizeComponentsCreated=false;}};HTMLElementBase.prototype.designDragComponent=function(doc){this.blur();var componentId=this.sys+"_DragComponent_"+this.code;this.divDragComponent=this.getDiv(componentId,this.posX,this.posY,window.getComputedStyle(this.div).width,this.height,100001,true);this.divDragComponent.style.cursor="move";this.divDragComponent.draggable=true;this.divDragComponent.dragActivated=false;this.divDragComponent.style.position="absolute";doc.appendChild(this.divDragComponent);this.attachEvent(this.divDragComponent,'mousedown',this.dragInitComponent);};HTMLElementBase.prototype.removeResizeDivs=function(e,divClicked){if(!controller.hasSelectedComponent()){controller.onComponentSelectionChangeAction(null,this);controller.setSelectedComponent(this);}else{var lastSelectedComponent=controller.getSelectedComponent();var lastDivDragComponent=lastSelectedComponent.divDragComponent;var clickedObject=window.event?event.srcElement:e.target;var dragComponentRegExp=/^.+_DragComponent_.+$/;var isDragComponent=dragComponentRegExp.test(clickedObject.name);var resizeComponentRegExp=/^.+_ResizeComponent_.+$/;var isResizeComponent=resizeComponentRegExp.test(clickedObject.name);if(lastDivDragComponent&&lastDivDragComponent.resizeComponentsCreated){if((this!=lastSelectedComponent&&isDragComponent)||(!isResizeComponent&&!isDragComponent)){if(lastSelectedComponent.divNWResize)lastDivDragComponent.removeChild(lastSelectedComponent.divNWResize);if(lastSelectedComponent.divSWResize)lastDivDragComponent.removeChild(lastSelectedComponent.divSWResize);if(lastSelectedComponent.divNEResize)lastDivDragComponent.removeChild(lastSelectedComponent.divNEResize);if(lastSelectedComponent.divSEResize)lastDivDragComponent.removeChild(lastSelectedComponent.divSEResize);if(lastSelectedComponent.divNResize)lastDivDragComponent.removeChild(lastSelectedComponent.divNResize);if(lastSelectedComponent.divSResize)lastDivDragComponent.removeChild(lastSelectedComponent.divSResize);if(lastSelectedComponent.divEResize)lastDivDragComponent.removeChild(lastSelectedComponent.divEResize);if(lastSelectedComponent.divWResize)lastDivDragComponent.removeChild(lastSelectedComponent.divWResize);lastDivDragComponent.resizeComponentsCreated=false;if(isDragComponent){controller.onComponentSelectionChangeAction(lastSelectedComponent,this);controller.setSelectedComponent(this);}}
if(!isResizeComponent&&!isDragComponent){controller.onComponentSelectionChangeAction(lastSelectedComponent,null);this.removeEvent(document,'mousedown');controller.setSelectedComponent(null);}}else if(isDragComponent){controller.onComponentSelectionChangeAction(lastSelectedComponent,this);this.removeEvent(document,'mousedown');controller.setSelectedComponent(this);}}};HTMLElementBase.prototype.dragKeyDownComponent=function(e){var code=e.keyCode||e.which;switch(code){case 46:{if(this.deletekeydown){return this.deletekeydown(e,this);}}}
return true;};HTMLElementBase.prototype.dragInitComponent=function(e){var evt=window.event?window.event:e;var divDragComponent=this.divDragComponent;if(divDragComponent&&divDragComponent.draggable&&!divDragComponent.dragActivated){this.mouseDiffX=0;this.mouseDiffY=0;divDragComponent.dragMouseMoved=false;divDragComponent.dragApproved=true;divDragComponent.dragActivated=true;if(isNaN(parseInt(divDragComponent.style.left)))
divDragComponent.style.left=0;if(isNaN(parseInt(divDragComponent.style.top)))
divDragComponent.style.top=0;divDragComponent.dragOffsetX=parseInt(divDragComponent.style.left);divDragComponent.dragOffsetY=parseInt(divDragComponent.style.top);if(this.designResizeComponent&&this.resizable){if(!divDragComponent.resizeComponentsCreated){this.designResizeComponent(this.doc);}}
this.removeEvent(document,'mousedown');this.attachEvent(document,'mousedown',this.removeResizeDivs,null,this.divDragComponent);this.removeEvent(document,'keydown');divDragComponent.dragPosX=evt.clientX;divDragComponent.dragPosY=evt.clientY;if(evt.preventDefault)evt.preventDefault();this.attachEvent(this.doc,'mousemove',this.dragMoveComponent);this.attachEvent(this.doc,'mouseup',this.dragLeaveComponent);this.onDragInitComponent(e);}};HTMLElementBase.prototype.dragMoveComponent=function(e){var divDragComponent=this.divDragComponent;if(divDragComponent&&divDragComponent.draggable&&divDragComponent.dragApproved&&divDragComponent.dragActivated){divDragComponent.dragMouseMoved=true;var evt=window.event?window.event:e;this.mouseDiffX=evt.clientX-divDragComponent.dragPosX;this.mouseDiffY=evt.clientY-divDragComponent.dragPosY;var left=divDragComponent.dragOffsetX+this.mouseDiffX;var top=divDragComponent.dragOffsetY+this.mouseDiffY;var oldLeft=this.getX();var oldTop=this.getY();if(top>0){divDragComponent.style.top=top+"px";this.setY(top);}
if(left>0){divDragComponent.style.left=left+"px";this.setX(left);}
this.onDragMoveComponent(e,oldLeft,oldTop,this.mouseDiffX,this.mouseDiffY);return true;}else{return false;}};HTMLElementBase.prototype.dragLeaveComponent=function(e){var divDragComponent=this.divDragComponent;if(divDragComponent&&divDragComponent.draggable&&divDragComponent.dragApproved){divDragComponent.dragApproved=false;divDragComponent.dragActivated=false;if(divDragComponent.dragMouseMoved){divDragComponent.dragMouseMoved=false;}
this.removeEvent(this.doc,'mousemove');this.removeEvent(this.doc,'mouseup');}
this.onDragLeaveComponent(e);};HTMLElementBase.prototype.onDragInitComponent=function(e){if(this.ondragini)this.ondragini(this,this.divDragComponent);};HTMLElementBase.prototype.onDragMoveComponent=function(e,oldX,oldY,mouseDiffX,mouseDiffY){if(this.ondragdrop)this.ondragdrop(this.getX(),this.getY(),oldX,oldY,this,mouseDiffX,mouseDiffY,this.divDragComponent);};HTMLElementBase.prototype.onDragLeaveComponent=function(e){if(this.ondragend)this.ondragend(this,this.divDragComponent);};HTMLElementBase.prototype.resizeWidth=5;HTMLElementBase.prototype.resizeHeight=5;HTMLElementBase.prototype.cursorMove="move";HTMLElementBase.prototype.cursorNWResize="nw-resize";HTMLElementBase.prototype.cursorSWResize="sw-resize";HTMLElementBase.prototype.cursorNEResize="ne-resize";HTMLElementBase.prototype.cursorSEResize="se-resize";HTMLElementBase.prototype.cursorNResize="n-resize";HTMLElementBase.prototype.cursorSResize="s-resize";HTMLElementBase.prototype.cursorEResize="e-resize";HTMLElementBase.prototype.cursorWResize="w-resize";HTMLElementBase.prototype.designResizeComponent=function(doc){function setResizeDivDefaultProperties(divResize){divResize.style.backgroundColor="orange";divResize.style.overflow="hidden";divResize.resizable=true;divResize.resizeActivated=false;return divResize;}
var divDragComponent=this.divDragComponent;divDragComponent.resizeComponentsCreated=true;var nwResizeId=this.sys+"_NW_ResizeComponent_"+this.code;this.divNWResize=this.getDiv(nwResizeId,0,0,this.resizeWidth,this.resizeHeight,1,true);this.divNWResize.style.cursor=this.cursorNWResize;setResizeDivDefaultProperties(this.divNWResize);divDragComponent.appendChild(this.divNWResize);this.attachEvent(this.divNWResize,'mousedown',this.resizeInit,null,[this.divNWResize,this.cursorNWResize]);var swResizeId=this.sys+"_SW_ResizeComponent_"+this.code;var swPosY=this.getHeight()-this.resizeHeight;this.divSWResize=this.getDiv(swResizeId,0,swPosY,this.resizeWidth,this.resizeHeight,1,true);this.divSWResize.style.cursor=this.cursorSWResize;setResizeDivDefaultProperties(this.divSWResize);divDragComponent.appendChild(this.divSWResize);this.attachEvent(this.divSWResize,'mousedown',this.resizeInit,null,[this.divSWResize,this.cursorSWResize]);var neResizeId=this.sys+"_NE_ResizeComponent_"+this.code;var nePosX=this.getWidth()-this.resizeWidth;this.divNEResize=this.getDiv(neResizeId,nePosX,0,this.resizeWidth,this.resizeHeight,1,true);this.divNEResize.style.cursor=this.cursorNEResize;setResizeDivDefaultProperties(this.divNEResize);divDragComponent.appendChild(this.divNEResize);this.attachEvent(this.divNEResize,'mousedown',this.resizeInit,null,[this.divNEResize,this.cursorNEResize]);var seResizeId=this.sys+"_SE_ResizeComponent_"+this.code;var sePosX=this.getWidth()-this.resizeWidth;var sePosY=this.getHeight()-this.resizeHeight;this.divSEResize=this.getDiv(seResizeId,sePosX,sePosY,this.resizeWidth,this.resizeHeight,1,true);this.divSEResize.style.cursor=this.cursorSEResize;setResizeDivDefaultProperties(this.divSEResize);divDragComponent.appendChild(this.divSEResize);this.attachEvent(this.divSEResize,'mousedown',this.resizeInit,null,[this.divSEResize,this.cursorSEResize]);if(!this.resizeProportional){var nResizeId=this.sys+"_N_ResizeComponent_"+this.code;var nPosX=(this.getWidth()/2)-(this.resizeWidth/2);this.divNResize=this.getDiv(nResizeId,nPosX,0,this.resizeHeight,this.resizeWidth,1,true);this.divNResize.style.cursor=this.cursorNResize;setResizeDivDefaultProperties(this.divNResize);divDragComponent.appendChild(this.divNResize);this.attachEvent(this.divNResize,'mousedown',this.resizeInit,null,[this.divNResize,this.cursorNResize]);var sResizeId=this.sys+"_S_ResizeComponent_"+this.code;var sPosX=(this.getWidth()/2)-(this.resizeWidth/2);var sPosY=this.getHeight()-this.resizeHeight;this.divSResize=this.getDiv(sResizeId,sPosX,sPosY,this.resizeWidth,this.resizeHeight,1,true);this.divSResize.style.cursor=this.cursorSResize;setResizeDivDefaultProperties(this.divSResize);divDragComponent.appendChild(this.divSResize);this.attachEvent(this.divSResize,'mousedown',this.resizeInit,null,[this.divSResize,this.cursorSResize]);var eResizeId=this.sys+"_E_ResizeComponent_"+this.code;var ePosX=this.getWidth()-this.resizeWidth;var ePosY=(this.getHeight()/2)-(this.resizeHeight/2);this.divEResize=this.getDiv(eResizeId,ePosX,ePosY,this.resizeWidth,this.resizeHeight,1,true);this.divEResize.style.cursor=this.cursorEResize;setResizeDivDefaultProperties(this.divEResize);divDragComponent.appendChild(this.divEResize);this.attachEvent(this.divEResize,'mousedown',this.resizeInit,null,[this.divEResize,this.cursorEResize]);var wResizeId=this.sys+"_W_ResizeComponent_"+this.code;var wPosY=(this.getHeight()/2)-(this.resizeHeight/2);this.divWResize=this.getDiv(wResizeId,0,wPosY,this.resizeWidth,this.resizeHeight,1,true);this.divWResize.style.cursor=this.cursorWResize;setResizeDivDefaultProperties(this.divWResize);divDragComponent.appendChild(this.divWResize);this.attachEvent(this.divWResize,'mousedown',this.resizeInit,null,[this.divWResize,this.cursorWResize]);}};HTMLElementBase.prototype.setResizeProportional=function(resizeProportional){this.resizeProportional=resizeProportional;};HTMLElementBase.prototype.resizeInit=function(e,divResize,cursorType){if(divResize.resizable&&!divResize.resizeActivated){this.divDragComponent.draggable=false;this.divDragComponent.style.cursor=cursorType;divResize.resizeMouseMoved=false;divResize.resizeApproved=true;divResize.resizeActivated=true;if(isNaN(parseInt(divResize.style.left))){divResize.style.left=0;}
if(isNaN(parseInt(divResize.style.top))){divResize.style.top=0;}
divResize.resizeOffsetX=parseInt(divResize.style.left);divResize.resizeOffsetY=parseInt(divResize.style.top);var evt=window.event?window.event:e;divResize.resizePosX=evt.clientX;divResize.resizePosY=evt.clientY;if(evt.preventDefault){evt.preventDefault();}
this.attachEvent(this.doc,'mousemove',this.resizeMove,null,[divResize]);this.attachEvent(this.doc,'mouseup',this.resizeLeave,null,[divResize]);this.onResizeInit(e,divResize);}};HTMLElementBase.prototype.resizeMove=function(e,divResize){if(divResize&&divResize.resizable&&divResize.resizeApproved&&divResize.resizeActivated){divResize.resizeMouseMoved=true;var evt=window.event?window.event:e;var left,top,width,height;var horizontalMouseDiff=evt.clientX-divResize.resizePosX;var verticalMouseDiff=evt.clientY-divResize.resizePosY;var northRexExp=/_N.?_/;if(northRexExp.test(divResize.name)&&verticalMouseDiff!=0){top=this.getY()+verticalMouseDiff;height=this.getHeight()-verticalMouseDiff;}
var southRexExp=/_S.?_/;if(southRexExp.test(divResize.name)&&verticalMouseDiff!=0){height=this.getHeight()+verticalMouseDiff;}
var eastRexExp=/_.?E_/;if(eastRexExp.test(divResize.name)&&horizontalMouseDiff!=0){width=this.getWidth()+horizontalMouseDiff;}
var westRexExp=/_.?W_/;if(westRexExp.test(divResize.name)&&horizontalMouseDiff!=0){left=this.getX()+horizontalMouseDiff;width=this.getWidth()-horizontalMouseDiff;}
var oldX=this.getX();var oldY=this.getY();var oldWidth=this.getWidth();var oldHeight=this.getHeight();var minHeight;if(this.minHeight){minHeight=this.minHeight;}else{minHeight=4*this.resizeHeight;}
var minWidth;if(this.minWidth){minWidth=this.minWidth;}else{minWidth=4*this.resizeWidth;}
height=height||this.getHeight();width=width||this.getWidth();if(height){if(height<minHeight){height=minHeight;}
this.setHeight(height);this.divDragComponent.style.height=height;}
if(width){if(this.resizeProportional){var temp=(height-oldHeight)/oldHeight;width=oldWidth+temp*oldWidth;}
if(width<minWidth){width=minWidth;}
this.setWidth(width);this.divDragComponent.style.width=width;}
if(left){if(this.getWidth()>minWidth){this.setX(left);this.divDragComponent.style.left=left;}}
if(top){if(this.getHeight()>minHeight){this.setY(top);this.divDragComponent.style.top=top;}}
divResize.resizePosX=evt.clientX;divResize.resizePosY=evt.clientY;this.setDivsNewPosition();this.onResizeMove(e,oldX,oldY,horizontalMouseDiff,verticalMouseDiff,divResize);return true;}else return false;};HTMLElementBase.prototype.resizeLeave=function(e,divResize){if(divResize&&divResize.resizable&&divResize.resizeApproved){divResize.resizeApproved=false;divResize.resizeActivated=false;if(divResize.resizeMouseMoved){divResize.resizeMouseMoved=false;}
this.removeEvent(this.doc,'mousemove');this.removeEvent(this.doc,'mouseup');this.divDragComponent.draggable=true;this.divDragComponent.style.cursor=this.cursorMove;this.onResizeLeave(e);}};HTMLElementBase.prototype.setDivsNewPosition=function(e){var east=this.getWidth()-this.resizeWidth;var south=this.getHeight()-this.resizeHeight;var middleWidth=(this.getWidth()/2)-(this.resizeWidth/2);var middleHeight=(this.getHeight()/2)-(this.resizeHeight/2);if(this.divNWResize){this.divNWResize.style.left=0;this.divNWResize.style.top=0;}
if(this.divNEResize){this.divNEResize.style.left=east;this.divNEResize.style.top=0;}
if(this.divSWResize){this.divSWResize.style.left=0;this.divSWResize.style.top=south;}
if(this.divSEResize){this.divSEResize.style.left=east;this.divSEResize.style.top=south;}
if(this.divNResize){this.divNResize.style.left=middleWidth;this.divNResize.style.top=0;}
if(this.divSResize){this.divSResize.style.left=middleWidth;this.divSResize.style.top=south;}
if(this.divEResize){this.divEResize.style.left=east;this.divEResize.style.top=middleHeight;}
if(this.divWResize){this.divWResize.style.left=0;this.divWResize.style.top=middleHeight;}};HTMLElementBase.prototype.onResizeInit=function(e,divResize){if(this.onresizeini){this.onresizeini(this,divResize);}};HTMLElementBase.prototype.onResizeMove=function(e,oldX,oldY,mouseDiffX,mouseDiffY,divResize){if(this.onresize){this.onresize(this.getX(),this.getY(),oldX,oldY,this,mouseDiffX,mouseDiffY,divResize,this.divDragComponent);}};HTMLElementBase.prototype.onResizeLeave=function(e,divResize){if(this.onresizeend){this.onresizeend(this,divResize);}};HTMLElementBase.prototype.updateHeight=function(height){this.setHeight(height);if(this.divDragComponent){this.divDragComponent.style.height=height;this.setDivsNewPosition();}};HTMLElementBase.prototype.updateWidth=function(width){this.setWidth(width);if(this.divDragComponent){this.divDragComponent.style.width=width;this.setDivsNewPosition();}};HTMLElementBase.prototype.updateX=function(x){this.setX(x);if(this.divDragComponent){this.divDragComponent.style.left=x;this.setDivsNewPosition();}};HTMLElementBase.prototype.updateY=function(y){this.setY(y);if(this.divDragComponent){this.divDragComponent.style.top=y;this.setDivsNewPosition();}};HTMLElementBase.prototype.updateComponent=function(obj){if(obj.x)this.updateX(obj.x);if(obj.y)this.updateY(obj.y);if(obj.width)this.updateWidth(obj.width);if(obj.height)this.updateHeight(obj.height);if(obj.description)this.setDescription(obj.description);};HTMLElementBase.prototype.noClickAreaSize=5;HTMLElementBase.prototype.isIn=function(x,y,x1,y1,x2,y2){x1--;x2++;y1--;y2++;return x>=x1&&x<=x2&&y>=y1&&y<=y2;};HTMLElementBase.prototype.showNoClickArea=function(e){this.timeout(this.showNoClickAreaTO,0);};HTMLElementBase.prototype.showNoClickAreaTO=function(e){if(!this.divNoClick){var mouseX=mX;var mouseY=mY;var dx=findPosX(this.div);var dy=findPosY(this.div);var size=this.noClickAreaSize;var sX=size;var sY=size;var a1=this.isIn(mouseX,mouseY,dx,dy,dx+sX,dy+this.height);var a2=this.isIn(mouseX,mouseY,dx,dy,dx+this.width,dy+sY);var a3=this.isIn(mouseX,mouseY,dx+this.width-sX,dy,dx+this.width,dy+this.height);var a4=this.isIn(mouseX,mouseY,dx,dy+this.height-sY,dx+this.width,dy+this.height);if(!a1&&!a2&&!a3&&!a4){if(mX<=dx+(this.width/2))a3=true;else a1=true;}
var x=this.width-size;var y=0;var w=size;var h=this.height;if(a1){x=this.width-size;y=0;w=size;h=this.height;}else if(a3){x=0;y=0;w=size;h=this.height;}else if(a2){x=0;y=this.height-size;w=this.width;h=size;}else if(a4){x=0;y=0;w=this.width;h=size;}
this.divNoClick=this.getDiv('',x,y,w,h,1000,true);this.divNoClick.style.backgroundColor='orange';this.attachEvent(this.divNoClick,'mouseover',this.onMouseOverNoClickArea);this.attachEvent(this.divNoClick,'mouseout',this.onMouseOutNoClickArea);this.div.appendChild(this.divNoClick);}};HTMLElementBase.prototype.removeNoClickArea=function(){this.timeout(this.removeNoClickAreaTO,0);};HTMLElementBase.prototype.removeNoClickAreaTO=function(){if(this.divNoClick){var x=findPosX(this.divNoClick);var y=findPosY(this.divNoClick);if(!this.isIn(mX,mY,x,y,x+this.divNoClick.offsetWidth,y+this.divNoClick.offsetHeight)){this.div.removeChild(this.divNoClick);this.divNoClick=null;}}};HTMLElementBase.prototype.onMouseOverNoClickArea=function(){if(this.divNoClick&&this.click)this.click();};HTMLElementBase.prototype.onMouseOutNoClickArea=function(){if(this.divNoClick){this.div.removeChild(this.divNoClick);this.divNoClick=null;}};HTMLElementBase.prototype.addComponentDependence=function(component){if(component)this.componentDependences.push(component);};HTMLElementBase.prototype.isDBAware=function(){return!isNullable(this.field);};HTMLElementBase.prototype.setGridValue=function(value){this.value=value;};HTMLElementBase.prototype.getImageSourceURL=function(image){return"openImageStreamFromGalery.do?sys="+URLEncode(this.sys,'GET')+"&formID="+URLEncode(this.formID,'GET')+"&guid="+URLEncode(image,'GET');};HTMLElementBase.prototype.flush=function(){this.divWResize=null;this.divEResize=null;this.divSResize=null;this.divNResize=null;this.divSEResize=null;this.divNEResize=null;this.divSWResize=null;this.divNWResize=null;this.divDragComponent=null;this.divHint=null;this.divPermission=null;this.input=null;this.componentDependences=null;this.context=null;};function HTMLElementController(){this.elems=new Array();this.elemsNotTabable=new Array();this.elemsByField=new Array();this.elemsById=new Array();this.formsByGUID=new Array();this.idx=-1;this.inc=0;this.sorted=false;this.maxtab=0;this.formLoaded=false;}
HTMLElementController.inherits(HTMLObject);HTMLElementController.prototype.checkRequireds=function(){var allElements=this.getAllElements();for(var i=0;i<allElements.length;i++){if(allElements[i].required&&allElements[i].visible&&allElements[i].hasEmptyValue()){if(trim(allElements[i].getDescription())!=''){interactionError(getLocaleMessage("ERROR.REQUIRED_FIELD",allElements[i].getDescription()),function(e){e.getFocus(true);},[allElements[i]]);return false;}
interactionError(getLocaleMessage("ERROR.REQUIRED_BLANK_FIELD"),function(e){e.getFocus(true);},[allElements[i]]);return false;}
if(allElements[i].cpf&&allElements[i].visible&&!CPF(allElements[i].getValue())){interactionError(getLocaleMessage("ERROR.INVALID_CPF_FIELD",allElements[i].getDescription()),function(e){e.getFocus(true);},[allElements[i]]);return false;}
if(allElements[i].cnpj&&allElements[i].visible&&!CNPJ(allElements[i].getValue())){interactionError(getLocaleMessage("ERROR.INVALID_CNPJ_FIELD",allElements[i].getDescription()),function(e){e.getFocus(true);},[allElements[i]]);return false;}
if(allElements[i].validateDataType&&!allElements[i].validateDataType(true))
return false;if(allElements[i].checkPost&&!allElements[i].checkPost())
return false;if(allElements[i].canCheckRegularExpression&&!isNullable(allElements[i].regularExpression)&&allElements[i].visible&&!testRegularExpression(allElements[i].getValue(),allElements[i].regularExpression)){interactionError(getLocaleMessage("ERROR.INVALID_FIELD_CONTENT",allElements[i].getDescription()),function(e){e.getFocus(true);},[allElements[i]]);return false;}}
return true;}
HTMLElementController.prototype.doInvisibleComponents=function(){var invisibleFields=$mainform().d.WFRForm.invisibleFields.value;var flag=false;for(var i=0;i<this.elems.length;i++){if(!this.elems[i].visible&&this.elems[i].code!=-1&&(invisibleFields.indexOf(this.elems[i].code)==-1)){invisibleFields=invisibleFields+this.elems[i].code+",";flag=true;}}
if(flag){invisibleFields=invisibleFields.substr(0,invisibleFields.length-1);}
$mainform().d.WFRForm.invisibleFields.value=invisibleFields;}
HTMLElementController.prototype.checkPost=function(){for(var i=0;i<this.elems.length;i++){if(!this.elems[i].checkPost())
return false;}
return true;}
HTMLElementController.prototype.addForm=function(formCode,GUID){this.formsByGUID[GUID]=formCode;}
HTMLElementController.prototype.addFormInfo=function(name,code,GUID,loadTime){if(this.formsLoadTime==null)
this.formsLoadTime=new Array();var o={name:name,code:code,loadTime:loadTime,GUID:GUID}
this.formsLoadTime.push(o);}
HTMLElementController.prototype.addNotTabable=function(o){this.elemsNotTabable.push(o);if(o.id)
this.elemsById[o.id]=o;if(o.field){if(!this.elemsByField[o.field])this.elemsByField[o.field]=new Array();this.elemsByField[o.field].push(o);}}
HTMLElementController.prototype.addTabable=function(o){this.idx=this.idx+1;this.elems.push(o);o.indexArray=this.idx;if(verifyObjectType(o,"HTMLNavigationButton")){orderTab.push(o);}
if(o.tabindex>0)
o.tabindex=o.tabindex+(this.inc/1000);else
o.tabindex=this.inc;this.inc=this.inc+1;this.sorted=false;if(o.field){if(!this.elemsByField[o.field])this.elemsByField[o.field]=new Array();this.elemsByField[o.field].push(o);}
if(o.id)
this.elemsById[o.id]=o;}
HTMLElementController.prototype.getElements=function(attribute,value){if(!attribute)return this.getAllElements();var all=this.getAllElements();var elems=new Array();for(var i in all){if(typeof(all[i])=='function')continue;if(all[i]&&all[i][attribute]==value)
elems.push(all[i]);}
return elems;}
HTMLElementController.prototype.getElementsByField=function(field){return this.elemsByField[field];}
HTMLElementController.prototype.getElementById=function(id,formID){if(!formID){return this.elemsById[id];}else{var elems=this.getElementsByForm(formID);for(var i in elems){if(typeof(elems[i])=='function')continue;if(elems[i]&&elems[i].id==id)
return elems[i];}}
interactionError(getLocaleMessage("ERROR.COMPONENT_FIELD_NOT_FOUND",id));}
HTMLElementController.prototype.getElementByCode=function(code){var all=this.getAllElements();for(var i in all){if(typeof(all[i])=='function')continue;if(all[i]&&all[i].code==code)
return all[i];}}
HTMLElementController.prototype.getElementsByTab=function(tab){return this.getElementsByDiv(tab.div);}
HTMLElementController.prototype.getElementByTab=function(tab,name){var elems=this.getElementsByTab(tab);for(var index in elems){var elem=elems[index];if(elem&&elem.getId&&(elem.getId()==name)){return elem;}}
return null;}
HTMLElementController.prototype.getElementsByDiv=function(div){var all=this.getAllElements();var elems=new Array();for(var i in all){if(typeof(all[i])=='function')continue;if(all[i]&&all[i].doc==div)elems.push(all[i]);}
return elems;}
HTMLElementController.prototype.getElementsByForm=function(formID){if(!isNumeric(formID))formID=this.formsByGUID[formID];var elems=new Array();if(formID){var all=this.getAllElements();for(var i in all){if(typeof(all[i])=='function')continue;if(all[i]&&all[i].formID==formID)
elems.push(all[i]);}}
return elems;}
HTMLElementController.prototype.verifyComponent=function(obj){if(typeof obj=="string"){return this.elemsById[obj];}else{return obj;}}
HTMLElementController.prototype.showLoadTime=function(){var r='';if(this.formsLoadTime){for(var i=0;i<this.formsLoadTime.length;i++){var form=this.formsLoadTime[i];var showLoadTime=form.loadTime;if(parseInt(form.loadTime)>50)
showLoadTime='<font color=#FF0000><b>'+showLoadTime+'ms</b></font>';else
showLoadTime+='ms';r+='<b><font color=#0000FF> '+getLocaleMessage("LABEL.FORM")+form.name+'</font></b>'+': '+showLoadTime+'\n';}}
var all=this.getAllElements();for(var i=0;i<all.length;i++){var element=all[i];if(isNullable(element.getCode())||element.getCode()<=0){continue;}
var description=element.getDescription();if(!description||description.length==0){description=(getLocaleMessage("LABEL.COMPONENT")+" "+element.getCode());}
var loadTime;if(!isNumeric(element.loadComponentTime)){loadTime='N√£o Informado';}else{loadTime=element.loadComponentTime;if(parseInt(loadTime)>50){loadTime='<font color=#FF0000><b>'+loadTime+'ms</b></font>';}else{loadTime=loadTime+'ms';}}
r+=('<b>'+description+'</b>'+': '+loadTime+'\n');}
interactionMessage(r);}
HTMLElementController.prototype.getAllElements=function(){var allElements=new Array();allElements=allElements.concat(this.elems);allElements=allElements.concat(this.elemsNotTabable);return allElements;}
HTMLElementController.prototype.getTabableElements=function(){return this.elems;}
HTMLElementController.prototype.getNotTabableElements=function(){return this.elemsNotTabable;}
HTMLElementController.prototype.getTabElements=function(tabController){var all=this.getAllElements();var formElems=new Array();for(var i=0;i<all.length;i++)
if(all[i]&&!all[i].ignore&&tabController.getTabByDiv(all[i].doc)!=null)
formElems.push(all[i]);return formElems;}
HTMLElementController.prototype.getFormElements=function(){return this.getDBAwareElements()}
HTMLElementController.prototype.getDBAwareElements=function(){var all=this.getAllElements();var formElems=new Array();for(var i=0;i<all.length;i++)
if(all[i]&&all[i].field)
formElems.push(all[i]);return formElems;}
HTMLElementController.prototype.remove=function(o){arrayRemove(this.elems,o);arrayRemove(orderTab,o);arrayRemove(this.elemsNotTabable,o);var arr=this.elemsByField[o.field];if(o.field&&arr)arrayRemove(arr,o);if(o.id)delete this.elemsById[o.id];}
HTMLElementController.prototype.focusFirst=function(){if(!this.sorted){this.elems.sort(this.sortFn);this.sorted=true;}
this.next(this.elems[this.elems.length-1],false);}
HTMLElementController.prototype.focusTabFirst=function(){if(!this.sorted){this.elems.sort(this.sortFn);this.sorted=true;}
for(var i=0;i<this.elems.length;i++){var elem=this.elems[i];if(elem.focus()){break;}}}
HTMLElementController.prototype.focusXY=function(mx,my,offset){function isInArea(elem,mx,my,offset){var isIn=false;var x=elem.posX;var y=elem.posY+offset;var w=elem.width;var h=elem.height;if(elem.labelDivHeight){y+=elem.labelDivHeight;}
if((mx>=x&&mx<=(x+w))&&(my>=y&&my<=(y+h))){isIn=true;}
return isIn;}
if(!this.sorted){this.elems.sort(this.sortFn);this.sorted=true;}
var found=false;for(var i in this.elems){if(typeof(this.elems[i])=='function')continue;var elem=this.elems[i];if(isInArea(elem,mx,my,offset)&&elem.focus()){found=true;break;}}
if(!found)this.focusTabFirst();}
HTMLElementController.prototype.next=function(o,invert){var controle;if(!$mainform().orderTab){orderTab=this.elems;this.sorted=true;}
if(!this.sorted){this.sortOrderTab();this.sorted=true;}
if(!invert){controle=arrayIndexOf(orderTab,o)+1;}else{controle=arrayIndexOf(orderTab,o)-1;}
window.setTimeout(function(){tabAsync(orderTab,controle,invert);},2);};HTMLElementController.prototype.sortOrderTab=function(){for(var i=orderTab.length-1;i>=0;i--){var t;if(typeof orderTab[i]==='number'){t=eval('d.c_'+orderTab[i]);}else{t=orderTab[i];}
if(t){if(arrayIndexOf(this.elems,t)!=-1){if(arrayIndexOf(orderTab,t.code)!=-1){orderTab.splice(arrayIndexOf(orderTab,t.code),1,t);}}else{if(arrayIndexOf(orderTab,t)!=-1)
orderTab.splice(arrayIndexOf(orderTab,t),1);else
orderTab.splice(arrayIndexOf(orderTab,t.code),1);}}}
var keys=detailPanelComponentsTab.getKeys();var values=detailPanelComponentsTab.getValues();for(var i=keys.length;i>0;i--){if(this.elems.indexOf(keys[i])!=-1){orderTab.splice(arrayIndexOf(orderTab,values[i])+1,0,keys[i]);}}};HTMLElementController.prototype.sortFn=function(a,b){if(parseFloat(a.tabindex)<parseFloat(b.tabindex))return-1;if(parseFloat(a.tabindex)>parseFloat(b.tabindex))return 1;if(parseFloat(a.tabindex)==parseFloat(b.tabindex))return 0;};HTMLElementController.prototype.removeNavigator=function(){document.n.setVisible(false);document.n.freeButtons();if(document.n.alertController){document.n.alertController.free(true);document.n.alertController=null;}
for(var i=0;i<document.body.childNodes.length;i++){var tagName=document.body.childNodes[i].tagName;if(tagName&&tagName.toUpperCase()=="TABLE"){document.body.removeChild(document.body.childNodes[i]);break;}}
document.t.div.style.top="1px";};HTMLElementController.prototype.flush=function(){var allElements=this.getAllElements();for(var i=0;i<allElements.length;i++){if(allElements[i].flush)allElements[i].flush();try{eval('document.c_'+allElements[i].code+' = null;');}catch(e){}}
if(debugManager){debugManager.flush();}}
HTMLElementController.prototype.getSelectedComponent=function(){return this.selectedComponent;}
HTMLElementController.prototype.setSelectedComponent=function(selectedComponent){this.selectedComponent=selectedComponent;}
HTMLElementController.prototype.hasSelectedComponent=function(){return this.selectedComponent!=null;}
HTMLElementController.prototype.onComponentSelectionChangeAction=function(lastSelectedComponent,currentSelectedComponent){if(this.oncomponentselectionchange)this.oncomponentselectionchange(lastSelectedComponent,currentSelectedComponent);}
HTMLElementController.prototype.setComponentSelectionChangeAction=function(func){if(typeof func=="string"){this.oncomponentselectionchange=new Function(func);}else{this.oncomponentselectionchange=func;}}
HTMLElementController.prototype.onRightClickAction=function(e,component){if(this.onrightclick)this.onrightclick(e,component);}
HTMLElementController.prototype.setRightClickAction=function(func){if(typeof func=="string"){this.onrightclick=new Function(func);}else{this.onrightclick=func;}}
HTMLElementController.prototype.onFormLoadAction=function(){this.formLoaded=true;for(var i=0;i<this.elems.length;i++){if(this.elems[i].onFormLoadAction){this.elems[i].onFormLoadAction();}
if(this.elems[i].forceInvisible){this.elems[i].forceInvisible(this.elems[i].div);}}
for(var i=0;i<this.elemsNotTabable.length;i++){if(this.elemsNotTabable[i].onFormLoadAction){this.elemsNotTabable[i].onFormLoadAction();}}}
HTMLElementController.prototype.beforeSubmit=function(){var elems=this.getFormElements();for(var i=0;i<elems.length;i++){if(elems[i]&&elems[i].beforeSubmit){elems[i].beforeSubmit();}}}
HTMLElementController.prototype.afterSubmit=function(){var elems=this.getFormElements();for(var i=0;i<elems.length;i++){if(elems[i]&&elems[i].afterSubmit){elems[i].afterSubmit();}}}
var controller=new HTMLElementController();function HTMLLabeledComponent(sys,formID,code,posX,posY,width,height,description,value){this.create(sys,formID,code,posX,posY,width,height,description,value);}
HTMLLabeledComponent.inherits(HTMLElementBase);HTMLLabeledComponent.prototype.name='HTMLLabeledComponent';HTMLLabeledComponent.prototype.labelDivHeight=15;HTMLLabeledComponent.prototype.createLabelDiv=function(){this.label=document.createElement("label");this.label.name="WFRComponentLabel"+this.code;this.div.appendChild(this.label);return this.label;};HTMLLabeledComponent.prototype.design=function(doc,tabControl){this.doc=doc;this.div=this.getBaseDiv(true,this.posX,this.posY,this.width,this.height);this.context=this.div;if(this.description&&this.description.length>0){this.createLabelDiv();}
this.designComponent(doc);doc.appendChild(this.div);this.updateLabel();this.init(tabControl);};HTMLLabeledComponent.prototype.setDescription=function(description){this.description=description.toString();if(this.label)this.label.innerHTML=this.decorateRequired(this.description,this.required);};HTMLLabeledComponent.prototype.flush=function(){if(this.label){if(this.label.onmousedown)this.label.onmousedown=null;if(this.label.onselectstart)this.label.onselectstart=null;this.label=null;}
this.callMethod(HTMLElementBase,"flush");};HTMLLabeledComponent.prototype.setColor=function(color){this.color=color;};HTMLLabeledComponent.prototype.setBGColor=function(color){this.bgColor=color;};HTMLLabeledComponent.prototype.updateLabel=function(){if(this.label){this.label.className="form-label";if(this.required)this.label.className+=" required";if(this.input&&this.input.id)this.label.setAttribute("for",this.input.id);this.label.innerHTML=this.decorateRequired(this.description,this.required);this.label.style.whiteSpace="pre";if(this.description&&this.labelPosition){if(this.labelPosition=='1'){this.label.className+=" bottom";if(this.required)this.label.className+=" required";if(this.div&&this.div.className.indexOf("labeled-bottom")==-1){this.div.className+=" labeled-bottom";this.divClass=this.div.className;}
try{if(this.label.parentElement&&this.label.parentElement.lastChild!=this.label){this.label.parentElement.appendChild(this.label);}}catch(e){}}else if(this.labelPosition=='2'){this.label.className+=" left";if(this.required)this.label.className+=" required";if(this.div&&this.div.className.indexOf("labeled-left")==-1){this.div.className+=" labeled-left";this.divClass=this.div.className;}}else if(this.labelPosition=='3'){this.label.className+=" right";if(this.required)this.label.className+=" required";if(this.div&&this.div.className.indexOf("labeled-right")==-1){this.div.className+=" labeled-right";this.divClass=this.div.className;}}else{this.label.className+=" top";if(this.required)this.label.className+=" required";if(this.div&&this.div.className.indexOf("labeled-top")==-1){this.div.className+=" labeled-top";this.divClass=this.div.className;}}}else{this.label.className+=" top";if(this.required)this.label.className+=" required";if(this.div&&this.div.className.indexOf("labeled-top")==-1){this.div.className+=" labeled-top";this.divClass=this.div.className;}}
if(this.fontDescStyle){this.label.setAttribute("style",this.label.hasAttribute("style")?(this.label.getAttribute("style")+" "+this.fontDescStyle).trim():this.fontDescStyle);}
var labelDistanceX="0.4rem";var labelDistanceY="0.25rem";if(this.labelPosition=='1'){this.label.style.top="calc(100% + "+labelDistanceY+")";}else if(this.labelPosition=='2'){if(isIE||isIE11){this.label.style.transform="translateX(-100%)";this.label.style.paddingRight=labelDistanceX;}else{this.label.style.right="calc(100% + "+labelDistanceX+")";}}else if(this.labelPosition=='3'){this.label.style.left="calc(100% + "+labelDistanceX+")";}else{this.label.style.bottom="calc(100% + "+labelDistanceY+")";}}};function fourdigits(number){return(number<1000)?number+1900:number;}
function HTMLEdit(sys,formID,code,posX,posY,width,height,description,value){this.create(sys,formID,code,posX,posY,width,height,description,value);this.type=1;this.month=this.actualMonth+1;this.realMonth=this.actualMonth;this.year=this.actualYear;this.tabable=true;this.maskSuport=true;this.report=false;this.dtpInitialized=false;this.mobile=isMobile();}
HTMLEdit.inherits(HTMLLabeledComponent);HTMLEdit.prototype.name='HTMLEdit';HTMLEdit.prototype.tagName='edit';HTMLEdit.prototype.now=new Date();HTMLEdit.prototype.actualMonth=HTMLEdit.prototype.now.getMonth();HTMLEdit.prototype.actualYear=fourdigits(HTMLEdit.prototype.now.getYear());HTMLEdit.prototype.canCheckRegularExpression=true;HTMLEdit.prototype.getValue=function(){var value=this.input.value;if(this.textMask){if(this.textMask=="U>"){value=value.toUpperCase();}else if(this.textMask=="l>"){value=value.toLowerCase();}}
return value;};HTMLEdit.prototype.setHeight=function(height){this.callMethod(HTMLLabeledComponent,'setHeight',[height]);if(this.input)this.input.style.height=this.div.style.height;};HTMLEdit.prototype.setType=function(type){this.type=type;if(this.btdiv){this.context.removeChild(this.btdiv);this.btdiv=null;this.img=null;}};HTMLEdit.prototype.setMonth=function(m){this.month=m+1;this.realMonth=m;};HTMLEdit.prototype.setYear=function(y){this.year=y;};HTMLEdit.prototype.setFont=function(f){this.font=f;if(this.input)this.input.style.fontFamily=f;};HTMLEdit.prototype.setSize=function(s){if(s.toString().indexOf("pt")==-1)s+="pt";this.size=s;if(this.input)this.input.style.fontSize=s;};HTMLEdit.prototype.setWeight=function(w){this.weight=w;if(this.input){if(w)this.input.style.fontWeight="bold";else this.input.style.fontWeight="normal";}};HTMLEdit.prototype.setItalic=function(w){this.italic=w;if(this.input){if(w)this.input.style.fontStyle="italic";else this.input.style.fontStyle="normal";}};HTMLEdit.prototype.setTextDecoration=function(){var textDecoration="";if(this.underline||this.strikeout){if(this.underline)textDecoration+="underline";if(this.strikeout)textDecoration+=" line-through";}else textDecoration="none";if(this.input)this.input.style.textDecoration=textDecoration;};HTMLEdit.prototype.designInput=function(doc,name,value){this.input=document.createElement("input");this.input.className="form-control";if(this.password)this.input.type="password";else this.input.type="text";if(this.placeholder)this.input.placeholder=this.placeholder;this.input.autocomplete=(this.autocomplete)?"on":"off";if(!name)this.input.name='WFRInput'+this.code;else this.input.name=name;this.input.id=this.input.name;if(this.maxlength)this.input.maxLength=this.maxlength;this.input.style.height=this.div.style.height;if(this.align)this.input.style.textAlign=this.align;if(!value)this.input.value=this.value;else this.input.value=value;this.input.onclick=function(e){e.stopPropagation();};if(this.datalist){var datalist=document.createElement("datalist");datalist.className="form-control";datalist.id="dl"+this.id;var options=this.datalist.split("\n");for(var i=0;i<options.length;i++){var option=document.createElement("option");option.value=options[i];datalist.appendChild(option);}
this.input.setAttribute("list","dl"+this.id);this.div.appendChild(datalist);}
this.dateFormat=this.getDateFormat();if(this.dateFormat&&this.dateFormat.indexOf(" ")!=-1){var formatParts=this.dateFormat.split(" ");if(formatParts.length==2&&formatParts[0].indexOf("/")!=-1){this.dateFormat=formatParts[0].toUpperCase()+" "+formatParts[1];}else if(formatParts.length==2&&formatParts[1].indexOf("/")!=-1){this.dateFormat=formatParts[0]+" "+formatParts[1].toUpperCase();}}else if(this.dateFormat.indexOf("/")!=-1){this.dateFormat=this.dateFormat.toUpperCase();}};HTMLEdit.prototype.designReport=function(){var labelReport=new HTMLLabel(this.sys,this.formID,this.code,0,0,this.width,this.height,this.value);labelReport.id="ReportLabel"+this.code;labelReport.design(this.context,false);};HTMLEdit.prototype.designComponent=function(doc){if(this.beforeComponentDesign){this.beforeComponentDesign(doc);}
if(this.type==2){this.context=this.getBaseDiv(false);this.context.className="input-group";if(this.classic){if(d&&d.n&&d.n.responsive){this.context.className+=" input-group-legacy-resp";}else{this.context.className+=" input-group-legacy";}}
this.context.style.height=this.div.style.height;this.divClass=this.context.className;if(!this.enabled||this.readonly)
this.context.className+=" disabled";this.div.appendChild(this.context);this.context.onclick=function(e){e.stopPropagation();};}
this.designInput(doc);this.context.appendChild(this.input);if(this.type==2){this.btdiv=document.createElement("div");this.btdiv.className="input-group-append";this.btdiv.style.cursor="pointer";this.btdiv.id="calendarButton"+this.code;var openDateAction=this.getAction('openDate');this.attachEvent(this.btdiv,'click',openDateAction);this.onF5press=openDateAction;this.img=document.createElement("i");this.img.className="input-group-text d-flex align-items-center fas fa-calendar h-100";this.img.style.pointerEvents="none";this.btdiv.appendChild(this.img);this.input.style.setProperty("border-top-left-radius",".25rem");this.input.style.setProperty("border-bottom-left-radius",".25rem");if(this.enabled&&!this.readonly){this.context.appendChild(this.btdiv);}
webrun.include("assets/moment.min.js");var definedLocale=resources_locale.toLowerCase();if(definedLocale=='en_us')this.locale='en';else if(definedLocale=='pt_br')this.locale='pt-br';else if(definedLocale=='es_es')this.locale='es';else if(definedLocale=='fr_fr')this.locale='fr';else this.locale='en';moment.locale(this.locale);if(!document.getElementById("datetimepicker-css")){var head=document.getElementsByTagName('head')[0];var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='assets/bootstrap-datetimepicker.min.css';link.id='datetimepicker-css';head.appendChild(link);}
webrun.include("assets/bootstrap-datetimepicker.min.js");var object=this;$(window).resize(function(e){object.closeDate();});if(this.mobile){this.input.addEventListener("focusin",function(){if(window.dtpComponent&&window.dtpComponent.dtpInitialized){window.dtpComponent.closeDate();setTimeout(function(){object.input.focus();},100);}});document.addEventListener("click",function(){if(object)object.closeDate();});}}
this.setEnabled(this.enabled);if(this.afterComponentDesign){this.afterComponentDesign(doc);}};HTMLEdit.prototype.initDateTimePicker=function(){var object=this;this.dtpDoc=document.body;if(this.dtpInitialized){$(this.input).datetimepicker("destroy");}
this.dtpDoc.style.position="relative";$(this.input).datetimepicker({locale:this.locale,format:this.dateFormat,ignoreReadonly:false,showTodayButton:true,allowInputToggle:false,useCurrent:false,focusOnShow:false,icons:{time:"fas fa-clock"},widgetParent:$(this.dtpDoc)});$(this.input).on("dp.show",function(){object.dateTimePickerPositioning();object.attachEvent(document,'click',object.closeDate);});$(this.input).on("dp.hide",function(){if(object.dtpInitialized){$(this).datetimepicker("destroy");object.dtpInitialized=false;try{if(!object.report&&object.textMask&&object.input&&object.input.value&&object.input.value.length>0){object.input.value=ebfMaskFormatter_(object.input.value,object.textMask);}}catch(e){}}});$(this.input).on("dp.change",function(e){try{if(!object.report&&object.textMask&&object.input&&object.input.value&&object.input.value.length>0){object.input.value=ebfMaskFormatter_(object.input.value,object.textMask);}}catch(e){}
try{if(object.isDateType()){object.closeDate();}}catch(e){}});this.dtpInitialized=true;window.dtpComponent=this;};HTMLEdit.prototype.setValidatedData=function(validated){validated=!!validated;this.regularExpressionValidated=validated;var value=this.getValue();visibleDiv(this.validateDataDiv,(value!=null&&value.length>0&&!validated));};HTMLEdit.prototype.setReadOnly=function(v){this.callMethod(HTMLElementBase,'setReadOnly',[v]);if(this.btdiv)visibleDiv(this.btdiv,!this.readonly);if(v){if(containsNode(this.context,this.btdiv)){this.context.removeChild(this.btdiv);}}else{if(this.type==2&&!containsNode(this.context,this.btdiv)){this.context.appendChild(this.btdiv);}}};HTMLEdit.prototype.keydownAction=function(e){this.callMethod(HTMLElementBase,'keydownAction',[e]);try{if(this.type==2){if(e.which==40||e.key=='ArrowDown'){if(this.input.value===undefined||this.input.value===null||this.input.value.length==0){this.input.value=moment().format(this.dateFormat);}else{var momentData=moment(this.input.value,this.dateFormat);if(momentData.isValid())this.input.value=momentData.subtract(1,"days").format(this.dateFormat);}}else if(e.which==38||e.key=='ArrowUp'){if(this.input.value===undefined||this.input.value===null||this.input.value.length==0){this.input.value=moment().format(this.dateFormat);}else{var momentData=moment(this.input.value,this.dateFormat);if(momentData.isValid())this.input.value=momentData.add(1,"days").format(this.dateFormat);}}}}catch(e){}};HTMLEdit.prototype.setEnabled=function(v){this.enabled=v;if(!this.enabled){if(containsNode(this.context,this.btdiv)){this.context.removeChild(this.btdiv);}}else{if(this.type==2&&!containsNode(this.context,this.btdiv)){this.context.appendChild(this.btdiv);}}
this.input.disabled=!v;};HTMLEdit.prototype.setColor=function(color){this.color=color;if(this.input)this.input.style.color=color;};HTMLEdit.prototype.setBGColor=function(color){this.bgColor=color;if(this.input)this.input.style.backgroundColor=color;};HTMLEdit.prototype.openDate=function(){if(!this.readonly&&this.enabled){if(this.mobile){this.input.blur();var object=this;setTimeout(function(){object.initDateTimePicker();$(object.input).datetimepicker("show");},200);}else{this.initDateTimePicker();this.input.focus();}}};HTMLEdit.prototype.closeDate=function(){if(this.dtpInitialized){$(this.input).datetimepicker("hide");if(window.dtpComponent==this){window.dtpComponent=null;}}};HTMLEdit.prototype.beforeSubmit=function(){if(!this.enabled)this.input.disabled=false;if(this.textMask&&this.input){if(this.textMask=="U>"){this.input.value=this.input.value.toUpperCase();}else if(this.textMask=="l>"){this.input.value=this.input.value.toLowerCase();}}};HTMLEdit.prototype.afterSubmit=function(){if(!this.enabled)this.input.disabled=true;};HTMLEdit.prototype.dateTimePickerPositioning=function(){var dateTimePicker=document.getElementsByClassName("bootstrap-datetimepicker-widget");if(dateTimePicker.length>0){dateTimePicker=dateTimePicker[0];dateTimePicker.style.zIndex=1000000009;var divPosX=findPosX(this.div);var divPosY=findPosY(this.div);var distanceFromTop=0;dateTimePicker.style.left=divPosX+"px";if(dateTimePicker.offsetHeight>0){dateTimePicker.style.minHeight=dateTimePicker.offsetHeight+"px";}
var distanceFromBottom=this.dtpDoc.offsetHeight-((divPosY-distanceFromTop)+this.div.offsetHeight);if(dateTimePicker.classList.contains("top")){dateTimePicker.style.top=(divPosY-dateTimePicker.offsetHeight-distanceFromTop-10)+"px";}else if(dateTimePicker.offsetHeight>distanceFromBottom&&!dateTimePicker.classList.contains("top")){dateTimePicker.style.top=1+"px";}else{dateTimePicker.style.top=(divPosY+this.div.offsetHeight-distanceFromTop)+"px";}
var xLimitScreen=(this.dtpDoc.offsetWidth-divPosX);if(dateTimePicker.offsetWidth>xLimitScreen){dateTimePicker.classList.add("pull-right");var dateMargin=dateTimePicker.offsetWidth+50-xLimitScreen;dateTimePicker.style.left=(divPosX-dateMargin)+'px';}}};HTMLEdit.prototype.isDateType=function(){return((!this.typeNumber&&this.textMask==='##/##/####')||this.typeNumber==91);};HTMLEdit.prototype.getDateFormat=function(){return(this.typeNumber===undefined)?(this.textMask&&this.textMask==='##/##/####')?(mainform&&mainform.DATE_PATTERN)?mainform.DATE_PATTERN:DATE_PATTERN:(mainform&&mainform.DATE_TIME_PATTERN)?mainform.DATE_TIME_PATTERN:DATE_TIME_PATTERN:(this.typeNumber==92)?(mainform&&mainform.TIME_PATTERN)?mainform.TIME_PATTERN:TIME_PATTERN?TIME_PATTERN:null:(this.typeNumber==91)?(mainform&&mainform.DATE_PATTERN)?mainform.DATE_PATTERN:DATE_PATTERN?DATE_PATTERN:null:(mainform&&mainform.DATE_TIME_PATTERN)?mainform.DATE_TIME_PATTERN:DATE_TIME_PATTERN?DATE_TIME_PATTERN:null;};function HTMLMemo(sys,formID,code,posX,posY,width,height,description,value){this.create(sys,formID,code,posX,posY,width,height,description,value);this.type=1;this.report=false;this.wrap=false;}
HTMLMemo.inherits(HTMLEdit);HTMLMemo.prototype.name='HTMLMemo';HTMLMemo.prototype.tabable=true;HTMLMemo.prototype.tagName='edit';HTMLMemo.prototype.tabKeys=[9];HTMLMemo.prototype.setHeight=function(height){this.callMethod(HTMLLabeledComponent,'setHeight',[height]);if(this.input){this.input.style.height=this.div.style.height;this.input.style.minHeight=this.div.style.height;this.input.style.maxHeight=this.div.style.height;}};HTMLMemo.prototype.designReport=function(){var div=this.getBaseDiv(false,this.posX,this.posY,this.width+(IE?2:0),this.height+(IE?2:0));div.id="ReportMemo"+this.code;div.innerHTML=this.value;var mainDiv=MM_findObj("lay");mainDiv.appendChild(div);};HTMLMemo.prototype.setReadOnly=function(v){this.callMethod(HTMLEdit,"setReadOnly",[v]);if(this.trumbowyg){if(v)this.trumbowyg.trumbowyg("disable");else this.trumbowyg.trumbowyg("enable");}};HTMLMemo.prototype.hasEmptyValue=function(){var currentValue=this.getValue();return(currentValue===undefined||currentValue=='');};HTMLMemo.prototype.setEnabled=function(v){this.callMethod(HTMLEdit,"setEnabled",[v]);if(this.richText){if(!this.enabled){if(this.trumbowygDiv)this.trumbowygDiv.classList.add("disabled");if(this.trumbowyg)this.trumbowyg.trumbowyg("disable");if(containsNode(this.context,this.btdiv))this.context.removeChild(this.btdiv);if(this.input)this.input.disabled=true;}else{if(this.trumbowygDiv)this.trumbowygDiv.classList.remove("disabled");if(this.trumbowyg)this.trumbowyg.trumbowyg("enable");if(this.type==2&&!containsNode(this.context,this.btdiv))this.context.appendChild(this.btdiv);if(this.input)this.input.disabled=false;}}};HTMLMemo.prototype.designInput=function(doc,name,value){this.input=document.createElement("textarea");this.input.className="form-control w-100"+
(this.isRichText()?" d-none":"");this.input.style.height=this.div.style.height;this.input.style.minHeight=this.div.style.height;this.input.style.maxHeight=this.div.style.height;this.input.setAttribute("wrap",this.wrap?"soft":"off");this.input.name=name?name:'WFRInput'+this.code;this.input.id=name?name:'WFRInput'+this.code;if(this.placeholder)this.input.placeholder=this.placeholder;if(this.maxlength)this.input.maxLength=this.maxlength;this.input.value=value?value:this.value;if(this.isRichText()){this.div.className+=" d-flex flex-column";this.divClass=this.div.className;this.trumbowygDiv=document.createElement("div");if(this.placeholder)this.trumbowygDiv.setAttribute("placeholder",this.placeholder);this.div.appendChild(this.trumbowygDiv);if(!document.getElementById("trumbowyg-css")){var head=document.getElementsByTagName('head')[0];var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='components/trumbowyg/ui/trumbowyg.min.css';link.id='trumbowyg-css';head.appendChild(link);}
if(!document.getElementById("trumbowyg-colors-css")&&this.richText==2){var head=document.getElementsByTagName('head')[0];var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='components/trumbowyg/plugins/colors/trumbowyg.colors.min.css';link.id='trumbowyg-colors-css';head.appendChild(link);}
webrun.include("components/trumbowyg/trumbowyg.min.js");if(this.richText==2){webrun.include("components/trumbowyg/plugins/colors/trumbowyg.colors.min.js");webrun.include("components/trumbowyg/plugins/fontfamily/trumbowyg.fontfamily.min.js");webrun.include("components/trumbowyg/plugins/fontsize/trumbowyg.fontsize.min.js");}
if(resources_locale.toLowerCase()!="en_us"){webrun.include("components/trumbowyg/langs/"+resources_locale.toLowerCase()+".min.js");}
var editorButtons=[];if(this.richText==1){editorButtons=[['viewHTML'],['undo','redo'],['formatting'],['strong','em','del'],['superscript','subscript'],['unorderedList','orderedList'],['removeformat']];}else if(this.richText==2){editorButtons=[['viewHTML'],['undo','redo'],['fontsize'],['fontfamily'],['formatting'],['strong','em','del'],['foreColor','backColor'],['superscript','subscript'],['link'],['insertImage'],['justifyLeft','justifyCenter','justifyRight','justifyFull'],['unorderedList','orderedList'],['horizontalRule'],['removeformat']];}
this.trumbowyg=$(this.trumbowygDiv);this.trumbowyg.trumbowyg({lang:resources_locale.toLowerCase(),svgPath:'components/trumbowyg/ui/icons.svg',disabled:!this.enabled||this.readonly,btns:editorButtons,urlProtocol:true,tagsToRemove:['script','link'],semantic:{'del':'s',}});this.trumbowyg.trumbowyg("html",value?value:this.value);var object=this;this.trumbowyg.on('tbwfocus',this.onfocus);this.trumbowyg.on('tbwblur',this.onblur);this.trumbowyg.on('tbwchange',function(){if(object.onchange)object.onchange();var value=object.getValue();var valueSizeLimited=object.defineTextByLength(null,object.maxlength==0);if(value!=valueSizeLimited){object.setValue(valueSizeLimited);}});this.trumbowyg.on('click',this.onclick);if(this.input)this.trumbowyg.on('keypress',this.input.onkeypress);this.trumbowyg.on('tbwinit',function(){object.trumbowygDiv.parentNode.style.height=object.height+"px";});if(this.wrap&&this.richText){this.trumbowygDiv.style.wordWrap="break-word";}}
if(!this.selectionEventSet){this.attachEvent(document,"selectionchange",this.handleSelectionChange);this.selectionEventSet=true;}};HTMLMemo.prototype.handleSelectionChange=function(){try{var selection=this.getSelection();if(selection){this.lastSelection=selection;this.lastSelectionRange=selection.getRangeAt(0);if(this.lastSelectionRange){this.lastSelectionRange=this.lastSelectionRange.cloneRange();}
if(this.input){if(typeof this.input.selectionEnd==="number"){this.input.__cursorPos=this.input.selectionEnd;}else this.input.__cursorPos=selection.focusOffset;}}}catch(e){}};HTMLMemo.prototype.getSelection=function(){var isDescendant=function(parent,child){if(!child||!parent)return false;var node=child.parentNode;while(node!=null){if(node==parent)return true;node=node.parentNode;}
return false;};var selection=window.getSelection?window.getSelection():document.selection;if(selection&&selection.anchorNode&&((this.isRichText()&&isDescendant(this.trumbowygDiv?this.trumbowygDiv:this.div,selection.anchorNode)||!this.isRichText()&&((this.input&&selection.anchorNode==this.input)||(this.div&&selection.anchorNode==this.div))))){return selection;}
return null;};HTMLMemo.prototype.insertHtmlAtCaret=function(html){if(this.lastSelection&&this.lastSelectionRange){var range=this.lastSelectionRange;var expandedSelRange=range.cloneRange();range.collapse(false);var el=document.createElement("div");el.innerHTML=html;var frag=document.createDocumentFragment(),node,lastNode;while((node=el.firstChild))lastNode=frag.appendChild(node);range.insertNode(frag);if(lastNode){expandedSelRange.setEndAfter(lastNode);this.lastSelection.removeAllRanges();this.lastSelection.addRange(expandedSelRange);}
if(this.trumbowygDiv)this.setValue(this.trumbowygDiv.innerHTML);}else{this.setValue(this.getValue()+html);}};HTMLMemo.prototype.keyupAction=function(e){var r=this.callMethod(HTMLElementBase,"keyupAction",[e]);if(r&&this.maxlength){var value=this.getValue();var valueSizeLimited=this.defineTextByLength(e);if(value!=valueSizeLimited){this.setValue(valueSizeLimited);}}};HTMLMemo.prototype.defineTextByLength=function(e,unlimited){var value=this.getValue();if(unlimited)
return value;if(value.length>this.maxlength)
value=value.substring(0,this.maxlength);return value;};HTMLMemo.prototype.validateDataType=function(focus){var r=this.callMethod(HTMLElementBase,"validateDataType",[focus]);if(r&&this.maxlength){if(this.getValue().length>this.maxlength){interactionError(getLocaleMessage("INFO.MEMO_MAXIMUM_CHARACTERS",(this.description?this.description:this.id),this.maxlength),focus?(function(e){e.getFocus(true);}):null,focus?[this]:null);return false;}}
return r;};HTMLMemo.prototype.focus=function(){var r=this.enabled&&this.visible&&!this.readonly&&!this.resizable&&!this.draggable;if(this.doc)r=r&&isVisibleDiv(this.doc);if(r){if(this.isRichText()){if(this.trumbowygDiv&&this.trumbowygDiv.focus)
this.trumbowygDiv.focus();this.focuzed=true;}else if(this.input){this.input.focus();this.focuzed=true;}}
return r;};HTMLMemo.prototype.setValue=function(value,checkDependences){if(this.isRichText())this.setRichTextValue(value,checkDependences);else this.callMethod(HTMLElementBase,"setValue",[value,checkDependences]);};HTMLMemo.prototype.setRichTextValue=function(value,checkDependences){if(this.trumbowyg){value=normalizeRuleParam(value,true);this.trumbowyg.trumbowyg("html",value);if(this.input)this.input.value=value;if(this.onchange&&(value!=this.value)){this.value=value;this.onchange();}
this.value=normalizeRuleParam(this.getValue());}else{this.callMethod(HTMLElementBase,"setValue",[value,checkDependences]);}};HTMLMemo.prototype.getValue=function(){if(this.isRichText())return this.getRichTextValue();else return this.input.value;};HTMLMemo.prototype.getRichTextValue=function(){if(this.trumbowyg){var content=this.trumbowyg.trumbowyg("html");if(this.input)this.input.value=content;return content;}else return null;};HTMLMemo.prototype.isRichText=function(){return(this.richText==1||this.richText==2);};HTMLMemo.prototype.richTextLoad=function(){this.input.parentElement.removeChild(this.input);this.designInput(this.doc,this.name,this.getValue());};HTMLMemo.prototype.afterInit=function(){this.callMethod(HTMLElementBase,"afterInit",[]);if(!this.bgColor)this.setBGColor('#fff');};HTMLMemo.prototype.setBGColor=function(color){this.bgColor=color;this.div.style.backgroundColor=color;};function HTMLContainer(sys,formID,code,posX,posY,width,height,description,value){this.create(sys,formID,code,posX,posY,width,height,description,value);}
HTMLContainer.inherits(HTMLElementBase);HTMLContainer.prototype.zindex=0;HTMLContainer.prototype.name='HTMLContainer';HTMLContainer.prototype.tabable=false;HTMLContainer.prototype.setEnabled=function(v){this.callMethod(HTMLElementBase,"setEnabled",[v]);if(this.onclick&&this.div)this.div.style.cursor=this.enabled?"pointer":"default";};HTMLContainer.prototype.focus=function(){return false;};HTMLContainer.prototype.blur=function(){return false;};HTMLContainer.prototype.toPermissionMode=function(){};HTMLContainer.prototype.designComponent=function(doc){if(this.onclick){this.div.onclick=this.onclick;this.div.onmouseover="pointer";this.div.style.cursor="pointer";}
if(this.classCss&&this.classCss.trim().length>0){this.div.buttonGroup=(this.classCss.toLowerCase().indexOf("btn-group")!=-1);}else if(this.name=="HTMLContainer"){this.div.className+=" p-3";}
this.div.id=this.id;this.divClass=this.div.className;if(this.maxWidth){this.div.style.maxWidth=this.maxWidth+"px";}};HTMLContainer.prototype.afterInit=function(){this.callMethod(HTMLElementBase,"afterInit",[]);if(this.tab)this.div.tab=this.tab;};function HTMLGroupBox(sys,formID,code,posX,posY,width,height,description,value){this.create(sys,formID,code,posX,posY,width,height,description,value);this.style=0;this.nodesc=false;}
HTMLGroupBox.inherits(HTMLContainer);HTMLGroupBox.prototype.name='HTMLGroupBox';HTMLGroupBox.prototype.setStyle=function(style){this.style=style;this.designComponent(this.doc);};HTMLContainer.prototype.setNoDescription=function(v){this.nodesc=v;};HTMLGroupBox.prototype.setX=function(posX){this.callMethod(HTMLElementBase,"setX",[posX]);this.updateLayout();};HTMLGroupBox.prototype.setY=function(posY){this.callMethod(HTMLElementBase,"setY",[posY]);this.updateLayout();};HTMLGroupBox.prototype.setWidth=function(width){this.callMethod(HTMLElementBase,"setWidth",[width]);this.updateLayout();};HTMLGroupBox.prototype.setHeight=function(height){this.callMethod(HTMLElementBase,"setHeight",[height]);this.updateLayout();};HTMLGroupBox.prototype.setVisible=function(visible){this.callMethod(HTMLElementBase,"setVisible",[visible]);this.updateLayout();};HTMLGroupBox.prototype.forceInvisible=function(div){var displayAba=div.style.display;if(displayAba==='none')div.style.setProperty("display","none","important");};HTMLGroupBox.prototype.designGroupBox=function(doc){if(this.style==0)this.div.className+=" border";else if(this.style==1)this.div.className+=" card";else if(this.style==2)this.div.className+=" border-top border-bottom-0 border-left-0 border-right-0";else if(this.style==3)this.div.className+=" border-top-0 border-bottom border-left-0 border-right-0";else if(this.style==4)this.div.className+=" border-top-0 border-bottom-0 border-left border-right-0";else if(this.style==5)this.div.className+=" border-top-0 border-bottom-0 border-left-0 border-right";else if(this.style==6)this.div.className+=" border-0";if(this.style==0||this.style==1||this.style==2||this.style==3||this.style==4||this.style==5){if(this.styleMold==0)this.div.className+=" border-inset";else if(this.styleMold==1)this.div.className+=" border-outset";if(this.description&&this.description.trim().length>0&&this.name!=="HTMLDetailPanel"){this.header=document.createElement("div");this.header.style.flex="0 0 auto";if(this.classic){this.header.className="position-absolute p-1 header-radio-group";this.header.style.marginTop="-0.6rem";this.header.style.marginLeft="0.5rem";this.header.style.zIndex=this.zindex;doc.appendChild(this.header);var object=this;window.addEventListener("resize",function(){if(object)object.updateLayout();});}else{this.header.className="card-header px-3 py-2";this.div.appendChild(this.header);}
this.label=document.createElement("label");this.label.className="d-block mb-0";this.label.id="WFRSpanComponent"+this.code;this.label.innerHTML=this.description;this.header.appendChild(this.label);}}};HTMLGroupBox.prototype.updateLayout=function(){if(this.header&&this.classic){this.header.style.backgroundColor=this.bgColor?this.bgColor:window.getComputedStyle(document.body).backgroundColor;this.header.style.top=this.div.offsetTop+"px";this.header.style.left=this.div.offsetLeft+"px";this.header.style.lineHeight="0.7";if(this.visible)this.header.style.display=null;else this.header.style.display="none";}};HTMLGroupBox.prototype.designComponent=function(doc){this.callMethod(HTMLContainer,"designComponent",[doc]);this.designGroupBox(doc);};HTMLGroupBox.prototype.afterInit=function(){this.callMethod(HTMLContainer,"afterInit",[]);if(this.codigoForm!==null&&this.codigoForm!==undefined&&this.codigoForm!==0){ebfFrameOpenFilteredForm(this.formID,this.id,this.codigoForm,true,this.params,true);}
if(!this.bgColor)this.div.style.backgroundColor='transparent';if(this.classic){if(this.tab){var object=this;this.tab.addShownListener(function(){if(object)object.updateLayout();});}}
this.updateLayout();};HTMLGroupBox.prototype.flush=function(){if(this.label&&this.label.flush)
this.label.flush();this.label=null;this.description=null;this.hidden=null;this.callMethod(HTMLElementBase,"flush",[]);};function HTMLHidden(sys,formID,code,value){this.sys=sys;this.code=code;this.value=value;this.inputname='WFRInput'+this.code;this.formID=formID;}
HTMLHidden.inherits(HTMLElementBase);HTMLHidden.prototype.name='HTMLHidden';HTMLHidden.prototype.isRequired=function(){return this.required;};HTMLHidden.prototype.setValue=function(value){value=normalizeRuleParam(value,true);this.value=value;this.hidden.value=value;};HTMLHidden.prototype.getCode=function(){return this.code;};HTMLHidden.prototype.setDecoration=function(){};HTMLHidden.prototype.setX=function(posX){};HTMLHidden.prototype.setY=function(posY){};HTMLHidden.prototype.design=function(doc){this.hidden=document.createElement("input");this.hidden.name=this.inputname;this.hidden.value=this.value;this.hidden.setAttribute('type','hidden');doc.appendChild(this.hidden);this.init(false);};HTMLHidden.prototype.focus=function(){return false;};HTMLHidden.prototype.blur=function(){return false;};HTMLHidden.prototype.setVisible=function(){return false;};HTMLHidden.prototype.setReadOnly=function(){return false;};HTMLHidden.prototype.setEnabled=function(){return false;};HTMLHidden.prototype.toString=function(){return"[object HTMLHidden]";};HTMLHidden.prototype.toPermissionMode=function(){};function HTMLLabel(sys,formID,code,posX,posY,width,height,value){this.create(sys,formID,code,posX,posY,width,height,'',value);this.wrap=false;this.type=1;}
HTMLLabel.inherits(HTMLElementBase);HTMLLabel.prototype.name='HTMLLabel';HTMLLabel.prototype.tabable=false;HTMLLabel.prototype.setDescription=function(description){this.value=description;this.setValue(description);};HTMLLabel.prototype.setValue=function(value){this.callMethod(HTMLElementBase,"setValue",[value]);if(!isNullable(this.value))this.value=this.value.toString();if(this.value.indexOf("\\n")!=-1)this.value=this.value.replace("\\n",'<br>');if(this.wrap)this.label.innerHTML=this.value;else this.label.innerHTML=this.value;if(this.hidden)this.hidden.setValue(this.value);};HTMLLabel.prototype.designComponent=function(doc){this.div.className+=" form-label fixed-height";this.divClass=this.div.className;this.label=document.createElement("label");this.label.className="mb-0";if(this.classCss&&this.classCss.trim().length>0){var classCssLowercaseTrim=this.classCss.toLowerCase().trim();if(classCssLowercaseTrim.startsWith("text-")&&classCssLowercaseTrim.indexOf(" ")==-1){this.label.className+=" "+classCssLowercaseTrim;this.label.textMuted=(classCssLowercaseTrim.indexOf("text-muted")!=-1);this.classCssDefined=true;}}
if(this.value){if(this.value.indexOf("\\n")!=-1)
this.value=this.value.replace("\\n",'<br>');this.label.innerHTML=this.value;}
if(this.wrap)this.label.className+=" text-break";this.label.style.whiteSpace=this.wrap?"pre-wrap":"pre";if(this.font)this.label.style.fontFamily=this.font;if(this.size)this.label.style.fontSize=this.size;if(this.weight)this.label.className+=" font-weight-bold";if(this.italic)this.label.className+=" font-italic";var textDecoration="";if(this.underline||this.strikeout){if(this.underline)textDecoration+="underline";if(this.strikeout)textDecoration+=" line-through";}else textDecoration="none";this.label.style.textDecoration=textDecoration;if(this.color)this.label.style.color=this.color;if(this.bgColor)this.div.style.backgroundColor=this.bgColor;else if(doc)this.label.style.backgroundColor=doc.style.backgroundColor;if(this.width)this.div.style.width=this.width+"px";if(this.height)this.div.style.height=this.height+"px";var flexLayout="d-flex";if(this.horizontalAlignment){switch(this.horizontalAlignment.toLowerCase()){case"left":flexLayout+=" justify-content-start";break;case"center":flexLayout+=" justify-content-center";break;case"right":flexLayout+=" justify-content-end";break;}}
if(this.verticalAlignment){switch(this.verticalAlignment.toLowerCase()){case"top":flexLayout+=" align-items-start";break;case"middle":flexLayout+=" align-items-center";break;case"bottom":flexLayout+=" align-items-end";break;}}
this.contentDiv=document.createElement("div");this.contentDiv.className="w-100 h-100 "+flexLayout;this.div.appendChild(this.contentDiv);this.contentDiv.style.minHeight=this.div.style.minHeight;this.contentDiv.appendChild(this.label);if((this.type==2)||(!isNullable(this.field)&&this.field.length>0)){this.hidden=new HTMLHidden(this.sys,this.formID,this.code,this.value);this.hidden.design(doc);}
if(this.onclick){this.clickAction=this.getAction("doOnClick");this.attachEvent(this.div,'click',this.clickAction);this.div.onmouseover=(this.div.style.cursor="pointer");this.label.onmouseover=(this.label.style.cursor="pointer");}};HTMLLabel.prototype.doOnClick=function(e){if(parseBoolean(this.enabled)&&this.onclick){this.onclick(e);}};HTMLLabel.prototype.setHint=function(hint){this.callMethod(HTMLElementBase,"setHint",[hint]);if(this.label){let init=this.label.hint?false:true;if(this.label.getAttribute("data-original-title")){this.label.setAttribute("data-original-title",hint.replace(/(?:\r\n|\r|\n)/g,'<br />'));}else{this.label.hint=hint;this.label.alt=hint;this.label.title=hint.replace(/(?:\r\n|\r|\n)/g,'<br />');this.label.setAttribute("data-toggle","tooltip");this.label.setAttribute("data-html","true");if(init)bootstrapInitTooltip(this.label);}}};HTMLLabel.prototype.focus=function(){return false;};HTMLLabel.prototype.blur=function(){return false;};HTMLLabel.prototype.getPermissionDescription=function(){if(!isNullable(this.value))return this.value;return this.callMethod(HTMLElementBase,"getPermissionDescription");};HTMLLabel.prototype.flush=function(){if(this.label){if(this.label.onmousedown)this.label.onmousedown=null;if(this.label.onselectstart)this.label.onselectstart=null;this.label=null;}
this.hidden=null;this.callMethod(HTMLElementBase,"flush");};HTMLLabel.prototype.setColor=function(color){this.color=color;this.label.style.setProperty("color",color);};function HTMLButton(sys,formID,code,posX,posY,width,height,description,img){this.create(sys,formID,code,posX,posY,width,height,description,'');this.img=img?img:"";this.hint='';this.description=this.description.replace(/\&/g,'');this.remainNotDBAwareValue=false;this.buttonGroup=false;}
HTMLButton.inherits(HTMLElementBase);HTMLButton.prototype.name='HTMLButton';HTMLButton.prototype.tabKeys=[9];HTMLButton.prototype.tabable=true;HTMLButton.prototype.zindex=100000;HTMLButton.prototype.isBinary=true;HTMLButton.prototype.setDescription=function(description){this.description=description;if(this.buttonSpan)
this.buttonSpan.parentElement.removeChild(this.buttonSpan);this.buttonSpan=document.createElement("span");if(this.img&&this.img.length>0)
this.buttonSpan.className="ml-2";this.buttonSpan.innerHTML=this.description;this.button.appendChild(this.buttonSpan);};HTMLButton.prototype.setColor=function(color){this.color=color;this.button.style.color=color;};HTMLButton.prototype.setFont=function(f){this.button.style.fontFamily=f;};HTMLButton.prototype.setSize=function(s){if(s.indexOf("pt")==-1)s+="pt";this.button.style.fontSize=s;};HTMLButton.prototype.setWidth=function(width){width=parseInt(width);this.width=width;if(this.buttonGroup)return;if(this.div)this.div.style.width=width+"px";else if(this.button)this.button.style.width=width+"px";if(this.button)this.button.style.width=width+"px";};HTMLButton.prototype.setHeight=function(height){height=parseInt(height);this.height=height;if(this.buttonGroup)return;if(this.div)this.div.style.height=height+"px";else if(this.button)this.button.style.height=height+"px";if(this.button)this.button.style.height=height+"px";};HTMLButton.prototype.setOnClick=function(evt){this.onclick=evt;this.setEnabled(true);};HTMLButton.prototype.updateEvent=function(evt){if(evt=='click')this.setEnabled(this.enabled);};HTMLButton.prototype.setReadOnly=function(v){this.readOnly=v;if(this.onclick&&this.readOnly){this.setEnabled(!this.readOnly);}};HTMLButton.prototype.setEnabled=function(v){this.button.disabled=(!v||!this.onclick);this.enabled=v;if(this.image){var img=this.image.src;if(!this.enabled||!this.onclick){if(img.indexOf('_des.gif')==-1)this.image.src=img.replace('.gif','_des.gif');}else{if(img.indexOf('_des.gif')!=-1)this.image.src=img.replace('_des.gif','.gif');}}};HTMLButton.prototype.design=function(doc,tabControl){if(doc.buttonGroup===true){this.doc=doc;this.buttonGroup=true;this.posX=null;this.posY=null;this.width=null;this.height=null;this.designComponent(doc,tabControl);this.init(tabControl);}else this.callMethod(HTMLElementBase,"design",[doc,tabControl]);};HTMLButton.prototype.designComponent=function(doc){if(!this.buttonGroup)this.div.style.zIndex=this.zindex;else this.doc.style.zIndex=this.zindex;if(!this.img&&this.description.length==0){this.description="&nbsp";}
this.button=document.createElement("button");this.button.type="button";this.button.className="w-100 p-0 align-items-center btn";if(!this.tabable)this.button.tabIndex="-1";if(this.classCss&&this.classCss.trim().length>0){var classCssLowercaseTrim=this.classCss.toLowerCase().trim();if(classCssLowercaseTrim.startsWith("btn-")&&classCssLowercaseTrim.indexOf(" ")==-1){this.button.className+=" "+classCssLowercaseTrim;this.classCssDefined=true;}}else this.button.className+=" btn-primary";if(!this.buttonGroup)this.button.style.height=this.height+"px";if(this.img&&this.img.length>0){this.image=document.createElement("img");this.image.src=this.img;this.button.appendChild(this.image);}
if(this.description&&this.description.length>0){let span=document.createElement("span");if(this.img&&this.img.length>0)
span.className="ml-2";span.innerHTML=this.description;span.style.whiteSpace="pre-wrap";this.button.appendChild(span);this.buttonSpan=span;}else if(!this.img||this.img.length==0){this.button.innerHTML="&nbsp;";}
if(!this.buttonGroup){this.div.appendChild(this.button);}else{this.div=this.button;this.doc.appendChild(this.button);}
this.clickArea=this.button;this.attachEvent(this.button,'click',this.clickAction);this.input=this.clickArea;this.onfocus2=this.onfocus;this.onblur2=this.onblur;this.onfocus=this.buttonFocus;this.onblur=this.buttonBlur;if(this.parent&&isTypeOf(this.parent,"HTMLGrid")){this.tabKeys.push(13);}
this.setEnabled(this.enabled);};HTMLButton.prototype.focus=function(){var r=this.enabled&&!this.button.disabled&&this.visible&&!this.readonly&&!this.resizable&&!this.draggable;if(this.doc)r=r&&isVisibleDiv(this.doc);if(r&&this.clickArea)this.clickArea.focus();if(this.button.disabled)this.enabled=false;else this.enabled=true;return r;};HTMLButton.prototype.blur=function(){var r=this.enabled&&this.visible&&!this.readonly;if(r&&this.clickArea)this.clickArea.blur();return r;};HTMLButton.prototype.click=function(){if(this.button.onclick)this.button.onclick.call(this);};HTMLButton.prototype.finalizeAction=function(filename){if(this.onfinalize)this.onfinalize.call(this,filename);};HTMLButton.prototype.refresh=function(arg,filename){if(filename)this.finalizeAction(filename);else this.callMethod(HTMLElementBase,'refresh');};HTMLButton.prototype.createUploadAction=function(){this.setOnClick(this.getAction(this.openUpload));};HTMLButton.prototype.openUpload=function(){var w=250;var h=50;var left=(screen.width-w)/2;var top=(screen.height-h)/2;MM_openBrWindow('upload'+PAGES_EXTENSION+'?sys='+this.sys+'&formID='+this.formID+'&comID='+this.code+'&type=R','UPLOAD'+this.formID+this.code,'toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width='+w+',height='+h+',left='+left+',top='+top);};HTMLButton.prototype.getGridShowValue=function(grid,row,column,oldContent,newDataArray){return newDataArray[column];};HTMLButton.prototype.clickAction=function(e,o){this.focus();this.callMethod(HTMLElementBase,"clickAction",[e,o]);};HTMLButton.prototype.setImage=function(img){this.img=img;if(this.img&&this.img.length>0){if(this.image){this.image.src=this.img;}else{this.image=document.createElement("img");this.image.src=this.img;this.button.appendChild(this.image);}}else if(this.image){this.button.removeChild(this.image);this.image=null;}};HTMLButton.prototype.setHint=function(hint){this.callMethod(HTMLElementBase,"setHint",[hint]);if(this.button){let init=this.button.hint?false:true;if(this.button.getAttribute("data-original-title")){this.button.setAttribute("data-original-title",hint.replace(/(?:\r\n|\r|\n)/g,'<br />'));}else{this.button.hint=hint;this.button.alt=hint;this.button.title=hint.replace(/(?:\r\n|\r|\n)/g,'<br />');this.button.setAttribute("data-toggle","tooltip");this.button.setAttribute("data-html","true");if(init)bootstrapInitTooltip(this.button);}}};HTMLButton.prototype.keydownAction=function(e){if(this.enabled&&this.visible&&!this.readonly){var r=true;if(this.parent&&isTypeOf(this.parent,'HTMLGrid')){if(this.tabKeys.indexOf(13)==-1){this.tabKeys.push(13);}}
r=checkKey(e,this,this.tabKeys);if(this.onkeydown)r=this.onkeydown(e);return r;}else return true;};function HTMLImageButton(sys,formID,code,posX,posY,width,height,description,src){this.create(sys,formID,code,posX,posY,width,height,description,'');if(src){this.src=index!=-1?src.substring(0,index):src;var index=src.lastIndexOf(".gif");this.src=index!=-1?src.substring(0,index):src;}else this.src="";this.hint="";}
HTMLImageButton.inherits(HTMLElementBase);HTMLImageButton.prototype.name="HTMLImageButton";HTMLImageButton.prototype.tabable=true;HTMLImageButton.prototype.zindex=11;HTMLImageButton.prototype.tabKeys=[9];HTMLImageButton.prototype.tagName='a';HTMLImageButton.prototype.setImage=function(img){var index=src.lastIndexOf(".gif");this.src=index!=-1?src.substring(0,index):src;}
HTMLImageButton.prototype.setOnClick=function(onclick){this.onclick=onclick;this.setEnabled(this.enabled);}
HTMLImageButton.prototype.setEnabled=function(v){this.enabled=v;if(this.img){this.img.disabled=!v;if(!this.hideImage){if(this.enabled&&this.input){this.img.src=this.src+".gif?locale="+resources_locale;this.input.setAttribute("href","javascript:;");}else{this.img.src=this.src+"_des.gif?locale="+resources_locale;this.input.removeAttribute("href");}}}}
HTMLImageButton.prototype.setReadOnly=function(v){this.setEnabled(!v);}
HTMLImageButton.prototype.designComponent=function(doc){if(!this.hideImage){preload(this.src+".gif?locale="+resources_locale);preload(this.src+"_des.gif?locale="+resources_locale);preload(this.src+"_over.gif?locale="+resources_locale);}
this.img=document.createElement("img");this.img.setAttribute('border','0');this.img.alt=this.description;this.img.title=this.description;if(!this.hideImage){if(this.enabled)
this.img.src=this.src+".gif?locale="+resources_locale;else
this.img.src=this.src+"_des.gif?locale="+resources_locale;}
this.attachEvent(this.img,'mouseover',this.onmouseover);this.attachEvent(this.img,'mouseout',this.onmouseout);this.img.style.height=this.height+"px";this.img.style.width=this.width+"px";this.input=document.createElement("a");this.input.href="javascript:;";this.onclickCatch=this.onclick;this.onclick=this.onclickActionWrapper;this.input.appendChild(this.img);this.context.appendChild(this.input);}
HTMLImageButton.prototype.onmouseover=function(e){if(!this.hideImage){if(this.canFocus()){this.img.src=this.src+"_over.gif?locale="+resources_locale;}}}
HTMLImageButton.prototype.onmouseout=function(){if(!this.hideImage){if(this.canFocus()){this.img.src=this.src+".gif?locale="+resources_locale;}}}
HTMLImageButton.prototype.canFocus=function(){return this.enabled&&this.visible;}
HTMLImageButton.prototype.focus=function(){var canFocus=this.canFocus();if(canFocus){this.input.focus();if(window.event){if(window.event.preventDefault){window.event.preventDefault();window.event.stopPropagation();}else{try{window.event.keyCode=0;}catch(e){}
window.event.returnValue=false;}}}
return canFocus;}
HTMLImageButton.prototype.click=function(e){if(this.enabled&&this.visible&&!this.readonly){if(this.onclick)
this.onclick.call(this,e);}}
HTMLImageButton.prototype.onclickActionWrapper=function(e){if(!this.hideImage){if(this.onclickCatch){this.img.src=this.src+".gif?locale="+resources_locale;this.onclickCatch.call(this,e);}}}
var lookupCanBlur=true;function HTMLLookup(sys,formID,code,posX,posY,width,height,description,value,showValue){this.create(sys,formID,code,posX,posY,width,height,description,value);this.type=1;this.openSubForm=false;this.style=0;this.showValue=showValue;this.expand=true;this.report=false;this.initialType=2;this.filterOnKeyPress=false;this.placeholder="";this.lastTime=null;this.mobile=isMobile();this.isAboveOverlay=false;}
HTMLLookup.inherits(HTMLEdit);HTMLLookup.prototype.name='HTMLLookup';HTMLLookup.prototype.tabable=true;HTMLLookup.prototype.tagName='lookup';HTMLLookup.prototype.canSelectOnFocus=false;HTMLLookup.prototype.defaultArrowWidth=17;HTMLLookup.prototype.defaultComponentHeight=21;HTMLLookup.prototype.setVisible=function(v){this.callMethod(HTMLElementBase,"setVisible",[v]);if(!this.visible)this.removeLookup(true);};HTMLLookup.prototype.validateDataType=function(){return true;};HTMLLookup.prototype.setValue=function(value,checkDependences,ignoreShowValue){value=normalizeRuleParam(value,true);var oldValue=this.getValue();this.value=value;this.hidden.setValue(value);if(this.mobileInput){for(let j=0;j<this.mobileInput.options.length;j++){let opt=this.mobileInput.options[j];if(opt.value==value){opt.selected=true;break;}}}else if(this.lookupInput&&this.lookupInput.options){for(let j=0;j<this.lookupInput.options.length;j++){let opt=this.lookupInput.options[j];if(opt.getAttribute("data-value")==value){if(opt.setSelected)opt.setSelected(true);else this.lookupInput.selectedIndex=j;break;}}}
if(trim(this.value)!=trim(oldValue)){if(this.field==null||this.field.length==0){if(!ignoreShowValue){var url="lookupShowValue.do?sys="+this.sys+"&formID="+this.formID+"&comID="+this.code+"&value="+URLEncode(value,"GET");if(d.t&&d.t.dependences){var components=d.t.dependences[this.code];if(components&&components.length>0){for(var code in components){if(isNumeric(code)){var component=eval("$mainform().d.c_"+components[code]);if(component)url+=("&WFRInput"+component.getCode()+"="+URLEncode(component.getValue(),"GET"));}}}}
var show=getContent(url);this.setShowValue(show);}}
this.changeAction(null,this,!checkDependences);}};HTMLLookup.prototype.setShowValue=function(value){this.showValue=value;if(this.input)this.input.value=value;if(this.mobileInput){if(value==""){this.mobileInput.innerHTML="";}
var dummyOption=document.createElement("option");dummyOption.value="";dummyOption.innerText=value;dummyOption.selected=true;dummyOption.hidden=true;this.mobileInput.appendChild(dummyOption);}};HTMLLookup.prototype.getValue=function(){return this.hidden.value;};HTMLLookup.prototype.getShowValue=function(){return this.input.value;};HTMLLookup.prototype.designEditInput=function(doc,name,value){this.input=document.createElement("input");this.input.className="form-control";this.input.id='WFRInput'+this.code;this.input.parent=this;if(!name)this.input.name='WFRInput'+this.code;else this.input.name=name;if(this.placeholder)this.input.placeholder=this.placeholder;this.input.readOnly=(this.style==1);this.input.autocomplete="off";if(this.maxlength)this.input.maxLength=this.maxlength;if(this.align)this.input.style.textAlign=this.align;if(value)this.input.value=value;this.input.style.height=(this.style==0?(this.height-2):this.height)+"px";this.input.addEventListener('input',this.inputSearchTimer);};HTMLLookup.prototype.designInput=function(doc){if(this.style==0||this.style==1||this.style==2){this.designEditInput(doc,'WFRInput'+this.code+'Show',this.showValue);}};HTMLLookup.prototype.designComponentReport=function(){var labelReport=new HTMLLabel(this.sys,this.formID,this.code,0,0,this.width,this.height,this.showValue);labelReport.id="reportLabelLookup"+this.code;labelReport.design(this.context,false);};HTMLLookup.prototype.designComponent=function(doc){this.divClass=this.div.className;if(!this.filterOnKeyPress){this.tabKeys=arrayIndexRemove(this.tabKeys,2);}
this.dependent=true;this.url='search.do?inputRetornoName=WFRInput'+this.code+'Show&sys='+this.sys+'&action=search&formID='+this.formID+'&componentID='+this.code+'&xml=true';if(this.report){this.designComponentReport();return"";}
this.onkeydown=this.checkKey;var parentDiv=this.div;var object=this;if(this.style==0&&!this.toGrid){if(this.openSubForm&&this.subFormCode&&parseInt(this.subFormCode)>0){parentDiv=document.createElement("div");parentDiv.className="d-flex flex-row-reverse";this.div.appendChild(parentDiv);this.sfdiv=document.createElement("div");this.sfdiv.id="lookupSubform"+this.code;this.sfdiv.className="d-flex flex-column align-items-center justify-content-center px-2";var sfdivIcon=document.createElement("span");sfdivIcon.className="generic-btn fas fa-window-maximize";this.sfdiv.appendChild(sfdivIcon);var sfdivEvent=this.getAction('openForm');if(sfdivEvent)this.attachEvent(this.sfdiv,'click',sfdivEvent);parentDiv.appendChild(this.sfdiv);}}
if(this.openSubForm&&this.subFormCode&&parseInt(this.subFormCode)>0&&this.style==0){this.onF5press=this.getAction('openForm');}
this.hidden=new HTMLHidden(this.sys,this.formID,this.code,this.value);this.hidden.design(this.context);if(!this.mobile&&this.style==0){this.context=this.getBaseDiv();this.context.className="input-group lookup lookup-styled";this.context.style.height=this.div.style.height;this.contextClass=this.context.className;if(!this.enabled||this.readonly)this.context.className+=" disabled";parentDiv.appendChild(this.context);}
this.callMethod(HTMLEdit,'designComponent',[doc]);if(!this.contextClass)this.contextClass=this.context.className;if(!this.mobile&&this.style==0){this.loadingSpinner=document.createElement("div");this.loadingSpinner.className="spinner-border text-secondary align-self-center mx-2";this.loadingSpinner.style.width="1rem";this.loadingSpinner.style.height="1rem";this.loadingSpinner.style.display="none";this.context.appendChild(this.loadingSpinner);this.button=document.createElement("button");this.button.className="input-group-append";this.button.type="button";this.button.onclick=function(e){if(object.readonly)return false;return object.openDetails();};this.context.appendChild(this.button);if(this.readonly||!this.enabled){this.button.className+=" disabled";this.button.setAttribute("aria-disabled","true");}}
this.onblur_catch=this.onblur;this.onblur=this.doOnBlur;if(this.mobile){this.input.readOnly=true;this.input.style.display="none";this.mobileInput=document.createElement("select");this.mobileInput.className="custom-select";this.mobileInput.name="HTMLSelectMobile"+this.code;if(this.readonly||!this.enabled)this.mobileInput.setAttribute("disabled","disabled");this.mobileInput.style.left="0";this.mobileInput.style.width="100%";this.mobileInput.style.height=this.div.style.height;this.mobileInput.url=this.url;this.mobileInput.lookup=this;this.attachEvent(this.mobileInput,"change",this.lookupChangeSelectValue,this,this.mobileInput);this.attachEvent(this.mobileInput,"touchstart",this.showLookupResults,this,this.mobileInput);if(this.openSubForm&&parentDiv&&this.subFormCode&&parseInt(this.subFormCode)>0){parentDiv.appendChild(this.mobileInput);}else{this.div.appendChild(this.mobileInput);}
if(this.value&&this.value.length>0&&this.showValue&&this.showValue.length>0){var initialOption=document.createElement("option");initialOption.selected=true;initialOption.value=this.value;initialOption.innerHTML=stringToHTMLString(this.showValue);this.mobileInput.appendChild(initialOption);}}}
HTMLLookup.prototype.setReadOnly=function(v){this.readonly=v;if(this.div){if(this.readonly||!this.enabled)this.context.className=this.contextClass+" disabled";else this.context.className=this.contextClass;}
if(this.input)this.input.readOnly=(this.readonly||!this.enabled);if(this.button){if(this.readonly||!this.enabled){this.button.className="input-group-append disabled";this.button.setAttribute("aria-disabled","true");}else{this.button.className="input-group-append";this.button.removeAttribute("aria-disabled");}}
if(this.mobileInput){if(this.readonly||!this.enabled){this.mobileInput.setAttribute("disabled","disabled");}else{this.mobileInput.removeAttribute("disabled");}}};HTMLLookup.prototype.setEnabled=function(v){this.enabled=v;if(this.input)this.input.disabled=!this.enabled;if(this.button)this.button.style.pointerEvents=this.enabled?null:"none";if(this.button){if(this.readonly||!this.enabled){this.button.className="input-group-append disabled";this.button.setAttribute("aria-disabled","true");}else{this.button.className="input-group-append";this.button.removeAttribute("aria-disabled");}}
if(this.mobileInput){if(this.readonly||!this.enabled){this.mobileInput.setAttribute("disabled","disabled");}else{this.mobileInput.removeAttribute("disabled");}}};HTMLLookup.prototype.setColor=function(color){this.callMethod(HTMLEdit,'setColor',[color]);if(this.button)this.button.style.setProperty("color",color,"important");if(this.input)this.input.style.setProperty("color",color,"important");if(this.mobileInput)this.mobileInput.style.setProperty("color",color,"important");};HTMLLookup.prototype.setBGColor=function(color){this.callMethod(HTMLEdit,'setBGColor',[color]);if(this.button)this.button.style.setProperty("background-color",color,"important");if(this.input)this.input.style.setProperty("background-color",color,"important");if(this.mobileInput)this.mobileInput.style.setProperty("background-color",color,"important");};HTMLLookup.prototype.doOnBlur=function(evt){if(this.input.value==""&&this.hidden.value!=""){this.hidden.value="";this.hidden.hidden.value="";}
if(controller.activeElement==this){controller.activeElement=null;}
if(evt.relatedTarget!=this.button){this.timeout(this.doOnBlurTO,100);}};HTMLLookup.prototype.doOnBlurTO=function(evt){if(controller.activeElement!=this&&controller.activeElement!=this.button&&this.onblur_catch&&!this.lookup){this.onblur_catch.call(this,evt);}};HTMLLookup.prototype.checkKey=function(evt){if(!evt)evt=event;var keyCode=evt.keyCode||evt.which;var r=true;if(evt.ctrlKey){if(evt.key==" "||keyCode==32){this.changeLookupType(this,this.id);r=false;}else if(evt.key=="v"||keyCode==86){this.keyOn=true;r=true;}}
if(evt.key=="F2"||keyCode==113){if(this.button)this.button.click();r=true;}else if((evt.key=="ArrowDown"||keyCode==40)||(evt.key=="ArrowUp"||keyCode==38)){if(!this.lookupInput&&(evt.key=="ArrowDown"||keyCode==40)){this.openDetails();this.timeout(function(){this.lookupInput.focus();},100);}else if(this.lookupInput){this.lookupInput.focus();}
r=false;}else if((evt.key=="Escape"||keyCode==27)||(evt.key=="Tab"||keyCode==9)){if(!this.lookup){document.disableEvents=false;return true;}
this.closeCurrentLookup(evt);this.keyOn=false;r=false;}
if(evt.shiftKey){if(evt.key=="Enter"||keyCode==13){controller.next(this,true);}}
if(evt.key=="Enter"||keyCode==13){if(!this.filterOnKeyPress){if((this.keyControllerOn&&this.keyOn)||this.keyOn){this.lastTime=this.inputSearch();}else{if(!evt.shiftKey){controller.next(this,false);}}}else{if(this.lookupInput){this.lookupChangeSelectValue(evt,this.lookupInput);}}
r=false;}else{if(!(keyCode==27)&&!(keyCode==16)&&!(keyCode==18)&&!(keyCode==9)&&!evt.ctrlKey){this.keyControllerOn=false;this.keyOn=true;}else{this.keyControllerOn=true;}}
if(!r){document.disableEvents=true;if(evt.preventDefault){evt.preventDefault();evt.stopPropagation();}else{evt.keyCode=0;evt.returnValue=false;}
return false;}else{return true;}};HTMLLookup.prototype.openDetails=function(){if(!this.enabled||this.readonly)return false;if(this.lookup){this.removeLookup();}else{this.getDivDetails();var editedURL=this.url;if(d.t&&d.t.dependences){var components=d.t.dependences[this.code];if(components&&components.length>0){for(var code in components){if(isNumeric(code)){var component=eval("$mainform().d.c_"+components[code]);if(component){editedURL+=("&WFRInput"+component.getCode()+"="+URLEncode(component.getValue(),"GET"));}}}}}
this.timeout(this.showLookupResults,0,[editedURL+'&type=1&q=']);}};HTMLLookup.prototype.getDivDetails=function(){controller.activeElement=this;lookupCanBlur=false;if(this.lookup)this.removeLookup();this.lookup=document.createElement("div");this.lookup.className="position-absolute card";this.lookup.id="lookupDetails"+this.code;this.lookup.name="lookupLayer";this.lookup.style.visibility="visible";this.lookup.style.zIndex="1000001";var object=this;var updateDetailsLayout=function(){if(!object||!object.lookup)return;var lookupSelectElem=object.mobile?object.mobileInput:object.context;if(document.n&&document.n.responsive&&lookupSelectElem&&!object.toGrid){if(object.larguraExibicao==="0"||object.larguraExibicao===undefined){if(object.styleCss&&object.styleCss.length>0){object.lookup.style.width=parseInt(window.getComputedStyle(document.getElementById(object.id)).width)+"px";}else{object.lookup.style.width=lookupSelectElem.offsetWidth+"px";}}else{var pscreen=parseInt(document.getElementById("lay").style.width,10);object.lookup.style.width=((object.larguraExibicao*100)/pscreen)+"%";}
object.lookup.style.left=findPosX(lookupSelectElem)+"px";}else{if(object.larguraExibicao==="0"||object.larguraExibicao===undefined){if(object.styleCss&&object.styleCss.length>0){object.lookup.style.width=parseInt(window.getComputedStyle(document.getElementById(object.id)).width)+"px";}else{object.lookup.style.width=lookupSelectElem.offsetWidth+"px";}}else{object.lookup.style.width=object.larguraExibicao+"px";}
object.lookup.style.left=findPosX(lookupSelectElem)+"px";}
var lookupComponentHeight=lookupSelectElem.offsetHeight;var lookupComponentPosY=findPosY(lookupSelectElem);var lookupListHeight=object.lookup.offsetHeight;var lookupListPosY=parseInt(lookupComponentPosY+lookupComponentHeight);var lookupMinListHeight=100;var lookupListNavigationHeight=object.lookupNavigationBar&&object.lookupNavigationBar.offsetHeight>0?object.lookupNavigationBar.offsetHeight:33;var windowScrollY=window.scrollY;var windowHeight=window.innerHeight;var windowHeightWithScroll=windowHeight+windowScrollY;var itemHeight=object.lookupInput&&object.lookupInput.firstChild&&object.lookupInput.firstChild.offsetHeight>0?object.lookupInput.firstChild.offsetHeight:29;if(object.lookupDataLength&&object.lookupDataLength>0){var size=(object.lookupDataLength*itemHeight)+6;var maxListSize=(14*14)+6;if(size>maxListSize)size=maxListSize;size=(size-(size%itemHeight))+6;lookupListHeight=size+lookupListNavigationHeight;}
if(lookupListHeight>0&&lookupListPosY+Math.max(lookupListHeight,lookupMinListHeight)>windowHeightWithScroll){if(lookupComponentPosY-lookupListHeight>windowScrollY){if(lookupComponentPosY-lookupListHeight-windowScrollY<0){lookupListHeight=Math.max(lookupMinListHeight,lookupComponentPosY-windowScrollY);}
lookupListPosY=parseInt(lookupComponentPosY-lookupListHeight);}else if(lookupComponentPosY+lookupComponentHeight+lookupMinListHeight>windowHeightWithScroll){lookupListHeight=Math.max(lookupMinListHeight,(windowHeight-(windowHeight-lookupComponentPosY))-windowScrollY);lookupListPosY=parseInt(lookupComponentPosY-lookupListHeight);}else{lookupListHeight=Math.max(lookupMinListHeight,windowHeightWithScroll-lookupListPosY);}}
if(lookupListHeight>0)object.lookup.style.height=lookupListHeight+"px";object.lookup.style.top=lookupListPosY+"px";};this.lookup.updateDetailsLayout=updateDetailsLayout;window.addEventListener("resize",updateDetailsLayout);window.addEventListener("scroll",updateDetailsLayout);document.body.appendChild(this.lookup);updateDetailsLayout();this.lookupLoading=bootstrapCreateSpinner(this.lookup,"text-secondary",true)[0];}
HTMLLookup.prototype.getSearchLabel=function(type){var typeValue=(type||this.initialType);try{typeValue=parseInt(typeValue);if(!(/[1-4]/.test(typeValue)))typeValue=3;}catch(e){}
switch(typeValue){case 1:return getLocaleMessage("LABEL.EQUAL");case 2:return getLocaleMessage("LABEL.CONTAINING");case 4:return getLocaleMessage("LABEL.ENDING_WITH");default:return getLocaleMessage("LABEL.STARTING_WITH");}};HTMLLookup.prototype.getXMLDataOK=function(response,args){if(this.mobile)return getXMLContent(response);else args[0].showDataLookupResults(response.responseXML);};HTMLLookup.prototype.getXMLDataError=function(response,args){args[0].showDataLookupResults(null);};HTMLLookup.prototype.showLookupResultsAction=function(obj,url){if(this.haveTooltips){try{$(".lookup-nav-tooltip").tooltip("hide");}catch(e){}}
this.showLookupResults(url);};HTMLLookup.prototype.showLookupResults=function(url,type,query){if(this.mobile)this.showDataLookupResults(this.url);else getAsyncXMLContent(url,this.getXMLDataOK,this.getXMLDataError,[this]);};HTMLLookup.prototype.showDataLookupResults=function(xmldoc){var object=this;if(this.mobile){if(this.mobileInput){var url=this.url;if(d.t&&d.t.dependences){var components=d.t.dependences[this.code];if(components&&components.length>0){for(var code in components){if(isNumeric(code)){var component=eval("$mainform().d.c_"+components[code]);if(component)url+=("&WFRInput"+component.getCode()+"="+URLEncode(component.getValue(),"GET"));}}}}
url+='&type=1&q=';xmldoc=this.getXMLDataOK([url]);if(xmldoc!==null){var root=xmldoc.getElementsByTagName("r").item(0);if(!root){var ex=xmldoc.children[0].children[0].getAttribute("message");handleException(new Error(ex));return;}
var data=root.getElementsByTagName("d");if(data!==null){while(this.mobileInput.firstChild){this.mobileInput.removeChild(this.mobileInput.firstChild);}
for(var nodeID=0;nodeID<data.length;nodeID++){let option=document.createElement("option");let node=data.item(nodeID);let text="&nbsp;";option.value=node.getAttribute("v");option.setAttribute("data-value",node.getAttribute("v"));if(node&&node.firstChild&&node.firstChild.nodeValue&&trim(node.firstChild.nodeValue)!="")
text=node.firstChild.nodeValue;option.innerHTML=replaceAll(replaceAll(text,">","&gt;"),"<","&lt;");if(this.value&&option.value==this.value){option.selected=true;}
this.mobileInput.appendChild(option);}}}}}else{if(this.lookup){this.getDivDetails();if(xmldoc!=null){var root=xmldoc.getElementsByTagName('r').item(0);if(!root){var ex=xmldoc.children[0].children[0].getAttribute("message");handleException(new Error(ex));return;}
var data=root.getElementsByTagName('d');this.lookupDataLength=data.length;this.lookupInput=document.createElement("ul");this.lookupInput.id="lookupInput";this.lookupInput.className="list-group list-group-flush form-control rounded-0 border-0 overflow-auto p-0 w-100 h-100 rounded-0 border-0 position-relative";this.lookupInput.tabIndex=0;this.lookupInput.options=[];this.lookupInput.selectedIndex=-1;this.lookup.appendChild(this.lookupInput);let selectedOptionDisplayValue="";let firstOption=null;for(let nodeID=0;nodeID<data.length;nodeID++){let option=document.createElement("li");option.className="list-group-item list-group-item-action rounded-0 px-2 py-1";if(nodeID>=data.length-1)option.className+=" border-bottom-0";option.style.cursor="pointer";option.text="";option.selected=false;let node=data.item(nodeID);let nodeIndex=nodeID;option.setAttribute("data-value",node.getAttribute("v"));if(node&&node.firstChild&&node.firstChild.nodeValue&&trim(node.firstChild.nodeValue)!=""){option.text=node.firstChild.nodeValue;option.innerText=node.firstChild.nodeValue;}else{option.innerHTML="&nbsp;";}
option.setSelected=function(selected){if(selected){if(object.lookupInput.selectedOption&&object.lookupInput.selectedOption.setSelected){object.lookupInput.selectedOption.setSelected(false);}
if(!option.classList.contains("active"))
option.classList.add("active");option.setAttribute("data-selected","true");option.selected=true;object.lookupInput.selectedIndex=nodeIndex;object.lookupInput.selectedOption=option;}else{if(option.classList.contains("active"))
option.classList.remove("active");option.setAttribute("data-selected","false");option.selected=false;}};if(this.value&&node.getAttribute("v")==this.value){option.setSelected(true);selectedOptionDisplayValue=option.text;}
this.lookupInput.appendChild(option);this.lookupInput.options.push(option);option.addEventListener("click",function(evt){option.setSelected(true);object.lookupChangeSelectValue(evt,object.lookupInput);});if(nodeID>=1&&firstOption===null)firstOption=option;}
if(this.allowInsert&&this.lookupDataLength<=1&&this.input&&this.input.value.trim().length>0){this.lookupAddOptionText=this.input.value.trim();this.lookupInput.style.overflow="hidden";this.lookupInput.style.boxShadow="none";this.lookupAddOption=document.createElement("a");this.lookupAddOption.href="#";this.lookupAddOption.className="border-top w-100 px-2 py-1";this.lookupAddOption.innerHTML="<b>"+replaceAll(replaceAll(this.lookupAddOptionText,'>','&gt;'),'<','&lt;')+"</b><small class=\"ml-2\">("+getLocaleMessage("LABEL.ADD")+")</small>";this.lookup.appendChild(this.lookupAddOption);this.lookupDataLength++;this.lookupAddOption.addEventListener("click",function(){object.lookupChangeValue("",object.lookupAddOptionText,true);});}
if((this.value==="")||(this.input&&(this.input.value.trim().length==0||this.input.value!=selectedOptionDisplayValue))){if(firstOption)firstOption.setSelected(true);}
let nav=root.getElementsByTagName("navigation").item(0);this.lookupNavigationBar=document.createElement("div");this.lookupNavigationBar.className="card-footer d-flex flex-row-reverse p-2";if(this.div.offsetWidth>0&&this.div.offsetWidth<162)this.lookupNavigationBar.className+=" justify-content-center";this.haveTooltips=false;for(let nodeID=nav.childNodes.length-1;nodeID>=0;nodeID--){let navItem=document.createElement("div");navItem.className="generic-btn float-right d-flex align-items-center justify-content-center px-1";let node=nav.childNodes.item(nodeID);if(node.getAttribute("enabled").toLowerCase()=="true"){this.attachEvent(navItem,'click',this.showLookupResultsAction,this,[node.firstChild.nodeValue]);}else{navItem.className+=" disabled";}
let nodeTag=node.tagName.toLowerCase();let navItemIcon=document.createElement("span");navItemIcon.id="lookupNavigation"+capitalizeFirstLetter(nodeTag)+this.code;if(this.div.offsetWidth>0&&this.div.offsetWidth>=162)navItemIcon.className="px-2";if(nodeTag=="last"){navItemIcon.className=(navItemIcon.className+" fas fa-angle-double-right").trim();var tooltip=getLocaleMessage('LABEL.LAST_RECORD');if(tooltip){navItem.className+=" lookup-nav-tooltip";navItem.title=tooltip;navItem.setAttribute("data-toggle","tooltip");this.haveTooltips=true;}}else if(nodeTag=="next"){navItemIcon.className=(navItemIcon.className+" fas fa-chevron-right").trim();var tooltip=getLocaleMessage('LABEL.NEXT_RECORD');if(tooltip){navItem.className+=" lookup-nav-tooltip";navItem.title=tooltip;navItem.setAttribute("data-toggle","tooltip");this.haveTooltips=true;}}else if(nodeTag=="previous"){navItemIcon.className=(navItemIcon.className+" fas fa-chevron-left").trim();var tooltip=getLocaleMessage('LABEL.PREVIOUS_RECORD');if(tooltip){navItem.className+=" lookup-nav-tooltip";navItem.title=tooltip;navItem.setAttribute("data-toggle","tooltip");this.haveTooltips=true;}}else if(nodeTag=="first"){navItemIcon.className=(navItemIcon.className+" fas fa-angle-double-left").trim();var tooltip=getLocaleMessage('LABEL.FIRST_RECORD');if(tooltip){navItem.className+=" lookup-nav-tooltip";navItem.title=tooltip;navItem.setAttribute("data-toggle","tooltip");this.haveTooltips=true;}}
navItem.appendChild(navItemIcon);this.lookupNavigationBar.appendChild(navItem);}
this.lookup.appendChild(this.lookupNavigationBar);if(this.lookup.updateDetailsLayout){this.lookup.updateDetailsLayout();}
this.attachEvent(this.lookupInput,"keydown",this.lookupSelectPress);}
this.attachEvent(document,"click",this.closeCurrentLookup);if(this.haveTooltips){bootstrapInitTooltip(".lookup-nav-tooltip");$(".lookup-nav-tooltip").on("show.bs.tooltip",function(){$(".lookup-nav-tooltip").not(this).tooltip("hide");});}
if(this.lookupLoading){if(this.lookupLoading.remove){this.lookupLoading.remove();}else this.lookup.removeChild(this.lookupLoading);this.lookupLoading=null;}}else this.removeLookup();}};HTMLLookup.prototype.openForm=function(){eval(this.subFormOpenCommand);};HTMLLookup.prototype.openFormKeyboard=function(){eval(this.subFormOpenCommand);};HTMLLookup.prototype.changeLookupType=function(o,id){var object=this;var alt='';var lookupTypeIconDiv=document.createElement("div");lookupTypeIconDiv.className="position-absolute d-flex align-items-center justify-content-center h-100 px-2";lookupTypeIconDiv.style.width="2rem";lookupTypeIconDiv.style.top="0px";lookupTypeIconDiv.style.bottom="0px";lookupTypeIconDiv.style.zIndex="10";lookupTypeIconDiv.style.right=this.button?this.button.offsetWidth+"px":"0px";this.div.appendChild(lookupTypeIconDiv);var lookupTypeIcon=document.createElement("i");lookupTypeIconDiv.appendChild(lookupTypeIcon);if(this.initialType=='3'){this.initialType='1';lookupTypeIcon.className="fas fa-equals";alt=getLocaleMessage("LABEL.EQUAL");}else if(this.initialType=='4'){this.initialType='2';lookupTypeIcon.className="fas fa-file-alt";alt=getLocaleMessage("LABEL.CONTAINING");}else if(this.initialType=='2'){this.initialType='3';lookupTypeIcon.className="fas fa-caret-left";alt=getLocaleMessage("LABEL.STARTING_WITH");}else if(this.initialType=='1'){this.initialType='4';lookupTypeIcon.className="fas fa-caret-right";alt=getLocaleMessage("LABEL.ENDING_WITH");}
var accessibilitySpan=document.createElement("span");accessibilitySpan.className="sr-only";accessibilitySpan.innerHTML=alt;lookupTypeIconDiv.appendChild(accessibilitySpan);$(lookupTypeIconDiv).fadeIn(1000,function(){$(lookupTypeIconDiv).fadeOut(1000,function(){if(object&&object.div)object.div.removeChild(lookupTypeIconDiv);});});if(this.lookupInput){this.inputSearch();}};HTMLLookup.prototype.closeCurrentLookup=function(evt){if(this.haveTooltips)bootstrapCloseTooltip(".lookup-nav-tooltip");var target=evt.target||evt.srcElement;if(this.lookup&&(!this.button||target!=this.button.btdiv)){if(!target.id||target.id.indexOf('lookup')!=0){if(!(target.parentNode&&target.parentNode.id&&target.parentNode.id.indexOf('lookup')==0))this.removeLookup(true);}}
this.isTyping=false;};HTMLLookup.prototype.lookupChangeSelectValue=function(e,sel){if(this.mobile){if(sel.options[sel.selectedIndex]&&sel.options[sel.selectedIndex].getAttribute("data-value")!=0){this.lookupChangeValue(sel.options[sel.selectedIndex].getAttribute("data-value"),sel.options[sel.selectedIndex].text);}else{this.lookupChangeValue("","");}}else{if(sel.options[sel.selectedIndex]){if(this.isNullOrEmpty(sel.options[sel.selectedIndex].text))sel.options[sel.selectedIndex].text=sel.options[sel.selectedIndex].text.replace(/\s/g,'');this.lookupChangeValue(sel.options[sel.selectedIndex].getAttribute("data-value"),sel.options[sel.selectedIndex].text);}else{this.lookupChangeValue("","");}
this.keyOn=false;}};HTMLLookup.prototype.lookupChangeValue=function(v,t,add){this.setValue(v,true,true);this.setShowValue(t);if(add===true){this.lookupAddValue(t);}else{this.timeout(this.removeLookup,0);}};HTMLLookup.prototype.lookupAddValue=function(text){if(!this.allowInsert)return;this.loadingSpinner.style.display=null;getAndEval("componentData.do?action=componentData&sys="+URLEncode(this.sys,'GET')+"&formID="+URLEncode(this.formID,'GET')+"&comID="+URLEncode(this.code,'GET')+"&type=insert"+"&value="+URLEncode(text,'GET'));};HTMLLookup.prototype.afterInsert=function(){this.loadingSpinner.style.display="none";this.lookupDoSearch();if(this.input)this.input.value="";};HTMLLookup.prototype.removeLookup=function(nofocus){if(this.lookup&&this.lookup.parentNode){if(this.lookup.updateDetailsLayout){try{window.removeEventListener("resize",this.lookup.updateDetailsLayout);window.removeEventListener("scroll",this.lookup.updateDetailsLayout);}catch(e){}
this.lookup.updateDetailsLayout=null;}
if(this.haveTooltips){try{$(".lookup-nav-tooltip").tooltip("hide");}catch(e){}
this.haveTooltips=false;}
this.lookup.parentNode.removeChild(this.lookup);this.div.className=this.divClass;this.removeEvent(document,"click");if(!nofocus)this.focus();this.lookup=null;this.lookupInput=null;this.lookupNavigationBar=null;this.lookupDataLength=null;}
lookupCanBlur=true;};HTMLLookup.prototype.lookupSelectPress=function(evt){var keyCode=evt.keyCode||evt.which;var r=true;if(evt.key=="PageUp"||keyCode==33){var x=this.lookupInput.selectedIndex-10;if(x>this.lookupInput.options.length-1)x=this.lookupInput.options.length-1;else if(x<0)x=0;if(this.lookupInput.options&&this.lookupInput.options[x]&&this.lookupInput.options[x].setSelected){this.lookupInput.options[x].setSelected(true);}else this.lookupInput.selectedIndex=x;try{evt.preventDefault();evt.stopPropagation();if(this.lookupInput.options[x].parentElement){this.lookupInput.options[x].parentElement.scrollTop=this.lookupInput.options[x].offsetTop;}else{this.lookupInput.options[x].scrollIntoView();}}catch(e){}
r=false;}else if(evt.key=="PageDown"||keyCode==34){let x=this.lookupInput.selectedIndex+10;if(x>this.lookupInput.options.length-1)x=this.lookupInput.options.length-1;else if(x<0)x=0;if(this.lookupInput.options&&this.lookupInput.options[x]&&this.lookupInput.options[x].setSelected){this.lookupInput.options[x].setSelected(true);}else this.lookupInput.selectedIndex=x;try{evt.preventDefault();evt.stopPropagation();if(this.lookupInput.options[x].parentElement){this.lookupInput.options[x].parentElement.scrollTop=this.lookupInput.options[x].offsetTop;}else{this.lookupInput.options[x].scrollIntoView();}}catch(e){}
r=false;}else if((evt.key=="Escape"||keyCode==27)||(evt.key=="Tab"||keyCode==9)){this.removeLookup();r=false;}else if(keyCode==10||(evt.key=="Enter"||keyCode==13)){this.lookupChangeSelectValue(evt,this.lookupInput);r=false;}else if((evt.key=="ArrowDown"||keyCode==40)||(evt.key=="ArrowUp"||keyCode==38)){if(this.lookupInput.options&&this.lookupInput.options.length>0){let targetIndex=this.lookupInput.selectedIndex;if(evt.key=="ArrowDown"||keyCode==40)targetIndex++;else if(evt.key=="ArrowUp"||keyCode==38)targetIndex--;if(targetIndex>=this.lookupInput.options.length)
targetIndex=this.lookupInput.options.length-1;else if(targetIndex<0)targetIndex=0;if(this.lookupInput.options[targetIndex]&&this.lookupInput.options[targetIndex].setSelected){this.lookupInput.options[targetIndex].setSelected(true);}else this.lookupInput.selectedIndex=targetIndex;try{evt.preventDefault();evt.stopPropagation();if(this.lookupInput.options[targetIndex].parentElement){this.lookupInput.options[targetIndex].parentElement.scrollTop=this.lookupInput.options[targetIndex].offsetTop;}else{this.lookupInput.options[targetIndex].scrollIntoView();}}catch(e){}}else{this.lookupInput.focus();}}else if(!evt.altKey&&!evt.ctrlKey&&((evt.key=="ArrowRight"||keyCode==39)||(evt.key=="ArrowLeft"||keyCode==37))){var idx=this.lookupInput.selectedIndex;if(evt.key=="ArrowRight"||keyCode==39){var nav=document.getElementById("lookupNavigationNext"+this.code);if(nav)nav.click();}else if(evt.key=="ArrowLeft"||keyCode==37){var nav=document.getElementById("lookupNavigationPrevious"+this.code);if(nav)nav.click();}
if(this.lookupInput.options&&this.lookupInput.options[idx]&&this.lookupInput.options[idx].setSelected){this.lookupInput.options[idx].setSelected(true);}else this.lookupInput.selectedIndex=idx;this.lookupInput.focus();}
if(!r){document.disableEvents=true;if(evt.preventDefault){evt.preventDefault();evt.stopPropagation();}else{evt.keyCode=0;evt.returnValue=false;}
return false;}else return true;};HTMLLookup.prototype.lookupDoSearch=function(){var editedURL=this.url;if(d.t&&d.t.dependences){var components=d.t.dependences[this.code];if(components&&components.length>0){for(var code in components){if(isNumeric(code)){var component=eval("$mainform().d.c_"+components[code]);if(component){editedURL+=("&WFRInput"+component.getCode()+"="+URLEncode(component.getValue(),"GET"));}}}}}
this.showLookupResults(editedURL+'&type='+this.initialType+'&q='+URLEncode(this.input.value,"GET"),this.initialType,this.input.value);};HTMLLookup.prototype.freeComponent=function(){if(this.sfdiv)this.doc.removeChild(this.sfdiv);if(this.toGrid&&this.div)this.doc.removeChild(this.div);};HTMLLookup.prototype.setHint=function(hint){this.hint=hint;if(this.div){let init=this.div.hint?false:true;if(this.div.getAttribute("data-original-title")){this.div.setAttribute("data-original-title",hint.replace(/(?:\r\n|\r|\n)/g,'<br />'));}else{this.div.setAttribute("data-toggle","tooltip");this.div.setAttribute("data-html","true");this.div.hint=hint;this.div.title=hint.replace(/(?:\r\n|\r|\n)/g,'<br />');if(init)bootstrapInitTooltip(this.div);}}};HTMLLookup.prototype.hasEmptyValue=function(){return(this.getValue()==this.emptyKeyValue);};HTMLLookup.prototype.inputSearch=function(){this.getDivDetails();this.lookupDoSearch();this.isTyping=true;};HTMLLookup.prototype.inputSearchTimer=function(){if(this.parent.filterOnKeyPress){if(this.parent.lastTime){clearTimeout(this.parent.lastTime);this.parent.lastTime=this.parent.timeout(this.parent.inputSearch,300);}else{this.parent.lastTime=this.parent.timeout(this.parent.inputSearch,300);}}};HTMLLookup.prototype.onFormEditMode=function(){if(this.isAboveOverlay&&this.div&&this.div.style.zIndex==100000&&d.n.visible){if(this.openSubForm&&this.subFormCode&&parseInt(this.subFormCode)>0&&this.style==0){this.div.style.zIndex=this.zindex;if(this.inputOverlay){this.context.removeChild(this.inputOverlay);this.inputOverlay=null;if(this.label){if(this.labelPreventEvt)this.label.removeEventListener("click",this.labelPreventEvt);if(this.inputOverlayEvt)this.label.removeEventListener("dblclick",this.inputOverlayEvt);this.labelPreventEvt=null;}
this.inputOverlayEvt=null;}
this.isAboveOverlay=false;}}};HTMLLookup.prototype.onFormViewMode=function(){if(!this.isAboveOverlay&&this.div&&this.div.style.zIndex!=100000&&d.n.visible){if(this.openSubForm&&this.subFormCode&&parseInt(this.subFormCode)>0&&this.style==0){this.div.style.zIndex=100000;if(!this.inputOverlay){this.inputOverlay=document.createElement("div");this.inputOverlay.style.position="absolute";this.inputOverlay.style.top="0px";this.inputOverlay.style.left="0px";this.inputOverlay.style.right="0px";this.inputOverlay.style.bottom="0px";this.inputOverlay.style.zIndex=10;this.context.appendChild(this.inputOverlay);var object=this;this.inputOverlayEvt=function(){if(object&&object.tab&&object.tab.dblClickAction&&object.tab.parent&&object.tab.parent.editWithDoubleClick){object.tab.dblClickAction();}};this.inputOverlay.addEventListener("dblclick",this.inputOverlayEvt);if(!this.labelPreventEvt&&this.label){this.labelPreventEvt=function(e){e.preventDefault();};this.label.addEventListener("click",this.labelPreventEvt);this.label.addEventListener("dblclick",this.inputOverlayEvt);}}
this.isAboveOverlay=true;}}};HTMLLookup.prototype.isNullOrEmpty=function(value){return(value==null||typeof value=='undefined'||trim(value+'')==''||value.toString()=='NaN');}
function HTMLTabController(sys,formID,posX,posY,width,height,hideTab){this.sys=sys;this.formID=formID;this.posX=posX;this.posY=posY;this.width=width;this.height=height;this.tabs=new Array();this.tabsByName=new Array();this.showTabButtons=true;this.useReadOnlyDiv=true;this.hideTab=hideTab;this.editWithDoubleClick=true;this.searchTab=null;this.currentTab=null;this.lastCreatedTab=null;}
HTMLTabController.inherits(HTMLElementBase);HTMLTabController.prototype.name='HTMLTabController';HTMLTabController.prototype.toString=function(){return'[object '+this.name+']';};HTMLTabController.prototype.view=function(){for(var i=0;i<this.tabs.length;i++){this.tabs[i].view();}};HTMLTabController.prototype.edit=function(){for(var i=0;i<this.tabs.length;i++){this.tabs[i].edit();}};HTMLTabController.prototype.setSearchTabVisible=function(visible){if(this.searchTab)this.searchTab.setVisible(visible);};HTMLTabController.prototype.add=function(description,onclick,onexit,imgSrc){return this.addTab(description,onclick,onexit,imgSrc,false);};HTMLTabController.prototype.addSearchTab=function(description,onclick,onexit,imgSrc){return this.addTab(description,onclick,onexit,imgSrc,true);};HTMLTabController.prototype.addTab=function(description,onclick,onexit,imgSrc,searchTab){var tab=new HTMLTab(this.tabs.length,description,this,onclick,onexit,imgSrc);tab.searchTab=searchTab;tab.showTabButtons=this.showTabButtons;tab.color=this.color;if(!this.editWithDoubleClick)tab.editWithDoubleClick=false;if(searchTab)this.searchTab=tab;tab.design(this.navdiv,this.tabs.length==0);this.tabs.push(tab);this.tabsByName[description]=tab;this.lastCreatedTab=tab;if(this.tabs.length==1)tab.select(true);return tab.div;};HTMLTabController.prototype.showTab=function(){};HTMLTabController.prototype.getTabByName=function(name){try{return this.tabsByName[name];}
catch(e){return null;}};HTMLTabController.prototype.getTabByDiv=function(div){for(var i=0;i<this.tabs.length;i++){if(this.tabs[i].div==div){return this.tabs[i];}}};HTMLTabController.prototype.getDiv=function(name){if(!name){if(this.lastCreatedTab&&this.lastCreatedTab.div){return this.lastCreatedTab.div;}}else{var t=this.tabsByName[name];if(t)return t.div;}
return this.doc;};HTMLTabController.prototype.getSelectedTabIndex=function(){if(!this.tabs||this.tabs.length==0)return-1;for(var i=0;i<this.tabs.length;i++)
if(this.tabs[i].selected)return i;return-1;};HTMLTabController.prototype.getSelectedTab=function(){var index=this.getSelectedTabIndex();if(index>=0)return this.tabs[index];return null;};HTMLTabController.prototype.openTabByIndex=function(index){var tab=this.tabs[index];if(tab&&tab.getVisible()){tab.clickAction();return tab;}
return null;};HTMLTabController.prototype.getTabInterval=function(){var firstTabPosition=0;for(var j=0;j<this.tabs.length;j++){if(this.tabs[j]&&this.tabs[j].getVisible()){firstTabPosition=j;break;}}
var lastTabPosition=this.tabs.length-1;for(var j=(this.tabs.length-1);j>=0;j--){if(this.tabs[j]&&this.tabs[j].getVisible()){lastTabPosition=j;break;}}
return{first:firstTabPosition,last:lastTabPosition};};HTMLTabController.prototype.openPreviousTab=function(){var selectedTabIndex=this.getSelectedTabIndex();var tabInterval=this.getTabInterval();var first=tabInterval.first;var last=tabInterval.last;if(first<last){if(selectedTabIndex==first){return this.openTabByIndex(last);}else if(selectedTabIndex>0){return this.openTabByIndex(selectedTabIndex-1);}}
return null;};HTMLTabController.prototype.openNextTab=function(){var selectedTabIndex=this.getSelectedTabIndex();var tabInterval=this.getTabInterval();var first=tabInterval.first;var last=tabInterval.last;if(first<last){if(selectedTabIndex==last){return this.openTabByIndex(first);}else if(selectedTabIndex>=0){return this.openTabByIndex(selectedTabIndex+1);}}
return null;};HTMLTabController.prototype.openFirstTab=function(){var tabInterval=this.getTabInterval();return(tabInterval.first>=0)?this.openTabByIndex(tabInterval.first):null;};HTMLTabController.prototype.openLastTab=function(){var tabInterval=this.getTabInterval();return(tabInterval.last>=0)?this.openTabByIndex(tabInterval.last):null;};HTMLTabController.prototype.design=function(doc){if(!this.code)this.code=getRandomCode();this.navdiv=document.createElement("ul");this.navdiv.id="tabsController"+this.code;this.navdiv.className="nav nav-tabs flex-sm-nowrap"+(!this.showTabButtons?" d-none":"");this.navdiv.style.flex="0 0 auto";this.navdiv.setAttribute("role","tablist");this.div=document.createElement("div");this.div.className="tab-content d-flex flex-fill w-100";this.div.id="tabsContent"+this.code;if(this.bgImage)this.setBackgroundImage(this.bgImage,this.bgImageMode);if(this.verticalCentered&&!this.responsive){this.div.className+=" align-items-center";}
if(navigationFixed&&d&&d.formNavDiv){d.formNavDiv.appendChild(this.navdiv);}else{doc.appendChild(this.navdiv);}
doc.appendChild(this.div);this.doc=doc;};HTMLTabController.prototype.getDistanceFromTop=function(){return this.div?this.div.offsetTop:0;};HTMLTabController.prototype.setBackgroundImage=function(img,viewMode){this.bgImage=img;this.bgImageMode=viewMode;if(this.div){this.div.style.backgroundImage="url("+img+")";if(viewMode){if(viewMode=="no-repeat"){this.div.style.backgroundRepeat=viewMode;this.div.style.backgroundPosition="center";this.div.style.backgroundSize=null;this.div.style.backgroundAttachment=null;}else if(viewMode=="stretch"){this.div.style.backgroundRepeat="no-repeat";this.div.style.backgroundPosition="center center";this.div.style.backgroundSize="cover";this.div.style.backgroundAttachment="fixed";}else{this.div.style.backgroundRepeat=viewMode;this.div.style.backgroundPosition="top left";this.div.style.backgroundSize=null;this.div.style.backgroundAttachment=null;}}}};HTMLTabController.prototype.flush=function(){for(i=0;i<this.tabs.length;i++)
this.tabs[i].flush();for(var i in this){if(this[i]){removeEvents(this[i]);this[i]=null;}}};HTMLTabController.prototype.setVisible=function(name,v){var t=this.tabsByName[name];if(t){if(!v&&t.selected){var foundTabPosition=-1;for(var i in this.tabs){if(this.tabs[i]&&this.tabs[i].description==name){this.tabs[i].selected=false;foundTabPosition=i;break;}}
var firstTabPosition=0;for(var j=0;j<this.tabs.length;j++){if(this.tabs[j]&&this.tabs[j].getVisible()){firstTabPosition=j;break;}}
var lastTabPosition=this.tabs.length-1;for(var j=(this.tabs.length-1);j>=0;j--){if(this.tabs[j]&&this.tabs[j].getVisible()){lastTabPosition=j;break;}}
if(foundTabPosition==firstTabPosition){var j=foundTabPosition;while(++j<this.tabs.length){var temp=this.tabs[j];if(temp&&temp.getVisible()){this.openTab(temp.description);break;}}}else if(foundTabPosition==lastTabPosition){for(var j=lastTabPosition-1;j>=firstTabPosition;j--){var temp=this.tabs[j];if(temp&&temp.getVisible()){this.openTab(temp.description);break;}}}else{var j=foundTabPosition;while(--j!=foundTabPosition){var temp=this.tabs[j];if(temp&&temp.getVisible()){this.openTab(temp.description);break;}else if(j==firstTabPosition){j=this.tabs.length;}}}}
t.setVisible(v);}};HTMLTabController.prototype.openSearchTab=function(){if(this.searchTab)this.searchTab.clickAction();};HTMLTabController.prototype.openTab=function(name){var t=this.tabsByName[name];if(t)t.clickAction();if(this.isCallFunction)this.isCallFunction=false;};function HTMLTab(index,description,parent,onclick,onexit,imgSrc){this.index=index;this.showTabButtons=true;this.sys=parent.sys;this.formID=parent.formID;this.description=description;this.onclick=onclick;this.onexit=onexit;this.parent=parent;this.selected=false;this.self=this;this.imgSrc=imgSrc;this.editMode=false;this.useReadOnlyDiv=parent.useReadOnlyDiv;this.searchTab=false;this.onshown=[];this.onhidden=[];}
HTMLTab.inherits(HTMLObject);HTMLTab.prototype.name='HTMLTab';HTMLTab.prototype.design=function(doc,select){this.selected=select?true:false;if(!this.parent.hideTab&&this.showTabButtons){this.tab=document.createElement("li");this.tab.className="nav-item overflow-hidden";this.tab.style.maxWidth="max-content";this.label=document.createElement("a");this.label.id="tabButton"+this.index;this.label.href="#tab"+this.index;this.labelClass="nav-link overflow-hidden w-auto outline-0 px-3 py-1";this.label.className=this.labelClass+(this.selected?" active":"");this.label.style.fontSize="0.9rem";this.label.style.textOverflow="ellipsis";this.label.title=this.description;this.label.setAttribute("role","tab");this.label.setAttribute("data-toggle","tab");this.label.setAttribute("aria-controls","tab"+this.index);this.label.setAttribute("aria-selected",(this.selected?"true":"false"));var labelSpan=document.createElement("span");labelSpan.className="text-truncate";labelSpan.innerHTML=this.description.replace(/\s/g,"&nbsp;");this.label.appendChild(labelSpan);this.tab.appendChild(this.label);doc.appendChild(this.tab);this.attachEvent(this.tab,'click',this.clickAction);}
this.div=document.createElement("div");this.div.id="tab"+this.index;this.div.setAttribute("webrun-tab-mode","view");this.divClass="tab-pane position-relative w-100 flex-fill";if(this.searchTab){this.divClass+=" overflow-hidden tab-search";}else{this.divClass+=" overflow-visible";this.div.style.minHeight=this.parent.height+"px";}
this.divClassSelected=this.divClass+" show active";this.div.className=this.selected?this.divClassSelected:this.divClass;this.div.tab=this;if(this.color)this.div.style.background=this.color;this.div['focus']=this.getAction('focus');EventCache.add(this.div,'focus',this.div['focus']);this.attachEvent(this.div,'onmousedown',this.cantSelect);this.attachEvent(this.div,'selectstart',this.cantSelect);this.div['canFocus']=this.getAction('canFocus');EventCache.add(this.div,'canFocus',this.div['focus']);this.div['tabName']=this.description;this.parent.div.appendChild(this.div);if(this.parent.useReadOnlyDiv){this.viewDiv=document.createElement("div");this.viewDiv.className="form-overlay";if(this.parent.editWithDoubleClick)
this.attachEvent(this.viewDiv,'dblclick',this.dblClickAction);this.div.appendChild(this.viewDiv);}
this.attachEvent(this.div,'click',this.clickDivAction);};HTMLTab.prototype.isSearchTab=function(){return this.searchTab;};HTMLTab.prototype.clickDivAction=function(e){var target=e.target||e.srcElement;if(target==this.div)controller.activeElement=this;};HTMLTab.prototype.cantSelect=function(e){var target=e.target||e.srcElement;return(target!=this.div);};HTMLTab.prototype.dblClickAction=function(){if(this.parent.nav){var nav=this.parent.nav;if(nav.canEdit){nav.focusXY=true;nav.mX=mX;nav.mY=mY;if(this.tab)nav.findPosY=findPosY(this.tab);nav.actEdit();}}};HTMLTab.prototype.canFocus=function(){var r=this.editMode||!this.useReadOnlyDiv;if(r&&!this.parent.showTabButtons)
r=r&&this==this.parent.selected;return r;};HTMLTab.prototype.focus=function(){return this.select();};HTMLTab.prototype.view=function(){if(this.parent.useReadOnlyDiv)
this.viewDiv.className="form-overlay";this.div.setAttribute("webrun-tab-mode","view");this.editMode=false;try{if(controller&&controller.elems&&controller.elems.length>0){for(var i=0;i<controller.elems.length;i++){if(controller.elems[i]&&controller.elems[i].onFormViewMode){controller.elems[i].onFormViewMode();}}}}catch(e){}};HTMLTab.prototype.edit=function(){if(this.parent.useReadOnlyDiv)
this.viewDiv.className="form-overlay disabled";this.div.setAttribute("webrun-tab-mode","edit");this.editMode=true;try{if(controller&&controller.elems&&controller.elems.length>0){for(var i=0;i<controller.elems.length;i++){if(controller.elems[i]&&controller.elems[i].onFormEditMode){controller.elems[i].onFormEditMode();}}}}catch(e){}};HTMLTab.prototype.blur=function(){return true;};HTMLTab.prototype.clickAction=function(e){if(this.parent.currentTab&&this.parent.currentTab.onexit)
this.parent.currentTab.onexit();this.parent.currentTab=this.self;if(this.onclick){if(this.onclick.load)this.onclick.load(e);else this.onclick(this.self.description,this.parent.selected.description);}
this.select();};HTMLTab.prototype.setVisible=function(v){if(this.label)this.label.className=v?this.labelClass:"d-none";};HTMLTab.prototype.rename=function(description){this.description=description;this.div['tabName']=description;var tabsByNameNew=new Array();for(var index in this.tabsByName){if(typeof index=='function')continue;if(index==description){tabsByNameNew[index]=this;}else{tabsByNameNew[index]=this.tabsByName[index];}}
this.tabsByName=tabsByNameNew;if(this.label)this.label.innerHTML=this.description.toString().replace(/\s/g,"&nbsp;");};HTMLTab.prototype.toString=function(){return'[object HTMLTab '+this.description+']';};HTMLTab.prototype.select=function(first){if(!first&&!this.getVisible())
return false;if(this.parent.selected!=this){if(this.parent.selected){if(this.parent.selected.label){this.parent.selected.label.className="nav-link";this.parent.selected.label.setAttribute("aria-selected","false");}
if(this.label){this.label.setAttribute("aria-selected","true");this.label.className=this.labelClass+" active";}}
if(this.editMode&&controller.activeElement&&controller.activeElement.blur){controller.activeElement.blur();}
this.selected=true;this.div.className=this.divClassSelected;if(this.parent.selected)this.parent.selected.unSelect();this.parent.selected=this;this.parent.currentTab=this;if(this.editMode)controller.focusTabFirst();if(this.onshown&&this.onshown.length>0){for(var i=0;i<this.onshown.length;i++){if(this.onshown[i])this.onshown[i].call(this,this.div);}}}
return true;};HTMLTab.prototype.getVisible=function(){if(this.parent.isCallFunction)return true;return(this.label&&this.label.className.indexOf("d-none")==-1);};HTMLTab.prototype.unSelect=function(){if(this.label){this.label.setAttribute("aria-selected","false");this.label.className=this.labelClass;}
this.selected=false;this.div.className=this.divClass;if(this.onhidden&&this.onhidden.length>0){for(var i=0;i<this.onhidden.length;i++){if(this.onhidden[i])this.onhidden[i].call(this,this.div);}}
return true;};HTMLTab.prototype.onMouseOver=function(e,elem){};HTMLTab.prototype.onMouseOut=function(e,elem){};HTMLTab.prototype.flush=function(){for(var i in this){if(this[i])removeEvents(this[i]);}};HTMLTab.prototype.free=function(notRemoveFromDoc){if(this.parent&&this.parent.div)
this.parent.div.removeChild(this.div);if(this.tab&&this.tab.parentNode)
this.tab.parentNode.removeChild(this.tab);return this;};HTMLTab.prototype.addShownListener=function(func){this.onshown.push(func);};HTMLTab.prototype.removeShownListener=function(func){var index=this.onshown.indexOf(func);if(index!==-1)this.onshown.splice(index,1);};HTMLTab.prototype.addHiddenListener=function(func){this.onhidden.push(func);};HTMLTab.prototype.removeHiddenListener=function(func){var index=this.onhidden.indexOf(func);if(index!==-1)this.onhidden.splice(index,1);};HTMLTab.prototype.getDistanceFromTop=function(){return this.parent.getDistanceFromTop();};function HTMLComboBox(sys,formID,code,posX,posY,width,height,description,value,showValue){this.create(sys,formID,code,posX,posY,width,height,description,value);}
HTMLComboBox.inherits(HTMLLabeledComponent);HTMLComboBox.prototype.name='HTMLComboBox';HTMLComboBox.prototype.tagName='input';HTMLComboBox.prototype.setBGColor=function(color){this.bgColor=color;if(this.input)this.input.style.backgroundColor=color;};HTMLComboBox.prototype.setColor=function(color){this.color=color;if(this.input)this.input.style.color=color;};HTMLComboBox.prototype.setReadOnly=function(v){this.callMethod(HTMLElementBase,"setReadOnly",[v]);if(this.input)this.input.disabled=!this.enabled||this.readonly;};HTMLComboBox.prototype.add=function(key,value){this.values=this.values.concat([value]);this.keys=this.keys.concat([key]);this.designOption(key,value);this.itemAddedAction(key,value);};HTMLComboBox.prototype.removeByIndex=function(idx){if(idx>=0&&idx<this.keys.length){var itemKey=this.values[idx];var itemValue=this.values[idx];this.keys.splice(idx,1);this.values.splice(idx,1);this.input.options[idx]=null;this.itemRemovedAction(itemKey,itemValue);}else interactionError(getLocaleMessage("ERROR.INEXISTENT_ELEMENT_KEY"),key);};HTMLComboBox.prototype.removeByKey=function(key){var idx=arrayIndexOf(this.keys,key);if(idx!=-1){var itemValue=this.values[idx];this.keys.splice(idx,1);this.values.splice(idx,1);var countItens=this.input.childElementCount;for(i=1;i<countItens;i++){if(this.input.options[i].value===key){this.input.options[i]=null;return;}}
this.itemRemovedAction(key,itemValue);}else interactionError(getLocaleMessage("ERROR.INEXISTENT_ELEMENT_KEY"),key);};HTMLComboBox.prototype.clean=function(){this.keys=new Array();this.values=new Array();if(this.input){this.input.innerHTML="";this.designPlaceholder();}};HTMLComboBox.prototype.length=function(){return this.keys?this.keys.length:this.values?this.values.length:0;};HTMLComboBox.prototype.setValue=function(value,checkDependences){if(value!==undefined&&value!==null&&typeof value==='string')
value=value.trim();value=normalizeRuleParam(value,true);var currentValue=this.getValue();if(typeof currentValue==='string'){currentValue=currentValue.trim();}
var idx=arrayIndexOf(this.keys,value,this.typeName)+1;if(idx<=0)value="";else this.input.selectedIndex=idx;this.value=value;this.hidden.setValue(value);this.input.value=value;if(this.value!=currentValue){this.changeAction(null,this,!checkDependences);}};HTMLComboBox.prototype.getShowValue=function(){return this.input.options[this.input.selectedIndex].text;};HTMLComboBox.prototype.getValue=function(){return this.input?this.input.value:this.value;};HTMLComboBox.prototype.inputChanged=function(e,sel){this.parent.setValue(this.value);};HTMLComboBox.prototype.designComponent=function(doc){if(this.beforeComponentDesign){this.beforeComponentDesign(doc);}
this.hidden=new HTMLHidden(this.sys,this.formID,this.code,this.value);this.hidden.design(this.context);if(this.report){this.designComponentReport();return"";}
this.onblur_catch=this.onblur;this.onkeydown=this.checkKey;this.input=document.createElement("select");this.input.className="custom-select d-flex align-self-start";this.input.style.height=this.div.style.height;this.context.appendChild(this.input);this.designPlaceholder();if(this.keys&&this.keys.length>0){for(var i=0;i<this.keys.length;i++){this.designOption(this.keys[i],this.values[i]);}
if(this.value){var idx=arrayIndexOf(this.keys,this.value,this.typeName)+1;if(idx>0)this.input.selectedIndex=idx;}}
if(this.hint)this.setHint(this.hint);this.input.parent=this;this.input.addEventListener("change",this.inputChanged,false);if(this.afterComponentDesign){this.afterComponentDesign(doc);}};HTMLComboBox.prototype.designPlaceholder=function(){this.emptyOption=document.createElement("option");this.emptyOption.value="";if(this.placeholder)this.emptyOption.innerHTML=replaceAll(replaceAll(this.placeholder,'>','&gt;'),'<','&lt;');this.emptyOption.setAttribute("selected","selected");this.input.appendChild(this.emptyOption);};HTMLComboBox.prototype.designOption=function(key,value){var option=document.createElement("option");option.value=key;if(value)option.innerHTML=replaceAll(replaceAll(value,'>','&gt;'),'<','&lt;');this.input.appendChild(option);};HTMLComboBox.prototype.itemAddedAction=function(key,value){};HTMLComboBox.prototype.itemRemovedAction=function(key,value){};function HTMLCheckbox(sys,formID,code,posX,posY,width,height,description,value,valueCheck,valueUnCheck){this.create(sys,formID,code,posX,posY,width,height,description,'');this.style=1;this.nodesc=false;this.value=value;this.valueCheck=valueCheck;this.valueUnCheck=valueUnCheck;this.inputname='WFRInput'+this.code;}
HTMLCheckbox.inherits(HTMLElementBase);HTMLCheckbox.prototype.name='HTMLCheckBox';HTMLCheckbox.prototype.tabable=true;HTMLCheckbox.prototype.setEnabled=function(v){this.callMethod(HTMLElementBase,"setEnabled",[v]);this.updateLayout();};HTMLCheckbox.prototype.setHint=function(hint){this.callMethod(HTMLElementBase,"setHint",[hint]);if(this.label){let init=this.label.hint?false:true;if(this.label.getAttribute("data-original-title")){this.label.setAttribute("data-original-title",hint.replace(/(?:\r\n|\r|\n)/g,'<br />'));}else{this.label.hint=hint;this.label.alt=hint;this.label.title=hint.replace(/(?:\r\n|\r|\n)/g,'<br />');this.label.setAttribute("data-toggle","tooltip");this.label.setAttribute("data-html","true");if(init)bootstrapInitTooltip(this.label);}}};HTMLCheckbox.prototype.setReadOnly=function(v){this.callMethod(HTMLElementBase,"setReadOnly",[v]);if(this.context){if(!this.readonly)
this.context.style.removeProperty("pointer-events");else
this.context.style.setProperty("pointer-events","none");}
this.updateLayout();};HTMLCheckbox.prototype.setColor=function(color){this.color=color;if(this.label)this.label.style.color=color;};HTMLCheckbox.prototype.setBGColor=function(color){this.bgColor=color;if(this.div)this.div.style.backgroundColor=color;};HTMLCheckbox.prototype.getGridShowValue=function(grid,row,column,oldContent,newDataArray){var eventCmd=("d.c_"+grid.code+".checkCmd("+this.code+", "+(row-1)+", "+column+")");return grid.gridCheckBox(this.status,this.valueCheck,this.valueUnCheck,this.code,row,{enabled:this.getEnabled(),readonly:this.getReadOnly(),hint:this.hint},eventCmd);};HTMLCheckbox.prototype.getValue=function(){return this.hidden.getValue();};HTMLCheckbox.prototype.updateLayout=function(){if(this.valueCheck==this.value){this.status=1;this.input.checked=true;}else if(this.valueUnCheck==this.value){this.status=0;this.input.checked=false;}else{this.status=2;this.input.checked=false;}};HTMLCheckbox.prototype.designComponent=function(doc){this.hidden=new HTMLHidden(this.sys,this.formID,this.code,this.value);this.hidden.inputname=this.inputname;this.hidden.design(this.div);this.context=this.getBaseDiv(false);this.context.className="custom-control custom-checkbox";this.div.appendChild(this.context);this.input=document.createElement("input");this.input.id=this.id+"-checkbox";this.input.type="checkbox";this.input.className="custom-control-input";this.context.appendChild(this.input);this.attachEvent(this.input,"click",this.clickAction);this.label=document.createElement("label");this.label.className="custom-control-label h-100";this.label.style.overflow="visible";this.label.style.lineHeight=this.height+"px";this.label.setAttribute("for",this.input.id);this.label.innerHTML=!this.wordWrap?this.description.replace(/\s/g,'&nbsp;'):this.description;this.context.appendChild(this.label);this.updateLayout();};HTMLCheckbox.prototype.keyPressedAction=function(evt){var key=getKey(evt);var r=true;if(key==32&&!isFirefox){this.click();r=false;}
if(!r){if(evt.preventDefault){evt.preventDefault();evt.stopPropagation();}else{evt.keyCode=0;evt.returnValue=false;}
return false;}else return true;};HTMLCheckbox.prototype.getChecked=function(e){return this.input?this.input.checked:this.valueCheck==this.value;};HTMLCheckbox.prototype.clickAction=function(e,o){if(!this.readonly&&this.enabled){this.setValue(this.input.checked?this.valueCheck:this.valueUnCheck);this.callMethod(HTMLElementBase,"clickAction",[e,o]);}};HTMLCheckbox.prototype.setValue=function(value){value=normalizeRuleParam(value,true);var temp=this.value;this.value=value.toString();this.hidden.setValue(this.value);this.updateLayout();if(temp!=value)this.changeAction(null,this);};HTMLCheckbox.prototype.getValueByStatus=function(status){switch(status.toString()){case"0":return this.valueUnCheck;case"1":return this.valueCheck;default:return"";}};HTMLCheckbox.prototype.setGridValue=function(value){var statusRegExp=/state="(\d)"/;var result=statusRegExp.exec(value);if(result!=null&&result.length>1){var status=result[1];this.value=this.getValueByStatus(status);}else{this.value=value;}};HTMLCheckbox.prototype.flush=function(){if(this.label){if(this.label.onmousedown)this.label.onmousedown=null;if(this.label.onselectstart)this.label.onselectstart=null;this.label=null;}
this.hidden=null;this.callMethod(HTMLElementBase,"flush");};function HTMLNavigation(sys,formID,posX,posY,width,height){this.create(sys,formID,posX,posY,width,height);}
HTMLNavigation.inherits(HTMLElementBase);HTMLNavigation.prototype.name='HTMLNavigation';HTMLNavigation.prototype.create=function(sys,formID,posX,posY,width,height){this.sys=sys;this.formID=formID;this.posX=posX;this.posY=posY;this.width=width;this.height=height;this.posInsert=0;this.posEdit=0;this.posMain=0;this.posDesign=0;this.queryMode=false;this.editMode=false;this.insertMode=false;this.normalMode=true;this.editCancel=false;this.buttons=new Array();this.edtButtons=new Array();this.insButtons=new Array();this.manButtons=new Array();this.dsgButtons=new Array();this.mode=0;};HTMLNavigation.prototype.setReadOnly=function(v){for(i=0;i<this.buttons.length;i++)this.buttons[i].setReadOnly(v);};HTMLNavigation.prototype.setEnabled=function(v){for(i=0;i<this.buttons.length;i++)this.buttons[i].setEnabled(v);};HTMLNavigation.prototype.setVisible=function(v){this.callMethod(HTMLElementBase,"setVisible",[v]);if(!this.visible&&this.div==="WFRComponentButton"){var bar=document.getElementById("WFRComponentButton");visibleDiv(bar,v);}};HTMLNavigation.prototype.createButton=function(img,description,hint,onclick,space,div,width,tab,visible){var bt=new HTMLNavigationButton(this.sys,this.formID,-1,space,0,width,this.height,hint,img);bt.hint=hint;bt.hideImage=this.hideButtons;bt.onclick=onclick;bt.onclickCatch=onclick;bt.visible=visible;bt.design(div,tab);this.buttons.push(bt);return bt;};HTMLNavigation.prototype.addMainButton=function(img,hint,onclick,width,tab){var bt=this.createButton(img,'',hint,onclick,this.posMain,this.context,width,tab,true);this.posMain=this.posMain+width+1;this.manButtons.push(bt);return bt;};HTMLNavigation.prototype.addEditButton=function(img,description,hint,onclick,tab,width){var bt=this.createButton(img,description,hint,onclick,this.posEdit,this.context,width,tab,false);this.posEdit=this.posEdit+width+1;this.edtButtons.push(bt);return bt;};HTMLNavigation.prototype.addIncludeButton=function(img,description,hint,onclick,tab,width){var bt=this.createButton(img,description,hint,onclick,this.posInsert,this.context,width,tab,false);this.posInsert=this.posInsert+width+1;this.insButtons.push(bt);return bt;};HTMLNavigation.prototype.addDesignButton=function(img,description,hint,onclick,tab,width){var bt=this.createButton(img,description,hint,onclick,this.posDesign,this.context,width,tab,false);this.posDesign=this.posDesign+width+1;this.dsgButtons.push(bt);return bt;};HTMLNavigation.prototype.btVisible=function(arr,v){for(i=0;i<arr.length;i++){if(arr[i])arr[i].setVisible(v);}};HTMLNavigation.prototype.setTabController=function(t){this.tabController=t;t.nav=this;};HTMLNavigation.prototype.setAlertController=function(a){this.alertController=a;};HTMLNavigation.prototype.getMode=function(){return this.mode;};HTMLNavigation.prototype.edit=function(){if(!this.insertMode&&!this.editMode){this.mode=1;this.btVisible(this.manButtons,false);this.btVisible(this.edtButtons,true);this.btVisible(this.insButtons,false);this.queryMode=false;this.editMode=true;this.insertMode=false;this.normalMode=false;if(this.tabController){this.tabController.edit();this.tabController.setSearchTabVisible(false);if(!this.focusXY)controller.focusTabFirst();}
if(this.alertController)this.alertController.showEdit(true);return true;}else return false;};HTMLNavigation.prototype.insert=function(){if(!this.insertMode&&!this.editMode){this.mode=2;this.btVisible(this.manButtons,false);this.btVisible(this.edtButtons,false);this.btVisible(this.insButtons,true);this.queryMode=false;this.editMode=false;this.insertMode=true;this.normalMode=false;if(this.tabController){this.tabController.edit();this.tabController.setSearchTabVisible(false);setTimeout(function(){controller.focusFirst();},0);}
if(this.alertController)this.alertController.showInclude(true);return true;}else return false;};HTMLNavigation.prototype.normal=function(){if(!this.normalMode){this.mode=0;this.btVisible(this.manButtons,true);this.btVisible(this.edtButtons,false);this.btVisible(this.insButtons,false);this.queryMode=false;this.editMode=false;this.insertMode=false;this.normalMode=true;if(this.tabController){this.tabController.view();this.tabController.setSearchTabVisible(true);}
if(this.alertController){this.alertController.showEdit(false);this.alertController.showInclude(false);this.alertController.unLock();this.alertController.recall();}
try{mainform.parent.focus();mainform.focus();}catch(e){}}};HTMLNavigation.prototype.formDesign=function(){this.btVisible(this.manButtons,false);this.btVisible(this.edtButtons,false);this.btVisible(this.insButtons,false);this.btVisible(this.dsgButtons,true);this.queryMode=false;this.editMode=false;this.insertMode=false;this.normalMode=false;if(this.tabController){this.tabController.edit();this.tabController.setSearchTabVisible(false);if(!this.focusXY)controller.focusTabFirst();}
return true;};HTMLNavigation.prototype.query=function(){this.mode=3;this.queryMode=true;this.editMode=false;this.insertMode=false;this.normalMode=false;if(this.tabController)this.tabController.edit();};HTMLNavigation.prototype.freeComponent=function(){for(var bt in this.edtButtons)
if(bt.free)bt.free();for(var bt in this.insButtons)
if(bt.free)bt.free();for(var bt in this.manButtons)
if(bt.free)bt.free();for(var bt in this.dsgButtons)
if(bt.free)bt.free();this.tabController=null;this.alertController=null;};HTMLNavigation.prototype.design=function(doc){this.doc=doc;this.div=document.createElement("nav");this.div.className="navbar";doc.appendChild(this.div);if(!this.visible)visibleDiv(this.div,false);};HTMLNavigation.prototype.getDiv=function(id,x,y,w,h,zindex,display){return getDiv(id,x,y,w,h,zindex,display);};HTMLNavigation.prototype.toString=function(){return'[object '+this.name+']';};HTMLNavigation.prototype.flush=function(){for(var i in this){if(this[i])removeEvents(this[i]);}};function HTMLNavigationGrid(sys,formID,posX,posY){this.create(sys,formID,posX,posY,40,20);this.onEditing=false;this.visible=true;this.enabled=true;this.buttons=[];this.bgColor={"add":"btn-success","edit":"btn-primary","remove":"btn-outline-secondary","refresh":"btn-outline-secondary","save":"btn-danger","cancel":"btn-outline-secondary"};}
HTMLNavigationGrid.inherits(HTMLNavigation);HTMLNavigationGrid.prototype.name='HTMLNavigationGrid';HTMLNavigationGrid.prototype.createButton=function(param,description,hint,onclick,icon){var bt=mainSystemFrame.document.createElement("i");bt.className="px-2 mr-2 d-flex align-items-center justify-content-center rounded-top btn "+this.bgColor[param];bt.id=param+"Button";bt.style.cursor="pointer";bt.style.fontStyle="normal";bt.href="#";bt.setAttribute("role","button");bt.addEventListener("click",onclick,false);if(hint){bt.title=hint;bt.setAttribute("data-toggle","tooltip");}
var btIcon=document.createElement("i");btIcon.className="fas fa-"+icon;if(param==="remove")btIcon.className+=" text-danger";btIcon.style.fontSize="1rem";bt.appendChild(btIcon);this.buttons.push({button:bt,class:bt.className,visible:true});return bt;};HTMLNavigationGrid.prototype.setReadOnly=function(v){this.readonly=v;this.updateLayout();};HTMLNavigationGrid.prototype.setEnabled=function(v){this.enabled=v;this.updateLayout();};HTMLNavigationGrid.prototype.updateLayout=function(){for(var i=0;i<this.buttons.length;i++){if(this.buttons[i].button.id!="saveButton"&&this.buttons[i].button.id!="cancelButton"){this.buttons[i].button.disabled=!this.enabled||this.readonly;if(this.enabled&&!this.readonly){if(this.buttons[i].button.classList.contains("disabled"))
this.buttons[i].button.classList.remove("disabled");if(this.buttons[i].class.indexOf(" disabled")!=-1)
this.buttons[i].class=this.buttons[i].class.replace(" disabled","");this.buttons[i].button.style.pointerEvents="all";}else{if(!this.buttons[i].button.classList.contains("disabled"))
this.buttons[i].button.classList.add("disabled");if(this.buttons[i].class.indexOf(" disabled")==-1)
this.buttons[i].class+=" disabled";this.buttons[i].button.style.pointerEvents="none";}}}};HTMLNavigationGrid.prototype.showNav=function(show){if(this.enabled){if(show){this.visible=true;if(this.onEditing){for(var i=0;i<this.buttons.length;i++){if(this.buttons[i].button.id=="saveButton"||this.buttons[i].button.id=="cancelButton"){this.buttons[i].button.className=this.buttons[i].class;this.buttons[i].visible=true;}}}else{for(var i=0;i<this.buttons.length;i++){if(this.buttons[i].button.id=="addButton"||this.buttons[i].button.id=="editButton"||this.buttons[i].button.id=="removeButton"||this.buttons[i].button.id=="refreshButton"){this.buttons[i].button.className=this.buttons[i].class;this.buttons[i].visible=true;}}}}else{this.visible=false;for(var i=0;i<this.buttons.length;i++){this.buttons[i].button.className="d-none";this.buttons[i].visible=false;}}}};HTMLNavigationGrid.prototype.setMainImages=function(imgInclude,imgEdit,imgDelete,imgRefresh,imgFields){if(imgInclude!=-1)this.btInclude=this.createButton("add",'Novo',getLocaleMessage('LABEL.INCLUDE')+' (Ctrl+Insert)',function(){if(this.disabled)return false;this.parentElement.grid.include();},"plus");if(imgEdit!=-1)this.btEdit=this.createButton("edit",'Editar',getLocaleMessage('INFO.FORM_EDIT'),function(){if(this.disabled)return false;this.parentElement.grid.edit();},"edit");if(imgDelete!=-1)this.btDelete=this.createButton("remove",'Excluir',getLocaleMessage('LABEL.REMOVE_RECORD')+' (Ctrl+Del/Ctrl+D)',function(){if(this.disabled)return false;this.parentElement.grid.deleteRow();},"trash-alt");if(imgRefresh!=-1)this.btRefresh=this.createButton("refresh",'Atualizar',getLocaleMessage('LABEL.REFRESH')+'',function(){if(this.disabled)return false;this.parentElement.grid.refresh(false,true);},"redo");};HTMLNavigationGrid.prototype.setEditImages=function(imgSave,imgCancel){if(imgSave!=-1)this.btEditSave=this.createButton("save",'Gravar',getLocaleMessage('LABEL.SAVE_RECORD')+' (Ctrl+G)',function(){if(this.disabled)return false;this.parentElement.grid.post();},"save");if(imgCancel!=-1)this.btEditCancel=this.createButton("cancel",'Cancelar',getLocaleMessage('LABEL.CANCEL')+' (ESC)',function(){if(this.disabled)return false;this.parentElement.grid.cancel();},"ban");};HTMLNavigationGrid.prototype.createElement=function(p){if(p){let elem=document.createElement(p.element);elem.id=p.id?p.id:this.name+'_'+(Math.floor(Math.random()*10009)+1)+"_"+p.element;elem.className=p.class?p.class:"";elem.style=p.style?p.style:"";if(p.position&&p.position>0)
p.parent.insertBefore(elem,p.parent.childNodes[p.position]);else
p.parent.appendChild(elem);if(p.hint){elem.title=p.hint;elem.alt=p.hint;elem.setAttribute("data-toggle","tooltip");}
return elem;}};HTMLNavigationGrid.prototype.setVisibleSeparator=function(v){let separator=document.getElementById(this.parent.id+"_separator_paging");let grid=this.parent;if(separator){if(v){if(separator.classList.contains("d-none")){separator.classList.add("d-inline-flex");separator.classList.remove("d-none");}}else{if(separator.classList.contains("d-inline-flex")){separator.classList.add("d-none");separator.classList.remove("d-inline-flex");}}}else if(grid.hasPagination&&grid.enableSimpleFilter){this.createElement({parent:grid.bar,element:"span",class:"mt-10 mb-0 mr-2 ml-2 d-inline-flex align-items-center justify-content-center border",style:"width: 1px;",id:grid.id+"_separator_paging",position:grid.bar.childNodes.length-1});}};HTMLNavigationGrid.prototype.actInclude=function(){if(!this.enabled||this.readonly)return;this.parent.include();};HTMLNavigationGrid.prototype.actEdit=function(){if(!this.enabled||this.readonly)return;this.parent.edit();};HTMLNavigationGrid.prototype.actDelete=function(){if(!this.enabled||this.readonly)return;this.parent.deleteRow(this);};HTMLNavigationGrid.prototype.actRefresh=function(){this.parent.refresh(true);};HTMLNavigationGrid.prototype.actFields=function(){this.parent.openGridManager();};HTMLNavigationGrid.prototype.actEditSave=function(){this.parent.post();};HTMLNavigationGrid.prototype.actEditCancel=function(){this.parent.cancelEdit();};HTMLNavigationGrid.prototype.actIncludeSave=function(){if(!this.enabled||this.readonly)return;this.parent.post();};HTMLNavigationGrid.prototype.actIncludeCancel=function(){this.parent.cancelInclude();};HTMLNavigationGrid.prototype.ensureVisibility=function(){};HTMLNavigationGrid.prototype.toggleButtons=function(b){if(this.enabled&&this.visible){if(this.onEditing){for(var i=0;i<this.buttons.length;i++){if(this.buttons[i].button.id=="saveButton"||this.buttons[i].button.id=="cancelButton"){this.buttons[i].button.className=this.buttons[i].class;this.buttons[i].visible=true;}else{this.buttons[i].button.className="d-none";this.buttons[i].visible=false;}}}else{for(var i=0;i<this.buttons.length;i++){if(this.buttons[i].button.id=="saveButton"||this.buttons[i].button.id=="cancelButton"){this.buttons[i].button.className="d-none";this.buttons[i].visible=false;}else{this.buttons[i].button.className=this.buttons[i].class;this.buttons[i].visible=true;}}}}};HTMLNavigationGrid.prototype.enableButtons=function(enable){if(this.visible){if(enable){for(var i=0;i<3;i++){this.buttons[i].button.className=this.buttons[i].class;this.buttons[i].visible=true;}}else{for(var i=0;i<3;i++){this.buttons[i].button.className="d-none";this.buttons[i].visible=false;}}}};HTMLNavigationGrid.prototype.checkButtons=function(){var buttonEnable=false;for(var i=0;i<this.buttons.length;i++){if(this.buttons[i].visible)buttonEnable=true;}
this.enabled=buttonEnable;};function HTMLNavigationForm(sys,formID,posX,posY){this.create(sys,formID,posX,posY,24,24);}
HTMLNavigationForm.inherits(HTMLNavigation);HTMLNavigationForm.prototype.name='HTMLNavigationForm';HTMLNavigationForm.prototype.iconsSize=28;HTMLNavigationForm.prototype.setMainImages=function(imgInclude,imgEdit,imgFirst,imgPrevious,imgNext,imgLast,imgDelete,imgRefresh,imgLog,imgDefaultValues,imgPrint,imgHelp,imgExit){if(imgInclude!=-1){this.btInclude=this.addMainButton('fas fa-plus-circle',getLocaleMessage('LABEL.INCLUDE')+' (Ctrl+Ins/Ctrl+I)',this.getAction('actInclude'),this.iconsSize,'');this.canInclude=true;}else this.canInclude=false;if(imgEdit!=-1){this.btEdit=this.addMainButton('fas fa-pencil-alt',getLocaleMessage('LABEL.RECORD_EDIT')+' (Ctrl+E)',this.getAction('actEdit'),this.iconsSize,'');this.canEdit=true;}else this.canEdit=false;if(imgFirst!=-1)this.btFirst=this.addMainButton('fas fa-angle-double-left',getLocaleMessage('LABEL.FIRST_RECORD')+' (Ctrl+Home)',this.getAction('actFirst'),this.iconsSize,'');if(imgPrevious!=-1)this.btPrevious=this.addMainButton('fas fa-chevron-left',getLocaleMessage('LABEL.PREVIOUS_RECORD')+' (PgUp)',this.getAction('actPrevious'),this.iconsSize,'');if(imgNext!=-1)this.btNext=this.addMainButton('fas fa-chevron-right',getLocaleMessage('LABEL.NEXT_RECORD')+' (PgDown)',this.getAction('actNext'),this.iconsSize,'','Next');if(imgLast!=-1)this.btLast=this.addMainButton('fas fa-angle-double-right',getLocaleMessage('LABEL.LAST_RECORD')+' (Ctrl+End)',this.getAction('actLast'),this.iconsSize,'','Last');if(imgDelete!=-1)this.btDelete=this.addMainButton('fas fa-trash-alt',getLocaleMessage('LABEL.REMOVE_RECORD')+' (Ctrl+Del/Ctrl+D)',this.getAction('actDelete'),this.iconsSize,'');if(imgRefresh!=-1)this.btRefresh=this.addMainButton('fas fa-redo',getLocaleMessage('LABEL.REFRESH')+' (Alt+A)',this.getAction('actRefresh'),this.iconsSize,'');if(imgPrint!=-1)this.btPrint=this.addMainButton('fas fa-print',getLocaleMessage('LABEL.PRINT')+' (Ctrl+P)',this.getAction('actPrint'),this.iconsSize,'');if(imgLog!=-1)this.btLog=this.addMainButton('fas fa-search',getLocaleMessage('LABEL.LOG_LABEL'),this.getAction('actLog'),this.iconsSize,'','Log');if(imgDefaultValues!=-1)this.btDefaultValues=this.addMainButton('fas fa-stream',getLocaleMessage('LABEL.DEFAULT_VALUES')+' (Ctrl+Shift+C)',this.getAction('actDefaultValues'),this.iconsSize,'');if(imgHelp!=-1){this.btHelp=this.addMainButton('far fa-question-circle',getLocaleMessage('LABEL.HELP')+' (F12)',this.getAction('actHelp'),this.iconsSize,'','Help');this.btHelp.div.className+=" self-enabled";}
if(this.isEditable){this.btDesign=this.addMainButton('eye',getLocaleMessage('INFO.FORM_EDIT'),this.getAction('actDesign'),this.iconsSize);this.btDesignCancel=this.addDesignButton('far fa-times-circle','',getLocaleMessage('LABEL.CANCEL')+' (Esc)',this.getAction('actDesignCancel'),true,this.iconsSize,'');this.btDesignSave=this.addDesignButton('fas fa-save','',getLocaleMessage('LABEL.SAVE_RECORD_MORE')+' (Ctrl+G)',this.getAction('actDesignSave'),true,this.iconsSize,'');}
if(imgExit!=-1){this.btExit=this.addMainButton('fas fa-sign-out-alt',getLocaleMessage('LABEL.EXIT')+' (Alt+F4)',this.getAction('actExit'),this.iconsSize,'');this.btExit.div.className+=" self-enabled";}};HTMLNavigationForm.prototype.design=function(doc,tabControl){this.div=document.createElement("nav");this.div.name="WFRComponent"+this.code;this.div.className="navbar navbar-expand-sm navbar-light mb-3 mb-sm-0";this.div.style.flex="0 0 auto";this.divClass=this.div.className;if(!this.enabled)this.div.className+=" disabled";this.div.id="formNavbar";this.div.zIndex=this.zindex;var navbarToggler=document.createElement("button");navbarToggler.className="navbar-toggler mr-3 outline-0";navbarToggler.setAttribute("type","button");navbarToggler.setAttribute("data-toggle","collapse");navbarToggler.setAttribute("data-target","#navbarMenu");navbarToggler.setAttribute("aria-controls","navbarMenu");navbarToggler.setAttribute("aria-expanded","false");navbarToggler.setAttribute("aria-label","...");navbarToggler.innerHTML='<span class="navbar-toggler-icon"></span>';this.div.appendChild(navbarToggler);var navbarNavCollapse=document.createElement("div");navbarNavCollapse.className="collapse navbar-collapse";navbarNavCollapse.id="navbarMenu";this.div.appendChild(navbarNavCollapse);var navbarNav=document.createElement("ul");navbarNav.className="navbar-nav flex-row flex-wrap";navbarNavCollapse.appendChild(navbarNav);this.doc=doc;this.context=navbarNav;this.designComponent(navbarNav,tabControl);if(navigationFixed&&d&&d.formNavDiv){d.formNavDiv.appendChild(this.div);}else{doc.appendChild(this.div);}
var object=this;$('#navbarMenu').on('show.bs.collapse',function(){var nav=$(".navbar");if(!nav.hasClass("navbar-bg")){nav.addClass("navbar-bg");object.divClassBase=object.divClass;object.divClass+=" navbar-bg";}});$('#navbarMenu').on('hide.bs.collapse',function(){var nav=$(".navbar");if(nav.hasClass("navbar-bg")){nav.removeClass("navbar-bg");object.divClass=object.divClassBase;object.divClassBase=null;}});this.init(tabControl);};HTMLNavigationForm.prototype.freeButtons=function(){if(this.btInclude)this.btInclude=null;if(this.btEdit)this.btEdit=null;if(this.btFirst)this.btFirst=null;if(this.btPrevious)this.btPrevious=null;if(this.btNext)this.btNext=null;if(this.btLast)this.btLast=null;if(this.btDelete)this.btDelete=null;if(this.btRefresh)this.btRefresh=null;if(this.btPrint)this.btPrint=null;if(this.btLog)this.btLog=null;if(this.btDefaultValues)this.btDefaultValues=null;if(this.btHelp)this.btHelp=null;if(this.btDesign)this.btDesign=null;if(this.btDesignCancel)this.btDesignCancel=null;if(this.btDesignSave)this.btDesignSave=null;if(this.btExit)this.btExit=null;if(this.btEditSave)this.btEditSave=null;if(this.btEditCancel)this.btEditCancel=null;if(this.btIncludeSaveMore)this.btIncludeSaveMore=null;if(this.btIncludeSave)this.btIncludeSave=null;if(this.btIncludeCancel)this.btIncludeCancel=null;};HTMLNavigationForm.prototype.setEditImages=function(imgSave,imgCancel){if(imgSave!=-1)this.btEditSave=this.addEditButton('fas fa-save','',getLocaleMessage("LABEL.SAVE_RECORD")+' (Ctrl+S)',this.getAction('actEditSave'),true,this.iconsSize,'EditSave');if(imgCancel!=-1)this.btEditCancel=this.addEditButton('far fa-times-circle','',getLocaleMessage("LABEL.CANCEL")+' (Esc)',this.getAction('actEditCancel'),true,this.iconsSize,'EditCancel');};HTMLNavigationForm.prototype.setIncludeImages=function(imgSave,imgCancel,imgSaveMore){if(imgSaveMore!=-1)this.btIncludeSaveMore=this.addIncludeButton('fas fa-save',getLocaleMessage("LABEL.SAVE_RECORD_MORE")+' +',getLocaleMessage("LABEL.SAVE_RECORD_MORE")+' (Ctrl+G)',this.getAction('actIncludeSaveMore'),true,this.iconsSize,'IncludeSaveMore');if(imgSave!=-1)this.btIncludeSave=this.addIncludeButton('far fa-save',getLocaleMessage("LABEL.SAVE_RECORD"),getLocaleMessage("LABEL.SAVE_RECORD")+' (Ctrl+S)',this.getAction('actIncludeSave'),true,this.iconsSize,'IncludeSave');if(imgCancel!=-1)this.btIncludeCancel=this.addIncludeButton('far fa-times-circle',getLocaleMessage("LABEL.CANCEL"),getLocaleMessage("LABEL.CANCEL")+' (Esc)',this.getAction('actIncludeCancel'),true,this.iconsSize,'IncludeCancel');};HTMLNavigationForm.prototype.execAjaxEval=function(param){var paramsName=arguments[1];var paramsValue=arguments[2];var url="";if(param=="refreshAllEdit"&&paramsValue!=null&&paramsValue.length!=0){url='sys='+this.sys+'&formID='+this.formID+'&param=edit&filter='+paramsValue+'&goto='+formrow;}else if(param=="refreshAllInclude"&&paramsValue!=null&&paramsValue.length!=0){url='sys='+this.sys+'&formID='+this.formID+'&param=include&filter='+paramsValue+'&goto='+formrow;}else if(param=="refreshAllShow"&&paramsValue!=null&&paramsValue.length!=0){url='sys='+this.sys+'&formID='+this.formID+'&param=refreshAll&filter='+paramsValue+'&goto='+formrow;}else if(param==="refresh"&&typeof paramsValue==="string"){url='sys='+this.sys+'&formID='+this.formID+'&param='+param+'&filter='+paramsValue+'&filter=&goto='+formrow;}else{url='sys='+this.sys+'&formID='+this.formID+'&param='+param+'&filter=&goto='+formrow;}
if(mainform.WEBRUN_CSRFTOKEN)url+="&WEBRUN-CSRFTOKEN="+mainform.WEBRUN_CSRFTOKEN;url+="&forceGetResponse=true"
if(paramsName!=null&&paramsName.length!=0){for(var i=0;i<paramsName.length;i++){var param=paramsName[i];if(param!="")url+=('&'+param+'='+paramsValue[i]);}}
if(document.t){var dep=document.t.dependences;for(var componentUpdateCode in dep){if(typeof componentUpdateCode=="function")continue;for(var index in dep[componentUpdateCode]){if(typeof index=="function")continue;var componentCode=dep[componentUpdateCode][index];if(isNumeric(componentCode)){var component=eval("$mainform().d.c_"+componentCode);if((component==null)||(typeof component=="undefined"))continue;url+=("&WFRInput"+component.getCode()+"="+URLEncode(component.getValue()));}}}}
postURLAsyncJs('form.do',url,false,function(response){if(response)eval(response);});};HTMLNavigationForm.prototype.execAjaxEvalSync=function(param){var url='sys='+this.sys+'&formID='+this.formID+'&param='+param+'&filter=&goto='+formrow;var paramsName=arguments[1];var paramsValue=arguments[2];if(paramsName!=null&&paramsName.length!=0){for(var i=0;i<paramsName.length;i++){var param=paramsName[i];if(param!="")url+=('&'+param+'='+paramsValue[i]);}}
url+="&forceGetResponse=true";if(mainform.WEBRUN_CSRFTOKEN)url+="&WEBRUN-CSRFTOKEN="+mainform.WEBRUN_CSRFTOKEN;if(document.t){var dep=document.t.dependences;for(var componentUpdateCode in dep){if(typeof componentUpdateCode=="function")continue;for(var index in dep[componentUpdateCode]){if(typeof index=="function")continue;var componentCode=dep[componentUpdateCode][index];if(isNumeric(componentCode)){var component=eval("$mainform().d.c_"+componentCode);if((component==null)||(typeof component=="undefined"))continue;url+=("&WFRInput"+component.getCode()+"="+URLEncode(component.getValue(),postForceUTF8));}}}}
eval(postURL("form.do",url));};HTMLNavigationForm.prototype.actInclude=function(){if(!this.enabled)return;if(this.queryMode&&document.t){this.postAction="include";document.t.openFirstTab();}else{this.execAjaxEval('include');}};HTMLNavigationForm.prototype.actIncludeSync=function(){if(!this.enabled)return;if(this.queryMode&&document.t){this.postAction="include";document.t.openFirstTab();}else{this.execAjaxEvalSync('include');}};HTMLNavigationForm.prototype.actEdit=function(){if(!this.enabled)return;if(this.queryMode&&document.t){if(hasdata){this.postAction="edit";}
document.t.openFirstTab();}else if(hasdata){this.execAjaxEval('edit');}
if(!hasdata){if(this.btInclude!=null&&this.btInclude.enabled)this.actInclude();else interactionInfo(getLocaleMessage("INFO.CANNOT_INSERT_FORM"));}};HTMLNavigationForm.prototype.actEditSync=function(){if(!this.enabled)return;if(this.queryMode&&document.t){this.postAction="edit";document.t.openFirstTab();}else if(hasdata){this.execAjaxEvalSync('edit');}
if(!hasdata){if(this.btInclude!=null&&this.btInclude.enabled)this.actInclude(true);else interactionInfo(getLocaleMessage("INFO.CANNOT_INSERT_FORM"));}};HTMLNavigationForm.prototype.actFirst=function(){if(!this.enabled)return;this.execAjaxEval('first');};HTMLNavigationForm.prototype.actFirstSync=function(){if(!this.enabled)return;this.execAjaxEvalSync('first');};HTMLNavigationForm.prototype.actPrevious=function(){if(!this.enabled)return;if(this.btPrevious!=null&&this.btPrevious.enabled){this.execAjaxEval('previous');}};HTMLNavigationForm.prototype.actPreviousSync=function(){if(!this.enabled)return;if(this.btPrevious!=null&&this.btPrevious.enabled){this.execAjaxEvalSync('previous');}};HTMLNavigationForm.prototype.actNext=function(){if(!this.enabled)return;if(this.btNext!=null&&this.btNext.enabled){this.execAjaxEval('next');}};HTMLNavigationForm.prototype.actNextSync=function(){if(!this.enabled)return;if(this.btNext!=null&&this.btNext.enabled){this.execAjaxEvalSync('next');}};HTMLNavigationForm.prototype.actLast=function(){if(!this.enabled)return;this.execAjaxEval('last');};HTMLNavigationForm.prototype.actLastSync=function(){if(!this.enabled)return;this.execAjaxEvalSync('last');};HTMLNavigationForm.prototype.actGoto=function(row){if(!this.enabled)return;if(hasdata){formrow=row;this.execAjaxEval('goto');}};HTMLNavigationForm.prototype.actGotoSync=function(row){if(!this.enabled)return;if(hasdata){formrow=row;this.execAjaxEvalSync('goto');}};HTMLNavigationForm.prototype.actDelete=function(){if(!this.enabled)return;if(this.queryMode&&document.t){this.postAction="delete";document.t.openFirstTab();}else if(hasdata){var interaction=new parent.mainform.HTMLMessage();interaction.showInteractionConfirmMessage($mainform().getLocaleMessage("LABEL.REMOVE_RECORD"),$mainform().getLocaleMessage("INFO.REMOVE_CONFIRM"),function(boolTest,sys,formID){try{formBeforeDelete();var elems=controller.elems;for(i=0;i<elems.length;i++){if(verifyObjectType(elems[i],"HTMLDetailPanel")){try{elems[i].beforeDelete();}catch(e){}}}
var actRequest='sys='+sys+'&formID='+formID+'&action=form&param=delete&forceGetResponse=true&filter=&pType=1&goto='+formrow;if(mainform.WEBRUN_CSRFTOKEN)actRequest+="&WEBRUN-CSRFTOKEN="+mainform.WEBRUN_CSRFTOKEN;eval(postURL('form.do',actRequest));try{d.p.loaded=false;}catch(e){}}catch(ex){handleException(ex);}},[null,this.sys,this.formID],null,null,null,$mainform().getLocaleMessage("LABEL.YES"),$mainform().getLocaleMessage("LABEL.NO"));}};HTMLNavigationForm.prototype.actRefresh=function(){if(!this.enabled)return;if(this.queryMode&&document.t){this.postAction="refresh";document.t.openFirstTab();}else{var refreshAction=function(){if(!isPopup){closeFloatingFormChilds(idForm);if(isFormOpenInGroupBox()){removeFormFromHierarchy(idForm);}}
if(parent.formOnUnLoadAction)parent.formOnUnLoadAction();parent.location=parent.location.toString();};if(this.developmentMode){if(this.isModal&&IE){if(parent.formOnUnLoadAction){parent.formOnUnLoadAction();}
alert("Voc√™ dever√° fechar e abrir novamente o formul√°rio modal para visualizar altera√ß√µes.");}else refreshAction();}else{interaction(getLocaleMessage("INFO.UPDATE_WANT"),[getLocaleMessage("INFO.UPDATE_CURRENT_RECORD"),getLocaleMessage("INFO.UPDATE_ALL_FORM")],[this.execAjaxEval,refreshAction],[["refresh"]],[this]);}}};HTMLNavigationForm.prototype.actHelp=function(){showFormHelp(this.sys,this.formID);};HTMLNavigationForm.prototype.actPrint=function(){if(!this.enabled)return;if(this.reportCode)openWFRReport2(this.sys,this.reportCode,this.formID,this.reportDescription);};HTMLNavigationForm.prototype.actExit=function(){if(isFormOpenInTabComponent()){closeFormInTabComponent();}else if(isFormOpenInGroupBox()){try{window.parent.parent.ebfFrameCloseForm(null,window.parent.frameElement.componentName);}catch(e){}}else if(isPopup||mainSystemFrame==null){parent.close();}else closeFloatingFormById(idForm);};HTMLNavigationForm.prototype.actDesign=function(){if(!this.enabled)return;if(this.btDesign!=null&&this.btDesign.enabled){this.formDesign();makercontroller.editMode();}};HTMLNavigationForm.prototype.actDesignSave=function(){if(!this.enabled)return;if(this.btDesignSave!=null&&this.btDesignSave.enabled){makercontroller.saveToDatabase();}};HTMLNavigationForm.prototype.actDesignCancel=function(){if(!this.enabled)return;if(this.btDesignCancel!=null&&this.btDesignCancel.enabled){makercontroller.cancelChanges();}};HTMLNavigationForm.prototype.getMaker=function(){return makercontroller;};HTMLNavigationForm.prototype.actEditSave=function(){if(!this.enabled)return;try{if(controller.checkRequireds()&&!httpprocessing){controller.doInvisibleComponents();formBeforeUpdate();var elems=controller.elems;for(i=0;i<elems.length;i++){if(verifyObjectType(elems[i],"HTMLDetailPanel")){try{elems[i].beforeUpdate();}catch(e){};}}
MM_findObj('goto').value=formrow;MM_findObj('param').value='postcancel';showWait();controller.beforeSubmit();WFRForm.submit();controller.afterSubmit();try{d.p.loaded=false;}catch(e){}}}catch(ex){hideWait();handleException(ex);}};HTMLNavigationForm.prototype.actEditSaveSync=function(){if(!this.enabled)return;try{if(controller.checkRequireds()&&!httpprocessing){controller.doInvisibleComponents();formBeforeUpdate();var elems=controller.elems;for(i=0;i<elems.length;i++){if(verifyObjectType(elems[i],"HTMLDetailPanel")){try{elems[i].beforeUpdate();}catch(e){};}}
showWait();controller.beforeSubmit();this.postAndEvalSync("postcancel",formrow);controller.afterSubmit();hideWait();try{d.p.loaded=false;}catch(e){}}}catch(ex){hideWait();handleException(ex);}};HTMLNavigationForm.prototype.postAndEvalSync=function(param,formrow){var url='sys='+this.sys+'&formID='+this.formID+'&param='+param+'&filter=&pType=1&goto='+formrow;var elems=controller.getFormElements();for(i=0;i<elems.length;i++){url+="&WFRInput"+elems[i].getCode()+"="+URLEncode(elems[i].getValue(),postForceUTF8);}
var all=controller.getAllElements();for(var i=0;i<all.length;i++){var elem=all[i];if(elem&&isTypeOf(elem,"HTMLDualList")){url+="&WFRInputDelete"+elem.getCode()+"="+URLEncode(elem.inputDelete.value,postForceUTF8);url+="&WFRInputInclude"+elem.getCode()+"="+URLEncode(elem.inputInclude.value,postForceUTF8);}}
if(mainform.WEBRUN_CSRFTOKEN)url+="&WEBRUN-CSRFTOKEN="+mainform.WEBRUN_CSRFTOKEN;url+="&forceGetResponse=true";if(document.t){var dep=document.t.dependences;for(var componentUpdateCode in dep){if(typeof componentUpdateCode=="function")continue;for(var index in dep[componentUpdateCode]){if(typeof index=="function")continue;var componentCode=dep[componentUpdateCode][index];if(isNumeric(componentCode)){var component=eval("$mainform().d.c_"+componentCode);if((component==null)||(typeof component=="undefined"))continue;url+=("&WFRInput"+component.getCode()+"="+URLEncode(component.getValue(),postForceUTF8));}}}}
eval(postURL("form.do",url));};HTMLNavigationForm.prototype.actEditCancel=function(){if(!this.enabled)return;this.editCancel=true;this.execAjaxEval('cancel');removeLookup(true);};HTMLNavigationForm.prototype.actEditCancelSync=function(){if(!this.enabled)return;this.editCancel=true;this.execAjaxEvalSync('cancel');removeLookup(true);};HTMLNavigationForm.prototype.actIncludeSave=function(){if(!this.enabled)return;try{if(controller.checkRequireds()&&!httpprocessing){controller.doInvisibleComponents();formBeforeInsert();var elems=controller.elems;for(i=0;i<elems.length;i++){if(verifyObjectType(elems[i],"HTMLDetailPanel")){try{elems[i].beforeInsert();}catch(e){}}}
MM_findObj('goto').value=formrow;MM_findObj('param').value='postcancel';showWait();controller.beforeSubmit();WFRForm.submit();controller.afterSubmit();try{d.p.loaded=false;}catch(e){}}}catch(ex){hideWait();handleException(ex);}};HTMLNavigationForm.prototype.actIncludeSaveSync=function(){if(!this.enabled)return;try{if(controller.checkRequireds()&&!httpprocessing){controller.doInvisibleComponents();formBeforeInsert();var elems=controller.elems;for(i=0;i<elems.length;i++){if(verifyObjectType(elems[i],"HTMLDetailPanel")){try{elems[i].beforeInsert();}catch(e){}}}
showWait();controller.beforeSubmit();this.postAndEvalSync("postcancel",formrow);controller.afterSubmit();hideWait();try{d.p.loaded=false;}catch(e){}}}catch(ex){hideWait();handleException(ex);}};HTMLNavigationForm.prototype.actIncludeSaveMore=function(){if(!this.enabled)return;try{if(controller.checkRequireds()&&!httpprocessing){controller.doInvisibleComponents();formBeforeInsert();var elems=controller.elems;for(i=0;i<elems.length;i++){if(verifyObjectType(elems[i],"HTMLDetailPanel")){try{elems[i].beforeInsert();}catch(e){}}}
MM_findObj('goto').value=formrow;MM_findObj('param').value='post';showWait();controller.beforeSubmit();WFRForm.submit();controller.afterSubmit();controller.focusFirst();try{d.p.loaded=false;}catch(e){}}}catch(ex){handleException(ex);}};HTMLNavigationForm.prototype.actIncludeSaveMoreSync=function(){if(!this.enabled)return;try{if(controller.checkRequireds()&&!httpprocessing){controller.doInvisibleComponents();formBeforeInsert();var elems=controller.elems;for(i=0;i<elems.length;i++){if(verifyObjectType(elems[i],"HTMLDetailPanel")){try{elems[i].beforeInsert();}catch(e){}}}
showWait();controller.beforeSubmit();this.postAndEvalSync("post",formrow);controller.afterSubmit();controller.focusFirst();try{d.p.loaded=false;}catch(e){}}}catch(ex){handleException(ex);}};HTMLNavigationForm.prototype.actIncludeCancel=function(){if(!this.enabled)return;this.execAjaxEval('cancel');removeLookup(true);};HTMLNavigationForm.prototype.actIncludeCancelSync=function(){if(!this.enabled)return;this.execAjaxEvalSync('cancel');removeLookup(true);};HTMLNavigationForm.prototype.actLog=function(){if(!this.enabled)return;if(this.queryMode&&document.t){this.postAction="log";document.t.openFirstTab();}else{openFormLog(this.sys,this.formID,'Log',pkeys,'1');}};HTMLNavigationForm.prototype.actDefaultValues=function(){if(!this.enabled)return;if(this.queryMode&&document.t){this.postAction="defaultValues";document.t.openFirstTab();}else{openDefaultValues(this.sys,this.formID);}};HTMLNavigationForm.prototype.setEnabled=function(v){this.enabled=v;if(this.div){this.div.className=(this.enabled)?this.divClass:this.divClass+" disabled";}};HTMLNavigationForm.prototype.checkForPostActions=function(){var object=this;setTimeout(function(){if(object.postAction){if(object.postAction=="refresh")object.actRefresh();else if(object.postAction=="delete")object.actDelete();else if(object.postAction=="log")object.actLog();else if(object.postAction=="defaultValues")object.actDefaultValues();else object.execAjaxEval(object.postAction);object.postAction=null;}},0);};var EDIT=0;var INSERT=1;var UNKNOW=-1;var timeouts;var lastTap=0;var buttonId=0;var imageId=0;var gridFunctions={};var gridChecks={};var gridCheckProperties={};let firstCheckOnly=true;let _STARTSCRITERIA=true;var preset={"sum":false,"avg":false,"max":false,"min":false,"multiplier":false,"count":false,"title":false,"first":false,"concat":false};var presetArray=["sum","avg","max","min","multiplier","count"];const _jsonOperator={equals:1,iContains:2,iEndsWith:4,iStartsWith:3,greaterThan:6,lessThan:7,greaterOrEqual:20,lessOrEqual:21,notEqual:25,iNotContains:22,iNotStartsWith:23,iNotEndsWith:24,notEqual:26,};const _jsonConverter={double:"@double",integer:"@long",boolean:"@boolean",date:"@date",datetime:"@timestamp",text:"",};let _setOperator=false;const _textOperators=["and","equals","greaterOrEqual","greaterThan","iContains","iEndsWith","iNotContains","iNotEndsWith","iNotStartsWith","iStartsWith","lessOrEqual","lessThan","not","or"];const _date_and_numberOperators=["and","equals","greaterOrEqual","greaterThan","lessOrEqual","lessThan","notEqual","not","or"];const _date_client=["iContains","iNotContains","and","equals","notEqual","not","or"];const _boolean=["and","equals"];var gridFieldsConfig={};var iconPathExport=getAbsolutContextPath()+isomorphicDir+"skins/resources/images/";function HTMLGrid(sys,formID,code,posX,posY,width,height,formCode){this.create(sys,formID,code,posX,posY,width,height,'','');this.type=1;this.callForm=true;this.formCode=formCode;this.able=true;this.gridini=0;this.currentWidth=this.width;this.formWidth=this.width;this.formHeight=this.height;this.tabable=true;this.hasdata=false;this.editRow=-1;this.currentRow=-1;this.editComponents=[];this.report=false;this.currentSelection=-1;this.toolbarHeight=40;this.headerHeight=38;this.cellHeight=33;this.allowsOrder=false;this.autoRowSize=true;this.isFiltered=false;this.isAdvancedFilter=false;this.buttonHeight=12;this.buttonWidth=14;this.hasFocus=false;this.ActUpGrid=true;this.noRefresh=false;this.groups=[];this.round=2;this.lockEditable=false;}
HTMLGrid.inherits(HTMLElementBase);HTMLGrid.prototype.name='HTMLGrid';HTMLGrid.prototype.instance=HTMLGrid;HTMLGrid.prototype.zindex=99999;HTMLGrid.prototype.designComponent=function(){isc.Log.WARN=00100;this.cellHeight=this.rowHeight?this.rowHeight:this.cellHeight;this.div.className+=" grid";this.div.style.zIndex=this.zindex;this.divClass=this.div.className;this.nav=new HTMLNavigationGrid(this.sys,this.formCode,0,0);this.nav.tabindex=this.tabindex;this.nav.design(this.context);this.nav.parent=this;this.grid_height=this.height-(this.toolbarHeight+1);if(this.editable){this.nav.setMainImages(this.imgInclude,this.imgEdit,this.imgDelete,this.imgRefresh,-1);this.nav.setEditImages(this.imgPost,this.imgCancel);if(this.nav.btEditSave)$(this.nav.btEditSave).hide();if(this.nav.btEditCancel)$(this.nav.btEditCancel).hide();}else{this.nav.setMainImages(-1,-1,-1,-1,-1);}
if(this.readonly){this.nav.setReadOnly(true);}
this.context.style.width=(pt(this.context.style.width)+2+(IE?2:0))+'px';this.context.style.height=(pt(this.context.style.height)+2+(IE?2:0))+'px';this.bar=document.createElement('div');this.bar.id=this.id+"bar";this.bar.style.height=this.toolbarHeight+"px";this.bar.style.zIndex="200090";this.bar.grid=this;this.bar.className="d-flex flex-row w-100 pb-2";this.bar.visible=true;for(var i=0;i<this.nav.buttons.length;i++){this.bar.appendChild(this.nav.buttons[i].button);}
if(this.editable&&(this.hasPagination||this.enableSimpleFilter)){this.nav.createElement({parent:this.bar,element:'span',class:"my-0 mr-2 d-inline-flex align-items-center justify-content-center border-left",style:"width: 1px;",id:this.id+"_separator_nav"});}
this.paging=new HTMLPaging(this.sys,this.formID,this.code,this.width-163,4,40,16);this.paging.onnavigate=this.getAction(this.pagingNavigateAction);this.paging.design(this);if(this.lastNavigation&&this.lastNavigation.length>=4){this.paging.enableButtons(this.lastNavigation[0],this.lastNavigation[1],this.lastNavigation[2],this.lastNavigation[3]);}
if(this.enableSimpleFilter){if(this.hasPagination){this.nav.createElement({parent:this.bar,element:"span",class:this.hasPagination?"my-0 mr-2 ml-2 d-inline-flex align-items-center justify-content-center border-left":"my-0 mr-2 d-inline-flex align-items-center justify-content-center border-left",style:"width: 1px;",id:this.id+"_separator_paging"});}
let p=this.nav.createElement({parent:this.bar,element:"i",class:"px-2 mr-2 d-flex align-items-center justify-content-center rounded-top btn btn-outline-secondary",hint:getLocaleMessage("INFO.GRID_ADVANCED_FILTER"),id:this.id+"_icon_filter",style:"cursor: pointer;"});let g_r=this.id;p.addEventListener('click',function(){gridAdvancedFilter(g_r)},false);this.nav.createElement({parent:p,element:"i",class:"fas fa-filter",style:"font-size: 1rem;",id:this.id+"_icon_c_filter",});}
var fontStyle="";if(this.font){fontStyle+=("font-family: "+this.font+"!important;");}
if(this.size){fontStyle+=("font-size: "+pt(this.size)+"pt!important;");if(this.autoRowSize){var fontSize=Math.round((4*pt(this.size))/3);this.rowHeight=fontSize+9.3;if(this.headerWidth==null||this.headerWidth==undefined)
this.headerWidth=this.rowHeight+(this.rowHeight*0.3);}}
if(this.weight){fontStyle+=("font-weight: bold!important;");}
if(this.italic){fontStyle+=("font-style: italic!important;");}
var textDecoration="text-decoration:";if(this.underline||this.strikeout){if(this.underline){textDecoration+=" underline";}
if(this.strikeout){textDecoration+=" line-through";}
textDecoration+="!important;";fontStyle+=textDecoration;}else{textDecoration+=" none!important;";fontStyle+=textDecoration;}
if(this.color){fontStyle+=("color: "+this.color+"!important;");}
if(this.decorationChanged){this.timeout(function(){for(var i=0;i<this.columns.length;i++){this.iscCanvas.setFieldHeaderBaseStyle(this.columns[i].name,''+this.iscCanvas.headerBaseStyle+' '+this.id+'headerBaseStyle');}
this.iscCanvas.setHeaderHeight(this.headerHeight);},0);}
if(this.bgColor){fontStyle+=("background-color: "+this.bgColor+"!important;");}
this.fontStyle=fontStyle;this.contextMenu=null;this.showGridSummary=null;this.showGroupSummary=null;this.showGroupSummaryInHeader=null;this.showCollapsedGroupSummary=null;this.multiGroup=null;this.animateFolderSpeed=null;var summary=this.summaryProperties.summary;this.components_to_Grid=["header","body"];if(this.enableSimpleFilter)
this.components_to_Grid.splice(0,0,"filterEditor");if(summary){var properties=summary.properties;if(properties){this.components_to_Grid.push("summaryRow");this.groupBy=properties.groupBy;this.showGridSummary=properties.showGridSummary;this.showGroupSummary=properties.showGroupSummary;this.showGroupSummaryInHeader=properties.showGroupSummaryInHeader;this.showCollapsedGroupSummary=properties.showCollapsedGroupSummary;this.multiGroup=properties.multiGroup;this.animateFolderSpeed=properties.animateFolderSpeed;this.groupByMaxRecords=properties.groupByMaxRecords;}}
if(this.hasPagination)this.createFooterRegisters();if(this.enableGridExport||this.enableSimpleFilter){let dataExport=[];let dataFilter=[];let data=null;if(this.enableGridExport){dataExport=[{icon:iconPathExport+"excel.png",title:"EXCEL",click:"gridExportData('"+this.id+"', 'XLS')"},{icon:iconPathExport+"html.png",title:"HTML",click:"gridExportData('"+this.id+"', 'HTML')"},{icon:iconPathExport+"json.png",title:"JSON",click:"gridExportData('"+this.id+"', 'JSON')"},{icon:iconPathExport+"list.png",title:"LISTAGEM",click:"gridExportData('"+this.id+"', 'LST')"},{icon:iconPathExport+"pdf.png",title:"PDF",click:"gridExportData('"+this.id+"', 'PDF')"},{icon:iconPathExport+"txt.png",title:"TEXTO",click:"gridExportData('"+this.id+"', 'TXT')"},{icon:iconPathExport+"xml.png",title:"XML",click:"gridExportData('"+this.id+"', 'XML')"},]}
if(this.enableSimpleFilter){dataFilter=[{icon:iconPathExport+"editorfilter.png",title:getLocaleMessage("INFO.GRID_ADVANCED_FILTER"),click:"gridAdvancedFilter('"+this.id+"')"}]
if(!this.enableGridExport)
dataFilter.shift();}
data=[{icon:iconPathExport+"export.png",title:getLocaleMessage("LABEL.GRID_EXPORT_DATA"),submenu:dataExport}].concat(dataFilter);this.contextMenu=isc.Menu.create({ID:this.id+"mainMenu",width:150,data:data,});}
isc.NumberUtil.decimalSymbol=DECIMAL_POINT;let dataSource=isc.DataSource.create({ID:this.id+"dataSource",fields:this.setColumnSize(this.columns),clientOnly:true,cacheData:this.data,allowAdvancedCriteria:true,});dataSource.setTypeOperators("text",_textOperators);dataSource.setTypeOperators("integer",_date_and_numberOperators);dataSource.setTypeOperators("double",_date_and_numberOperators);dataSource.setTypeOperators("boolean",_boolean);isc.SimpleType.setDefaultSummaryFunction("integer",function(){return arguments[0].length+" "+getLocaleMessage("INFO.GRID_COUNT_RECORDS");});var componentGrid=this;this.iscCanvas=isc.ListGrid.create({showAllColumns:true,ID:this.id,height:this.grid_height,width:this.width,top:this.toolbarHeight,autoFetchData:true,dataSource:this.id+"dataSource",dataFetchMode:"local",alternateRecordeStyles:true,bodyBackgroundColor:null,canSort:false,bodyBackgroundColor:null,selectionType:"single",showFilterEditor:this.enableSimpleFilter===undefined?false:this.enableSimpleFilter,filterEditorHeight:33,filterData:function(){let grid=$c(this.ID);if((!grid.editing&&!grid.inserting)){let filterButton=document.getElementById(grid.id+"_icon_filter");this.deselectAllRecords();grid.currentRow=-1;grid.currentSelection=grid.currentRow;if(grid&&!grid.filterMode||grid.filterMode===0){let containsFilter=false;if(arguments&&arguments[0]!==null&&!arguments[0]._constructor)containsFilter=true;else if(arguments&&arguments[0]!==null&&arguments[0]._constructor&&arguments[0].criteria.length>0)containsFilter=true;if(containsFilter){grid.isFiltered=containsFilter;filterButton.setAttribute("data-original-title",getLocaleMessage("INFO.GRID_FILTER_ACTIVE"));if(filterButton.classList.contains("btn-outline-secondary"))
filterButton.classList.remove("btn-outline-secondary");if(!filterButton.classList.contains("btn-danger"))
filterButton.classList.add("btn-danger");}else{grid.isFiltered=containsFilter;filterButton.setAttribute("data-original-title",getLocaleMessage("INFO.GRID_ADVANCED_FILTER"));if(filterButton.classList.contains("btn-danger"))
filterButton.classList.remove("btn-danger");if(!filterButton.classList.contains("btn-outline-secondary"))
filterButton.classList.add("btn-outline-secondary");}
return this.Super("filterData",arguments);}else{let criteria=null;if(arguments&&arguments[0]){if(arguments[0].criteria)
if(Object.keys(arguments[0].criteria).length>0)criteria=arguments[0];else criteria=null;else if(Object.keys(arguments[0]).length>0)criteria=arguments[0];}
if(criteria&&!grid.validateTypesAndValues(criteria))return false;if(!criteria){if(grid.isFiltered){grid.isFiltered=false;filterButton.setAttribute("data-original-title",getLocaleMessage("INFO.GRID_ADVANCED_FILTER"));if(filterButton.classList.contains("btn-danger"))
filterButton.classList.remove("btn-danger");if(!filterButton.classList.contains("btn-outline-secondary"))
filterButton.classList.add("btn-outline-secondary");grid.refreshURL="";grid.refresh();}}else{let jCriteria={mainCriteria:criteria.operator?criteria.operator.toUpperCase():"AND"}
criteria=grid.parseCriteria(criteria);jCriteria.criterias=criteria;grid.filter(jCriteria,true);grid.isFiltered=true;filterButton.setAttribute("data-original-title",getLocaleMessage("INFO.GRID_FILTER_ACTIVE"));if(filterButton.classList.contains("btn-outline-secondary"))
filterButton.classList.remove("btn-outline-secondary");if(!filterButton.classList.contains("btn-danger"))
filterButton.classList.add("btn-danger");_STARTSCRITERIA=true;}}}
if(projectMode==='N'&&grid.isAdvancedFilter){grid.saveAdvancedFilter(arguments[0]);grid.isAdvancedFilter=false;}},groupTreeChanged:function(){this.Super('groupTreeChanged',arguments);let grid=$c(this.ID);if(grid)grid.returnStateGroup();},getFilterOperatorMenuItems:function(field){if(field.realType){$c(this.ID).filterMode==1?this.getDataSource().setTypeOperators("text",_date_and_numberOperators):this.getDataSource().setTypeOperators("text",_date_client);_setOperator=true;}
if(!field.realType&&_setOperator)
this.getDataSource().setTypeOperators("text",_textOperators);return this.Super("getFilterOperatorMenuItems",arguments);},dataChanged:function(){this.Super("dataChanged",arguments);if(componentGrid.hasPagination&&componentGrid.enableNumberOfRecords&&componentGrid.totalLabels)
componentGrid.totalLabels.setContents(componentGrid.gridend+" de "+componentGrid.totalRows+" "+getLocaleMessage("INFO.GRID_COUNT_RECORDS"));},wrapCells:false,fixedRecordHeights:true,cellHeight:this.cellHeight,canFreezeFields:true,groupByMaxRecords:this.groupByMaxRecords?this.groupByMaxRecords:5000,showRowNumbers:this.gridColumnNumberWidth===0?false:true,showSortArrow:"corner",baseStyle:"grid",contextMenu:this.contextMenu,canGroupBy:this.groupBy===undefined?false:this.groupBy,groupStartOpen:"none",groupByField:this.startGroup,canMultiGroup:this.multiGroup===undefined?false:this.multiGroup,showGroupSummary:this.showGroupSummary===undefined?false:this.showGroupSummary,showGroupSummaryInHeader:this.showGroupSummaryInHeader===undefined?false:this.showGroupSummaryInHeader,showCollapsedGroupSummary:this.showCollapsedGroupSummary===undefined?false:this.showCollapsedGroupSummary,animateFolderSpeed:this.animateFolderSpeed===undefined?3000:this.animateFolderSpeed,showGridSummary:this.showGridSummary===undefined||this.showGridSummary===null?false:this.showGridSummary,canReorderFields:projectMode==="D"?false:true,gridComponents:this.components_to_Grid,showEmptyMessage:true,emptyMessage:this.placeholder?this.placeholder:getLocaleMessage("INFO.GRID_EMPTY_DATA"),editorExit:function(e,record,newValue,rowNum,colNum){if(e=="escape")$c(this.ID).cancel();},editOnF2Keypress:false,canAutoFitFields:false,canEdit:true,editEvent:null,recordClick:function(){var ref=$c(this.ID);ref.onRowClick();},rowDoubleClick:function(record,row,col){if(!record.isFolder){var ref=$c(this.ID);if(ref.editable){var column=this.showRowNumbers?ref.showGroupSummaryInHeader?col-2:col-1:col;if(column>=0&&ref.columns[column].type==="boolean")return false;}
ref.colDoubleClicked=column;ref.executeRowDoubleClick();}},cellChanged:function(record,newValue,oldValue,row,col,grid){var ref=$c(this.ID);ref.selectRow(row);if(typeof newValue==="boolean"&&this.fields[col].type==="boolean"){if(ref.paging.gt!==-1)
row=row+ref.gridini;if(ref.inserting)
ref.checkBoxChecked={"row":row,"col":col,};else
ref.executeCheckCmd(ref,row,col);}},canEditCell:function(rowNum,colNum){var ref=$c(this.ID);if(!ref.editable)return false;if(colNum===undefined||colNum===null)return true;if(this.showRowNumbers&&colNum===0||ref.inserting)return this.Super("canEditCell",arguments);if(!ref.startEditing){var col=ref.getComponentColumnIndexByName(this.fields[colNum].name);if(col>=0&&ref.columns[col].type==="boolean"){if(!ref.enabled||ref.readonly)
return false;else if(Object.keys(gridCheckProperties).length>0){var properties=gridCheckProperties[rowNum+"_"+this.fields[colNum].cod];if(properties){if(Object.keys(properties).length>0){if(!(properties.enabled)||properties.readonly)
return false;else
return true;}}}}}
return this.Super("canEditCell",arguments);},getCellCSSText:function(record,row,column){var styleReturn="";styleReturn=$c(this.ID).setRowColor(record,row,column);if(!styleReturn)styleReturn=$c(this.ID).fontStyle;else styleReturn+=$c(this.ID).fontStyle;return styleReturn;},doubleClick:function(){if(this.getTotalRows()===0)
$c(this.ID).executeRowDoubleClick();},headerClick:function(fieldNum){var ref=$c(this.ID);if(ref.allowsOrder){if(this.inserting||this.editing)return false;if(this.showRowNumbers&&fieldNum===0){return false;}else{var desc="";if(ref.ordered)
desc=ref.ordered.desc;desc=desc==="DESC"?"ASC":"DESC";ref.order(fieldNum,desc);}}else{return false;}},getHeaderContextMenuItems:function(fieldNum){var iscCanvas=this;var ref=$c(this.ID);var menu=[];var submenuCols=[];var field=iscCanvas.fields[fieldNum];if(field&&ref&&!ref.editing&&!ref.inserting){var minCols=iscCanvas.showRowNumbers?2:1;for(var i=0;i<ref.columns.length;i++){if(!iscCanvas.isRowNumberField(ref.columns[i])){submenuJson={title:ref.columns[i].title,checked:ref.isFieldVisible(ref.columns[i].name),click:function(target,item,menu){var field;if(this.checked){field=ref.iscCanvas.fields[ref.iscCanvas.fields.findIndex(function(age){return age.name==item.name})];if(!(field.type=='image'))ref.iscCanvas.fields[ref.iscCanvas.fields.findIndex(function(age){return age.name==item.name})].canGroupBy=!this.checked;ref.setShowColumn(this.title,!this.checked);}else{ref.setShowColumn(this.title,!this.checked);field=ref.iscCanvas.fields[ref.iscCanvas.fields.findIndex(function(age){return age.name==item.name})];if(!(field.type=='image'))ref.iscCanvas.fields[ref.iscCanvas.fields.findIndex(function(age){return age.name==item.name})].canGroupBy=!this.checked;}},autoDismiss:false,name:ref.columns[i].name,checkIf:function(target,menu,item){return iscCanvas.fieldIsVisible(this.name);},visible:ref.columns[i].visible,enableIf:function(){if(!this.visible)
return false;if(gridFieldsConfig[ref.id]['frozenFields'][this.name])
return false;if(iscCanvas.fieldIsVisible(this.name)&&iscCanvas.fields.length==minCols)
return false;return true;},};submenuCols.push(submenuJson);}}
if(ref.allowsOrder){menu.push({title:getLocaleMessage("LABEL.SORT_ASCENDING"),icon:"[SKIN]/sort_ascending.png",click:function(){ref.order(fieldNum,'');}});menu.push({title:getLocaleMessage("LABEL.SORT_DESCENDING"),icon:"[SKIN]/sort_descending.png",click:function(){ref.order(fieldNum,'DESC');}});menu.push({isSeparator:true});}
menu.push({title:getLocaleMessage("LABEL.COLUMNS"),icon:"[SKIN]/column_preferences.png",submenu:submenuCols,});if(ref.groupBy&&!(ref.iscCanvas.fields[fieldNum].type=='image')){menu.push({isSeparator:true});menu.push({title:getLocaleMessage("LABEL.GRID_GROUP_BY_COLUMN"),icon:"[SKIN]/groupby.png",click:function(){ref.group(field.title);}});menu.push({title:getLocaleMessage("LABEL.GRID_UNGROUP_COLUMN"),icon:"[SKIN]/ungroup.png",click:function(){ref.ungroup(field.title);}});menu.push({title:getLocaleMessage("LABEL.GRID_UNGROUP_ALL_COLUMNS"),icon:"[SKIN]/ungroup.png",click:function(){ref.ungroup("");}});if(this.canMultiGroup){menu.push({title:getLocaleMessage("LABEL.GRID_OPEN_CONFIGURE_GROUP"),icon:"[SKIN]/groupby.png",click:function(){ref.openGroupConfig();}});}
menu.push({isSeparator:true});}
if(ref.canFreezeColumns){if(field.frozen){menu.push({title:getLocaleMessage("LABEL.GRID_UNFREEZE_COLUMN"),icon:"[SKIN]/unfreeze.png",click:function(){$c(ref.id).unfreezeColumn(field.title);},});}else{menu.push({title:getLocaleMessage("LABEL.GRID_FREEZE_COLUMN"),icon:"[SKIN]/freezeLeft.png",click:function(){$c(ref.id).freezeColumn(field.title);},enableIf:function(target,menu,item){return iscCanvas.fieldIsVisible(target.name?target.name:target.dragTarget.name);}});}
if(projectMode==='N'&&!ref.disableUserCustomize&&loggedUserWithProfile){menu.push({isSeparator:true});menu.push({title:getLocaleMessage("LABEL.BACK_DEFAULT"),icon:"[SKIN]/clear_sort.png",click:function(){ref.defaultGrid();}});}}}
return menu;},saveLocally:true,autoFitHeaderHeights:true,redrawOnResize:false,timeFormatter:"toShort24HourTime",resized:function(){var ref=$c(this.ID);var hscrollbar=(this.getBody())?this.getBody().hscrollbar:undefined;if(hscrollbar){if(ref&&hscrollbar.isVisible()===ref.hscrollbarVisible)
ref.performFocus();}}});var object=this;this.iscCanvas.mouseOver=function(){this.setBorder("1px solid "+object.getPrimaryColor());}
this.iscCanvas.mouseOut=function(){$c(this.ID).performFocus();}
if(!gridFieldsConfig[this.id])
gridFieldsConfig[this.id]={"frozenFields":{},"hiddenFields":this.readingHiddenFields(),"removedFields":[],"fieldsSizes":null,"fieldOrder":this.getFieldsOrder()};else{this.loadConfigs();}
this.iscCanvas.setBorder("0px");this.iscCanvas.setHeaderHeight(this.headerHeight);if(this.gridColumnNumberWidth>0){this.iscCanvas.fields[0].align="center";this.iscCanvas.resizeField(0,this.gridColumnNumberWidth);}
var cR=this.iscCanvas.getCanvasName();var pC=document.getElementById(cR);var body=document.getElementById(this.iscCanvas.getBody().getCanvasName());this.iscCanvas.getBody().scrolled=function(){var ref=$c(this.creator.ID);if(!ref.hasFocus&&!ref.inserting&&!ref.editing)
this.creator.focus();};this.iscCanvas.getBody().$148o=function(){};this.hscrollbarVisible=body.hscrollbar&&body.hscrollbar.isVisible()?true:false;this.vscrollbarVisible=body.vscrollbar&&body.vscrollbar.isVisible()?true:false;this.gridDiv=body;this.performFocus();this.div.appendChild(this.bar);this.div.appendChild(pC);this.iscCanvas.body.canSelectOnRightMouse=false;this.nav.checkButtons();this.nav.toggleButtons();this.checkShowBar();if(this.enableSimpleFilter)this.iscCanvas.filterEditor.actionButton.setVisibility(false);};HTMLGrid.prototype.getPrimaryColor=function(){return getComputedStyle(document.body).getPropertyValue('--primary');};HTMLGrid.prototype.getRecord=function(row){var ref=this.iscCanvas;return this.isGrouped()?ref.groupTree.getAllItems()[row]:ref.getOriginalData().localData?ref.getOriginalData().localData[row]:ref.getDataSource().cacheData[row];};HTMLGrid.prototype.getValueData=function(data){if(data){var lValues=[];let lKeys=this.iscCanvas.getFields();let i=this.iscCanvas.showRowNumbers?1:0;var size=lKeys.length;for(i;i<size;i++)
lValues.push(data[lKeys[i].name]);return lValues;}
return data;};HTMLGrid.prototype.getCellData=function(i,j){j=this.columns[j].name;if(i==-1)
i=this.getSelectedRow();try{return this.data[i][j];}catch(e){}};HTMLGrid.prototype.getSelectedRow=function(keyPress){var rc,idx=-1;rc=this.iscCanvas.getSelectedRecord();if(this.isGrouped()&&!this.editing&&!this.inserting){if(!keyPress){idx=rc?this.getRecordRealIndex(rc):-1;return idx;}}
idx=this.iscCanvas.getRecordIndex(rc);if(idx==-1){rc=this.iscCanvas.getSelection().length>1?this.iscCanvas.getSelection()[1]:this.iscCanvas.getSelection()[0];if(rc)
idx=this.iscCanvas.getRecordIndex(rc);}
if(idx===-1&&this.currentRow!==-1){return this.currentRow;}
return idx;};HTMLGrid.prototype.getRowDBCursor=function(record){const canvas=this.iscCanvas;let rec=record?record:canvas.getSelectedRecord();let row=-1;if(rec){row=rec.row;}
return row;};HTMLGrid.prototype.getSelectedRows=function(id){var rs=[];var rows=this.getSelectedRecords(id);if(rows.length>0){for(var i=0;i<rows.length;i++){var rc=this.iscCanvas.getRecordIndex(rows[i]);rs.push(rc);}}
return rs;};HTMLGrid.prototype.getSelectedRecord=function(id){return this.iscCanvas.getSelectedRecord();};HTMLGrid.prototype.getSelectedRecords=function(id){return this.iscCanvas.getSelectedRecords();};HTMLGrid.prototype.getRowCount=function(ignoreMode){if(!ignoreMode&&this.isFiltered)
return this.iscCanvas.getOriginalData().localData.length;return this.data.length;};HTMLGrid.prototype.getRealNameColumn=function(c){var idx=this.findColumn(c);if(!(idx===-1)){return this.iscCanvas.getAllFields()[idx].name;}else{return idx;}};HTMLGrid.prototype.getColumnTitle=function(realName){for(var i=0;i<this.iscCanvas.fields.length;i++){if(this.iscCanvas.fields[i].name===realName)
return this.iscCanvas.fields[i].title;}
return null;};HTMLGrid.prototype.getColumnCode=function(column){var cols=this.iscCanvas.getAllFields();return cols[this.findColumn(column)].cod;};HTMLGrid.prototype.getRowInGroup=function(){return this.iscCanvas.getRecordIndex(this.iscCanvas.getSelectedRecord());};HTMLGrid.prototype.getFirstRowIgnoreFolder=function(){var ref=this.iscCanvas;var allRows=ref.groupTree.getAllItems();var i=0,a=-1;for(i;i<allRows.length;i++){if(allRows[i].isFolder||allRows[i].isGroupSummary){continue;}else{a=i;break;}}
return a;};HTMLGrid.prototype.getComponentColumnIndexByName=function(fieldName){for(var i=0;i<this.columns.length;i++){if(this.columns[i].name===fieldName)
return i;}
return-1;}
HTMLGrid.prototype.getRowNo=function(data){this.startedEdition=true;var gridrn=this.getRowDBCursor();if(gridrn>this.getRowCount(data)-1)
gridrn=-2;var gt=1+parseInt(gridrn)+parseInt(this.gridini);return gt;};HTMLGrid.prototype.getRowIgnoreState=function(){let row=-1;if(this.isGrouped()){if(this.inserting)
row=this.data.length-1;else{row=this.getRowDBCursor(this.getRecord(this.editRow));}}else{row=this.inserting?this.editRow:this.getRowDBCursor(this.getRecord(this.editRow))===-1?this.data.length-1:this.getRowDBCursor(this.getRecord(this.editRow))}
return row;}
HTMLGrid.prototype.getPermissionDescription=function(){if(!isNullable(this.permissionDescription)){return this.permissionDescription;}
return this.callMethod(HTMLElementBase,"getPermissionDescription");};HTMLGrid.prototype.setColumn=function(c,nN){var idx=this.findColumn(c,true);var jnN={title:nN};this.iscCanvas.setFieldProperties(idx,jnN);};HTMLGrid.prototype.setColumns=function(cols,width,components){var summary=this.summaryProperties.summary;var summaryFields=summary&&summary.fields?summary.fields:{};var field=null;var t=this;for(var i=0;i<components.length;i++){cols[i].cod=components[i];field=summaryFields[this.findInSummary(cols[i].name,summaryFields)];if(field&&field.getGridSummary&&(preset[field.getGridSummary]==undefined||preset[field.getGridSummary])){field.getGridSummaryFlow=field.getGridSummary;field.getGridSummary=function(records,summaryField){return ebfFlowExecute(summaryField.getGridSummaryFlow,[clearRecords(records),summaryField]);}}
if(field&&field.summaryFunction&&(preset[field.summaryFunction]==undefined||preset[field.summaryFunction])){field.summaryFunctionFlow=field.summaryFunction;field.summaryFunction=function(records,summaryField){return ebfFlowExecute(summaryField.summaryFunctionFlow,[clearRecords(records),summaryField]);}}
if(field&&field.summaryFunction&&presetArray.includes(field.summaryFunction)&&cols[i].type=="double"){field.summaryFunctionOperation=field.summaryFunction;field.summaryFunction=function(records,summaryField){return t.groupOperation(clearRecords(records),summaryField,summaryField.summaryFunctionOperation);}}
cols[i]=Object.assign(cols[i],field);if(!(cols[i].type=='image')&&cols[i].showIf=='false')cols[i].canGroupBy=false;if(cols[i].type=='image')cols[i].canGroupBy=false;if(cols[i].type=='datetime'||cols[i].type=='date'){cols[i].realType=cols[i].type;cols[i].type='text';this.enableSimpleFilter&&this.filterMode==1?cols[i].defaultOperator='equals':null;}}
if(!objectIsEmpty(summaryFields)){var startGroup=[];var startGroupField=summaryFields.filter(function(elem){return elem['startGroup']===true;});if(startGroupField){startGroupField.map(function(group){startGroup.push(group.name);});}
this.startGroup=startGroup;}
this.columns=cols;this.columnsWidth=width;this.components=components;};HTMLGrid.prototype.createFooterRegisters=function(){if(this.enableNumberOfRecords){this.registers=isc.ToolStrip.create({ID:this.id+"_registers",width:"100%",height:24,members:[this.totalLabels=isc.Label.create({ID:this.id+"_totalsLabel",padding:3,width:"100%",})],});this.components_to_Grid.push(this.registers);}}
HTMLGrid.prototype.setColumnSize=function(cols){if(typeof document.n==="object"&&d.n.responsive){if(this.gridColumnNumberWidth&&this.gridColumnNumberWidth>0){let diffSize=this.gridColumnNumberWidth-28;let pscreen=this.width-diffSize;let size=cols.length;for(var i=0;i<size;i++){cols[i].width=Math.round((((pscreen*parseInt(cols[i].width,10))/this.width))+1)+"";}}}
return cols;};HTMLGrid.prototype.setData=function(data){if(this.editing)
this.completeCancelEdit();if(this.inserting)
this.completeCancelInclude();this.data=data;};HTMLGrid.prototype.setShowColumn=function(c,show){var idxColumn=this.findColumn(c);var rn=this.getRealNameColumn(c);if(rn!=-1){var gridConfig=gridFieldsConfig[this.id];if(show){this.iscCanvas.showField(rn);gridConfig["hiddenFields"].splice(gridConfig["hiddenFields"].indexOf(rn),1);this.iscCanvas.getAllFields()[idxColumn].showIf="true";}
else{this.iscCanvas.hideField(rn);gridConfig["hiddenFields"].push(rn);this.iscCanvas.getAllFields()[idxColumn].showIf="false";}
this.nav.setEnabled(!this.hasFrozenFieldVisible());if(this.editing||this.inserting)
this.cancel();}
var comp=this.iscCanvas.getAllFields()[idxColumn].comp;if(comp){var idx=this.iscCanvas.showRowNumbers?(idxColumn-1):idxColumn;if(this.showGroupSummary&&this.showGroupSummaryInHeader&&this.isGrouped())idx=idx-1;if(projectMode.toLowerCase()==='n')
this.setGrid(idx,show,comp);}
this.performFocus();};HTMLGrid.prototype.setSizeColumns=function(lC,lNw){if(lC instanceof Array&&lNw instanceof Array){var idx;for(var i=0;i<lC.length;i++){idx=this.findColumn(lC[i],true);this.iscCanvas.resizeField(idx,parseInt(lNw[i]));}}};HTMLGrid.prototype.setAllColumns=function(arrJson){var ref=this.iscCanvas;ref.setFields(arrJson);};HTMLGrid.prototype.setAllRecords=function(data){this.data=data;this.refreshData();};HTMLGrid.prototype.setCellDataByColumn=function(row,column,value){this.setCellDataByColumnNoRefresh(row,column,value);this.refreshData();};HTMLGrid.prototype.setCellDataByColumnNoRefresh=function(row,column,value){if(parseInt(row).toString()==="NaN"){let error=new Error();error.name=getLocaleMessage("ERROR.IMCOMPATIBLE_TYPE");error.message=getLocaleMessage("ERROR.NOT_A_NUMBER_VALUE");handleException(error);return;}
this.data[row][this.getRealNameColumn(column)]=value;};HTMLGrid.prototype.setEnabled=function(v){this.callMethod(HTMLElementBase,"setEnabled",[v]);if(this.nav)this.nav.setEnabled(this.enabled);};HTMLGrid.prototype.setVisible=function(v){this.callMethod(HTMLElementBase,"setVisible",[v]);if(this.nav)this.nav.setVisible(this.visible);};HTMLGrid.prototype.setReadOnly=function(v){this.callMethod(HTMLElementBase,"setReadOnly",[v]);this.readOnly=this.readonly;if(this.nav)this.nav.setReadOnly(this.readonly);};HTMLGrid.prototype.setRowColor=function(record,row,column){if(this.iscCanvas.getEditRow()!==row){var expression=this.conditionExpression;var flowCondition=this.conditionExpressionFlow;var showRowNumbers=this.iscCanvas.showRowNumbers;let canvas=this.iscCanvas;let diff=(canvas.getAllFields().length-canvas.fields.length)>0?true:false;let grouped=this.isGrouped();let paint;var colsPaint;var expressions;if(showRowNumbers&&(column===0)||(record&&(record.isFolder||record.isGroupSummary)))
return;if(flowCondition.length>0){var cfP=null;for(var i=0;i<flowCondition.length;i++){if(grouped){paint=(flowCondition[i].row===record.row);}else{paint=(flowCondition[i].row===row);}
if(paint)
cfP=flowCondition[i];}
if(cfP){colsPaint=cfP.colsPaint;if(colsPaint&&colsPaint.length>0){if(diff)
colsPaint=getGridVerifyColumns(this,colsPaint);if(colsPaint.contains(column))
return"background:"+cfP.color+"; border-color:"+cfP.color;}else return"background:"+cfP.color+"; border-color:"+cfP.color;}}
if(expression.length>0){expressions=this.getExpressionByRow(expression,record.row);for(var j=0;j<expressions.length;j++){var express=expressions[j];var expr=express.expression;if(grouped){paint=(expr&&record.row===express.row);}else{paint=expr;}
if(paint){if(showRowNumbers&&(column===0))return;colsPaint=express.colsPaint;if(colsPaint&&colsPaint.length>0){colsPaint=getGridVerifyColumns(this,colsPaint);if(colsPaint.contains(column))
return"background:"+express.color+"; border-color:"+express.color;}else return"background:"+express.color+"; border-color:"+express.color;}}}}
return;};HTMLGrid.prototype.getExpressionByRow=function(expressions,row){return expressions.filter(function(data){return data.row==row});}
HTMLGrid.prototype.setGridPageIni=function(v){this.gridini=v;};HTMLGrid.prototype.setGridPageEnd=function(v){this.gridend=v;if(this.paging)
this.paging.setGoto(v);};HTMLGrid.prototype.setMainImages=function(imgInclude,imgEdit,imgDelete,imgRefresh){this.imgInclude=imgInclude;this.imgEdit=imgEdit;this.imgDelete=imgDelete;this.imgRefresh=imgRefresh;};HTMLGrid.prototype.setEditImages=function(imgPost,imgCancel){this.imgPost=imgPost;this.imgCancel=imgCancel;};HTMLGrid.prototype.setIncludeImages=function(imgPost,imgCancel){this.imgPost=imgPost;this.imgCancel=imgCancel;};HTMLGrid.prototype.setShowFilter=function(show){var ref=this.iscCavas;ref.setShowFilterEditor(show);};HTMLGrid.prototype.setHeight=function(height){height=parseInt(height);this.callMethod(HTMLElementBase,'setHeight',[height]);this.iscCanvas.setHeight(height);};HTMLGrid.prototype.setWidth=function(width){width=parseInt(width);this.callMethod(HTMLElementBase,'setWidth',[width]);this.iscCanvas.setWidth(width);};HTMLGrid.prototype.setHint=function(hint){this.callMethod(HTMLElementBase,"setHint",[hint]);if(this.gridDiv){this.gridDiv.alt=hint;this.gridDiv.title=hint;}};HTMLGrid.prototype.setNumericFormat=function(i){if(!this.numericColumns)
this.numericColumns=[];this.numericColumns[i]=true;};HTMLGrid.prototype.setActionFlag=function(detail,page,post,order,refresh){this.actRefresh=refresh;this.actPaged=page;this.actPost=post;this.detailSelectRow=detail;this.actOrder=order;};HTMLGrid.prototype.exportData=function(type){var types=['HTML','JSON','LST','PDF','TXT','XLS','XML'];if(types.contains(type.toUpperCase())){var id=this.id+"Loading";let _parent=this.div;gridLoading(id,_parent);var formGuid=this.formGUID+"_"+this.id;var url=getAbsolutContextPath()+'WFRGridExport';url+='?sys='+sysCode+'&formID='+this.formCode+'&type='+type+'&formGUID='+URLEncode(formGuid,'GET');var xhr=new XMLHttpRequest();xhr.open("GET",url,true);xhr.responseType="blob";xhr.onload=function(e){if(xhr.readyState===4){if(xhr.status>=200&&xhr.status<=299){gridDownloadFileData(this.response,type);gridRemoveLoading(id,_parent);}else{gridRemoveLoading(id,_parent);try{let reader=new FileReader();reader.onload=function(event){eval(reader.result);}
reader.readAsText(xhr.response,ENCODING);}catch(e){var msg=new HTMLMessage();msg.showErrorMessage("",getLocaleMessage("ERROR.GRID_EXPORT_DATA_FAILED"),null,xhr.statusText,null);}}}};xhr.onerror=function(e){gridRemoveLoading(id,_parent);var msg=new HTMLMessage();msg.showErrorMessage("",getLocaleMessage("ERROR.GRID_EXPORT_DATA_FAILED"),null,xhr.statusText,null);}
xhr.send(null);}
return false;};HTMLGrid.prototype.groupOperation=function(records,summaryField,operation){if(records&&operation=="sum"||operation=="avg"){var sum=0;for(var i=0;i<records.length;i++){sum+=parseNumeric(records[i][summaryField.name]=="&nbsp;"?0:records[i][summaryField.name]);}
return operation=="avg"?ebfFormatNumber(ebfArredondaDecimal(sum/records.length,this.round),"###,###.00"):ebfFormatNumber(ebfArredondaDecimal(sum,this.round),"###,###.00");}else if(records&&operation=="count"){return records.length;}else if(records&&operation=="multiplier"){var sum=1;for(var i=0;i<records.length;i++){sum*=parseNumeric(records[i][summaryField.name]=="&nbsp;"?0:records[i][summaryField.name]);}
return ebfFormatNumber(ebfArredondaDecimal(sum,this.round),"###,###.00");}else if(records&&operation=="max"){var valor,maximo=0;for(var i=0;i<records.length;i++){valor=parseNumeric(records[i][summaryField.name]=="&nbsp;"?0:records[i][summaryField.name]);if(valor>maximo)
maximo=valor;}
return ebfFormatNumber(ebfArredondaDecimal(maximo,this.round),"###,###.00");}else if(records&&operation=="min"){var valor,minimo=0;for(var i=0;i<records.length;i++){valor=parseNumeric(records[i][summaryField.name]=="&nbsp;"?0:records[i][summaryField.name]);var valor,minimo=0;if(valor<minimo)
minimo=valor;}
return ebfFormatNumber(ebfArredondaDecimal(minimo,this.round),"###,###.00");}};HTMLGrid.prototype.clearSelectedRows=function(rowNum){var ref=this.iscCanvas;if(rowNum>=0)
ref.deselectRecord(rowNum);};HTMLGrid.prototype.showNormalElements=function(){if(this.elements_Of_Grid){let size=this.elements_Of_Grid.length;for(var i=0;i<size;i++){if(this.elements_Of_Grid[i].style.display&&this.elements_Of_Grid[i].style.display==='none')
this.elements_Of_Grid[i].style.removeProperty('display');}}};HTMLGrid.prototype.checkShowBar=function(){if(!this.nav.enabled&&!this.hasPagination){this.bar.style.setProperty("display","none","important");this.bar.visible=false;}else{this.bar.style.display=null;this.bar.visible=true;}};HTMLGrid.prototype.cancel=function(){this.navigationEndEditing();if(this.editing)
this.cancelEdit();else if(this.inserting)
this.cancelInclude();};HTMLGrid.prototype.edit=function(){var ref=this.iscCanvas;var gridConfig=gridFieldsConfig[this.id];if(!this.enabled||this.readonly||!this.editable||(this.nav&&!this.nav.btEdit)||(Object.keys(gridConfig["frozenFields"]).length>0&&this.hasFrozenFieldVisible()))
return;this.navigationStartEditing();if(this.data.length==0){this.include();}else{if(this.isGrouped())
row=this.getRowInGroup()==-1?this.getFirstRowIgnoreFolder():this.getRowInGroup();else
row=this.getSelectedRow()==-1||this.getSelectedRow()>ref.getOriginalData().getAllRows().length-1?0:this.getSelectedRow();if(row==-1){this.navigationEndEditing();return;}
if(this.getSelectedRow()==-1)this.selectRow(0);this.currentRow=row;this.startEditing=true;this.startedEdition=true;ref.collapseGroupOnRowClick=false;ref.canCollapseGroup=false;var gt=this.getRowNo(true);if(gt<=0){this.focusColumn=0;gt=this.gridini+1;}
getAndEval('gridEdit.do?sys='+this.sys+'&action=gridEdit&param=edit&formID='+this.formID+'&comID='+this.code+'&gridComID=-1&gt='+gt);}};HTMLGrid.prototype.cancelEdit=function(){getAndEval('gridEdit.do?sys='+this.sys+'&action=gridEdit&param=canceledit&formID='+this.formID+'&comID='+this.code+'&gt=-1');};HTMLGrid.prototype.completeEdit=function(){this.startEditing=false;this.editing=true;var ref=this.iscCanvas;ref.setCanResizeFields(false);this.vScrollSetDisabled(true);this.timeout(function(){this.completeEditRow()},0);this.editCells=[];this.navWasVisible=this.paging.getVisible();this.paging.setVisible(false);};HTMLGrid.prototype.cancelInclude=function(){getAndEval('gridEdit.do?sys='+this.sys+'&action=gridEdit&param=cancelinsert&formID='+this.formID+'&comID='+this.code+'&gt=-1');};HTMLGrid.prototype.completeCancelInclude=function(){this.showNormalElements();this.completePost(true);this.data.pop();this.keys.pop();if(this.data.length>0){this.moveScrollToRow(0);}
this.clearSelectedRows(this.currentRow);this.currentRow=this.currentRow-=this.isGrouped()?(this.showGroupSummaryInHeader&&this.showCollapsedGroupSummary?0:(eval(this.iscCanvas.getGroupState()).length))+1:1;this.selectRow(this.currentRow);this.selectionChanged();this.timeout(this.gridFocus,100);};HTMLGrid.prototype.include=function(){if(!this.enabled||this.readonly||!this.editable||this.editing||this.inserting||(this.nav&&!this.nav.btInclude))
return;this.navigationStartEditing();this.startedEdition=true;this.iscCanvas.collapseGroupOnRowClick=false;this.iscCanvas.canCollapseGroup=false;getAndEval('gridEdit.do?sys='+this.sys+'&action=gridEdit&param=insert&formID='+this.formID+'&comID='+this.code+'&gt=-1');};HTMLGrid.prototype.addColumn=function(column){var idx=this.findColumn(column);if(idx!==-1){let error=new Error();error.name=getLocaleMessage("LABEL.ADD_ITEM");error.message=getLocaleMessage("INFO.GRID_ALREADY_CONTAINS_COLUMN",column,this.description);handleException(error);return;}
var jC={};jC.name=column;jC.title=column;jC.type="text";jC.width=50;this.iscCanvas.addField(jC);if(this.editing||this.inserting)
this.cancel();};HTMLGrid.prototype.findColumn=function(column,rendered){var idx=-1;var ref=this.iscCanvas;var lC=null;if(!rendered)lC=ref.getAllFields();else lC=ref.fields;if(column){for(var i=0;i<lC.length;i++){if(lC[i].title===column){idx=i;break;}}}
return idx;};HTMLGrid.prototype.findInSummary=function(name,data){var idx=-1;var lC=data;if(name){for(var i=0;i<lC.length;i++){if(lC[i].name===name){idx=i;break;}}}
return idx;};HTMLGrid.prototype.findVisibleColumn=function(column){var idx=-1;var ref=this.iscCanvas;var lC=ref.fields;if(column){for(var i=0;i<lC.length;i++){if(lC[i].title===column)
return i;}}
return idx;};HTMLGrid.prototype.columnIsVisible=function(columnCode){var ref=this.iscCanvas.fields;if(columnCode)
for(var i=0;i<ref.length;i++)
if(ref[i].cod===columnCode)
return true;return false;};HTMLGrid.prototype.deleteRow=function(){var currentGrid=this;var ref=this.iscCanvas;var lS=this.getSelectedRow();var code=this.code;var formId=this.formID;var gt=this.getRowNo(true);var self=this;if(!this.enabled||this.readonly||!this.editable||(this.nav&&!this.nav.btDelete))
return;if(lS<0||this.getLengthData()<lS){interactionError(getLocaleMessage("INFO.GRID_RECORD_SELECT"));}else{this.lastSelectionIndex=lS;var okFunction=function(boolTest,argumentsArray){try{if(currentGrid.beforeDelete)
currentGrid.beforeDelete();getAndEvalSync('gridEdit.do?sys='+sysCode+'&action=gridEdit&param=delete&formID='+formId+'&comID='+code+'&gridComID=-1&gt='+gt);self.timeout(self.focus,0);}catch(e){handleException(e);}};var cancelFunction=function(){self.timeout(self.focus,0);};var interaction=new parent.mainform.HTMLMessage();interaction.showInteractionConfirmMessage($mainform().getLocaleMessage("LABEL.REMOVE_RECORD"),$mainform().getLocaleMessage("INFO.REMOVE_CONFIRM"),okFunction,null,cancelFunction,null,null,$mainform().getLocaleMessage("LABEL.YES"),$mainform().getLocaleMessage("LABEL.NO"));}};HTMLGrid.prototype.refreshData=function(notFocus){this.resetDataSource();if(!notFocus)
this.gridFocus();if(this.nav)
this.nav.setVisible(this.editable&&this.parentHasData);};HTMLGrid.prototype.resetDataSource=function(){var ref=this.iscCanvas;var grid=this;var gridConfig=gridFieldsConfig[this.id];var fields=ref.fields;gridConfig["fieldsSizes"]={};for(var i=0;i<fields.length;i++){var field=fields[i];if(field.name)
gridConfig["fieldsSizes"][field.name]=field.width;}
gridConfig["fieldOrder"]=this.getFieldsOrder();gridConfig["groupState"]={};if(grid.isGrouped()){gridConfig["groupState"]["openDescendantFolders"]=[];var openDescendantFolders=ref.groupTree.getDescendantFolders();for(var i=0,a=0;i<openDescendantFolders.length;i++){const element=openDescendantFolders[i];if(element["_isOpen_"+ref.groupTree.ID]){gridConfig["groupState"]["openDescendantFolders"][a]=[element,i];a++;}}}
var data=this.data;ref.getDataSource().setCacheData(data);ref.refreshData(function(){grid.loadConfigs();grid.checkSelectionRow();});};HTMLGrid.prototype.loadConfigs=function(){var gridConfig=gridFieldsConfig[this.id];var ref=this.iscCanvas;var rowNumbers=ref.showRowNumbers?1:0;var idx=0;for(var i=0;i<gridConfig.fieldOrder.length;i++){if(ref.fieldIsVisible(gridConfig.fieldOrder[i])){this.ActUpGrid=false;ref.reorderField(ref.getFieldNum(gridConfig.fieldOrder[i]),idx+rowNumbers);this.ActUpGrid=true;idx++;}}
if(Object.keys(gridConfig["frozenFields"]).length>0){this.nav.setEnabled(!this.hasFrozenFieldVisible());for(var i=0;i<Object.keys(gridConfig["frozenFields"]).length;i++){var field=Object.keys(gridConfig["frozenFields"])[i];var fieldTitle=this.getColumnTitle(field);var idx=this.findColumn(fieldTitle);this.ActUpGrid=false;ref.reorderField(idx,gridConfig["frozenFields"][field]);this.ActUpGrid=true;ref.freezeField(field);}}
if(gridConfig["hiddenFields"].length>0)
for(var i=0;i<gridConfig["hiddenFields"].length;i++)
if(projectMode!=="D")
ref.hideField(gridConfig["hiddenFields"][i]);if(gridConfig["removedFields"].length>0)
for(var i=0;i<gridConfig["removedFields"].length;i++)
ref.removeField(gridConfig["removedFields"][i]);if(gridConfig["fieldsSizes"]){for(var i=0;i<ref.fields.length;i++){var field=ref.fields[i];if(gridConfig["fieldsSizes"][field.name]){var fieldIndex=ref.getFieldNum(field.name);ref.resizeField(fieldIndex,gridConfig["fieldsSizes"][field.name]);}}}};HTMLGrid.prototype.returnStateGroup=function(arr){var gridConfig=gridFieldsConfig[this.id];var ref=this.iscCanvas;var oldArr;if(this.isGrouped()&&gridConfig["groupState"]){var folders=gridConfig["groupState"]["openDescendantFolders"];if(!folders)
return;oldArr=gridConfig["groupState"]["oldState"]
if(!oldArr)
oldArr=arr;else
oldArr=oldArr;if(oldArr===arr){var foldersNew=ref.groupTree.getDescendantFolders();var paths=this.openFolders(folders,foldersNew,ref)
ref.groupTree.openFolders(paths);this.moveScrollToRow(this.currentRow);this.checkSelectionRow();}
gridConfig["groupState"]["oldState"]=arr;}};HTMLGrid.prototype.openFolders=function(folders,foldersNew,ref){var paths=[];for(var i=0;i<folders.length;i++){const element=folders[i];paths[i]=ref.groupTree.getPath(foldersNew[element[1]]);}
return paths;};HTMLGrid.prototype.checkSelectionRow=function(){var rowNum=this.getSelectedRow();if(this.actRefresh||this.actPost||this.actPaged){if(!this.dependentGrids||this.dependentGrids.length===0){this.clearSelectedRows(rowNum);this.selectRow(this.currentRow);}else if(this.actPost||this.gridSelectRowMaster){this.selectRow(rowNum);}else{this.selectRow(rowNum);}}else if((this.detailSelectRow||this.actOrder)||(this.gridMaster&&this.currentRow!=-1)){this.clearSelectedRows(rowNum);this.selectRow(this.currentRow);}};HTMLGrid.prototype.completeDeleteRow=function(){this.actRefresh=true;this.startedEdition=false;if(this.afterDelete){try{this.afterDelete();}catch(e){handleException(e);}}
if(this.data.length>0){this.lastSelectionIndex=this.lastSelectionIndex<this.data.length?this.lastSelectionIndex:this.lastSelectionIndex-1;this.currentRow=this.lastSelectionIndex
this.selectRow(this.lastSelectionIndex);}
if(this.hasPagination)this.iscCanvas.dataChanged();};HTMLGrid.prototype.removeColumn=function(c){var rNc=this.getRealNameColumn(c);if(rNc!=-1){var gridConfig=gridFieldsConfig[this.id];if(c)
gridConfig["removedFields"].push(rNc);else
gridConfig["removedFields"].splice(gridConfig["removedFields"].indexOf(rNc),1);this.iscCanvas.removeField(rNc);for(var i=0;i<Object.keys(gridConfig["frozenFields"]).length;i++)
if(Object.keys(gridConfig["frozenFields"])[i]===rNc)
delete gridConfig["frozenFields"][rNc];if(this.editing||this.inserting)
this.cancel();}};HTMLGrid.prototype.removeDataRow=function(r){if(r>=0){this.data=arrayIndexRemove(this.data,r);this.refreshData();}else{interactionError(getLocaleMessage("INFO.GRID_RECORD_SELECT"));}};HTMLGrid.prototype.includeNewRow=function(notRefresh){var jRow={};for(var i=0;i<this.columns.length;i++){jRow[this.columns[i].name]='';}
this.data.push(jRow);var newKeyData=new Array(this.keysLength);if(this.eventParams.indexOf(3)!=-1){for(var i=0;i<newKeyData.length;i++){newKeyData[i]='';}}
this.keys.push(newKeyData);var newQueryValues=new Array(this.queryValuesLength);if(this.eventParams.indexOf(5)!=-1){for(var i=0;i<newQueryValues.length;i++){newQueryValues[i]='';}}
this.queryValues.push(newQueryValues);if(!notRefresh)
this.refreshData();};HTMLGrid.prototype.moveScrollToRow=function(rowIndex){var ref=this.iscCanvas;var leftPos=ref.body.getScrollLeft();ref.scrollToRow(rowIndex);ref.body.scrollTo(leftPos);};HTMLGrid.prototype.moveScrollToColumn=function(column){this.iscCanvas.scrollToColumn(this.findColumn(column));};HTMLGrid.prototype.selectRow=function(r,increment){var ref=this.iscCanvas;if(r>=0&&r<=ref.getTotalRows()-1){var record=ref.getRecord(r);if(this.isGrouped()){while(record&&record.isGroupSummary){this.selectRow(r+1);return;}
while(record&&record.isFolder){ref.openGroup(record);record=record.groupMembers[0];}}
ref.selectRecord(record);}};HTMLGrid.prototype.refresh=function(updateColumns,keepFocus){gridLoading("_"+this.id+"_refresh",this.div,this.id);this.setActionFlag(false,false,false,false,true);var url='gridEdit.do?sys='+this.sys+'&action=gridEdit&param=refresh&formID='+this.formID+'&comID='+this.code+'&gridComID=-1&gt=-1';let first=false;let regexp=null;let arr=null;var components=d.t.dependences[this.code];if(components&&components.length>0){let size=components.length;for(var i=0;i<size;i++){if(isNumeric(components[i])){var component=eval("$mainform().d.c_"+components[i]);if(component&&(!this.isFiltered||this.filterMode===0)){url+=("&WFRInput"+component.code+"="+URLEncode(component.value,"GET"));}else if(this.isFiltered){if(this.refreshURL&&this.filterMode===1){if(!first){regexp=new RegExp(/[^&?]*?=[^&?]*/g);arr=this.refreshURL.match(regexp);first=true;}
if(arr){let size=arr.length;for(var j=0;j<size;j++){let oldvalue=arr[j];if(oldvalue.indexOf("WFRInput"+component.code+"=")!=-1)
this.refreshURL=this.refreshURL.replace(oldvalue,("WFRInput"+component.code+"="+URLEncode(component.value,"GET")));}}else{this.refreshURL+=("&WFRInput"+component.code+"="+URLEncode(component.value,"GET"));}}}}}}
if(this.refreshURL)
url=this.refreshURL;let comp=this;updateColumns=updateColumns?true:false;gridSendCommand(url,"_"+this.id+"_refresh",this.div,true,function(resp,grid,updateColumns){lastReceivedContent=resp;grid.ordered=null;eval(resp);if(keepFocus){grid.gridFocus();}
if(updateColumns){grid.timeout(grid.setAllColumns,0,[grid.columns]);}
if(grid.hasPagination)grid.iscCanvas.dataChanged();},comp,updateColumns,this.id);};HTMLGrid.prototype.filter=function(f,editor){gridLoading("_"+this.id+"_filter",this.div,this.id);const param=!editor?"filter":"editorfilter";f=!editor?f:JSON.stringify(f);var url='gridEdit.do?sys='+this.sys+'&param='+param+'&formID='+this.formID+'&comID='+this.code+'&filter='+URLEncode(f,"GET");var components=d.t.dependences[this.code];if(components&&components.length>0){let size=components.length;for(var i=0;i<size;i++){if(isNumeric(components[i])){var component=eval("$mainform().d.c_"+components[i]);if(component){url+=("&WFRInput"+component.code+"="+URLEncode(component.value,"GET"));}}}}
gridSendCommand(url,"_"+this.id+"_filter",this.div,true,function(resp,grid){eval(resp);grid.iscCanvas.dataChanged();},this,null,this.id);this.refreshURL=url;};HTMLGrid.prototype.updateFilter=function(){if(this.isFiltered){this.isFiltered=false;this.iscCanvas.clearCriteria();if(this.refreshURL)
this.refreshURL=null;}};HTMLGrid.prototype.saveAdvancedFilter=function(criteria){if(!this.disableUserCustomize&&loggedUserWithProfile){if(criteria){var formID=this.formGUID+'_'+this.id;gridSendCommand('saveGridFilter.do?sys='+sysCode+'&action=saveGridFilter&formID='+encodeURI(formID)+'&jsonFilter='+URLEncode(JSON.stringify(criteria),'GET')+'&formCode='+this.formCode);}}};HTMLGrid.prototype.parseCriteria=function(criteria,main,constructor){let jCriteria=[];if(criteria){if(!criteria.criteria){let cont=0;for(var o=null in criteria){let jCols=this.columns.filter(function(v){return v.name===o});jCriteria[cont]={field:jCols[0].cod,value:this.parseValue(jCols[0].cod,criteria[o],(jCols[0].realType?jCols[0].realType:jCols[0].type),jCols[0]),operator:this.parseOperator("",(jCols[0].realType?jCols[0].realType:jCols[0].type),true,jCols[0].cod),};cont++;}
return jCriteria;}else{let cont=0;criteria=criteria.criteria;let size=criteria.length;for(var i=0;i<size;i++){if(criteria[i]["_constructor"]){let constructor=(_STARTSCRITERIA&&i===0)?false:true;let nCriteria=this.parseCriteria(criteria[i],criteria[i].operator.toUpperCase(),constructor);jCriteria=jCriteria.concat(nCriteria);_STARTSCRITERIA=false;cont=jCriteria.length;continue;}
let jCols=this.columns.filter(function(v){return v.name===criteria[i].fieldName});jCriteria[cont]={field:jCols[0].cod,value:this.parseValue(jCols[0].cod,criteria[i].value,(jCols[0].realType?jCols[0].realType:jCols[0].type),jCols[0]),operator:this.parseOperator(criteria[i].operator,(jCols[0].realType?jCols[0].realType:jCols[0].type),false,jCols[0].cod),};cont++;}
if(constructor){jCriteria=[{_constructor:{mainOperator:main,criteria:jCriteria}}];}
return jCriteria;}}
return criteria;};HTMLGrid.prototype.checkIsAdvancedCriteria=function(criteria){let size=criteria.length;var onlyCriteria=false
for(var i=0;i<size;i++){if(criteria[i]["_constructor"])
onlyCriteria=true;else
onlyCriteria=false;}
return onlyCriteria;}
HTMLGrid.prototype.parseValue=function(cod,value,type,col){if(this.bind&&this.bind.length>0){let jsValueParse=this.bind.filter(function(o){return Object.keys(o)[0]==cod;});if(jsValueParse&&jsValueParse.length>0)
return jsValueParse[0][cod][value]?jsValueParse[0][cod][value]:value;}
if(type==='datetime'||type==='date')
return value+_jsonConverter["date"];if(type==='boolean'){return value?this["componentCheck"+cod].valueCheck:this["componentCheck"+cod].valueUnCheck;}
return value;};HTMLGrid.prototype.validateTypesAndValues=function(criteria){let validated=true;if(!criteria.criteria){for(var o=null in criteria){let jCols=this.columns.filter(function(v){return v.name===o});validated=this.checkTypeValidate(jCols[0].realType?jCols[0].realType:jCols[0].type,criteria[o],jCols[0].title);if(validated)continue;else break;}}
else{criteria=criteria.criteria;let size=criteria.length;for(var i=0;i<size;i++){if(criteria[i]["_constructor"]){let v=this.validateTypesAndValues(criteria[i]);if(v)continue;else return v;}
let jCols=this.columns.filter(function(v){return v.name===criteria[i].fieldName});let rv=this.checkTypeValidate(jCols[0].realType?jCols[0].realType:jCols[0].type,criteria[i].value,jCols[0].title);if(rv)continue;else return rv;}}
return validated;};HTMLGrid.prototype.checkTypeValidate=function(type,value,col){let validated=true;if(type==='datetime'||type==='date'){validated=isDateTime(value);if(!validated){let error=new Error();error.name=getLocaleMessage("ERROR.GET_XML_DATA_FAILED");error.message=getLocaleMessage("ERROR.INVALID_FIELD_DATE_FORMAT",col);handleException(error);return validated;}}
else if(type==='integer'||type==='numeric'||type==='double'||type==='float'){if(toDouble(value).toString()==='NaN')
validated=false;else
validated=isNumeric(value);if(!validated){let error=new Error();error.name=getLocaleMessage("ERROR.GET_XML_DATA_FAILED");error.message=getLocaleMessage("ERROR.FIELD_NOT_A_NUMBER",value,col)
handleException(error);return validated;}}
return validated;};HTMLGrid.prototype.parseOperator=function(operator,type,def,cod){let equals=false;if(this.bind&&this.bind.length>0){let jsValueParse=this.bind.filter(function(o){return Object.keys(o)[0]==cod;});if(jsValueParse&&jsValueParse.length>0){type=jsValueParse[0][cod]["type"]?jsValueParse[0][cod]["type"]:type;operator="equals";equals=true;}}
if(def&&!equals){if(type==="integer"||type==="double")
return 17;else if(type==="date"||type==="datetime")
return 10;else if(type==="boolean"){if(this["componentCheck"+cod].valueCheck==="true"||this["componentCheck"+cod].valueCheck==="false")
return 28;else if(!isNaN(this["componentCheck"+cod].valueCheck)&&isFinite(this["componentCheck"+cod].valueCheck))
return 17}
return 2;}
if(!type||type==="text")
return operator&&_jsonOperator[operator]?_jsonOperator[operator]:2;else if(type==="boolean"){if(this["componentCheck"+cod].valueCheck==="true"||this["componentCheck"+cod].valueCheck==="false")
return 28;else if(!isNaN(this["componentCheck"+cod].valueCheck)&&isFinite(this["componentCheck"+cod].valueCheck))
return 17
return 2;}else{if(operator&&operator==="equals"&&(type==="integer"||type==="double"||type==="date"||type==="datetime")){if(type==="date"||type==="datetime")
return 10;return 17;}else if(operator&&operator==="lessThan"&&(type==="integer"||type==="double"||type==="date"||type==="datetime")){if(type==="date"||type==="datetime")
return 12;return 19;}else if(operator&&operator==="greaterThan"&&(type==="integer"||type==="double"||type==="date"||type==="datetime")){if(type==="date"||type==="datetime")
return 11;return 18;}else if(operator&&operator==="notEqual"&&(type==="integer"||type==="double"||type==="date"||type==="datetime")){if(type==="date"||type==="datetime")
return 27;return 26;}else if(operator&&operator==="lessOrEqual"&&(type==="integer"||type==="double"||type==="date"||type==="datetime")){if(type==="date"||type==="datetime")
return 14;return 21;}else if(operator&&operator==="greaterOrEqual"&&(type==="integer"||type==="double"||type==="date"||type==="datetime")){if(type==="date"||type==="datetime")
return 13;return 20;}}};HTMLGrid.prototype.openNormalForm=function(include){if(!this.enabled||this.readonly||!this.parentHasData)
return;var gotoRow=this.getRowNo(true);var properties=getContent("gridOpenForm.do?sys="+this.sys+"&formID="+this.formCode);let jsonPorperties={};jsonPorperties.formGUID=mainform.formGUID;jsonPorperties.component=this.id;jsonPorperties.method='refreshPage';jsonPorperties.action='wea';var otherProperties=(", gotoRow: "+gotoRow+", onClose: true, jsonProperties:'"+JSON.stringify(jsonPorperties)+"'");var content=("openForm({"+properties+otherProperties+"})");if(include==true){content=content.replace('mode: 0','mode: 1');content=content.replace('mode: -1','mode: 1');}
this.actRefresh=true;eval(content);};HTMLGrid.prototype.refreshPage=function(){var url='gridEdit.do?sys='+this.sys+'&action=gridEdit&param=refreshpage&formID='+this.formID+'&comID='+this.code+'&gridComID=-1&gt=-1';var content=getContent(url);lastReceivedContent=content;eval(content);};HTMLGrid.prototype.gridCheckBox=function(state,valueCheck,valueUnCheck,com,row,componentProperties,checkCmd){this["componentCheck"+com]={"valueCheck":valueCheck,"valueUnCheck":valueUnCheck};if(state==0){state=false;}else if(state==1){state=true;}else{state=undefined;}
var canEdit=(this.editable&&this.enabled&&!this.readonly&&(isNullable(componentProperties)||(componentProperties.enabled&&!componentProperties.readonly)));if(isNullable(checkCmd)){checkCmd="";}else{checkCmd+="; ";}
if(canEdit){var stt=state?1:0;var postCmd="postCheckOption(\'"+this.code+"\','"+com+"',"+"'"+stt+"',"+"'"+valueCheck+"',"+"'"+valueUnCheck+"',"+"'"+row+"',"+''+");";var cmd=checkCmd+postCmd;gridChecks[com+"_"+row]=cmd;}
if(componentProperties)
gridCheckProperties[(row-1)+"_"+com]=componentProperties;return state;};HTMLGrid.prototype.resetRowColor=function(){};HTMLGrid.prototype.setNumericFormat=function(){};HTMLGrid.prototype.enableNavigation=function(f,p,n,l){this.lastNavigation=[f,p,n,l];this.paging.enableButtons(f,p,n,l);if(f||p||n||l)this.hasPagination=true;else this.hasPagination=false;};HTMLGrid.prototype.post=function(includeNew){if(!this.editing&&!this.inserting)
return;if(this.checkBoxChecked){var row=this.checkBoxChecked['row'];var col=this.checkBoxChecked['col'];}
if(this.checkRequireds()){this.setActionFlag(false,false,true,false,false);if(this.checkBoxChecked){this.executeCheckCmd(this,row,col);}
try{if(this.editing&&this.beforeUpdate)
this.beforeUpdate();if(this.inserting&&this.beforeInsert)
this.beforeInsert();var arr=eval('document.editComponents'+this.code);var value,code;const line=this.getRowIgnoreState();var url='gridEdit.do?sys='+this.sys+'&action=gridEdit&param=post&formID='+this.formID+'&comID='+this.code+'&line='+line+'&gt=-1&gridComID=-1&storedProcedureName=&storedProcedureParams=&align=0';if(includeNew){url+='&includeNew=true';}
for(var i=0;i<arr.length;i++){var editor=arr[i];value=editor.value;code=editor.getCode();url=url+'&WFRInput'+code+'='+URLEncode(value,"GET");}
getAndEvalSync2(url);}catch(e){handleException(e);}}
else{this.currentRow=this.editRow;this.clearSelectedRows(this.getSelectedRow());}
if(this.checkBoxChecked){var ref=this.iscCanvas;var fieldName=ref.getField(col).name;ref.getRecord(row)[fieldName]=ref.getRecord(row)[fieldName]?false:true;ref.refreshCell(row,col);this.checkBoxChecked=undefined;}};HTMLGrid.prototype.gridButton=function(func,code,img,componentProperties){var icon=iconPathExport+'grid_button.gif';var id="grid"+this.getCode()+'button'+buttonId;var hint=componentProperties.hint?componentProperties.hint:"";hint=stringToHTMLString(hint);if(img)
icon=getAbsolutContextPath()+img;gridFunctions[id]=func;buttonId++;return{src:icon,width:14,height:12,extraStuff:"id="+id+" onClick=executeGridComponentEvent(id) alt="+hint+" title="+hint+" style=cursor:pointer"};};function executeGridComponentEvent(componentID){eval(gridFunctions[componentID]);}
HTMLGrid.prototype.completePost=function(cancel,newDataRow,newKeyData,newQueryValues){try{this.navigationEndEditing();var ref=this.iscCanvas;let row=this.getRowIgnoreState();var arr=eval('document.editComponents'+this.code);if(!arr){this.editRow=-1;this.actRefresh=true;this.refreshData();return false;}
if(row<0){this.editRow=-1;this.editing=false;this.inserting=false;this.startedEdition=false;ref.collapseGroupOnRowClick=true;ref.canCollapseGroup=true;return;}
if(this.editing||this.inserting){var colNum=ref.showRowNumbers?1:0;var fields=ref.fields;var sizeFields=fields.length;while(sizeFields>colNum){var fieldCode=fields[colNum].cod;var elem=getComponent(arr,fieldCode);if(elem){if(!cancel&&elem.canRemainNotDBAwareValue()&&!(this.passwordFieldHideValue&&elem.password)){let value=elem.getValue();if(value)newDataRow["field"+fieldCode]=value;}
if(elem.div&&elem.visible)
elem.div.parentElement.removeChild(elem.div);}
colNum++;}}
if((this.inserting||this.editing)&&!cancel){ref.getDataSource().cacheData[row]=newDataRow;}
if(this.editing&&this.afterUpdate&&!cancel)
this.afterUpdate();if(this.inserting&&this.afterInsert&&!cancel){try{this.afterInsert();}catch(e){handleException(e);}}
for(var i=0;i<arr.length;i++){var elem=arr[i];try{elem.free(true);}catch(e){console.error(e);}}
eval('document.editComponents'+parseInt(this.code)+'= undefined');this.keys[row]=newKeyData;this.queryValues[row]=newQueryValues;this.editRow=-1;this.paging.setVisible(this.navWasVisible);this.editing=false;this.inserting=false;this.startedEdition=false;ref.collapseGroupOnRowClick=true;ref.canCollapseGroup=true;ref.setCanResizeFields(true);this.vScrollSetDisabled(false);this.timeout(this.gridFocus,100);if(!cancel)$c(ref.ID).refreshData();ref.cancelEditing();}catch(e){handleException(e);}};HTMLGrid.prototype.refreshServer=function(focus){var url='gridEdit.do?sys='+this.sys+'&action=gridEdit&param=refresh&formID='+this.formID+'&comID='+this.code+'&gridComID=-1&gt=-1';var components=d.t.dependences[this.code];if(components&&components.length>0){for(var code in components){if(isNumeric(code)){var component=eval("$mainform().d.c_"+components[code]);if(component){url+=("&WFRInput"+component.code+"="+URLEncode(component.value,"GET"));}}}}
if(this.refreshURL)
url=this.refreshURL;var content=getContent(url);lastReceivedContent=content;this.ordered=null;eval(content);if(focus){this.gridFocus();}};HTMLGrid.prototype.gridFocus=function(){this.iscCanvas.focus();this.performFocus();};HTMLGrid.prototype.afterInsert=function(){};HTMLGrid.prototype.completeNotPost=function(){};HTMLGrid.prototype.completeInclude=function(){var ref=this.iscCanvas;this.clearSelectedRows(this.getSelectedRow());var editingRow;this.inserting=true;ref.setCanResizeFields(false);this.vScrollSetDisabled(true);ref.startEditingNew(null,true);editingRow=ref.getEditRow();this.moveScrollToRow(editingRow);ref.focusInCell(editingRow,0);this.includeNewRow(true);this.currentRow=this.isGrouped()||this.isFiltered?editingRow:this.data.length-1;this.selectRow(this.currentRow);this.selectionChanged();this.navWasVisible=this.paging.getVisible();this.paging.setVisible(false);this.timeout(function(){this.completeEditRow(true)},0);};HTMLGrid.prototype.completeIncludePost=function(){if(this.data.length>this.pagingSize){this.refresh();}else{this.clearSelectedRows(this.currentRow);if(this.isGrouped()){this.currentRow=-1;this.iscCanvas.deselectAllRecords();}else{this.currentRow=this.data.length-1;this.selectRow(this.currentRow);}}
this.iscCanvas.dataChanged();};HTMLGrid.prototype.completeCancelEdit=function(){this.completePost(true);this.showNormalElements();this.gridFocus();this.selectRow(this.currentRow);};HTMLGrid.prototype.navigationEndEditing=function(){this.nav.onEditing=false;if(!this.enabled){this.nav.setEnabled(true);this.nav.toggleButtons();this.nav.setEnabled(false);}else
this.nav.toggleButtons();if(this.showFilter)this.iscCanvas.setShowFilterEditor(true);}
HTMLGrid.prototype.navigationStartEditing=function(){this.nav.onEditing=true;this.nav.toggleButtons();}
HTMLGrid.prototype.pagingNavigateAction=function(param){if(this.execOnChangeOnNavigate&&this.onchange){this.onchange.call(this);}};HTMLGrid.prototype.markFirst=function(){if(this.gridMaster){var gm=$c(this.gridMaster);if(gm){gm.iscCanvas.recordClick=function(){gm.onRowClick();gm.selectionChanged();}
if(gm&&gm.data.length>0){gm.timeout(function(row){gm.clearSelectedRows(gm.currentRow);gm.currentRow=0;gm.currentSelection=0;gm.moveScrollToRow(0);if(!gm.inserting&&!gm.editing)
gm.selectRow(row);},250,[0]);}}}};HTMLGrid.prototype.onFormLoadAction=function(){if(!this.masterDefined){this.masterDefined=true;this.defineGridMaster();}
if(this.gridMaster){var gm=$c(this.gridMaster);if(gm&&gm.data.length>0)
gm.timeout(gm.selectRow,250,[0]);}};HTMLGrid.prototype.defineGridMaster=function(){if(this.gridMaster){var gm=$c(this.gridMaster);if(gm){gm.addDependentGrid(this.id,this.gridMasterFilter);}}};HTMLGrid.prototype.addDependentGrid=function(gridName,filter){if(!this.dependentGrids)
this.dependentGrids=[];this.dependentGrids.push({gridName:gridName,filter:filter});};HTMLGrid.prototype.selectionChanged=function(e){if(this.canPost()){if(this.disableSelectionRowOnEdit){this.timeout(this.selectRow,0.5,[this.editRow]);return false;}else{if(controller&&controller.activeElement&&controller.activeElement.blur){controller.activeElement.blur();}
this.timeout(this.post,0,[]);}}
var newSelection=this.getRowDBCursor();var newRow=this.getRowNo(true);if(this.currentSelection!=newSelection&&newSelection!=-1){if(this.onchange){var realLine=parseInt(this.getSelectedRow());if(realLine==-1){this.execEvent(this.onchange,0,-1,[],[],[]);}else{this.execEvent(this.onchange,newRow,realLine,this.keys[realLine],this.data[realLine],this.queryValues[realLine]);}}
if(this.dependentGrids){var gt=newRow;if(newSelection==-1)
gt=0;for(var i=0;i<this.dependentGrids.length;i++){var gridData=this.dependentGrids[i];var url='gridEdit.do?sys='+this.sys+'&param=refreshDependence&formID='+this.formID+'&comID='+this.code+'&gt='+gt+'&dependentGrid='+gridData.gridName+'&dependentGridFilter='+URLEncode(gridData.filter,"GET");$c(gridData.gridName).setActionFlag(true,false,false,false,false);getAndEvalSync2(url);$c(gridData.gridName).refreshURL=url;}}}
this.currentRow=this.getSelectedRow();this.currentSelection=this.getRowDBCursor();};HTMLGrid.prototype.canPost=function(keyPress){var row=this.currentRow;var rowSelected=this.getSelectedRow(keyPress);var t=false;if(this.dependentGrids)
t=this.editRow!=-1&&rowSelected!=this.editRow;else
t=(this.editRow!=-1&&row!=this.editRow)||(this.editRow!=-1&&row!=-1&&row!=rowSelected);return t;};function gridImage(u,w,h,componentProperties,gridCode,empty){var id="grid"+gridCode+"Image"+imageId;gridFunctions[id]=componentProperties.onclick;imageId++;var url=u;var hint=componentProperties.hint?componentProperties.hint:"";hint=stringToHTMLString(hint);if(url.indexOf("?")!=-1){url+="&";}else{url+="?";}
url+=("dateTime="+new Date().getTime());url+=("&formFilter="+$mainform().idForm);fields=null;try{fields=controller?controller.getAllElements():[];for(i=0;i<fields.length;i++){field=fields[i];if(!(verifyObjectType(field,'HTMLRadioGroupOption'))&&!(verifyObjectType(field,'HTMLGroupBox'))&&!(verifyObjectType(field,'HTMLPage'))){if(parseInt(field.getCode())!=-1&&field.getCode()!==undefined&&field.getCode()!=="undefined"){if(verifyObjectType(field,'HTMLRadioGroup')){url+="&F_"+i+"_"+field.getCode()+"="+URLEncode(field.hidden.value,postForceUTF8);}else if(field.doc!==undefined){if(field.doc.lastChild.id!=="HTMLRadioGroupOptions"){url+="&F_"+i+"_"+field.getCode()+"="+URLEncode(field.getValue(),postForceUTF8);}}else{url+="&F_"+i+"_"+field.getCode()+"="+URLEncode(field.getValue(),postForceUTF8);}}}}}catch(e){}
var path=empty?getAbsolutContextPath()+isomorphicDir:getAbsolutContextPath();return{src:path+url,width:20,height:18,extraStuff:"id="+id+" onClick=executeGridComponentEvent(id) alt="+hint+" title="+hint+" style=cursor:pointer"};};HTMLGrid.prototype.clickGrid=function(){if(!this.inserting&&!this.editing){controller.activeElement=this;}
if(this.onclick&&this.enabled){var relativeRow=this.isGrouped()?this.getRowDBCursor():this.getSelectedRow();var absoluteRow=(this.gridini+relativeRow);this.execEvent(this.onclick,absoluteRow,relativeRow,this.keys[relativeRow],this.data[relativeRow],this.queryValues[relativeRow]);}};HTMLGrid.prototype.executeRowDoubleClick=function(){if(!this.ondblclick&&!this.editing){controller.activeElement=this;}
if(this.ondblclick&&this.enabled){var relativeRow=this.isGrouped()?this.getRowDBCursor():this.getSelectedRow();var absoluteRow=(this.gridini+relativeRow);if(this.onclick)
this.execEvent(this.onclick,absoluteRow,relativeRow,this.keys[relativeRow],this.data[relativeRow],this.queryValues[relativeRow]);this.execEvent(this.ondblclick,absoluteRow,relativeRow,this.keys[relativeRow],this.data[relativeRow],this.queryValues[relativeRow]);}
this.checkDoubleClick();}
HTMLGrid.prototype.clickEditableRow=function(){this.clickGrid();};HTMLGrid.prototype.execEvent=function(func,absoluteRow,relativeRow,keys,data,queryValues){var params=[];if(this.eventParams.indexOf(1)!=-1){params.push(absoluteRow);}
if(this.eventParams.indexOf(2)!=-1){params.push(relativeRow);}
if(this.eventParams.indexOf(3)!=-1){params.push(keys);}
if(this.eventParams.indexOf(4)!=-1){params.push(this.getValueData(data));}
if(this.eventParams.indexOf(5)!=-1){params.push(queryValues);}
func.apply(this,params);};HTMLGrid.prototype.showNav=function(show){if(show&&!this.bar.visible){this.bar.style.display=null;this.bar.visible=true;}}
HTMLGrid.prototype.checkRequireds=function(){var arr=eval('document.editComponents'+this.code);for(var i=0;i<arr.length;i++){if(arr[i].required&&arr[i].visible&&arr[i].input&&arr[i].hasEmptyValue()){if(trim(arr[i]._description)!=''){interactionError(getLocaleMessage("ERROR.REQUIRED_FIELD",arr[i]._description),function(e){e.getFocus(true);},[arr[i]]);}else{interactionError(getLocaleMessage("ERROR.REQUIRED_BLANK_FIELD"),function(e){e.getFocus(true);},[arr[i]]);}
this.currentRow=this.editRow;return false;}
if(arr[i].cpf&&!CPF(arr[i].getValue())){interactionError(getLocaleMessage("ERROR.INVALID_CPF_FIELD",arr[i]._description),function(e){e.getFocus(true);},[arr[i]]);return false;}
if(arr[i].cnpj&&!CNPJ(arr[i].getValue())){interactionError(getLocaleMessage("ERROR.INVALID_CNPJ_FIELD",arr[i]._description),function(e){e.getFocus(true);},[arr[i]]);return false;}
if(arr[i].validateDataType&&!arr[i].validateDataType(true))
return false;if(arr[i].canCheckRegularExpression&&!isNullable(arr[i].regularExpression)&&arr[i].visible&&!testRegularExpression(arr[i].getValue(),arr[i].regularExpression)){interactionError(getLocaleMessage("ERROR.INVALID_FIELD_CONTENT",arr[i]._description),function(e){e.getFocus(true);},[arr[i]]);return false;}}
return true;};HTMLGrid.prototype.completeEditRow=function(include){this.editCells=[];var editComs=[];var ref=this.iscCanvas;var tbodies=ref.getBody().getTableElement().getElementsByTagName('tbody');var tbody;var cont=0
while(cont<tbodies.length){tbody=tbodies[cont];if(tbody.childElementCount===0){cont++;}else{if(tbody.querySelector('[role=listitem]'))
cont=tbodies.length;else
cont++;}}
var rowReference;if(include){rowReference=tbody.lastChild;}else{rowReference=tbody.querySelector('[aria-selected=true]');}
var arr=eval('document.editComponents'+this.code);arr=this.reorderComponents(arr);for(var i=0;i<arr.length;i++){if(!this.columnIsVisible(arr[i].code))
arr[i].setVisible(false);}
reorderCodeComponents(this,ref.getAllFields());createEditComponents(this,arr,rowReference,include,editComs);for(var j=this.components.length-1;j>=0;j--){orderTab.splice(arrayIndexOf(orderTab,this)+1,0,this.components[j]);}
controller.sortOrderTab();this.paging.setVisible(false);let _colIdx=(this.editing&&this.colDoubleClicked)?this.colDoubleClicked:undefined;this.timeout(this.focusInEdit,100,[editComs,_colIdx]);editComs=null;};function createEditComponents(grid,arr,rowReference,include,editComs){var ref=grid.iscCanvas;var colNum=ref.showRowNumbers===true?1:0;var count=ref.showRowNumbers?1:0;var fields=ref.fields;var allFields=ref.getAllFields();let arrElems=new Array();for(colNum;colNum<fields.length;colNum++){var elem=getComponent(arr,fields[colNum].cod);if(elem){var template=rowReference.children[colNum];editComs.push(grid.editCell(template,false,colNum,include));var element=template.firstElementChild;if(!element){grid.cancel();return;}
elem.design(template,true);element.style.display="none";arrElems.push(element);if(verifyObjectType(elem,'HTMLLookup')||elem.typeName==='datetime'||elem.typeName==='date'||verifyObjectType(elem,'HTMLImage')){elem.div.style.position="relative";}else elem.div.style.position="inherit";if(verifyObjectType(elem,'HTMLCheckbox')){elem.divClass="d-flex align-items-center justify-content-center";elem.div.className=elem.divClass;}else elem.div.style.display="grid";}}
for(count;count<allFields.length;count++){if(!(allFields[count].name=="groupTitle")&&!allFields[count].visible||(allFields[count].showIf&&!parseBoolean(allFields[count].showIf))){elem=getComponent(arr,allFields[count].cod);elem.toGrid=true;elem.design(document.body);}}
grid.elements_Of_Grid=arrElems;}
HTMLGrid.prototype.reorderComponents=function(arr){var newOrderElemenst=[];var codes=this.components;for(i=0;i<arr.length;i++){var code=codes[i];for(j=0;j<arr.length;j++){if(code==arr[j].getCode()){newOrderElemenst.add(arr[j]);break;}}}
return newOrderElemenst;};HTMLGrid.prototype.editCell=function(template,notedit,idx,include){var row=-1;if(include)
row=this.iscCanvas.getEditRow();else
row=this.getSelectedRow();if(row==-1){throw getLocaleMessage("INFO.GRID_RECORD_SELECT");}
var x,y,w,h;w=template.offsetWidth;h=template.offsetHeight;var editor=eval('document.c_'+this.iscCanvas.fields[idx].cod);editor._row=row;editor.height=h;editor.width=w;editor.posX=x;editor.posY=y;editor.tabindex=parseFloat(this.tabindex+'.'+decimalFormat(idx,5));editor._description=editor.description;editor.description='';editor.template=template;editor.grid=this.grid;editor.parent=this;editor.toGrid=true;editor.onfocusGrid=editor.onfocus;if(!editor.field&&!editor.isBinary){let fields=this.iscCanvas.fields;var value=this.data[row][fields[idx].name];value=(value!="&nbsp;"?value:"");editor.setGridValue(value);}
if(!notedit&&this.nav.getMode()==0)
this.nav.edit();this.editRow=row;return editor;};HTMLGrid.prototype.focusElement=function(o,elems){var e=o;if(o!=null){var i=arrayIndexOf(elems,o);while(!e.getFocus(true)){document.fromDblClick=false;i++;if(i>elems.length-1)
i=0;e=elems[i];if(o==e){e.getFocus(true);break;}}}};HTMLGrid.prototype.keydownAction=function(e){var keyCode=e.keyCode||e.which;if((this.editRow!=-1)&&this.disableSelectionRowOnEdit){if((keyCode==35)||(keyCode==36)||(keyCode==38)||(keyCode==40)||(keyCode==33)||(keyCode==34)){return false;}}else if(this.editing||this.inserting){if(keyCode===35||keyCode===36)
return true;}else if((!this.editing||!this.inserting)&&this.enableSimpleFilter&&keyCode===13){e.preventDefault();e.stopPropagation();const canvas=this.iscCanvas;canvas.filterData(canvas.getFilterEditorCriteria());return false;}else if((!this.editing||!this.inserting)&&this.enableSimpleFilter&&keyCode===9){return false;}
this.gridKeyPress(e);};HTMLGrid.prototype.getLengthData=function(){var sub=!this.showGroupSummary?1:this.showGroupSummaryInHeader&&this.showCollapsedGroupSummary?1:2;if(this.isGrouped()){return(this.iscCanvas.groupTree.getAllItems().length-sub)-(this.showGroupSummaryInHeader&&this.showCollapsedGroupSummary?0:(eval(this.iscCanvas.getGroupState()).length-1));}else if(this.isFiltered){return this.iscCanvas.getOriginalData().length-1;}else{return this.data.length-1;}};HTMLGrid.prototype.gridKeyPress=function(evt){var altKey=false;var ctrlKey=false;var shiftKey=false;var target=evt.target||evt.srcElement;var keyCode=evt.keyCode||evt.which;var targtype=target.type;var chr=String.fromCharCode(keyCode).toUpperCase();if(w3c){if(document.layers){altKey=((evt.modifiers&Event.ALT_MASK)>0);ctrlKey=((evt.modifiers&Event.CONTROL_MASK)>0);shiftKey=((evt.modifiers&Event.SHIFT_MASK)>0);}else{altKey=evt.altKey;ctrlKey=evt.ctrlKey;shiftKey=evt.shiftKey;}}else{altKey=evt.altKey;ctrlKey=evt.ctrlKey;shiftKey=evt.shiftKey;}
if(this.canPost(true)&&this.disableSelectionRowOnEdit){if((keyCode==35)||(keyCode==36)||(keyCode==38)||(keyCode==40)){return false;}}
var r=true;if(!this.editing&&!this.inserting&&((keyCode==33)||(keyCode==34))){var increment=keyCode==33?-10:10;var row=this.getSelectedRow(true)==-1?this.currentRow:this.getSelectedRow(true);var newSelectRow=row+increment;if(keyCode==33){this.currentRow=newSelectRow<0?0:newSelectRow;}else{this.currentRow=newSelectRow>this.data.length-1?this.data.length-1:newSelectRow;}
this.clearSelectedRows(row);this.selectRow(this.currentRow);this.moveScrollToRow(this.currentRow);this.selectionChanged();r=false;}
if(!this.editing&&!this.inserting&&(keyCode==35||keyCode==36)){var row=this.getSelectedRow(true);this.clearSelectedRows(row);this.currentRow=keyCode==35?this.getLengthData():0;this.selectRow(this.currentRow);this.moveScrollToRow(this.currentRow);this.selectionChanged();}
if(((!altKey&&!ctrlKey&&keyCode==27))){this.cancel();r=false;}
else if(!altKey&&ctrlKey&&(keyCode==45||chr=='I')){if((!this.editable||this.lockEditable)&&this.callForm){this.timeout(this.openNormalForm,0,[true]);}else if(Object.keys(gridFieldsConfig[this.id]["frozenFields"]).length>0){return false;}else{if(this.editing||this.inserting){if(controller&&controller.activeElement){controller.activeElement.blur();}
this.timeout(this.post,0,[true]);}else if(!this.lockEditable){this.include();}}
r=false;}
else if(ctrlKey&&keyCode==116){window.location.reload(true);}
else if(!altKey&&ctrlKey&&chr=='E'){if((!this.editable||this.lockEditable)&&this.callForm){this.timeout(this.openNormalForm,0,[this]);}else if(Object.keys(gridFieldsConfig[this.id]["frozenFields"]).length>0){return false;}
else{if(this.editing||this.inserting){if(controller&&controller.activeElement){controller.activeElement.focus();}}else if(!this.lockEditable){this.edit();}}
r=false;}
else if(!altKey&&ctrlKey&&chr=='S'){if(this.editing||this.inserting){if(controller&&controller.activeElement){controller.activeElement.blur();}
this.timeout(this.post,0);r=false;}}
else if(!altKey&&ctrlKey&&(chr=='+'||chr=='='||keyCode==187||chr=='G')){if(this.editing||this.inserting){if(controller&&controller.activeElement){controller.activeElement.blur();}
this.timeout(this.post,0);r=false;}}
else if(!altKey&&ctrlKey&&(keyCode==46||chr=='D')){if(Object.keys(gridFieldsConfig[this.id]["frozenFields"]).length>0){return false;}
if(!this.lockEditable){if((!this.editing||(this.editing==undefined))&&(!this.inserting||(this.inserting==undefined))){this.deleteRow();}}
r=false;}
else if(keyCode==40&&(this.getSelectedRow(true)==this.getLengthData())){if(Object.keys(gridFieldsConfig[this.id]["frozenFields"]).length>0)
return false;if(this.editing||this.inserting){if(controller&&controller.activeElement){controller.activeElement.blur();}
this.timeout(this.post,0,[true]);}else{this.include();}
r=false;}
else if(keyCode==40&&this.editing){if(Object.keys(gridFieldsConfig[this.id]["frozenFields"]).length>0)
return false;if(controller&&controller.activeElement){controller.activeElement.blur();}
let line=this.currentRow+=1;this.timeout(this.post,0[false]);r=false;}
else if(!altKey&&!ctrlKey&&keyCode==39&&(!this.editing&&!this.inserting)){if(this.paging&&this.paging.btNext.visible&&!this.paging.btNext.disabled)
this.paging.btNext.action.click();this.timeout(this.gridFocus,100);r=false;}
else if(!altKey&&!ctrlKey&&keyCode==37&&(!this.editing&&!this.inserting)){if(this.paging&&this.paging.btPrevious.visible&&!this.paging.btPrevious.disabled)
this.paging.btPrevious.action.click();this.timeout(this.gridFocus,100);r=false;}
else if(!altKey&&ctrlKey&&keyCode==39){if(this.paging&&this.paging.btLast.visible&&!this.paging.btLast.disabled)
this.paging.btLast.action.click();r=false;}
else if(!altKey&&ctrlKey&&keyCode==37){if(this.paging&&this.paging.btFirst.visible&&!this.paging.btFirst.disabled)
this.paging.btFirst.action.click();r=false;}
else if(!altKey&&!ctrlKey&&keyCode==112){if(target&&!isNullable(target.hint)){var func=function(){try{target.focus();}catch(ex){}};interactionInfo(target.hint,func);}else if(!isNullable(this.hint)){interactionInfo(this.hint,this.gridFocus,[evt],this);}
r=false;}
if(r)
r=checkKey(evt,this,this.tabKeys);if(!r){document.disableEvents=true;if(evt.preventDefault){evt.preventDefault();evt.stopPropagation();}else{evt.keyCode=0;evt.returnValue=false;}
return false;}else
return true;};HTMLGrid.prototype.checkCmd=function(field,row,column){var gridrn=this.getSelectedRow();if(gridrn>this.data.length-1)
gridrn=-2;var gt=this.getRowNo();if(gt<=0){this.focusColumn=0;gt=(this.gridini+1);}
getAndEvalSync("gridEdit.do?sys="+this.sys+"&formID="+this.formID+"&comID="+this.code+"&param=checkCmd&fieldID="+field+"&row="+row+"&column="+column+"&gt="+gt);};HTMLGrid.prototype.postCheckOption=function(com,state,valueCheck,valueUnCheck,row,img){if(this.editing||this.inserting||!this.enabled||this.readonly)
return;var checked=state==1;var removeRuleErrors=true;var gt=this.getRowNo(true);var url='gridEdit.do?sys='+this.sys+'&action=gridEdit&param=post&formID='+this.formID+'&comID='+this.code+'&gt='+gt+'&gridComID=-1&storedProcedureName=&storedProcedureParams=&align=0&postSameIfNotPresent=true&checkBoxPost=true';url+='&checkCode='+com+'&WFRInput'+com+'='+URLEncode(checked?valueUnCheck:valueCheck,"GET");url+='&line='+this.getRowIgnoreState();var gridrn=gt-parseInt(this.gridini)-1;this.completePostCheckOption=this.getAction(this.completePostCheckOptionAction,[com,state,valueCheck,valueUnCheck,row,img,gridrn]);this.navWasVisible=this.paging.getVisible();getAndEvalSync(url);};HTMLGrid.prototype.completePostCheckOptionAction=function(com,state,valueCheck,valueUnCheck,row,img,gridrn){if(parseInt(state)==0||parseInt(state)==2){state=1;}else if(parseInt(state)==1){state=0;}
var idx=arrayIndexOf(this.components,com);this.data[gridrn]["field"+com]=this.gridCheckBox(state,valueCheck,valueUnCheck,com,row);};HTMLGrid.prototype.executeCheckCmd=function(ref,row,col){var fieldTitle=ref.iscCanvas.fields[col].title;var col=this.findColumn(fieldTitle);col=ref.iscCanvas.showRowNumbers?col-1:col;var column=ref.components[col]
var key=column+"_"+(this.getRowDBCursor()+this.gridini+1);var cmd=gridChecks[key];if(cmd)
eval(cmd);return false;};HTMLGrid.prototype.onRowClick=function(){this.clickEditableRow();this.selectionChanged();};HTMLGrid.prototype.saveSize=function(colIndex,name){var columns=this.iscCanvas.getAllFields();var newSize=this.iscCanvas.getFieldWidth(colIndex);colIndex=columns.findIndex(function(c){return c.name===name});colIndex=this.iscCanvas.showRowNumbers?(colIndex-1):colIndex;if(!this.disableUserCustomize&&loggedUserWithProfile){getAndEvalSync('gridEdit.do?sys='+this.sys+'&action=gridEdit&param=setsize&formID='+this.formID+'&comID='+this.code+'&gt=-1&fieldID='+this.components[colIndex]+'&size='+pt(newSize));}};HTMLGrid.prototype.flush=function(){recursiveFlush(this);};HTMLGrid.prototype.checkDoubleClick=function(){if(!this.editing&&!this.inserting){controller.activeElement=this;if(!this.ondblclick||!this.doubleClickOnly){if(this.editable&&(!this.lockEditable)){if(this.data.length!==0)
this.edit();}else if(this.callForm){this.openNormalForm();}}}};HTMLGrid.prototype.order=function(field,desc){var idx=field;var type=desc;this.setActionFlag(false,false,false,true,false);if(isNumeric(field)){field=this.iscCanvas.fields[idx].cod;this.ordered={index:idx,desc:desc};}
getAndEvalSync2('gridEdit.do?sys='+this.sys+'&param=order&formID='+this.formID+'&comID='+this.code+'&field='+field+'&type='+type);};HTMLGrid.prototype.isFieldVisible=function(fieldName){var gridConfig=gridFieldsConfig[this.id];for(var i=0;i<gridConfig["hiddenFields"].length;i++)
if(gridConfig["hiddenFields"][i]===fieldName)
return false;return true;};function postCheckOption(grid,com,state,valueCheck,valueUnCheck,row,img){var obj=controller.getElementByCode(grid);obj.timeout(obj.postCheckOption,0,[com,state,valueCheck,valueUnCheck,row,img]);};HTMLGrid.prototype.focusInEdit=function(editComs,idxCol){if(idxCol){if(editComs[idxCol].getFocus())
return;else
this.focusInEdit(editComs,(idxCol+1<editComs?idxCol+1:editComs.length-1));}else{const size=editComs.length;for(var i=0;i<size;i++){if(editComs[i].getFocus()){break;}}}};HTMLGrid.prototype.vScrollSetDisabled=function(disable){if(this.iscVScroll===undefined){this.iscVScroll=this.iscCanvas.body.vscrollbar;if(this.iscVScroll)this.iscVScroll.autoEnable=false;}
if(this.iscVScroll){this.iscVScroll.setDisabled(disable);this.iscVScroll.autoEnable=false;this.div.onwheel=function(){return!disable;}}};HTMLGrid.prototype.hScrollSetDisabled=function(disable){if(this.iscHScroll===undefined){this.iscHScroll=this.iscCanvas.body.hscrollbar;if(this.iscHScroll)this.iscHScroll.autoEnable=false;}
if(this.iscHScroll){this.iscHScroll.setDisabled(disable);this.iscHScroll.autoEnable=false;}};HTMLGrid.prototype.hasFrozenFieldVisible=function(){var gridConfig=gridFieldsConfig[this.id];var keys=Object.keys(gridConfig["frozenFields"]);if(gridConfig){if(keys.length<=0)return false;for(var i=0;i<keys.length;i++)
if(this.isFieldVisible(keys[i]))
return true;}
return false;}
HTMLGrid.prototype.scrollLeft=function(value){this.iscCanvas.body.scrollBy(value,0);};HTMLGrid.prototype.scrollTop=function(value){if(!this.editing&&!this.inserting)
this.iscCanvas.body.scrollBy(0,value);};HTMLGrid.prototype.getHorizontalScrollPosition=function(){return this.iscCanvas.body.getScrollLeft();};HTMLGrid.prototype.getVerticalScrollPosition=function(){return this.iscCanvas.body.getScrollTop();};HTMLGrid.prototype.readingHiddenFields=function(){var i=0;var sc=this.columns.length;var hideFields=[];while(sc>i){if(this.columns[i].showIf=="false")
hideFields.push(this.columns[i].name);i++;}
return hideFields;};HTMLGrid.prototype.focus=function(){var r=this.enabled&&this.visible&&!this.readonly;if(this.doc)
r=r&&isVisibleDiv(this.doc);if(r){this.hasFocus=true;this.gridFocus();}
return r;};HTMLGrid.prototype.focusChanged=function(hasFocus){this.hasFocus=hasFocus;this.performFocus();}
HTMLGrid.prototype.performFocus=function(){this.iscCanvas.setBorder(this.hasFocus||this.editing||this.inserting?"1px solid "+this.getPrimaryColor():"1px solid #ededed");if(this.hasFrozenFieldVisible()&&this.iscCanvas.frozenBody){this.iscCanvas.frozenBody.getStyleHandle().borderRight="1px solid #ededed";}}
HTMLGrid.prototype.freezeColumn=function(fieldName){var idx=this.findVisibleColumn(fieldName);var ref=this.iscCanvas;fieldName=this.getRealNameColumn(fieldName);var gridConfig=gridFieldsConfig[this.id];gridConfig["frozenFields"][fieldName]=idx;ref.freezeField(fieldName);this.nav.setEnabled(false);this.focus();ref.getBody().scrolled=function(){var ref=$c(this.creator.ID);if(!ref.hasFocus&&!ref.inserting&&!ref.editing)
this.creator.focus();};var frozenFields=Object.keys(gridConfig["frozenFields"]).length-1;var delta=ref.showRowNumbers?frozenFields-idx+1:frozenFields-idx;this.adjustFilterEditorButton();if(projectMode.toLowerCase()==='n')
this.upGrid(idx,delta);};HTMLGrid.prototype.unfreezeColumn=function(title){this.performFocus();fieldName=this.getRealNameColumn(title);var ref=this.iscCanvas;var gridConfig=gridFieldsConfig[this.id];var fields=ref.fields;ref.unfreezeField(fieldName);this.adjustFilterEditorButton();ref.reorderField(this.findColumn(title),gridConfig["frozenFields"][fieldName]);delete gridConfig["frozenFields"][fieldName];gridConfig["fieldsSizes"]={};for(var i=0;i<fields.length;i++){var field=fields[i];if(field.name)
gridConfig["fieldsSizes"][field.name]=field.width;}
gridConfig["fieldOrder"]=this.getFieldsOrder();this.timeout(this.selectRow,0,[this.currentRow]);this.focus();if(Object.keys(gridConfig["frozenFields"]).length===0)
this.nav.setEnabled(true);};HTMLGrid.prototype.checkPost=function(){if(this.editing||this.inserting){interactionError(getLocaleMessage("INFO.GRID_EDIT_FINALIZE"),function(){arguments[0].getFocus(true);},[this]);return false;}
return true;};HTMLGrid.prototype.upGrid=function(old,delta){if(!this.disableUserCustomize&&loggedUserWithProfile){if(delta&&delta!==0&&this.ActUpGrid&&!this.noRefresh){var ref=this.iscCanvas;var formID=this.formGUID+"_"+this.id;var columns=this.columnsUpGrid(ref.getAllFields());gridSendCommand('upGrid.do?sys='+sysCode+'&action=upGrid&formID='+encodeURI(formID)+'&comID='+this.code+'&columns='+URLEncode(columns,'UTF8'));reorderCodeComponents(this,ref.getAllFields());}}};HTMLGrid.prototype.columnsUpGrid=function(fields){var newJsonColumns=[];var i=this.iscCanvas.showRowNumbers?1:0;var size=fields.length;for(i;i<size;i++){if(!fields[i].comp)continue;var pJson={};pJson['field']=fields[i].comp;pJson['show']=fields[i].showIf==='true'?'1':'0';pJson['size']=""+fields[i].width;newJsonColumns.push(pJson);}
return JSON.stringify(newJsonColumns);};HTMLGrid.prototype.setGrid=function(num,value,comp){if(!this.disableUserCustomize&&loggedUserWithProfile){var formID=this.formGUID+'_'+this.id;gridSendCommand('setGrid.do?sys='+sysCode+'&action=setGrid&formID='+encodeURI(formID)+'&num='+num+'&formCode='+this.formCode+'&comp='+comp+'&value='+value);}};HTMLGrid.prototype.defaultGrid=function(){var formID=this.formGUID+"_"+this.id;var id=this.id+"Loading";var parent=this.div;gridLoading(id,parent);gridSendCommand('revertDefaultGrid.do?sys='+sysCode+'&action=revertDefaultGrid&param=cancel&formID='+encodeURI(formID)+'&formCode='+URLEncode(this.formID,'GET')+'&comID='+this.getCode(),id,parent);gridUpdateFieldsConfig(this.id);}
HTMLGrid.prototype.getFieldsOrder=function(){var order=[];var ref=this.iscCanvas;var i=ref.showRowNumbers?1:0;var fields=ref.getAllFields();for(var i;i<fields.length;i++){order.push(fields[i].name);}
return order;};HTMLGrid.prototype.showGridSummaryRow=function(show){var ref=this.iscCanvas;if(show){this.showGridSummary=true;ref.showGridSummary=true;ref.showSummaryRow();}else{this.showGridSummary=false;ref.showGridSummary=false;ref.clearSummaryRow();}};HTMLGrid.prototype.enableOrDisableGroup=function(enable){var ref=this.iscCanvas;if(enable===true){ref.canGroupBy=true;this.groupBy=true;}else{ref.canGroupBy=false;this.groupBy=false;}};HTMLGrid.prototype.getNameGroups=function(){var ref=this.iscCanvas;if(this.isGrouped()){var arrNames=[];ref.data.getFolders().map(function(item){arrNames.add(item.groupValue);});}
return arrNames?arrNames:null;};HTMLGrid.prototype.getValueInSummary=function(value){var ref=this.iscCanvas;if(ref.showGridSummary){var value=ref.getGridSummaryData()[0][this.getRealNameColumn(value)];return value?value:"";}
return null;};HTMLGrid.prototype.getValueInSummaryGroup=function(group,column){var ref=this.iscCanvas;if(typeof group==="string"){group=this.getSpecificGroup(group);}
var field=ref.fields.find("name",this.getRealNameColumn(column));if(group&&(field.showGroupSummary||field.showGroupSummary===undefined)){var value=ref.getGroupSummaryData(this.getRecordsInGroup(group))[0][this.getRealNameColumn(column)];return value?value:"";}
return null;};HTMLGrid.prototype.getSpecificGroup=function(nameGroup){var ref=this.iscCanvas;if(this.isGrouped()){return ref.data.getFolders().find("groupValue",nameGroup);}};HTMLGrid.prototype.getRecordsInGroup=function(group){var ref=this.iscCanvas;if(typeof group==="string"){group=this.getSpecificGroup(group);}
if(group&&this.isGrouped()){return ref.data.getRecordsInGroup(group);}};HTMLGrid.prototype.openGroup=function(group){var ref=this.iscCanvas;if(group&&this.isGrouped()){var it;it=typeof group==="string"?ref.data.getFolders().find("groupValue",group):group;if(it&&!ref.data.isOpen(it)){ref.openFolder(it);}}};HTMLGrid.prototype.openAllGroups=function(){var ref=this.iscCanvas;if(this.isGrouped()){ref.groupTree.openAll();}};HTMLGrid.prototype.closeGroup=function(group){var ref=this.iscCanvas;if(group&&this.isGrouped()){var it;it=typeof group==="string"?ref.data.getFolders().find("groupValue",group):group;if(it&&ref.data.isOpen(it)){ref.closeFolder(it);}}};HTMLGrid.prototype.pathGetDescendent=function(path,reverse){var ref=this.iscCanvas;var oldElem;var groups=[];var root=ref.data.getFolders().find("groupValue",path[0]);for(let index=0;index<path.length;index++){const group=path[index];if(index==0){it=root;}else{if(oldElem)
it=oldElem.groupMembers.find("groupValue",group);}
if(it){groups.add(it);}
oldElem=it;}
return reverse?groups.slice(0).reverse():groups;}
HTMLGrid.prototype.closeAllGroups=function(){var ref=this.iscCanvas;if(this.isGrouped()){ref.groupTree.closeAll();}};HTMLGrid.prototype.group=function(colName){var ref=this.iscCanvas;if(ref.groupBy&&ref.canGroupBy){var realName=this.getRealNameColumn(colName)==-1?"":this.getRealNameColumn(colName);var groups=ref.getGroupByFields()?ref.getGroupByFields():[];if(realName!=-1&&!groups.contains(realName)){if(!groups||!ref.canMultiGroup)
groups=[];groups.push(realName);ref.groupBy(groups);ref.deselectAllRecords();this.currentRow=-1;}}};HTMLGrid.prototype.ungroup=function(colName){var ref=this.iscCanvas;if(ref.groupBy&&ref.canGroupBy){var realName=this.getRealNameColumn(colName);var groups=ref.getGroupByFields();if(groups&&colName){if(groups.indexOf(realName)!=-1)
groups.splice(groups.indexOf(realName),1);}else{this.groups=[];groups=[];}
ref.groupBy(groups);}};HTMLGrid.prototype.isGrouped=function(){return this.iscCanvas.isGrouped>0?true:false;};HTMLGrid.prototype.getRecordRealIndex=function(record){let rows;if((this.startedEdition||this.dependentGrids)&&!this.isGrouped())
rows=this.iscCanvas.getOriginalData().getAllRows();else
rows=this.iscCanvas.groupTree.getAllItems();return rows.findIndex(function(elem){return elem.row===record.row});};HTMLGrid.prototype.getAllGroups=function(){return this.iscCanvas.groupTree.getChildren();}
HTMLGrid.prototype.openGroupConfig=function(){var ref=this.iscCanvas;if(ref.groupBy&&ref.canGroupBy&&ref.canMultiGroup){this.iscCanvas.configureGrouping();}}
HTMLGrid.prototype.afterInit=function(){this.callMethod(HTMLElementBase,"afterInit",[]);if(d.n&&d.n.responsive){this.gridResizeResponsive();}};HTMLGrid.prototype.gridResizeResponsive=function(){var grid=this;var docWidth=0,data=null;var frame=null;if(this.tab&&this.tab.selected){if(this.doc.offsetWidth===0){let floatingForms=getFrameInFloatingForms(this.formGUID);data=getWidthInFrame(this,floatingForms);if(data&&data.find){docWidth=this.container.length>0?this.doc.clientWidth===0?((parseFloat(this.doc.style.width)/100)*data.width):this.doc.clientWidth:data.width;frame=data.frame;}else if(this.container){docWidth=this.doc.clientWidth;}}else{docWidth=this.doc.offsetWidth;}
this.iscCanvas.setWidth(parseInt(docWidth)*(parseFloat(this.div.style.width)/100));if(data&&data.find){if(data.none)frame.style.display="none";frame.style.removeProperty("visibility");if(data.window&&data.window.mainform)data.window.mainform.addEventListener("resize",function(){gridResize(grid);},false);}}
if(!this.resizeEventSet){mainform.addEventListener("resize",function(){if(grid)gridResize(grid);},false);this.resizeEventSet=true;}
if(this.tab){this.tab.addShownListener(function(){this.timeout(function(){gridResize(grid)},0);});}
if(frame&&frame.tab){frame.tab.addShownListener(function(){gridResize(grid);});}
var tabLiElem=getFormParentTabComponentTab();if(tabLiElem){var tabAElem=tabLiElem.getElementsByTagName("a");if(tabAElem&&tabAElem.length>0){tabAElem[0].addEventListener("click",function(){gridResize(grid);});}}
window.addEventListener("load",function(){gridResize(grid);});};HTMLGrid.prototype.resizeColumns=function(resizeGrid){if(!this.userCustomColumnWidth&&!isMobile()){if(this.tab&&!this.tab.selected)return;let gridColumns=this.iscCanvas.getAllFields();for(var i=this.iscCanvas.showRowNumbers?1:0;i<gridColumns.length;i++){gridColumns[i].width=Math.round(gridColumns[i].width*resizeGrid);}
this.iscCanvas.setFields(gridColumns);}};HTMLGrid.prototype.adjustFilterEditorButton=function(){if(this.iscCanvas.filterEditor){this.iscCanvas.filterEditor.actionButton.setStyleName("buttonFilterEditor");}}
HTMLGrid.prototype.updatePage=function(){this.checkFooterRegisters();if(this.hasPagination&&this.enableNumberOfRecords&&this.totalLabels)this.iscCanvas.dataChanged();var elem=document.getElementById(this.id+"_page");if(elem)elem.innerHTML=this.gridPage;};HTMLGrid.prototype.checkFooterRegisters=function(){if(this.hasPagination&&this.enableNumberOfRecords&&!this.totalLabels){this.createFooterRegisters();this.iscCanvas.updateGridComponents();}else if(this.enableNumberOfRecords&&this.totalLabels&&!this.hasPagination){this.components_to_Grid.pop();this.totalLabels=undefined;this.registers=undefined;this.iscCanvas.updateGridComponents();}}
HTMLGrid.prototype.setTotalRows=function(total){this.totalRows=total;this.updatePage();};HTMLGrid.prototype.checkGridEnd=function(total){if(this.isLastPage&&total!==this.gridend)this.gridend=total;};function decimalFormat(value,qtt){if(qtt<=0){return value;}
if(isNullable(value)){value="";while(qtt-->0){value+="0";}
return value;}
value=new String(value);if(value.length==qtt){return value;}
if(value.length>qtt){return value.substring(0,qtt);}
qtt-=value.length;while(qtt-->0){value="0"+value;}
return value;};HTMLGrid.prototype.clearDataSelected=function(rowNum){this.selectRow(0);this.clearSelectedRows(rowNum);this.currentRow=0;};function gridExportData(comp,type){$c(comp).exportData(type);return false;};function gridLoading(id,parent,child){if(!parent)parent=mainform.document.body;var spinner=bootstrapCreateSpinner(parent,null,true);spinner[0].id=child?id:"overlay";};function gridRemoveLoading(id,parent,child){if(!parent)parent=mainform.document.body;var spinner=mainform.document.getElementById(id);if(!spinner)spinner=mainform.document.getElementById("overlay");parent.removeChild(spinner);};function gridDownloadFileData(response,type){type=type==="LST"?"html":type;var blob=new Blob([response],{type:'application/octet-binary'});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(blob,"result."+type.toLowerCase());return false;}
var a=mainform.document.createElement('a');var url=window.URL.createObjectURL(blob);a.href=url;a.download="result."+type.toLowerCase();mainform.document.body.appendChild(a);a.click();window.URL.revokeObjectURL(url);mainform.document.body.removeChild(a);};function reorderCodeComponents(comp,fields){var count=comp.iscCanvas.showRowNumbers?1:0;var codes=[];while(count<fields.length){if(fields[count].cod!==undefined)
codes.add(fields[count].cod);count++;}
comp.components=codes;};function getComponent(arr,code){var sizeArr=arr.length;for(var i=0;i<sizeArr;i++){if(arr[i].getCode()===code)
return arr[i];}
return null;};function gridShowMessage(type,title,msg,time){var message=new mainform.HTMLMessage();if(type.toUpperCase()==='W')
message.showWarningMessage(title,msg,time);else
message.showErrorMessage(title,msg,time);return false;};function gridSendCommand(url,id,parent,notException,callback,grid,updateColumns,child){var xhr=new XMLHttpRequest();xhr.open("GET",url,true);xhr.onload=function(e){if(xhr.readyState===4){if(xhr.status===200){if(id)
if(child)
gridRemoveLoading(id,parent,"_overlay_"+child);else
gridRemoveLoading(id,parent);if(this.response!==''){if(callback&&typeof callback==="function")
return callback.call(this,this.responseText,grid,updateColumns);eval(this.response);}}}};xhr.onerror=function(e){if(id)
if(child)
gridRemoveLoading(id,parent,"_overlay_"+child);else
gridRemoveLoading(id,parent);if(!notException){var msg=new HTMLMessage();msg.showErrorMessage("",getLocaleMessage("ERROR.GRID_EXPORT_DATA_FAILED"),null,this.statusText,null);}}
xhr.send(null);};function gridUpdateFieldsConfig(id){if(id){var gridConfig=gridFieldsConfig[id];gridConfig['hiddenFields']=[];gridConfig['fieldOrder']=[];gridConfig['removedFields']=[];gridConfig['fieldsSizes']={};gridConfig['frozenFields']={};}};function objectIsEmpty(obj){for(var key in obj){if(obj.hasOwnProperty(key))
return false;}
return true;}
function clearRecords(records){var arr=[];records.map(function(json){var parcialJson={};for(var key in json){if(key.indexOf("field")!=-1){parcialJson[key]=json[key];}}
if(!objectIsEmpty(parcialJson)){arr.add(Object.assign(parcialJson,{}));}});return arr;}
function gridResize(grid){if(grid&&getWindowDimensions().width!==0){let newWidth=0;if(!grid.visible)newWidth=getWindowDimensions().width*(parseFloat(grid.div.style.width)/100);else newWidth=grid.div.offsetWidth>0?grid.div.offsetWidth:grid.width;if(newWidth===grid.currentWidth)return false;if(grid.inserting){grid.completeCancelInclude();}else if(grid.editing){grid.cancelEdit();}
if(grid.currentWidth&&grid.currentWidth>0)grid.resizeColumns(newWidth/grid.currentWidth);grid.currentWidth=newWidth;grid.iscCanvas.setWidth(newWidth);try{var gridPagingSeparator=document.getElementById(grid.id+"_separator_paging");var gridFilterButton=document.getElementById(grid.id+"_icon_filter");if(newWidth<410){if(gridPagingSeparator)gridPagingSeparator.style.setProperty("display","none","important");if(gridFilterButton)gridFilterButton.style.setProperty("display","none","important");}else{if(gridPagingSeparator)gridPagingSeparator.style.display=null;if(gridFilterButton)gridFilterButton.style.display=null;}}catch(e){}
try{if(grid.paging&&grid.paging.buttons&&grid.paging.buttons.length>0){for(var i=0;i<grid.paging.buttons.length;i++){var buttonElement=grid.paging.buttons[i].getElementsByTagName("a")[0];var iconElement=buttonElement.getElementsByTagName("i")[0];if(newWidth<360){buttonElement.style.paddingLeft=grid.paging.smallPadding;buttonElement.style.paddingRight=grid.paging.smallPadding;iconElement.style.fontSize="0.85rem";}else{buttonElement.style.paddingLeft=grid.paging.defaultPadding;buttonElement.style.paddingRight=grid.paging.defaultPadding;iconElement.style.fontSize="1rem";}}}}catch(e){}
try{if(grid.nav&&grid.nav.buttons&&grid.nav.buttons.length>0){for(var i=0;i<grid.nav.buttons.length;i++){var iconElement=grid.nav.buttons[i].button.getElementsByTagName("i")[0];if(newWidth<360){iconElement.style.fontSize="0.85rem";}else{iconElement.style.fontSize="1rem";}}}}catch(e){}}
return false;};function getGridVerifyColumns(grid,colsPaint){let size=colsPaint.length;let isGrouped=grid.isGrouped();let isShowGroupSummary=grid.showGroupSummary;let isShowGroupSummaryInHeader=grid.showGroupSummaryInHeader;grid=grid.iscCanvas;let showColumns=grid.fields;let allColumns=grid.getAllFields();let nCols=[];for(let i=0;i<size;i++){let field=allColumns[isGrouped&&isShowGroupSummary&&isShowGroupSummaryInHeader?colsPaint[i]+1:colsPaint[i]];let findIndex=showColumns.findIndex(function(e){return e.name===field.name});if(findIndex)nCols[i]=findIndex;}
return nCols.length===colsPaint.length?nCols:colsPaint;}
function gridAdvancedFilter(grid){grid=$c(grid);if(grid){if(!grid.filterModal){grid.filterModal=bootstrapCreateModal(getLocaleMessage("INFO.GRID_ADVANCED_FILTER")+(grid.description?" - "+grid.description:""),true,null,null,null,null,false,false);grid.filterModal[2].className+=" overflow-auto";grid.filterModal[4].className+=" modal-xl";if(IE){grid.filterModal[2].style.maxHeight="65vh";}else{var modalContent=grid.filterModal[0].getElementsByClassName("modal-content")[0];modalContent.style.maxHeight="90vh";}
grid.advancedFilter=isc.FilterBuilder.create({ID:grid.id+"advancedFilter",referenceGrid:grid.id,dataSource:grid.id+"dataSource",criteria:grid.gridSavedConfigFilter?grid.gridSavedConfigFilter:{_constructor:"AdvancedCriteria",operator:"and",criteria:[],},getFieldOperators:function(){const comp=$c(this.referenceGrid);const field=arguments[1];if(field.realType){comp.filterMode==1?this.getDataSource().setTypeOperators("text",_date_and_numberOperators):this.getDataSource().setTypeOperators("text",_date_client);_setOperator=true;}
if(!field.realType&&_setOperator)this.getDataSource().setTypeOperators("text",_textOperators);return this.Super("getFieldOperators",arguments);}});var resetButton=document.createElement("button");resetButton.type="button";resetButton.className="btn btn-secondary";resetButton.innerHTML=getLocaleMessage("INFO.GRID_ADVANCED_FILTER_CLEAR");grid.buttonReset=resetButton;grid.filterModal[3].appendChild(resetButton);resetButton.onclick=function(){grid.advancedFilter.clearCriteria();};var applyFilterButton=document.createElement("button");applyFilterButton.type="button";applyFilterButton.className="btn btn-primary";applyFilterButton.innerHTML=getLocaleMessage("INFO.GRID_ADVANCED_FILTER_APPLY");grid.buttonFilter=applyFilterButton;grid.filterModal[3].appendChild(applyFilterButton);applyFilterButton.onclick=function(){grid.isAdvancedFilter=true;grid.iscCanvas.clearCriteria();grid.iscCanvas.filterData(grid.advancedFilter.getCriteria());bootstrapCloseModal(grid.filterModal[0]);};grid.VStack=isc.VStack.create({membersMargin:10,height:60,left:5,members:[grid.advancedFilter],htmlElement:grid.filterModal[2]});}
bootstrapShowModal(grid.filterModal[0]);}};function HTMLPaging(sys,formID,code,posX,posY,width,height){this.sys=sys;this.code=code;this.formID=formID;this.posX=posX;this.posY=posY;this.width=width;this.height=height;this.space=0;this.buttons=new Array();this.gt=-1;this.defaultPadding="1rem";this.smallPadding="0.75rem";}
HTMLPaging.inherits(HTMLElementBase);HTMLPaging.prototype.name='HTMLPaging';HTMLPaging.prototype.navigationAction=function(e,obj,param,sync){if(this.onnavigate)this.onnavigate.call(param);var resultContentURL=getContent('navigate.do?sys='+this.sys+'&formID='+this.formID+'&componentID='+this.code+'&action=navigate&param='+param+'&inner=true&gt='+this.gt);eval(resultContentURL);};HTMLPaging.prototype.setGoto=function(gt){this.gt=gt;};HTMLPaging.prototype.setReadOnly=function(v){};HTMLPaging.prototype.setEnabled=function(v){var object=this;this.buttons.forEach(function(elem){object.setDisabled(elem,!v);});};HTMLPaging.prototype.createButton=function(param,hint,icon,isPage){var li=document.createElement("li");li.className="page-item h-100";if(isPage)li.classList.add("disabled");li.disabled=false;li.visible=true;if(hint){li.title=hint;li.setAttribute("data-toggle","tooltip");}
this.ulPagination.appendChild(li);var bt=document.createElement("a");bt.className="page-link py-1 h-100 d-flex align-items-center justify-content-center";bt.style.paddingLeft=this.defaultPadding;bt.style.paddingRight=this.defaultPadding;bt.id=param+"Button";bt.href="#";li.appendChild(bt);if(!isPage){var object=this;bt.addEventListener("click",function(){object.grid.setActionFlag(false,true,false,false,false);if(object.onnavigate)object.onnavigate.call(param);eval(getContent('navigate.do?sys='+object.sys+'&formID='+object.formID+'&componentID='+object.code+'&action=navigate&param='+param+'&inner=true&gt='+object.gt));object.grid.updatePage();},false);}
li.action=bt;var btIcon=document.createElement(isPage?"span":"i");if(!isPage){btIcon.className="fas fa-"+icon;btIcon.style.fontSize="1rem";}else{btIcon.innerHTML=icon;btIcon.id=this.grid.id+"_page";btIcon.className="font-weight-bold";}
bt.appendChild(btIcon);return li;};HTMLPaging.prototype.createSameImageButton=function(param,hint,img,additionalClassName){};HTMLPaging.prototype.design=function(grid){this.grid=grid;this.doc=grid.bar;this.div=document.createElement("div");this.div.className="d-flex h-100 justify-content-end align-middle";this.ulPagination=document.createElement("ul");this.ulPagination.className="pagination h-100 mb-0";this.div.appendChild(this.ulPagination);this.buttons.push(this.btFirst=this.createButton("first",getLocaleMessage('LABEL.FIRST_PAGE'),"angle-double-left"));this.buttons.push(this.btPrevious=this.createButton("previous",getLocaleMessage('LABEL.PREVIOUS_PAGE'),"chevron-left"));this.buttons.push(this.btPage=this.createButton("","",this.grid.gridPage,true));this.buttons.push(this.btNext=this.createButton("next",getLocaleMessage('LABEL.NEXT_PAGE'),"chevron-right"));this.buttons.push(this.btLast=this.createButton("last",getLocaleMessage('LABEL.LAST_PAGE'),"angle-double-right"));this.doc.appendChild(this.div);};HTMLPaging.prototype.enableButtons=function(f,p,n,l){this.setDisabled(this.btFirst,!f);this.setDisabled(this.btPrevious,!p);this.setDisabled(this.btNext,!n);this.setDisabled(this.btLast,!l);this.setVisible(f||p||n||l);};HTMLPaging.prototype.setDisabled=function(elem,v){v=parseBoolean(v);elem.disabled=v;if(v){if(!elem.classList.contains("disabled")){elem.classList.add("disabled");}}else{if(elem.classList.contains("disabled")){elem.classList.remove("disabled");}}};HTMLPaging.prototype.setEnabled=function(elem){if(elem.disabled)this.setDisabled(elem,false);else this.setDisabled(elem,true);};HTMLPaging.prototype.setNumPages=function(num){this.numPages=num;};HTMLPaging.prototype.setVisible=function(v){this.callMethod(HTMLElementBase,"setVisible",[v]);this.grid.nav.setVisibleSeparator(v);this.buttons.forEach(function(elem){elem.visible=v;});};HTMLPaging.prototype.toString=function(){return'[object '+this.name+']';};HTMLPaging.prototype.flush=function(){};function HTMLRadioGroup(sys,formID,code,posX,posY,width,height,description,value,labels,values,fontDecoration){this.fontDescStyle=fontDecoration;this.create(sys,formID,code,posX,posY,width,height,description,value);this.labels=labels;this.values=values;if(!this.values)this.values=this.labels;this.columns=1;this.options=new Array();this.inputname='WFRInput'+this.code;this.style=1;}
HTMLRadioGroup.inherits(HTMLGroupBox);HTMLRadioGroup.prototype.name='HTMLRadioGroup';HTMLRadioGroup.prototype.tabable=true;HTMLRadioGroup.prototype.setFont=function(f){this.font=f;for(var i=0;i<this.options.length;i++){this.options[i].setFont(f);}};HTMLRadioGroup.prototype.setWeight=function(weight){this.weight=weight;for(var i=0;i<this.options.length;i++){this.options[i].setWeight(weight);}};HTMLRadioGroup.prototype.setItalic=function(italic){this.italic=italic;for(var i=0;i<this.options.length;i++){this.options[i].setItalic(italic);}};HTMLRadioGroup.prototype.setTextDecoration=function(){for(var i=0;i<this.options.length;i++){this.options[i].setTextDecoration();}};HTMLRadioGroup.prototype.setSize=function(s){if(s.indexOf("pt")==-1)s+="pt";this.size=s;for(var i=0;i<this.options.length;i++){this.options[i].setSize(s);}};HTMLRadioGroup.prototype.setEnabled=function(v){this.callMethod(HTMLElementBase,"setEnabled",[v]);for(var i=0;i<this.options.length;i++){this.options[i].setEnabled(this.enabled);}};HTMLRadioGroup.prototype.setVisible=function(v){this.callMethod(HTMLElementBase,"setVisible",[v]);for(var i=0;i<this.options.length;i++){this.options[i].setVisible(this.visible);}
this.updateLayout();};HTMLRadioGroup.prototype.setReadOnly=function(v){this.callMethod(HTMLElementBase,"setReadOnly",[v]);for(var i=0;i<this.options.length;i++){this.options[i].setReadOnly(this.readonly);}};HTMLRadioGroup.prototype.setColor=function(color){this.color=color;for(var i=0;i<this.options.length;i++){this.options[i].setColor(color);}};HTMLRadioGroup.prototype.setColumns=function(c){this.columns=c;this.reDesign();};HTMLRadioGroup.prototype.focus=function(){return false;};HTMLRadioGroup.prototype.blur=function(){return false;};HTMLRadioGroup.prototype.designOptions=function(root,tabControl){var rows=Math.ceil(this.labels.length/this.columns);var idx=0,cell=0;var container=document.createElement("div");container.className="card-body my-auto px-3 py-2";container.style.flex="0 0 auto";var isResponsive=(d&&d.n&&d.n.responsive);var colSize=(this.columns<=0)?12:(this.columns>=12)?1:Math.ceil(12/this.columns);var colClass=isResponsive?(colSize>0)?"col-sm-"+colSize:"col-sm":(colSize>0)?"col-"+colSize:"col";for(var i=0;i<rows;i++){if(rows!=this.labels.length)cell=i;var rowDiv=document.createElement("div");rowDiv.className="row no-gutters w-100";for(var j=0;j<this.columns;j++){if(idx<=this.values.length){if(cell!==this.labels.length&&cell<this.labels.length&&idx<this.labels.length){var o=(rows!=this.labels.length)?new HTMLRadioGroupOption(this,this.sys,this.formID,this.code,this.labels[cell],this.values[cell],idx+cell):new HTMLRadioGroupOption(this,this.sys,this.formID,this.code,this.labels[idx],this.values[idx],idx+cell);o.index=idx;o.tabindex=this.tabindex;o.color=this.color;o.dependent=this.dependent;if(tabControl!=undefined){o.design(rowDiv,tabControl);}else{o.design(rowDiv,true);}
o.div.className+=" "+colClass+" pl-4 pr-2";o.divClass+=" "+colClass+" pl-4 pr-2";this.options.push(o);rowDiv.appendChild(o.div);orderTab.splice(arrayIndexOf(orderTab,this.code),0,o);if(rows<this.values.length)cell+=rows;idx++;}}}
container.appendChild(rowDiv);}
root.appendChild(container);};HTMLRadioGroup.prototype.getValue=function(){return this.hidden.value;};HTMLRadioGroup.prototype.getShowValue=function(){for(i=0;i<this.options.length;i++){if(this.options[i].isChecked())
return this.options[i].getShowValue();}
return'';};HTMLRadioGroup.prototype.setValue=function(value){value=normalizeRuleParam(value,true);var temp=this.value;this.hidden.setValue(value);this.value=value;for(var i=0;i<this.options.length;i++){if(this.options[i].value==this.value)
this.options[i].setChecked(true);else this.options[i].setChecked(false);}
if(this.value!=temp){this.changeAction(null,this);}};HTMLRadioGroup.prototype.designComponent=function(doc,tabControl){this.div.className+=" overflow-auto fixed-height";this.divClass=this.div.className;this.designGroupBox(doc);this.hidden=new HTMLHidden(this.sys,this.formID,this.code,this.value);this.hidden.name=this.name;this.hidden.design(this.context);this.designOptions(this.context,tabControl);for(var i=0;i<this.options.length;i++){if(this.options[i].value==this.value)
this.options[i].setChecked(true);else this.options[i].setChecked(false);}};HTMLRadioGroup.prototype.reDesign=function(tabControl){this.free();this.options=new Array();this.design(this.doc,tabControl);};HTMLRadioGroup.prototype.freeComponent=function(){for(var i=0;i<this.options.length;i++){this.options[i].free(true);}
this.hidden.free();};HTMLRadioGroup.prototype.add=function(value,label){this.labels=this.labels.concat([label]);this.values=this.values.concat([value]);this.reDesign();};HTMLRadioGroup.prototype.removeByIndex=function(idx){this.labels.splice(idx,1);this.values.splice(idx,1);this.reDesign();};HTMLRadioGroup.prototype.removeByKey=function(key){var idx=arrayIndexOf(this.values,key);if(idx!=-1){this.values.splice(idx,1);this.labels.splice(idx,1);this.reDesign();}else interactionError(getLocaleMessage("INFO.KEY_ELEMENT_DOES_NOT_EXIST",key));};HTMLRadioGroup.prototype.focusNext=function(current){if(current>=this.options.length-1)this.options[0].focus();else this.options[current+1].focus();};HTMLRadioGroup.prototype.focusPrevious=function(current){if(current<=0)this.options[this.options.length-1].focus();else this.options[current-1].focus();};HTMLRadioGroup.prototype.setHint=function(hint){this.callMethod(HTMLElementBase,"setHint",[hint]);if(this.div){let init=this.div.hint?false:true;if(this.div.getAttribute("data-original-title")){this.div.setAttribute("data-original-title",hint.replace(/(?:\r\n|\r|\n)/g,'<br />'));}else{this.div.setAttribute("data-toggle","tooltip");this.div.setAttribute("data-html","true");this.div.hint=hint;this.div.title=hint.replace(/(?:\r\n|\r|\n)/g,'<br />');if(init)bootstrapInitTooltip(this.div);}}};function HTMLRadioGroupOption(group,sys,formID,code,description,value,index){this.create(sys,formID,code,null,null,null,null,description,value);this.group=group;this.checked=false;this.index=index;if(group.size)this.size=group.size;}
HTMLRadioGroupOption.inherits(HTMLElementBase);HTMLRadioGroupOption.prototype.name='HTMLRadioGroupOption';HTMLRadioGroupOption.prototype.ignore=true;HTMLRadioGroupOption.prototype.tabable=true;HTMLRadioGroupOption.prototype.setWidth=function(width){};HTMLRadioGroupOption.prototype.setHeight=function(height){};HTMLRadioGroupOption.prototype.updateImage=function(){if(this.checked)this.input.checked=true;else this.input.checked=false;if(this.readonly||!this.enabled){this.onkeydown=null;this.removeEvent(this.input,'click');if(this.label)this.removeEvent(this.label,'click');if(!this.enabled)this.input.disabled=true;this.div.className=this.divClass+" disabled";}else{this.attachEvent(this.input,'click',this.click);if(this.label)this.attachEvent(this.label,'click',this.click);this.onkeydown=this.keyPressedAction;if(this.enabled)this.input.disabled=false;this.div.className=this.divClass;}};HTMLRadioGroupOption.prototype.designComponent=function(doc){this.div.className="custom-control custom-radio";this.divClass=this.div.className;this.div.onmousedown=function(){return false;};this.div.onselectstart=function(){return false;};this.input=document.createElement("input");this.input.type="radio";this.input.id="option"+this.code+"-"+this.index;this.input.className="custom-control-input";this.div.appendChild(this.input);this.radio=document.createElement("div");this.radio.className="custom-control-label";this.radio.style.lineHeight="100%";this.radio.style.height="100%";this.div.appendChild(this.radio);if(this.description!=null&&this.description.length>0){this.label=document.createElement("label");this.label.setAttribute("for","option"+this.code+"-"+this.index);this.label.innerHTML=this.description;this.radio.appendChild(this.label);}
if(this.click)this.attachEvent(this.div,'click',this.click);doc.appendChild(this.div);this.updateImage();};HTMLRadioGroupOption.prototype.getFocus=function(fromKeyBoard){try{if(this.tabable&&this.enabled&&this.visible&&!this.readonly&&!this.resizable&&!this.draggable){if(this.group.doc&&this.group.doc.focus&&this.group.doc.canFocus!=null&&!this.group.doc.canFocus.call(this))return false;this.fromKeyBoard=fromKeyBoard;try{if(!this.group.doc.focus.isHTMLAction)this.group.doc.focus();else this.group.doc.focus.call(this);}catch(e){}
return this.focus();}else return false;}catch(e){return false;}};HTMLRadioGroupOption.prototype.keyPressedAction=function(e){var key=getKey(e);if(key==32)this.click();else if(key==40)this.group.focusNext(this.index);else if(key==38)this.group.focusPrevious(this.index);};HTMLRadioGroupOption.prototype.setReadOnly=function(v){this.readonly=v;this.updateImage();};HTMLRadioGroupOption.prototype.setEnabled=function(v){this.enabled=v;this.updateImage();};HTMLRadioGroupOption.prototype.setColor=function(color){this.color=color;this.label.style.color=color;};HTMLRadioGroupOption.prototype.setChecked=function(checked){this.checked=checked;this.updateImage();};HTMLRadioGroupOption.prototype.isChecked=function(){return this.checked;};HTMLRadioGroupOption.prototype.getValue=function(){return this.value;};HTMLRadioGroupOption.prototype.getShowValue=function(){return this.description;};HTMLRadioGroupOption.prototype.setVisible=function(v){this.visible=v;};HTMLRadioGroupOption.prototype.click=function(e){this.input.focus();this.group.clickAction(e);this.group.setValue(this.value);};HTMLRadioGroupOption.prototype.designDragComponent=function(){};HTMLRadioGroupOption.prototype.setDraggable=function(draggable){};HTMLRadioGroupOption.prototype.setResizable=function(resizable){};HTMLRadioGroupOption.prototype.flush=function(){if(this.label){if(this.label.onmousedown)this.label.onmousedown=null;if(this.label.onselectstart)this.label.onselectstart=null;this.label=null;}
if(this.div){if(this.div.onmousedown)this.div.onmousedown=null;if(this.div.onselectstart)this.div.onselectstart=null;this.div=null;}
this.img=null;this.callMethod(HTMLElementBase,"flush");};function HTMLPage(sys,formID,code,posX,posY,width,height,nav,scrolling){this.create(sys,formID,code,posX,posY,width,height,'','');this.nav=nav;this.loaded=false;this.scrolling=scrolling;}
HTMLPage.inherits(HTMLElementBase);HTMLPage.prototype.name='HTMLPage';HTMLPage.prototype.ignore=true;HTMLPage.prototype.designComponent=function(doc){this.div.style.height=null;this.div.style.minHeight=null;this.doc.style.minHeight=null;this.div.className="position-relative w-100 h-100 border-0 outline-0";this.divClass=this.div.className;this.page=document.createElement("iframe");this.page.className="w-100 h-100 border-0 outline-0 overflow-auto";this.page.style.top="0px";this.page.style.bottom="0px";this.page.style.left="0px";this.page.style.right="0px";this.page.setAttribute("frameborder","no");this.page.setAttribute("border","0");this.page.setAttribute("marginwidth","0");this.page.setAttribute("marginheight","0");this.page.setAttribute("scrolling","yes");this.page.style.margin="0";this.page.style.border="0";this.page.style.outline="0";this.context.appendChild(this.page);};HTMLPage.prototype.load=function(e){if(!this.loaded){this.page.src='javascript:false';this.page.src='basic_query'+PAGES_EXTENSION+'?sys='+this.sys+'&formID='+this.formID;if(frameElement&&frameElement.assignEventsHierarchy){var object=this;this.page.assignEventsHierarchy=frameElement.assignEventsHierarchy;this.page.onload=function(){try{frameElement.assignEventsHierarchy(object.page.contentWindow.document);}catch(e){}};}
this.loaded=true;}
this.nav.query();};HTMLPage.prototype.focus=function(){return false;};HTMLPage.prototype.blur=function(){return false;};function HTMLDetailPanel(sys,formID,code,posX,posY,width,height,description,value){this.create(sys,formID,code,posX,posY,width,height,description,value);this.components=new Array();this.wasVisible=new Array();this.wasEnabled=new Array();this.wasNotReadOnly=new Array();}
HTMLDetailPanel.inherits(HTMLGroupBox);HTMLDetailPanel.prototype.name='HTMLDetailPanel';HTMLDetailPanel.prototype.designComponent=function(doc){this.callMethod(HTMLGroupBox,'designComponent',[doc]);this.hidden=document.createElement("input");this.hidden.name="WFRDetailPanelVisible"+this.code;this.hidden.type="hidden";this.hidden.value=this.visible.toString();this.context.appendChild(this.hidden);};HTMLDetailPanel.prototype.setX=function(posX){posX=parseInt(posX);var oldX=parseInt(this.posX);this.callMethod(HTMLGroupBox,'setX',[posX]);for(var i=0;i<this.components.length;i++){var com=this.components[i];if(com){var diff=posX-oldX;com.setX(com.getX()+diff);}}};HTMLDetailPanel.prototype.setY=function(posY){posY=parseInt(posY);var oldY=parseInt(this.posY);this.callMethod(HTMLGroupBox,'setY',[posY]);for(var i=0;i<this.components.length;i++){var com=this.components[i];if(com){var diff=posY-oldY;com.setY(com.getY()+diff);}}};HTMLDetailPanel.prototype.add=function(comp){this.components.push(comp);if(arrayIndexOf(orderTab,this.code)!=-1){orderTab.splice(arrayIndexOf(orderTab,this.code),0,comp.code);}else{detailPanelComponentsTab.add(comp,this);}
comp.parentPanelCode=this.getCode();comp.designDragComponent=function(){};comp.setDraggable=function(){};comp.setResizable=function(){};};HTMLDetailPanel.prototype.setVisible=function(visible,force){if(visible==this.visible&&!force)return;this.callMethod(HTMLGroupBox,'setVisible',[visible]);if(!visible){this.wasVisible=new Array();for(var i=0;i<this.components.length;i++){if(this.components[i]){if(this.components[i].getVisible())
this.wasVisible.push(this.components[i]);this.components[i].setVisible(false);}}}else{for(var i=0;i<this.wasVisible.length;i++)
this.wasVisible[i].setVisible(true);}
this.hidden.value=this.visible.toString();};HTMLDetailPanel.prototype.setEnabled=function(enabled,force){if(enabled==this.enabled&&!force)return;this.callMethod(HTMLGroupBox,'setEnabled',[enabled]);if(!enabled){this.wasEnabled=new Array();for(var i=0;i<this.components.length;i++){if(this.components[i]){if(this.components[i].getEnabled())
this.wasEnabled.push(this.components[i]);this.components[i].setEnabled(false);}}}else{for(var i=0;i<this.wasEnabled.length;i++)
this.wasEnabled[i].setEnabled(true);}};HTMLDetailPanel.prototype.setReadOnly=function(readonly,force){if(readonly==this.readonly&&!force)return;this.readonly=readonly;if(readonly){this.wasNotReadOnly=new Array();for(var i=0;i<this.components.length;i++){if(this.components[i]){if(!this.components[i].getReadOnly())
this.wasNotReadOnly.push(this.components[i]);this.components[i].setReadOnly(true);}}}else{for(var i=0;i<this.wasNotReadOnly.length;i++)
this.wasNotReadOnly[i].setReadOnly(false);}};HTMLDetailPanel.prototype.freeComponent=function(){for(i=0;i<this.components.length;i++){if(this.components[i])this.components[i].free();}};function HTMLImage(sys,formID,code,posX,posY,width,height,description,value,type,criptografado,magnifier){this.create(sys,formID,code,posX,posY,width,height,description,value);this.report=false;this.viewMode="Estender";this.type=type?parseInt(type):1;this.criptografado=criptografado;this.url=value?value.trim().replace("{","%7b").replace("}","%7d"):"";this.urlIsBase64=false;this.hasImage=(this.url&&this.url.length>0&&this.url!="null");this.magnifier=magnifier;this.shouldHideMagnifier=false;this.isMagnifierVisible=false;this.staticImage=false;this.hovered=false;this.footerVisible=true;this.noImageVisible=false;this.imgVisible=true;}
HTMLImage.inherits(HTMLElementBase);HTMLImage.prototype.name='HTMLImage';HTMLImage.prototype.tabable=false;HTMLImage.prototype.isBinary=true;HTMLImage.prototype.setEnabled=function(v){this.callMethod(HTMLElementBase,"setEnabled",[v]);this.updateLayout();};HTMLImage.prototype.setVisible=function(v){this.callMethod(HTMLElementBase,"setVisible",[v]);if(this.div){this.updateLayout();}};HTMLImage.prototype.setReadOnly=function(v){this.callMethod(HTMLElementBase,"setReadOnly",[v]);this.updateLayout();};HTMLImage.prototype.setHint=function(hint){this.callMethod(HTMLElementBase,"setHint",[hint]);if(this.img){let init=this.img.hint?false:true;if(this.img.getAttribute("data-original-title")){this.img.setAttribute("data-original-title",hint.replace(/(?:\r\n|\r|\n)/g,'<br />'));}else{this.img.hint=hint;this.img.alt=hint;this.img.title=hint.replace(/(?:\r\n|\r|\n)/g,'<br />');this.img.setAttribute("data-toggle","tooltip");this.img.setAttribute("data-html","true");if(init)bootstrapInitTooltip(this.img);}}};HTMLImage.prototype.getGridShowValue=function(grid,row,column,oldContent,newDataArray){var componentProperties;var gridCode;if(newDataArray[column]!=''&&newDataArray[column]!='&nbsp;'){componentProperties={enabled:this.enabled,readonly:this.readonly,hint:this.img.hint};gridCode=0;if(isTypeOf(grid,"HTMLGrid"))gridCode=grid.getCode();return gridImage(this.url,this.width,this.height,componentProperties,gridCode);}else return"";};HTMLImage.prototype.setValue=function(value,checkDependences){this.callMethod(HTMLElementBase,"setValue",[value,checkDependences]);this.setImage(value.trim().replace("{","%7b").replace("}","%7d"),false);};HTMLImage.prototype.hasEmptyValue=function(){return isNullable(this.md5);};HTMLImage.prototype.setDescription=function(v){var table;if(this.img){if(!this.divText){if(v&&v.length>0){this.divText=this.getDiv('',0,0,this.width,this.height,6,true);this.divText.style.cursor='pointer';table=getTable(1,1,'100%','100%');this.label=getLabel(v,true);table[CELLS][0][0].setAttribute('align','center');table[CELLS][0][0].setAttribute('valign','middle');table[CELLS][0][0].appendChild(this.label);this.divText.appendChild(table[TABLE]);this.context.appendChild(this.divText);this.label.onmousedown=function(){return false;};this.label.onselectstart=function(){return false;};this.attachEvent(this.divText,'click',this.doOnClick);this.attachEvent(this.divText,'mouseover',this.mouseOverAction);this.attachEvent(this.divText,'mouseout',this.mouseOutAction);}}else{if(v&&v.length>0){this.label.innerHTML=v;}else{this.context.removeChild(this.divText);this.divText=null;this.label=null;}}}};HTMLImage.prototype.designComponent=function(){var object=this;if(this.report)this.enabled=false;this.noImage=document.createElement("div");this.noImageClass="w-100 h-100 flex-fill text-muted align-items-center justify-content-center";this.noImage.className=this.noImageClass;this.context.appendChild(this.noImage);var noImageDesc=document.createElement("span");noImageDesc.innerHTML=(this.type==1)?this.decorateRequired("("+getLocaleMessage("LABEL.IMAGE")+")",this.required):this.decorateRequired("("+getLocaleMessage("LABEL.DIGITAL_PRINTING")+")",this.required);this.noImage.appendChild(noImageDesc);this.context=this.getBaseDiv(false);this.contextClass="w-100 mw-100 mh-100 overflow-hidden d-flex align-items-center justify-content-center";this.context.className=this.contextClass;this.context.style.height=this.height+"px";this.div.appendChild(this.context);if(this.getViewMode()=="stretch"){this.img=document.createElement("img");this.imgClass="border-0 outline-0 overflow-hidden img-fluid";}else{this.img=document.createElement("div");this.img.style.height=this.height+"px";this.imgClass="w-100 overflow-hidden";}
this.img.className=this.imgClass;this.img.style.width=this.width+"px";this.context.appendChild(this.img);if(this.magnifier){this.zoomLevel=2;this.zoomType=0;this.magnifierDiv=document.createElement("div");if(this.zoomWidth>0&&this.zoomHeight>0){this.magnifierDiv.className="imagebox-magnifier pointer";this.context.appendChild(this.magnifierDiv);this.zoomType=1;this.magnifierOutsideDiv=document.createElement("div");this.magnifierOutsideDiv.className="imagebox-magnifier outside";this.magnifierOutsideDiv.style.width=this.zoomWidth+"px";this.magnifierOutsideDiv.style.height=this.zoomHeight+"px";this.doc.appendChild(this.magnifierOutsideDiv);}else{this.magnifierDiv.className="imagebox-magnifier inside bg-light";this.doc.appendChild(this.magnifierDiv);this.zoomType=0;}
var updateMagnifierAction=function(e){if(object.hasImage&&object.url&&object.url.length>0&&object.url!="null"){object.updateMagnifier(e);}};this.div.addEventListener("mouseover",function(){object.mouseOver=true;object.showMagnifier();},false);this.div.addEventListener("mouseout",function(){object.mouseOver=false;object.hideMagnifier();},false);this.div.addEventListener("mousemove",updateMagnifierAction,false);this.div.addEventListener("touchmove",updateMagnifierAction,false);this.div.addEventListener("wheel",function(e){if(object.isMagnifierVisible&&object.zoomType==0){e=window.event||e;var delta=-Math.sign(e.deltaY);object.zoomLevel+=delta;if(object.zoomLevel<2)object.zoomLevel=2;else if(object.zoomLevel>6)object.zoomLevel=6;object.updateMagnifier(e);}},false);if(this.getViewMode()=="stretch"){this.img.addEventListener("load",function(){object.imgRealWidth=object.img.naturalWidth;object.imgRealHeight=object.img.naturalHeight;object.updateMagnifier();},false);}}
if(this.canUpload()&&this.type!=2){this.footerDiv=document.createElement("div");this.footerDivClass="card-footer bg-light flex-row flex-wrap align-items-center justify-content-center text-center p-2 w-100";this.footerDiv.className=this.footerDivClass;this.footerDiv.style.bottom="0px";this.footerDiv.style.left="0px";this.footerDiv.style.right="0px";this.footerDiv.style.zIndex="100";this.div.appendChild(this.footerDiv);this.haveTooltips=false;this.divUpload=document.createElement("div");this.divUpload.name="WFRUpload";this.divUpload.id="imageboxButtonUpload"+this.code;this.divUpload.className="generic-btn flex-fill";this.divUploadIcon=document.createElement("i");this.divUploadIcon.className="fas fa-upload";this.divUploadIcon.style.fontSize="1.25rem";var uploadDescription=getLocaleMessage("LABEL.UPLOAD");if(uploadDescription){this.divUploadIcon.alt=uploadDescription;this.divUpload.title=uploadDescription;this.divUpload.setAttribute("data-toggle","tooltip");this.divUpload.setAttribute("data-placement","right");this.haveTooltips=true;}
this.attachEvent(this.divUpload,"touchstart",this.uploadClickAction);this.attachEvent(this.divUpload,"click",this.uploadClickAction);this.divUpload.appendChild(this.divUploadIcon);this.footerDiv.appendChild(this.divUpload);this.divWebcam=document.createElement("div");this.divWebcam.name="WFRWebcam";this.divWebcam.id="imageboxButtonWebcam"+this.code;this.divWebcam.className="generic-btn flex-fill";this.divWebcamIcon=document.createElement("i");this.divWebcamIcon.className="fas fa-camera";this.divWebcamIcon.style.fontSize="1.25rem";var webcamDescription=getLocaleMessage("LABEL.WEBCAM");if(webcamDescription){this.divWebcam.title=webcamDescription;this.divWebcam.setAttribute("data-toggle","tooltip");this.divWebcam.setAttribute("data-placement","right");this.haveTooltips=true;}
this.attachEvent(this.divWebcam,"touchstart",this.captureClickAction);this.attachEvent(this.divWebcam,"click",this.captureClickAction);this.divWebcam.appendChild(this.divWebcamIcon);this.footerDiv.appendChild(this.divWebcam);this.divZoom=document.createElement("div");this.divZoom.name="WFRZoom";this.divZoom.id="imageboxButtonZoom"+this.code;this.divZoom.className="generic-btn flex-fill";this.divZoomIcon=document.createElement("i");this.divZoomIcon.className="fas fa-expand";this.divZoomIcon.style.fontSize="1.25rem";var zoomDescription=getLocaleMessage("LABEL.ZOOM_IMAGE");if(zoomDescription){this.divZoomIcon.alt=zoomDescription;this.divZoom.title=zoomDescription;this.divZoom.setAttribute("data-toggle","tooltip");this.divZoom.setAttribute("data-placement","right");this.haveTooltips=true;}
this.attachEvent(this.divZoom,"touchstart",this.zoomClickAction);this.attachEvent(this.divZoom,"click",this.zoomClickAction);this.divZoom.appendChild(this.divZoomIcon);this.footerDiv.appendChild(this.divZoom);}
this.attachEvent(this.div,"touchstart",this.clickAction);this.attachEvent(this.div,"touchend",this.touchEndAction);this.attachEvent(this.div,"mouseenter",this.mouseEnterAction);this.attachEvent(this.div,"mouseleave",this.mouseLeaveAction);this.attachEvent(this.noImage,"click",this.clickAction);this.attachEvent(this.div,"click",this.clickAction);this.attachEvent(this.img,"touchstart",this.clickAction);this.attachEvent(this.img,"touchend",this.touchEndAction);this.attachEvent(this.img,"click",this.clickAction);this.divClass="form-group fixed-height card text-center align-items-center";this.div.className=this.divClass;this.setImage(this.hasImage?this.url:null,this.urlIsBase64);};HTMLImage.prototype.updateMagnifier=function(e){var imgWidth=(this.img.offsetWidth>0)?this.img.offsetWidth:this.width;var imgHeight=(this.img.offsetHeight>0)?this.img.offsetHeight:this.height;var imgNatWidth=(this.imgRealWidth!==undefined&&this.imgRealWidth>0)?this.imgRealWidth:imgWidth;var imgNatHeight=(this.imgRealHeight!==undefined&&this.imgRealHeight>0)?this.imgRealHeight:imgHeight;if(this.getViewMode()=="stretch"){imgNatWidth=imgWidth;imgNatHeight=imgHeight;}
var divPosX=this.div.offsetLeft;var divWidth=this.div.offsetWidth;var divPosY=this.div.offsetTop;switch(this.zoomType){case 0:var dimensionPercentage=Math.ceil(Math.max(imgWidth,imgHeight)*0.32);this.magnifierDiv.style.width=dimensionPercentage+"px";this.magnifierDiv.style.height=dimensionPercentage+"px";this.magnifierDiv.middleX=dimensionPercentage/2;this.magnifierDiv.middleY=dimensionPercentage/2;this.magnifierDiv.style.backgroundSize=Math.ceil(imgNatWidth*this.zoomLevel)+"px "+
Math.ceil(imgNatHeight*this.zoomLevel)+"px";break;case 1:var magWidth=Math.max(imgWidth/6,Math.min(imgWidth,((imgWidth*this.zoomWidth)/imgNatWidth)/this.zoomLevel));var magHeight=Math.max(imgHeight/6,Math.min(imgHeight,((imgHeight*this.zoomHeight)/imgNatHeight)/this.zoomLevel));this.magnifierDiv.style.width=Math.ceil(magWidth)+"px";this.magnifierDiv.style.height=Math.ceil(magHeight)+"px";this.magnifierDiv.middleX=magWidth/2;this.magnifierDiv.middleY=magHeight/2;this.magnifierOutsideDiv.style.backgroundSize=Math.ceil(imgNatWidth*(this.zoomWidth/magWidth))+"px "+
Math.ceil(imgNatHeight*(this.zoomHeight/magHeight))+"px";this.magnifierOutsideDiv.style.left="calc("+(divPosX+divWidth)+"px + 0.5rem)";this.magnifierOutsideDiv.style.top=(divPosY-3)+"px";break;}
this.moveMagnifier(e);};HTMLImage.prototype.moveMagnifier=function(e){if(e)e.preventDefault();var event=e||window.event;if(event){var a=this.img.getBoundingClientRect();var x=(event.touches&&event.touches.length>0?event.touches[0].pageX:event.pageX)-a.left+this.img.offsetLeft-window.pageXOffset;var y=(event.touches&&event.touches.length>0?event.touches[0].pageY:event.pageY)-a.top+this.img.offsetTop-window.pageYOffset;var imgWidth=(this.img.offsetWidth>0)?this.img.offsetWidth:this.width;var imgHeight=(this.img.offsetHeight>0)?this.img.offsetHeight:this.height;var imgNatWidth=(this.imgRealWidth!==undefined&&this.imgRealWidth>0)?this.imgRealWidth:imgWidth;var imgNatHeight=(this.imgRealHeight!==undefined&&this.imgRealHeight>0)?this.imgRealHeight:imgHeight;if(this.getViewMode()=="stretch"){imgNatWidth=imgWidth;imgNatHeight=imgHeight;}
var divPosX=this.div.offsetLeft;var divPosY=this.div.offsetTop;var imgOffsetX=0;var imgOffsetY=0;if(this.viewMode&&this.viewMode.toLowerCase()=="centralizado"){imgOffsetX=this.context.offsetWidth-imgWidth;imgOffsetY=this.context.offsetHeight-imgHeight;imgOffsetX+=(imgNatWidth/2)-(imgWidth/2);imgOffsetY+=(imgNatHeight/2)-(imgHeight/2);}
this.magnifierDiv.middleX=this.magnifierDiv.offsetWidth/2;this.magnifierDiv.middleY=this.magnifierDiv.offsetHeight/2;if(this.zoomType==0){if(x>imgWidth+(this.magnifierDiv.middleX/this.zoomLevel)+this.img.offsetLeft){x=imgWidth+(this.magnifierDiv.middleX/this.zoomLevel)+this.img.offsetLeft;}else if(x<-(this.magnifierDiv.middleX/this.zoomLevel)+this.img.offsetLeft){x=-(this.magnifierDiv.middleX/this.zoomLevel)+this.img.offsetLeft;}
if(y>imgHeight+(this.magnifierDiv.middleY/this.zoomLevel)+this.img.offsetTop){y=imgHeight+(this.magnifierDiv.middleY/this.zoomLevel)+this.img.offsetTop;}else if(y<-(this.magnifierDiv.middleY/this.zoomLevel)+this.img.offsetTop){y=-(this.magnifierDiv.middleY/this.zoomLevel)+this.img.offsetTop;}
x-=this.magnifierDiv.middleX;y-=this.magnifierDiv.middleY;this.magnifierDiv.style.left=(divPosX+x)+"px";this.magnifierDiv.style.top=(divPosY+y)+"px";x+=this.magnifierDiv.middleX/2;y+=this.magnifierDiv.middleY/2;this.magnifierDiv.style.backgroundPosition=(-Math.floor((x-this.img.offsetLeft+imgOffsetX)*this.zoomLevel))+"px "+
(-Math.floor((y-this.img.offsetTop+imgOffsetY)*this.zoomLevel))+"px";}else if(this.zoomType==1){x-=this.magnifierDiv.middleX;y-=this.magnifierDiv.middleY;if(x>imgWidth-this.magnifierDiv.offsetWidth+this.img.offsetLeft)
x=imgWidth-this.magnifierDiv.offsetWidth+this.img.offsetLeft;else if(x<this.img.offsetLeft)x=this.img.offsetLeft;if(y>imgHeight-this.magnifierDiv.offsetHeight+this.img.offsetTop)
y=imgHeight-this.magnifierDiv.offsetHeight+this.img.offsetTop;else if(y<this.img.offsetTop)y=this.img.offsetTop;this.magnifierDiv.style.left=x+"px";this.magnifierDiv.style.top=y+"px";this.magnifierOutsideDiv.style.backgroundPosition=(-Math.floor((x-this.img.offsetLeft+imgOffsetX)*(this.zoomWidth/this.magnifierDiv.offsetWidth)))+"px "+
(-Math.floor((y-this.img.offsetTop+imgOffsetY)*(this.zoomHeight/this.magnifierDiv.offsetHeight)))+"px";}}};HTMLImage.prototype.setWidth=function(width){this.callMethod(HTMLElementBase,"setWidth",[width]);if(this.img)this.img.style.width=this.width+"px";if(this.divText)this.divText.style.width=this.width+"px";};HTMLImage.prototype.setHeight=function(height){this.callMethod(HTMLElementBase,"setHeight",[height]);if(this.context)this.context.style.height=this.height+"px";if(this.getViewMode()!="stretch"&&this.img)this.img.style.height=this.height+"px";if(this.divText)this.divText.style.height=this.height+"px";};HTMLImage.prototype.zoomClickAction=function(e){e.stopPropagation();this.setFooterVisible(false);if(this.hasImage&&this.url&&this.url.length>0&&this.url!="null"){var imgWidth=(this.img.offsetWidth>0)?this.img.offsetWidth:this.width;var imgHeight=(this.img.offsetHeight>0)?this.img.offsetHeight:this.height;var formZoom=WFRZoomImg(this.urlIsBase64?"":this.url,imgWidth,imgHeight);if(this.urlIsBase64&&formZoom){var iframes=formZoom.getElementsByTagName("iframe");if(iframes&&iframes.length>0)iframes[0].urlImageZoom=this.url;}}};HTMLImage.prototype.uploadClickAction=function(e){e.stopPropagation();this.setFooterVisible(false);if(this.readonly||!this.enabled)return;this.uploadWindow=openUpload(this.sys,this.formID,this.code,this.getCriptografado(),true);};HTMLImage.prototype.captureClickAction=function(e){e.stopPropagation();this.setFooterVisible(false);if(this.readonly||!this.enabled)return;this.captureWindow=openCapture(this.sys,this.formID,this.code);};HTMLImage.prototype.updateLayout=function(){var compHasImage=(this.hasImage&&this.url&&this.url.length>0&&this.url!="null");if(this.canUpload()){this.setFooterVisible(this.enabled&&!this.readonly&&(!this.hasImage||(this.hovered&&!this.magnifier)));this.div.style.cursor=this.enabled&&!this.readonly?"pointer":null;this.noImage.style.cursor=this.div.style.cursor;this.img.style.cursor=this.div.style.cursor;this.div.style.borderStyle=null;}else{this.setFooterVisible(false);this.div.style.cursor=null;this.noImage.style.cursor=null;this.img.style.cursor=null;if(compHasImage){if(this.div&&this.div.classList.contains("card")){this.div.classList.remove("card");}
this.div.style.borderStyle=null;}else{if(this.div&&!this.div.classList.contains("card")){this.div.classList.add("card");}
this.div.style.borderStyle="dashed";}}
if(compHasImage){this.setImageVisible(true);if(this.divZoom&&this.divZoom.classList.contains("disabled"))
this.divZoom.classList.remove("disabled");if(this.divText)visibleDiv(this.divText,true);}else{this.setImageVisible(false);if(this.divZoom&&!this.divZoom.classList.contains("disabled"))
this.divZoom.classList.add("disabled");if(this.divText)visibleDiv(this.divText,false);}
if(this.getViewMode()!="stretch"){if(this.viewMode&&this.viewMode.toLowerCase()=="centralizado"){this.img.style.backgroundPosition="center center";}else{this.img.style.backgroundPosition=null;}
this.img.style.backgroundRepeat=this.getViewMode();if(this.magnifier){if(this.zoomType==1&&this.magnifierOutsideDiv){this.magnifierOutsideDiv.style.backgroundRepeat=this.img.style.backgroundRepeat;}else if(this.zoomType==0&&this.magnifierDiv){this.magnifierDiv.style.backgroundRepeat=this.img.style.backgroundRepeat;}}}};HTMLImage.prototype.refresh=function(hasImage,fileMD5){var changed=this.md5!=fileMD5;this.md5=fileMD5;this.hasImage=hasImage;this.setImage(this.hasImage?this.url:null,false);try{if(this.uploadWindow&&typeof this.uploadWindow.close==='function'){this.uploadWindow.close();this.uploadWindow=null;}}catch(e){}
try{if(this.captureWindow&&typeof this.captureWindow.close==='function'){this.captureWindow.close();this.captureWindow=null;}}catch(e){}
if(this.onchange&&changed){this.onchange.call(this);}};HTMLImage.prototype.setType=function(type){this.type=type;};HTMLImage.prototype.touchEndAction=function(e,o){e.preventDefault();};HTMLImage.prototype.showMagnifier=function(){if(!this.shouldHideMagnifier&&this.hasImage&&this.url&&this.url.length>0&&this.url!="null"){if(this.magnifierDiv)this.magnifierDiv.style.display="block";if(this.zoomType==1&&this.magnifierOutsideDiv){this.magnifierOutsideDiv.style.display="block";}
this.isMagnifierVisible=true;}else{this.hideMagnifier();}};HTMLImage.prototype.hideMagnifier=function(){if(this.magnifierDiv)this.magnifierDiv.style.display="none";if(this.zoomType==1&&this.magnifierOutsideDiv){this.magnifierOutsideDiv.style.display="none";}
this.isMagnifierVisible=false;};HTMLImage.prototype.toggleMagnifier=function(){this.setFooterVisible(this.enabled&&!this.readonly&&!this.isFooterVisible());this.shouldHideMagnifier=this.isFooterVisible();if(this.mouseOver){if(this.shouldHideMagnifier)this.hideMagnifier();else this.showMagnifier();this.updateMagnifier();}};HTMLImage.prototype.clickAction=function(e,o){e.stopPropagation();if(this.enabled&&!this.readonly){if(e.touches&&e.touches.length>0){if(this.magnifier&&this.hasImage&&!this.isMagnifierVisible&&!this.isFooterVisible()){this.showMagnifier();this.updateMagnifier();}else{if(this.canUpload()&&this.hasImage){this.setFooterVisible(!this.isFooterVisible());if(!this.isFooterVisible())e.preventDefault();}
this.hideMagnifier();}
if(this.onclick)this.onclick.call(this);return;}
if(this.onclick){this.onclick.call(this);}else if(this.magnifier&&this.hasImage&&this.canUpload()){this.toggleMagnifier();}else if(this.exhibitionType==1){this.zoomClickAction(e,o);}else if(this.canUpload()){switch(this.type){case 1:{this.uploadWindow=openUpload(this.sys,this.formID,this.code,this.getCriptografado(),this.hasImage,this.hasImage);break;}case 2:{this.captureWindow=openDigitalCapture(this.sys,this.formID,this.code,this.getCriptografado());break;}}}}};HTMLImage.prototype.mouseEnterAction=function(e){this.hovered=true;this.updateLayout();};HTMLImage.prototype.mouseLeaveAction=function(e){this.hovered=false;this.updateLayout();};HTMLImage.prototype.canUpload=function(){return(this.exhibitionType==0&&!this.staticImage&&!this.readonly);};HTMLImage.prototype.isFooterVisible=function(){return this.footerVisible;};HTMLImage.prototype.setFooterVisible=function(visible){this.footerVisible=visible;if(!this.footerVisible)this.shouldHideMagnifier=false;if(this.footerDiv)this.footerDiv.className=this.footerDivClass+
(visible?" d-flex":" d-none")+
(this.noImageVisible?"":" position-absolute");};HTMLImage.prototype.setNoImageVisible=function(visible){this.noImageVisible=visible;if(this.noImage)this.noImage.className=this.noImageClass+(visible?" d-flex":" d-none");this.setFooterVisible(this.footerVisible);};HTMLImage.prototype.setImageVisible=function(visible){this.imgVisible=visible;if(this.context)this.context.className=(visible?this.contextClass:"d-none");else if(this.img)this.img.className=this.imgClass+(visible?" d-inline-block":" d-none");this.setNoImageVisible(!visible);};HTMLImage.prototype.getCriptografado=function(){return this.criptografado?"1":"0";};HTMLImage.prototype.setCriptografado=function(criptografado){this.criptografado=criptografado;};HTMLImage.prototype.getViewMode=function(){if(this.viewMode=="Estender")return"stretch";if(this.viewMode=="Centralizado")return"no-repeat";if(this.viewMode=="Repetir")return"repeat";if(this.viewMode=="Repetir na Horizontal")return"repeat-x";if(this.viewMode=="Repetir na Vertical")return"repeat-y";return"stretch";};HTMLImage.prototype.setImage=function(imageUrl,isBase64){var object=this;this.urlIsBase64=isBase64;if(imageUrl&&imageUrl.length>0&&imageUrl!="null"){this.url=imageUrl;this.hasImage=true;if(!isBase64&&imageUrl.toLowerCase().indexOf("datetime=")<0){imageUrl=(imageUrl.indexOf("?")<0?imageUrl+"?datetime=":imageUrl+"&datetime=")+
new Date().getTime();}
if(this.div)this.div.style.borderStyle=null;if(this.getViewMode()=="stretch"){if(this.img)this.img.src=imageUrl;}else{if(this.img)this.img.style.backgroundImage="url('"+imageUrl+"')";}
if(this.magnifier){if(this.zoomType==1&&this.magnifierOutsideDiv){this.magnifierOutsideDiv.style.backgroundImage="url('"+imageUrl+"')";}else if(this.zoomType==0&&this.magnifierDiv){this.magnifierDiv.style.backgroundImage="url('"+imageUrl+"')";}}
if(this.getViewMode()!="stretch"){try{var wrapperImg=new Image();wrapperImg.addEventListener("load",function(){object.imgRealWidth=wrapperImg.naturalWidth;object.imgRealHeight=wrapperImg.naturalHeight;object.updateMagnifier();});wrapperImg.src=imageUrl;}catch(e){this.updateMagnifier();}}}else{this.hasImage=false;this.imgRealWidth=0;this.imgRealHeight=0;if(this.getViewMode()=="stretch"){if(this.img)this.img.src="";}else{if(this.img)this.img.style.backgroundImage=null;}
if(this.magnifier){if(this.zoomType==1&&this.magnifierOutsideDiv){this.magnifierOutsideDiv.style.backgroundImage=null;}else if(this.zoomType==0&&this.magnifierDiv){this.magnifierDiv.style.backgroundImage=null;}
this.updateMagnifier();}}
this.updateLayout();};HTMLImage.prototype.setImageBase64=function(imageData){if(imageData){if(!imageData.startsWith("data:"))imageData="data:image/jpeg;base64,"+imageData;this.setImage(imageData,true);}};HTMLImage.prototype.flush=function(){this.divText=null;this.label=null;this.noImage=null;this.img=null;this.divUpload=null;this.divUploadIcon=null;this.divWebcam=null;this.divWebcamIcon=null;this.divZoom=null;this.divZoomIcon=null;this.callMethod(HTMLElementBase,"flush");};function HTMLAlert(){this.visible=true;this.locked=false;this.activeFilter=false;this.waiting=false;this.includeMode=false;this.alterMode=false;this.hideImages=false;this.status=new Array();}
HTMLAlert.inherits(HTMLElementBase);HTMLAlert.prototype.name='HTMLAlert';HTMLAlert.prototype.showFilter=function(v){if(!this.hideImages){if(v&&this.locked)v=!v;if(!this.filterDiv&&v)this.filterDiv=this.createAlert('FILTER',null,1,100,getLocaleMessage("LABEL.ACTIVE_FILTER"),true);if(v&&this.filterDiv.startTime)this.filterDiv.resetTimestamp();if(this.filterDiv)this.setToastVisible(this.filterDiv,v&&this.visible);this.setStatus("filter",v);}};HTMLAlert.prototype.showInclude=function(v){if(!this.hideImages){if(!this.includeDiv&&v)this.includeDiv=this.createAlert('INCLUSION',null,1,200,getLocaleMessage("LABEL.INCLUSION"),true);if(v&&this.includeDiv.startTime)this.includeDiv.resetTimestamp();if(this.includeDiv)this.setToastVisible(this.includeDiv,v&&this.visible);if(v)this.lock();this.setStatus('include',v);}};HTMLAlert.prototype.showEdit=function(v){if(!this.hideImages){if(!this.editDiv&&v)this.editDiv=this.createAlert('EDIT',null,1,200,getLocaleMessage("LABEL.ALTERATION"),true);if(v&&this.editDiv.startTime)this.editDiv.resetTimestamp();if(this.editDiv)this.setToastVisible(this.editDiv,v&&this.visible);if(v)this.lock();this.setStatus('edit',v);}};HTMLAlert.prototype.showProcessing=function(v){if(!this.hideImages){if(v){if(this.filterDiv)this.setToastVisible(this.filterDiv,false);if(this.includeDiv)this.setToastVisible(this.includeDiv,false);if(this.editDiv)this.setToastVisible(this.editDiv,false);if(this.errorDiv)this.setToastVisible(this.errorDiv,false);}
if(!this.processDiv&&v)this.processDiv=this.createAlert('WAIT',null,1,300,getLocaleMessage("LABEL.WAIT"),false);if(v&&this.processDiv.startTime)this.processDiv.resetTimestamp();if(this.processDiv)this.setToastVisible(this.processDiv,v&&this.visible);if(!v)this.recall();this.setStatus('waiting',v);}};HTMLAlert.prototype.showError=function(v){if(!this.hideImages){if(v&&this.locked)v=!v;if(!this.errorDiv&&v)this.errorDiv=this.createAlert('ERROR',showErrors,1,301,getLocaleMessage("LABEL.ERROR"),true);if(v&&this.errorDiv.startTime)this.errorDiv.resetTimestamp();if(this.errorDiv)this.setToastVisible(this.errorDiv,v);this.setStatus('error',v);}};HTMLAlert.prototype.setStatus=function(status,v){this.status[status]=v;};HTMLAlert.prototype.lock=function(){this.locked=true;};HTMLAlert.prototype.unLock=function(){this.locked=false;};HTMLAlert.prototype.recall=function(){this.showFilter(this.status["filter"]);this.showInclude(this.status["include"]);this.showEdit(this.status["edit"]);this.showError(this.status["error"]);};HTMLAlert.prototype.design=function(doc){var doc;try{doc=mainform.document;}
catch(e){doc=document;}
this.doc=doc;if(!doc.body){doc.writeln("<body></body>");}
this.div=doc.getElementById("toast-container-tr");if(!this.div){this.div=document.createElement("div");this.div.id="toast-container-tr";this.div.className="toast-container position-fixed mt-3 mr-3";this.div.style.pointerEvents="none";this.div.style.top="0px";this.div.style.right="0px";}
doc.body.appendChild(this.div);};HTMLAlert.prototype.setColor=function(color){this.color=color;};HTMLAlert.prototype.setBGColor=function(color){this.bgColor=color;};HTMLAlert.prototype.setVisible=function(v){this.visible=v;};HTMLAlert.prototype.setFont=function(f){};HTMLAlert.prototype.createAlert=function(src,oc,place,zindex,description,closeable){var object=this;var code=Math.floor(Math.random()*1000000)+1;var toastDiv=document.createElement("div");toastDiv.className="toast";toastDiv.id="toast"+code;toastDiv.setAttribute("role","alert");toastDiv.setAttribute("data-autohide","false");toastDiv.setAttribute("data-delay","1000");toastDiv.zIndex=zindex;var toastHeader=document.createElement("div");toastHeader.className="toast-header";toastDiv.appendChild(toastHeader);if(this.color){toastDiv.style.color=this.color;toastHeader.style.color=this.color;}
if(this.bgColor){toastDiv.style.backgroundColor=this.bgColor;toastHeader.style.backgroundColor=this.bgColor;}
if(src){var toastIcon,srcUpper=src.toUpperCase();if(srcUpper=="ERROR"){toastIcon=document.createElement("i");toastIcon.className="fas fa-exclamation-triangle mr-2";}else if(srcUpper=="EDIT"){toastIcon=document.createElement("i");toastIcon.className="fas fa-pencil-alt mr-2";}else if(srcUpper=="INCLUSION"){toastIcon=document.createElement("i");toastIcon.className="fas fa-plus mr-2";}else if(srcUpper=="FILTER"){toastIcon=document.createElement("i");toastIcon.className="fas fa-filter mr-2";}else if(srcUpper=="WAIT"){toastIcon=document.createElement("div");toastIcon.className="spinner-border text-secondary mr-2";toastIcon.setAttribute("role","status");toastIcon.style.width="20px";toastIcon.style.height="20px";toastIcon.innerHTML='<span class="sr-only">...</span>';toastDiv.className+=" toast-wait";}else{toastIcon=document.createElement("img");toastIcon.className="mr-2";toastIcon.id="toastIcon"+code;toastIcon.src=src;toastIcon.width=20;toastIcon.height=20;if(description)toastIcon.alt=description;}
toastHeader.appendChild(toastIcon);}
if(description){var toastTitle=document.createElement("strong");toastTitle.className="mr-auto";toastTitle.id="toastTitle"+code;toastTitle.innerHTML=description;toastHeader.appendChild(toastTitle);}
try{webrun.include("assets/moment.min.js");var lang=resources_locale.replace("_","-");if(lang.indexOf("en")!=-1)lang="en";else if(lang.indexOf("es")!=-1)lang="es";else if(lang.indexOf("fr")!=-1)lang="fr";moment.locale(lang);toastDiv.startTime=moment();var toastTimestamp=document.createElement("small");toastTimestamp.className="ml-2";toastTimestamp.innerHTML=moment(toastDiv.startTime).fromNow();toastHeader.appendChild(toastTimestamp);toastDiv.updateTimestamp=function(){if(toastDiv&&toastTimestamp){toastTimestamp.innerHTML=moment(toastDiv.startTime).fromNow();}};toastDiv.resetTimestamp=function(){if(toastDiv){toastDiv.startTime=moment();toastDiv.updateTimestamp();}};toastTimer=setInterval(function(){if(toastDiv)toastDiv.updateTimestamp();},10000);}catch(e){}
if(closeable){var toastClose=document.createElement("button");toastClose.type="button";toastClose.id="toastButton"+code;toastClose.className="ml-2 mb-1 close";toastClose.setAttribute("aria-label",getLocaleMessage("LABEL.CLOSE"));toastClose.style.outline="0";toastClose.style.zIndex="1";toastClose.innerHTML='<span aria-hidden="true">&times;</span>';toastHeader.appendChild(toastClose);toastClose.onclick=function(e){e.preventDefault();e.stopPropagation();object.setToastVisible(toastDiv,false);return false;};}
if(oc){var clickFunction=function(e){e.stopPropagation();oc();return true;};toastDiv.onclick=clickFunction;if(toastTitle)toastTitle.onclick=clickFunction;if(toastIcon)toastIcon.onclick=clickFunction;if(toastTimestamp)toastTimestamp.onclick=clickFunction;toastDiv.style.cursor="pointer";}
this.div.appendChild(toastDiv);this.setToastVisible(toastDiv,true);return toastDiv;};HTMLAlert.prototype.setToastVisible=function(toast,visible){if(visible)$(toast).toast("show");else $(toast).toast("hide");visibleDiv(toast,visible);};HTMLAlert.prototype.flush=function(){this.div=null;this.filterDiv=null;this.includeDiv=null;this.editDiv=null;if(this.errorDiv){if(this.errorDiv.onclick)this.errorDiv.onclick=null;this.errorDiv=null;}
this.processDiv=null;this.status=null;this.callMethod(HTMLElementBase,"flush");};function HTMLPermissionForm(sys,formID,width,height,formDescription){this.sys=sys;this.formID=formID;this.width=width;this.height=height;this.formDescription=formDescription;}
HTMLPermissionForm.inherits(HTMLObject);HTMLPermissionForm.prototype.name="HTMLPermissionForm";HTMLPermissionForm.prototype.zindex=1000002;HTMLPermissionForm.prototype.design=function(){this.doc=d&&d.lay?d.lay:document.getElementById("lay");this.div=document.createElement("div");this.div.id="WFRFormPerm"+this.formID;this.div.className="position-fixed d-flex flex-row align-items-stretch justify-content-center w-100 p-3";this.div.style.bottom="0px";this.div.style.right="0px";this.div.style.zIndex=this.zindex;this.div.style.pointerEvents="none";this.doc.appendChild(this.div);if(this.forms&&this.forms.length>0){this.forms=this.sorted();this.formsCombo=document.createElement("select");this.formsCombo.className="form-control w-100 mr-2";this.formsCombo.style.pointerEvents="all";this.formsCombo.style.maxWidth="15rem";this.formsCombo.parent=this;this.div.appendChild(this.formsCombo);var emptyOption=document.createElement("option");emptyOption.value="";emptyOption.selected=true;emptyOption.disabled=true;emptyOption.innerHTML="&nbsp;";this.formsCombo.appendChild(emptyOption);for(var i=0;i<this.forms.length;i++){var formOption=document.createElement("option");formOption.value=this.forms[i].guid;formOption.innerHTML=stringToHTMLString(this.forms[i].name);this.formsCombo.appendChild(formOption);}
this.openFormButton=document.createElement("button");this.openFormButton.type="button";this.openFormButton.className="btn btn-secondary";this.openFormButton.title=getLocaleMessage("LABEL.OPEN_FORM");this.openFormButton.setAttribute("data-toggle","tooltip");this.openFormButton.style.pointerEvents="all";this.openFormButton.disabled=true;this.openFormButton.parent=this;this.div.appendChild(this.openFormButton);var openFormButtonIcon=document.createElement("i");openFormButtonIcon.className="fas fa-external-link-alt";this.openFormButton.appendChild(openFormButtonIcon);this.openFormButton.addEventListener("click",function(){ebfFormOpenForm(this.parent.formsCombo.options[this.parent.formsCombo.selectedIndex].value);});this.formsCombo.addEventListener("change",function(){var selectedValue=this.parent.formsCombo.selectedIndex>=0?this.parent.formsCombo.options[this.parent.formsCombo.selectedIndex].value:null;this.parent.openFormButton.disabled=(selectedValue===null||selectedValue.length==0);});var separatorDiv=document.createElement("div");separatorDiv.className="mx-2 border-left";this.div.appendChild(separatorDiv);}
this.permissionsButton=document.createElement("div");this.permissionsButton.className="btn btn-secondary px-2";this.permissionsButton.title=getLocaleMessage("LABEL.EDIT_PERMISSIONS");this.permissionsButton.setAttribute("data-toggle","tooltip");this.permissionsButton.style.pointerEvents="all";this.permissionsButton.parent=this;this.div.appendChild(this.permissionsButton);var permissionsButtonIcon=document.createElement("i");permissionsButtonIcon.className="fas fa-key";this.permissionsButton.appendChild(permissionsButtonIcon);this.permissionsButton.addEventListener("click",function(){openFormAccess(this.parent.sys,this.parent.formID,document.title);});};HTMLPermissionForm.prototype.toString=function(){return"[object "+this.name+": "+this.formDescription+"]";};HTMLPermissionForm.prototype.sorted=function(){if(this.forms&&this.forms.length>0){return this.forms.sort(function(a,b){return a['name'].localeCompare(b['name']);});}};function HTMLShape(sys,formID,code,posX,posY,width,height,type){this.create(sys,formID,code,posX,posY,width,height,'','');this.color="#000000";this.textColor="#000000";this.bgColor="#FFFF00";this.shapes=new Array();this.type=type;this.stroke=1;}
HTMLShape.inherits(HTMLElementBase);HTMLShape.prototype.loadScripts=function(){webrun.include("components/dojo/dojo.js");dojo.baseUrl='components/dojo/';dojo.require('dojox.gfx');}
HTMLShape.prototype.name='HTMLShape';HTMLShape.prototype.tabable=false;HTMLShape.prototype.BALLOON_RADIX=30;HTMLShape.prototype.COMMENT_RADIX=20;HTMLShape.prototype.ARROW_RADIX=8;HTMLShape.prototype.CIRCLE_TYPE=1;HTMLShape.prototype.RECT_TYPE=2;HTMLShape.prototype.DIAMOND_TYPE=3;HTMLShape.prototype.BALLOON_TYPE=4;HTMLShape.prototype.COMMENT_TYPE=5;HTMLShape.prototype.SUBRULE_TYPE=6;HTMLShape.prototype.ENDCIRCLE_TYPE=7;HTMLShape.prototype.setDescription=function(v){this.description=v;if(!this.divText){if(v&&v.length>0){this.divText=this.getDiv('',0,0,this.width,this.height,6,true);this.divText.style.cursor='pointer';var table=getTable(1,1,'100%','100%');this.label=getLabel(v,true);this.label.style.color=this.textColor;table[CELLS][0][0].setAttribute('align','center');table[CELLS][0][0].setAttribute('valign','middle');table[CELLS][0][0].appendChild(this.label);this.divText.appendChild(table[TABLE]);this.context.appendChild(this.divText);this.label.onmousedown=function(){return false;};this.label.onselectstart=function(){return false;};}}else{if(v&&v.length>0){this.label.innerHTML=v;}else{this.context.removeChild(this.divText);this.divText=null;this.label=null;}}}
HTMLShape.prototype.getDescription=function(){return this.description;}
HTMLShape.prototype.setFont=function(f){if(this.label)
this.label.style.fontFamily=f;}
HTMLShape.prototype.setSize=function(s){if(s.indexOf("pt")==-1)
s+="pt";if(this.label)
this.label.style.fontSize=s;}
HTMLShape.prototype.setWeight=function(w){if(this.label){if(w)this.label.style.fontWeight="bold";else this.label.style.fontWeight="normal";}}
HTMLShape.prototype.setItalic=function(w){if(this.label){if(w)this.label.style.fontStyle="italic";else this.label.style.fontStyle="normal";}}
HTMLShape.prototype.setUnderline=function(u){if(this.label){if(u)this.label.style.textDecoration="underline";else this.label.style.textDecoration="none";}}
HTMLShape.prototype.setStrikeout=function(st){if(this.label){if(st)this.label.style.textDecoration="line-through";else this.label.style.textDecoration="none";}}
HTMLShape.prototype.setTextDecoration=function(){if(this.label){var textDecoration="";if(this.underline||this.strikeout){if(this.underline){textDecoration+="underline";}
if(this.strikeout){textDecoration+=" line-through";}}else{textDecoration="none";}
this.label.style.textDecoration=textDecoration;}}
HTMLShape.prototype.setColor=function(color){this.color=color;}
HTMLShape.prototype.setTextColor=function(color){this.textColor=color;if(this.label)this.label.style.color=color;}
HTMLShape.prototype.setBGColor=function(color){this.bgColor=color;}
HTMLShape.prototype.setWidth=function(w){w=parseInt(w);this.callMethod(HTMLElementBase,'setWidth',[w]);for(var id in this.shapes){var shape=this.shapes[id];if(shape._resizeWidth)
shape._resizeWidth.call(this,shape,w,this.height);}
if(this.divText)this.divText.style.width=w+"px";}
HTMLShape.prototype.setHeight=function(h){h=parseInt(h);this.callMethod(HTMLElementBase,'setHeight',[h]);for(var id in this.shapes){var shape=this.shapes[id];if(shape._resizeHeight)
shape._resizeHeight.call(this,shape,this.width,h);}
if(this.divText)this.divText.style.height=h+"px";}
HTMLShape.prototype.getDefault=function(){if(this.useDefaultColors){this.color=this.colorDefault;this.textColor=this.textColorDefault;this.bgColor=this.bgColorDefault;}}
HTMLShape.prototype.getCodeType=function(){return this.codeType;}
HTMLShape.prototype.isCircle=function(){return this.codeType==this.CIRCLE_TYPE;}
HTMLShape.prototype.isRect=function(){return this.codeType==this.RECT_TYPE;}
HTMLShape.prototype.isDiamond=function(){return this.codeType==this.DIAMOND_TYPE;}
HTMLShape.prototype.isBalloon=function(){return this.codeType==this.BALLOON_TYPE;}
HTMLShape.prototype.isComment=function(){return this.codeType==this.COMMENT_TYPE;}
HTMLShape.prototype.isSubRule=function(){return this.codeType==this.SUBRULE_TYPE;}
HTMLShape.prototype.isEndCircle=function(){return this.codeType==this.ENDCIRCLE_TYPE;}
HTMLShape.prototype.designComponent=function(doc){this.surface=dojox.gfx.createSurface(this.context,IE?this.width:'100%',IE?this.height:'100%');this.surface_size=this.surface.getDimensions();this.surface_size.width=parseInt(this.surface_size.width);this.surface_size.height=parseInt(this.surface_size.height);var regexp=/^(.+[^\d])\d*$/;if(regexp.test(this.type)){this.type=RegExp.$1;}
if(this.type){switch(this.type){case'CIRCLE':case'FlowStart':{this.colorDefault='#FFFFFF';this.bgColorDefault='#000000';this.textColorDefault='#FFFFFF';this.getDefault();this.timeout(this.drawCircle,0);this.resizeProportional=true;this.codeType=this.CIRCLE_TYPE;break;}
case'RECT':case'FlowExpression':{this.colorDefault='#2dc128';this.bgColorDefault='#dbf7da';this.textColorDefault='#000000';this.getDefault();this.timeout(this.drawRect,0);this.codeType=this.RECT_TYPE;break;}
case'DIAMOND':case'FlowDecision':{this.colorDefault='#ff0000';this.bgColorDefault='#ffdede';this.textColorDefault='#000000';this.getDefault();this.timeout(this.drawDiamond,0);this.codeType=this.DIAMOND_TYPE;break;}
case'BALLOON':case'FlowActivity':{this.colorDefault='#000080';this.bgColorDefault='#dce6fa';this.textColorDefault='#000000';this.getDefault();this.minWidth=this.BALLOON_RADIX*2+1;this.minHeight=this.BALLOON_RADIX*2+1;this.timeout(this.drawBalloon,0);this.codeType=this.BALLOON_TYPE;break;}
case'COMMENT':case'FlowRemark':{this.colorDefault='#800000';this.bgColorDefault='#eddcdc';this.textColorDefault='#000000';this.getDefault();this.timeout(this.drawComment,0);this.codeType=this.COMMENT_TYPE;break;}
case'SUBRULE':case'FlowSubRoutine':{this.colorDefault='#ff8000';this.bgColorDefault='#f8f5cb';this.textColorDefault='#000000';this.getDefault();this.timeout(this.drawSubRule,0);this.codeType=this.SUBRULE_TYPE;break;}
case'ENDCIRCLE':case'FlowEnd':{this.colorDefault='#000000';this.bgColorDefault='#000000';this.textColorDefault='#FFFFFF';this.getDefault();this.timeout(this.drawEndCircle,0);this.resizeProportional=true;this.codeType=this.ENDCIRCLE_TYPE;break;}}}
this.setDescription(this.description);}
HTMLShape.prototype.drawRect=function(id){var aShape=this.surface.createRect({x:this.stroke,y:this.stroke,width:(this.width-(this.stroke*2)),height:(this.height-(this.stroke*2))});if(this.stroke)aShape.setStroke({color:this.color,width:this.stroke});aShape.setFill(this.bgColor);var resize=function(shape){shape.setShape({x:this.stroke,y:this.stroke,width:this.width-(this.stroke*2),height:this.height-(this.stroke*2)});shape.setFill(this.bgColor);};aShape._resizeWidth=resize;aShape._resizeHeight=resize;this.connectEvents();this.shapes['Main']=aShape;return aShape;}
HTMLShape.prototype.drawSubRule=function(){var aShape=this.surface.createRect({x:this.stroke,y:this.stroke,width:this.width-(this.stroke*2),height:this.height-(this.stroke*2)});if(this.stroke)aShape.setStroke({color:this.color,width:this.stroke});aShape.setFill(this.bgColor);var l1=this.surface.createPolyline([{x:15,y:this.stroke},{x:15,y:this.height-this.stroke}]);l1.setStroke({color:this.color,width:this.stroke});var l2=this.surface.createPolyline([{x:this.width-15,y:this.stroke},{x:this.width-15,y:this.height-this.stroke}]);l2.setStroke({color:this.color,width:this.stroke});aShape._l1=l1;aShape._l2=l2;var resize=function(shape){shape.setShape({x:this.stroke,y:this.stroke,width:this.width-(this.stroke*2),height:this.height-(this.stroke*2)});shape._l1.setShape([{x:15,y:this.stroke},{x:15,y:this.height-this.stroke}]);shape._l2.setShape([{x:this.width-15,y:this.stroke},{x:this.width-15,y:this.height-this.stroke}]);};aShape._resizeWidth=resize;aShape._resizeHeight=resize;this.connectEvents();this.shapes['Main']=aShape;return aShape;}
HTMLShape.prototype.drawCircle=function(){var aShape=this.surface.createEllipse({cx:this.width/2,cy:this.height/2,rx:(this.width/2)-this.stroke,ry:(this.height/2)-this.stroke});aShape.setStroke({color:this.color,width:this.stroke});aShape.setFill(this.bgColor);var resize=function(shape){shape.setShape({cx:this.width/2,cy:this.height/2,rx:(this.width/2)-this.stroke,ry:(this.height/2)-this.stroke})};aShape._resizeWidth=resize;aShape._resizeHeight=resize;this.connectEvents();this.shapes['Main']=aShape;return aShape;}
HTMLShape.prototype.drawEndCircle=function(){var aShape=this.surface.createEllipse({cx:this.width/2,cy:this.height/2,rx:(this.width/2)-this.stroke,ry:(this.height/2)-this.stroke});if(this.stroke)aShape.setStroke({color:this.color,width:this.stroke});var innerCircle=this.surface.createEllipse({cx:this.width/2,cy:this.height/2,rx:((this.width/2)-this.stroke)-5,ry:((this.height/2)-this.stroke)-5});innerCircle.setStroke({color:this.color,width:this.stroke});innerCircle.setFill(this.bgColor);var resize=function(shape){shape.setShape({cx:this.width/2,cy:this.height/2,rx:(this.width/2)-this.stroke,ry:(this.height/2)-this.stroke})
shape._innerCircle.setShape({cx:this.width/2,cy:this.height/2,rx:((this.width/2)-this.stroke)-5,ry:((this.height/2)-this.stroke)-5});};aShape._resizeWidth=resize;aShape._resizeHeight=resize;aShape._innerCircle=innerCircle;this.connectEvents();this.shapes['Main']=aShape;return aShape;}
HTMLShape.prototype.drawDiamond=function(){var aShape=this.surface.createPolyline([{x:0,y:parseInt(this.height/2)},{x:parseInt(this.width/2),y:0},{x:this.width,y:parseInt(this.height/2)},{x:parseInt(this.width/2),y:this.height},{x:0,y:parseInt(this.height/2)}]);aShape.setStroke({color:this.color,width:this.stroke?this.stroke:1});aShape.setFill(this.bgColor);aShape._resizeWidth=function(shape){shape.setShape([{x:0,y:parseInt(this.height/2)},{x:parseInt(this.width/2),y:0},{x:this.width,y:parseInt(this.height/2)},{x:parseInt(this.width/2),y:this.height},{x:0,y:parseInt(this.height/2)}])}
aShape._resizeHeight=function(shape){shape.setShape([{x:0,y:parseInt(this.height/2)},{x:parseInt(this.width/2),y:0},{x:this.width,y:parseInt(this.height/2)},{x:parseInt(this.width/2),y:this.height},{x:0,y:parseInt(this.height/2)}])}
this.connectEvents();this.shapes['Main']=aShape;return aShape;}
HTMLShape.prototype.drawComment=function(){var aShape=this.surface.createPolyline([{x:this.COMMENT_RADIX,y:this.stroke},{x:this.width-this.stroke,y:this.stroke},{x:this.width-this.stroke,y:this.height-this.stroke},{x:this.stroke,y:this.height-this.stroke},{x:this.stroke,y:this.COMMENT_RADIX},{x:this.COMMENT_RADIX,y:this.stroke+1},{x:this.COMMENT_RADIX,y:this.COMMENT_RADIX},{x:this.stroke,y:this.COMMENT_RADIX}]);if(this.stroke)aShape.setStroke({color:this.color,width:this.stroke});aShape.setFill(this.bgColor);var resize=function(shape){shape.setShape([{x:this.COMMENT_RADIX,y:this.stroke},{x:this.width-this.stroke,y:this.stroke},{x:this.width-this.stroke,y:this.height-this.stroke},{x:this.stroke,y:this.height-this.stroke},{x:this.stroke,y:this.COMMENT_RADIX},{x:this.COMMENT_RADIX,y:this.stroke},{x:this.COMMENT_RADIX,y:this.COMMENT_RADIX},{x:this.stroke,y:this.COMMENT_RADIX}]);};aShape._resizeWidth=resize;aShape._resizeHeight=resize;this.connectEvents();this.shapes['Main']=aShape;return aShape;}
HTMLShape.prototype.drawBalloon=function(){var aShape=this.surface.createRect({x:this.stroke,y:this.stroke,width:this.width-(this.stroke*2),height:this.height-(this.stroke*2),r:this.BALLOON_RADIX});aShape.setStroke({color:this.color,width:this.stroke});aShape.setFill(this.bgColor);var resize=function(shape){shape.setShape({x:this.stroke,y:this.stroke,width:this.width-(this.stroke*2),height:this.height-(this.stroke*2),r:this.BALLOON_RADIX})
shape.setFill(this.bgColor);};aShape._resizeWidth=resize;aShape._resizeHeight=resize;this.connectEvents();this.shapes['Main']=aShape;return aShape;}
HTMLShape.prototype.drawLine=function(id,x1,y1,x2,y2){var aShape=this.surface.createLine({x1:x1,y1:y1,x2:x2,y2:y2});aShape.setStroke({color:this.color,width:this.stroke&&this.stroke>0?this.stroke:2});aShape._id=id;aShape.isLine=function(){return true;}
aShape.toString=function(){return'[HTMLShape # Line: '+this._id+']';}
this.connectEvents();this.shapes[id]=aShape;return aShape;}
HTMLShape.prototype.ARROW_FROM=-1;HTMLShape.prototype.ARROW_TO=1;HTMLShape.prototype.getIntersectionPoint=function(fromShape,toShape,directionType){if(directionType==this.ARROW_FROM){var aux=fromShape;fromShape=toShape;toShape=aux;}
var x1=fromShape.getX()+fromShape.getWidth()/2;var y1=fromShape.getY()+fromShape.getHeight()/2;var w=toShape.getWidth();var h=toShape.getHeight();var x2=toShape.getX()+w/2;var y2=toShape.getY()+h/2;var r=this.ARROW_RADIX;var a=0;var b=0;var xt1=0;var yt1=0;var xt2=0;var yt2=0;var xt3=0;var yt3=0;var ms=null;var ns=null;var mr=null;var nr=null;if(toShape.isRect()||toShape.isBalloon()||toShape.isSubRule()||toShape.isComment()){var xa=0;var ya=0;var xe=x2-(w/2);var xd=x2+(w/2);var yi=y2-(h/2);var ys=y2+(h/2);var min=Number.MAX_VALUE;var ye=((y2-y1)/(x2-x1))*xe+((x2*y1-x1*y2)/(x2-x1));var de2=null;if(ye<=ys&&ye>=yi)
de2=Math.pow(x1-xe,2)+Math.pow(y1-ye,2);if(de2&&de2<min){xa=xe;ya=ye;min=de2;}
var xs=((ys*(x2-x1))+(x1*y2-x2*y1))/(y2-y1);var ds2=null;if(xs<=xd&&xs>=xe)
ds2=Math.pow(x1-xs,2)+Math.pow(y1-ys,2);if(ds2&&ds2<min){xa=xs;ya=ys;min=ds2;}
var yd=(xd*((y2-y1)/(x2-x1)))+((x2*y1-x1*y2)/(x2-x1))
var dd2=null;if(yd<=ys&&yd>=yi)
dd2=Math.pow(x1-xd,2)+Math.pow(y1-yd,2);if(dd2&&dd2<min){xa=xd;ya=yd;min=dd2;}
var xi=((yi*(x2-x1))+(x1*y2-x2*y1))/(y2-y1);var di2=null;if(xi<=xd&&xi>=xe)
di2=Math.pow(x1-xi,2)+Math.pow(y1-yi,2);if(di2&&di2<min){xa=xi;ya=yi;min=di2;}
var mr=(y2-y1)/(x2-x1);var nr=((x2*y1)-(x1*y2))/(x2-x1);if(toShape.isComment()&&xa>=xe&&xa<=(xe+this.COMMENT_RADIX)&&ya>=yi&&ya<=(yi+this.COMMENT_RADIX)){var x=(yi+xe+this.COMMENT_RADIX-nr)/(mr+1);var y=(mr*x)+nr;var d2=null;if(x>=xe&&x<=(xe+this.COMMENT_RADIX)&&y>=yi&&y<=(yi+this.COMMENT_RADIX))
d2=Math.pow(x1-x,2)+Math.pow(y1-y,2);xa=x;ya=y;min=d2;}
if(toShape.isBalloon()){var min=Number.MAX_VALUE;var tempX=0;var tempY=0;var radix=this.BALLOON_RADIX;var za=0;var zb=0;var zc=0;var zd=0;var bxa=x2-(w/2)+radix;var bya=y2+(h/2);var bxb=x2+(w/2)-radix;var bxc=x2+(w/2);var byc=y2+(h/2)-radix;var byd=y2-(h/2)+radix;var bye=y2-(h/2);var bxh=x2-(w/2);if(x1==x2){xt3=x2;yt3=(y2>=y1)?y2-(h/2):y2+(h/2);a=x2;b=(y2>=y1)?yt3-r:yt3+r;}else{var mr=(y2-y1)/(x2-x1);var nr=((x2*y1)-(x1*y2))/(x2-x1);za=1+(mr*mr);zb=2*((mr*nr)-bxa-(byc*mr));zc=(bxa*bxa)+(byc*byc)+(nr*nr)-(radix*radix)-(2*byc*nr);zd=(zb*zb)-(4*za*zc);tempX=(-zb+Math.sqrt(zd))/(2*za);tempY=(mr*tempX)+nr;var dlambda11=null;if(tempX<=bxa&&tempX>=(bxa-radix)&&tempY<=bya&&tempY>=byc){dlambda11=Math.pow(x1-tempX,2)+Math.pow(y1-tempY,2);}
if(dlambda11&&dlambda11<min){xa=tempX;ya=tempY;min=dlambda11;}
tempX=(-zb-Math.sqrt(zd))/(2*za);tempY=(mr*tempX)+nr;var dlambda12=null;if(tempX<=bxa&&tempX>=(bxa-radix)&&tempY<=bya&&tempY>=byc){dlambda12=Math.pow(x1-tempX,2)+Math.pow(y1-tempY,2);}
if(dlambda12&&dlambda12<min){xa=tempX;ya=tempY;min=dlambda12;}
za=1+(mr*mr);zb=2*((mr*nr)-bxb-(byc*mr));zc=(bxb*bxb)+(byc*byc)+(nr*nr)-(radix*radix)-(2*byc*nr);zd=(zb*zb)-(4*za*zc);tempX=(-zb+Math.sqrt(zd))/(2*za);tempY=(mr*tempX)+nr;var dlambda21=null;if(tempX<=bxc&&tempX>=bxb&&tempY<=bya&&tempY>=byc){dlambda21=Math.pow(x1-tempX,2)+Math.pow(y1-tempY,2);}
if(dlambda21&&dlambda21<min){xa=tempX;ya=tempY;min=dlambda21;}
tempX=(-zb-Math.sqrt(zd))/(2*za);tempY=(mr*tempX)+nr;var dlambda22=null;if(tempX<=bxc&&tempX>=bxb&&tempY<=bya&&tempY>=byc){dlambda22=Math.pow(x1-tempX,2)+Math.pow(y1-tempY,2);}
if(dlambda22&&dlambda22<min){xa=tempX;ya=tempY;min=dlambda22;}
za=1+(mr*mr);zb=2*((mr*nr)-bxb-(byd*mr));zc=(bxb*bxb)+(byd*byd)+(nr*nr)-(radix*radix)-(2*byd*nr);zd=(zb*zb)-(4*za*zc);tempX=(-zb+Math.sqrt(zd))/(2*za);tempY=(mr*tempX)+nr;var dlambda31=null;if(tempX<=bxc&&tempX>=bxb&&tempY<=byd&&tempY>=bye){dlambda31=Math.pow(x1-tempX,2)+Math.pow(y1-tempY,2);}
if(dlambda31&&dlambda31<min){xa=tempX;ya=tempY;min=dlambda31;}
tempX=(-zb-Math.sqrt(zd))/(2*za);tempY=(mr*tempX)+nr;var dlambda32=null;if(tempX<=bxc&&tempX>=bxb&&tempY<=byd&&tempY>=bye){dlambda32=Math.pow(x1-tempX,2)+Math.pow(y1-tempY,2);}
if(dlambda32&&dlambda32<min){xa=tempX;ya=tempY;min=dlambda32;}
za=1+(mr*mr);zb=2*((mr*nr)-bxa-(byd*mr));zc=(bxa*bxa)+(byd*byd)+(nr*nr)-(radix*radix)-(2*byd*nr);zd=(zb*zb)-(4*za*zc);tempX=(-zb+Math.sqrt(zd))/(2*za);tempY=(mr*tempX)+nr;var dlambda41=null;if(tempX<=bxa&&tempX>=bxh&&tempY<=byd&&tempY>=bye){dlambda41=Math.pow(x1-tempX,2)+Math.pow(y1-tempY,2);}
if(dlambda41&&dlambda41<min){xa=tempX;ya=tempY;min=dlambda41;}
tempX=(-zb-Math.sqrt(zd))/(2*za);tempY=(mr*tempX)+nr;var dlambda42=null;if(tempX<=bxa&&tempX>=bxh&&tempY<=byd&&tempY>=bye){dlambda42=Math.pow(x1-tempX,2)+Math.pow(y1-tempY,2);}
if(dlambda42&&dlambda42<min){xa=tempX;ya=tempY;min=dlambda42;}
var dp1p2=Math.abs(Math.sqrt(Math.pow(x1-xa,2)+Math.pow(y1-ya,2)));var ni=(r*(xa-x1))/dp1p2;a=xa-ni;b=(mr*a)+nr;xt3=xa;yt3=ya;ns=b+(a/mr);}}
var dp1p2=Math.abs(Math.sqrt(Math.pow(x1-xa,2)+Math.pow(y1-ya,2)));var ni=(r*(xa-x1))/dp1p2;if(x1==x2){a=x2;b=(y2>=y1)?ya-r:ya+r;}else{a=xa-ni;b=(mr*a)+nr;xt3=xa;yt3=ya;ns=b+(a/mr);}}else if(toShape.isCircle()||toShape.isEndCircle()){var min=Number.MAX_VALUE;var tempX=0;var tempY=0;var dd2=0;var radix=w/2;if(x1==x2){xt3=x2;yt3=(y2>=y1)?y2-radix:y2+radix;a=x2;b=(y2>=y1)?yt3-r:yt3+r;}else{var mr=(y2-y1)/(x2-x1);var nr=((x2*y1)-(x1*y2))/(x2-x1);var za=1+(mr*mr);var zb=2*((mr*nr)-x2-(y2*mr));var zc=(x2*x2)+(nr*nr)+(y2*y2)-(radix*radix)-(2*y2*nr);var zd=(zb*zb)-(4*za*zc);tempX=(-zb+Math.sqrt(zd))/(2*za);tempY=(mr*tempX)+nr;dd2=Math.pow(x1-tempX,2)+Math.pow(y1-tempY,2);if(dd2&&dd2<min){xa=tempX;ya=tempY;min=dd2;}
tempX=(-zb-Math.sqrt(zd))/(2*za);tempY=(mr*tempX)+nr;dd2=Math.pow(x1-tempX,2)+Math.pow(y1-tempY,2);if(dd2&&dd2<min){xa=tempX;ya=tempY;min=dd2;}
var dp1p2=Math.abs(Math.sqrt(Math.pow(x1-xa,2)+Math.pow(y1-ya,2)));var ni=(r*(xa-x1))/dp1p2;a=xa-ni;b=(mr*a)+nr;xt3=xa;yt3=ya;ns=b+(a/mr);}}else if(toShape.isDiamond()){w+=2*this.stroke;h+=2*this.stroke;var xa=0;var ya=0;var xpa=x2;var ypa=y2+(h/2);var xpb=x2+(w/2);var ypb=y2;var xpc=x2;var ypc=y2-(h/2);var xpd=x2-(w/2);var ypd=y2;var min=Number.MAX_VALUE;var tempX=0;var tempY=0;var mr=(y2-y1)/(x2-x1);var nr=((x2*y1)-(x1*y2))/(x2-x1);tempX=(y2+(h/2)-((h*x2)/w)-nr)/(mr-(h/w));tempY=mr*tempX+nr;var dda2=null;if(tempY<=ypa&&tempY>=ypd&&tempX<=x2&&tempX>=xpd)
dda2=Math.pow(x1-tempX,2)+Math.pow(y1-tempY,2);if(dda2&&dda2<min){xa=tempX;ya=tempY;min=dda2;}
tempX=(((h*x2)/w)+y2+(h/2)-nr)/(mr+(h/w));tempY=mr*tempX+nr;var ddb2=null;if(tempY<=ypa&&tempY>=ypb&&tempX<=xpb&&tempX>=x2)
ddb2=Math.pow(x1-tempX,2)+Math.pow(y1-tempY,2);if(ddb2&&ddb2<min){xa=tempX;ya=tempY;min=ddb2;}
tempX=(y2-(h/2)-((h*x2)/w)-nr)/(mr-(h/w));tempY=mr*tempX+nr;var ddc2=null;if(tempY<=ypb&&tempY>=ypc&&tempX<=xpb&&tempX>=x2)
ddc2=Math.pow(x1-tempX,2)+Math.pow(y1-tempY,2);if(ddc2&&ddc2<min){xa=tempX;ya=tempY;min=ddc2;}
tempX=(((h*x2)/w)+y2-(h/2)-nr)/(mr+(h/w));tempY=mr*tempX+nr;var ddd2=null;if(tempY<=ypd&&tempY>=ypc&&tempX<=x2&&tempX>=xpd)
ddd2=Math.pow(x1-tempX,2)+Math.pow(y1-tempY,2);if(ddd2&&ddd2<min){xa=tempX;ya=tempY;min=ddd2;}
var dp1p2=Math.abs(Math.sqrt(Math.pow(x1-xa,2)+Math.pow(y1-ya,2)));var ni=(r*(xa-x1))/dp1p2;if(x1==x2){xt3=x2;yt3=(y2>=y1)?y2-(h/2):y2+(h/2);a=x2;b=(y2>=y1)?yt3-r:yt3+r;}else{a=xa-ni;b=(mr*a)+nr;xt3=xa;yt3=ya;ns=b+(a/mr);}}else{a=(x1+x2)/2;b=(y1+y2)/2;}
if(x1==x2||y1==y2){if(x1==x2){if(directionType!=this.ARROW_FROM){xt1=(a-r);yt1=b;xt2=a+r;yt2=b;}
xt3=a;yt3=(y2>=y1)?b+r:b-r;}else if(y1==y2){if(directionType!=this.ARROW_FROM){xt1=a;yt1=y1+r;xt2=a;yt2=b-r;}
xt3=(x2>=x1)?a+r:a-r;yt3=b;}}else{ms=(x2-x1)/(y1-y2);if(!ns)ns=((y1+y2)/2)-((x1+x2)/2)*((x2-x1)/(y1-y2));mr=(y2-y1)/(x2-x1);nr=((x2*y1)-(x1*y2))/(x2-x1);var delta1=Math.pow(((ms*ns)-a-(b*ms)),2);var delta2=(Math.pow(ms,2)+1)*(Math.pow(a,2)+Math.pow(b,2)+Math.pow(ns,2)-(2*b*ns)-Math.pow(r,2));var deltaRaiz=Math.sqrt(delta1-delta2);if(directionType!=this.ARROW_FROM){xt1=(a+(ms*(b-ns))+deltaRaiz)/(Math.pow(ms,2)+1);xt2=(a+(ms*(b-ns))-deltaRaiz)/(Math.pow(ms,2)+1);yt1=(ms*xt1)+ns;yt2=(ms*xt2)+ns;}
delta1=Math.pow(((mr*nr)-a-(b*mr)),2);delta2=(Math.pow(mr,2)+1)*(Math.pow(a,2)+Math.pow(b,2)+Math.pow(nr,2)-(2*b*nr)-Math.pow(r,2));deltaRaiz=Math.sqrt(delta1-delta2);if(!toShape&&x2<=x1){xt3=(a+(mr*(b-nr))-deltaRaiz)/(Math.pow(mr,2)+1);yt3=(mr*xt3)+nr;}
if(!xt3)xt3=(a+(mr*(b-nr))+deltaRaiz)/(Math.pow(mr,2)+1);if(!yt3)yt3=(mr*xt3)+nr;}
return[{x:xt1,y:yt1},{x:xt2,y:yt2},{x:xt3,y:yt3},{x:xt1,y:yt1}];}
HTMLShape.prototype.getArrowPoints=function(fromShape,toShape){var fromObj=this.getIntersectionPoint(fromShape,toShape,this.ARROW_FROM);var toObj=this.getIntersectionPoint(fromShape,toShape,this.ARROW_TO);return[fromObj,toObj];}
HTMLShape.prototype.drawArrowLine=function(id,fromShape,toShape,text){var intersectionPoints=this.getArrowPoints(fromShape,toShape);var fromIntersection=intersectionPoints[0];var toIntersection=intersectionPoints[1];var x1=fromIntersection[2].x;var y1=fromIntersection[2].y;var x2=toIntersection[2].x;var y2=toIntersection[2].y;var aShape=this.surface.createLine({x1:x1,y1:y1,x2:x2,y2:y2});aShape.setStroke({color:this.color,width:this.stroke?this.stroke:1});this.connectEvents();this.shapes[id]=aShape;var arrow=this.surface.createPolyline(toIntersection);if(this.stroke)arrow.setStroke({color:this.color,width:this.stroke});arrow.setFill(this.bgColor);aShape._id=id;aShape.getId=function(){return this._id;}
aShape.toString=function(){return'[HTMLShape # ArrowLine: '+this._id+']';}
aShape.attachEvent=this.attachEvent;aShape.arrow=arrow;aShape._fromShape=fromShape;aShape._toShape=toShape;aShape._div=this.div;aShape.fromIntersection=fromIntersection;aShape.toIntersection=toIntersection;aShape.isArrowLine=function(){return true;}
aShape.setText=function(text){if(text){if(this.textDiv){this._div.removeChild(this.textDiv);this.textDiv=null;}
var x1=fromIntersection[2].x;var y1=fromIntersection[2].y;var x2=toIntersection[2].x;var y2=toIntersection[2].y;var cx=(x2+x1)/2;var cy=(y2+y1)/2;var textDiv=getTextDiv(text,cx,cy);this._div.appendChild(textDiv);this.textDiv=textDiv;this.moveText=function(x1,y1,x2,y2){var w=this.textDiv.firstChild.offsetWidth;var h=this.textDiv.firstChild.offsetHeight;var mr=(y2-y1)/(x2-x1);var eixoy=parseInt(x1)==parseInt(x2);var eixox=parseInt(y1)==parseInt(y2);var cx;var cy;if(eixoy){cx=x1+2;cy=((y1+y2)/2)-(h/2);mr=0;}else if(eixox){cx=((x1+x2)/2)-(w/2);cy=y1+2;}else{if(mr<0){cx=((x1+x2)/2);cy=((y1+y2)/2);}else if(mr>0){cy=((y1+y2)/2)-h;cx=((x1+x2)/2);}}
this.textDiv.style.left=cx+'px';this.textDiv.style.top=cy+'px';}
this.moveText(x1,y1,x2,y2);}}
aShape.setText(text);aShape.free=this.getActionFunction(this.freeArrowLineAction,[aShape]);dojo.connect(aShape.getEventSource(),"onmouseover",aShape,this.getActionFunction(this.onMouseOverArrowLine,[aShape]));dojo.connect(aShape.getEventSource(),"onmouseout",aShape,this.getActionFunction(this.onMouseOutArrowLine,[aShape]));dojo.connect(aShape.getEventSource(),"onclick",aShape,this.getActionFunction(this.onClickArrowLine,[aShape]));return aShape;}
HTMLShape.prototype.freeArrowLineAction=function(e,shape){this.clean(shape);}
HTMLShape.prototype.onMouseOverArrowLine=function(e,shape){shape.setStroke({color:'#FF0000',width:3});}
HTMLShape.prototype.onMouseOutArrowLine=function(e,shape){if(this.selectedArrowLine!=shape)
shape.setStroke({color:this.color,width:this.stroke});}
HTMLShape.prototype.onClickArrowLine=function(e,shape){if(this.selectedArrowLine)
this.selectedArrowLine.setStroke({color:this.color,width:this.stroke});this.selectedArrowLine=shape;shape.setStroke({color:'#FF0000',width:3});this.attachEvent(document,'mousedown',this.unSelectArrowLine,this,[shape]);controller.setSelectedComponent(shape);}
HTMLShape.prototype.unSelectArrowLine=function(e,o,shape){this.removeEvent(document,'mousedown');this.selectedArrowLine.setStroke({color:this.color,width:this.stroke});this.selectedArrowLine=null;controller.setSelectedComponent(null);}
HTMLShape.prototype.drawPolyline=function(id,shape){var aShape=this.surface.createPolyline(shape);if(this.stroke)aShape.setStroke({color:this.color,width:this.stroke});aShape.setFill(this.bgColor);this.connectEvents();this.shapes[id]=aShape;return aShape;}
HTMLShape.prototype.connectEvents=function(aShape){if(aShape){dojo.event.connect(aShape.getEventSource(),"ondblclick",this.getActionFunction(this.ondblclick));dojo.event.connect(aShape.getEventSource(),"onclick",this.getActionFunction(this.onclick));dojo.event.connect(aShape.getEventSource(),"onmouseover",this.getActionFunction(this.onmouseover));dojo.event.connect(aShape.getEventSource(),"onmouseout",this.getActionFunction(this.onmouseout));}}
HTMLShape.prototype.move=function(obj,attributes){var shape;if(typeof obj=="string"){shape=this.getShape(obj);}else{shape=obj;}
if(shape){shape.setShape(attributes);}
return shape;}
HTMLShape.prototype.moveCircle=function(name,x,y){this.move(name,{cx:x,cy:y});}
HTMLShape.prototype.movePolyline=function(name,shape){this.move(name,shape);}
HTMLShape.prototype.moveLine=function(name,x1,y1,x2,y2){this.move(name,[{x:x1,y:y1},{x:x2,y:y2}]);}
HTMLShape.prototype.moveArrowLine=function(name,fromShape,toShape){var intersectionPoints=this.getArrowPoints(fromShape,toShape);var fromIntersection=intersectionPoints[0];var toIntersection=intersectionPoints[1];var x1=fromIntersection[2].x;var y1=fromIntersection[2].y;var x2=toIntersection[2].x;var y2=toIntersection[2].y;var tempShape=this.move(name,{x1:x1,y1:y1,x2:x2,y2:y2});tempShape.arrow.setShape(toIntersection);if(tempShape.textDiv)
tempShape.moveText(x1,y1,x2,y2);}
HTMLShape.prototype.getSurface=function(){return this.surface;}
HTMLShape.prototype.clean=function(name){var shape=typeof(name)=='string'?this.getShape(name):name;if(shape){if(shape.ondelete)
shape.ondelete.call(this,null);this.surface.remove(shape);this.shapes[name]=null;if(shape.arrow)
this.surface.remove(shape.arrow);if(shape.textDiv)
shape.textDiv.parentNode.removeChild(shape.textDiv);}}
HTMLShape.prototype.getShape=function(id){return this.shapes[id];}
HTMLShape.prototype.getId=function(){if(this.isArrowLine){return this._id;}else{return this.id;}}
HTMLShape.prototype.focus=function(){return false;}
HTMLShape.prototype.blur=function(){return false;}
function HTMLTreeview(sys,formID,code,posX,posY,width,height,value){this.create(sys,formID,code,posX,posY,width,height,'',value);this.type=1;this.maxCode=0;this.id=value;this.idCount=1;this.border=true;this._id=value;this._objectId="Bs_Tree_"+value;this.tree=this;this._tree=this;this.useRadioButton=false;this.useFolderIcon=true;this.useLeaf=true;this.walkTree=true;this.useAutoSequence=true;this.draggable=false;this.imageDir='';}
HTMLTreeview.inherits(HTMLElementBase);HTMLTreeview.prototype.name='HTMLTreeview';HTMLTreeview.prototype.tabable=false;HTMLTreeview.prototype.zindex=100000;HTMLTreeview.prototype.imageHeight=24;HTMLTreeview.prototype.clean=function(){if(this.children&&this.children.length>0){for(var i=0;i<this.children.length;i++){var node=this.children[i];node.deleteSelf();}}
this.nodesDiv.innerHTML="";this.children=new Array();this.length=0;this._children=this.children;this.selectedNode=null;this.hoveredNode=null;};HTMLTreeview.prototype.filter=function(value){var url='treeViewFilter.do?sys='+this.sys+'&formID='+this.formID+'&comID='+this.code+'&filter='+URLEncode(value,'GET');getAndEvalSync2(url);this.refreshURL=url;};HTMLTreeview.prototype.attachEvent=function(obj,type,fn,owner,params){this.callMethod(HTMLObject,"attachEvent",[obj,type,fn,owner,params]);if(obj==this&&this.div)this.callMethod(HTMLObject,"attachEvent",[this.div,type,fn,owner,params]);if(obj==this&&this.nodesDiv)this.callMethod(HTMLObject,"attachEvent",[this.nodesDiv,type,fn,owner,params]);};HTMLTreeview.prototype.designComponent=function(doc){this.status="closed";this.children=new Array();this.length=0;this._children=this.children;this.div.id="WFRTree"+this.code;this.div.className+=" p-0 overflow-auto";this.divClass=this.div.className;this._pseudoElement=this.div;if(this.border)this.div.className+=" card";if(this.bgColor)this.div.style.backgroundColor=this.bgColor;this.setFontStyle();this.nodesDiv=document.createElement("div");this.nodesDiv.className="list-group list-group-flush";this.div.appendChild(this.nodesDiv);this.otherDiv=this.div;};HTMLTreeview.prototype.setColor=function(color){this.callMethod(HTMLElementBase,"setColor",[color]);this.setFontStyle();};HTMLTreeview.prototype.hideTree=function(){this.div.style.display="none";};HTMLTreeview.prototype.showTree=function(){this.div.style.display="block";};HTMLTreeview.prototype.setIcon=function(element,iconFile,skin){if(element)element.setIcon(iconFile,skin);};HTMLTreeview.prototype.show=function(){};HTMLTreeview.prototype.getRoot=function(){return this;};HTMLTreeview.prototype.getTree=function(){return this.tree;};HTMLTreeview.prototype.setIconsHeight=function(height){this.imageHeight=height;};HTMLTreeview.prototype.setFontStyle=function(){if(this.nodesDiv){this.nodesDiv.style.color=this.color?this.color:null;this.nodesDiv.style.fontFamily=this.font?this.font:null;this.nodesDiv.style.fontWeight=this.weight?"bold":null;this.nodesDiv.style.fontStyle=this.italic?"italic":null;this.nodesDiv.style.fontSize=this.size?this.size+
(this.size.indexOf("pt")==-1&&this.size.indexOf("px")==-1&&this.size.indexOf("em")==-1&&this.size.indexOf("rem")==-1?"pt":""):null;this.nodesDiv.style.textDecoration=this.underline&&this.strikeout?"underline line-through":this.underline?"underline":this.strikeout?"line-through":null;}
if(parseInt(this.size)<8||parseInt(this.size)>12){if(parseInt(this.size)>=10&&parseInt(this.size)<=20){this.setIconsHeight((parseInt(this.size)+10)+'px');}else if(parseInt(this.size)>20){this.setIconsHeight((parseInt(this.size)+20)+'px');}else{this.setIconsHeight((parseInt(this.size)+5)+'px');}}};HTMLTreeview.prototype.setElementDBInfo=function(element,arrInfo){element.dataContainer=arrInfo;};HTMLTreeview.prototype.getElementDBInfo=function(element){return element.dataContainer;};HTMLTreeview.prototype.setElementDBCodeInfo=function(element,code,codeParent){var arrInfo=new Array();arrInfo['code']=code;arrInfo['codeParent']=codeParent;element.dataContainer=arrInfo;};HTMLTreeview.prototype.getElementByName=function(caption){if(this.children&&this.children.length>0){for(var i=0;i<this.children.length;i++){var node=this.children[i];if(node&&node.caption==caption)return node;var nodeChildren=node.findChildByCaption(caption);if(nodeChildren!=null)return nodeChildren;}}
return null;};HTMLTreeview.prototype.getChildIndexById=function(id){if(this.children&&this.children.length>0){for(var i=0;i<this.children.length;i++){var node=this.children[i];if(node&&node.id==id)return i;else if(node&&node.getChildIndexById){var result=node.getChildIndexById(id);if(result!=-1)return result;}}}
return-1;};HTMLTreeview.prototype.getHoveredElement=function(){return(this.hoveredNode)?this.hoveredNode:this.selectedNode;};HTMLTreeview.prototype.getActiveElement=function(){return(this.selectedNode)?this.selectedNode:this.hoveredNode;};HTMLTreeview.prototype.setActiveElement=function(node){if(this.selectedNode&&this.selectedNode.div)
this.selectedNode.div.classList.remove("active");this.selectedNode=node;if(node&&node.div)node.div.classList.add("active");};HTMLTreeview.prototype.getElement=function(id){if(this.children&&this.children.length>0){for(var i=0;i<this.children.length;i++){var node=this.children[i];if(node&&node.id==id)return node;var nodeChildren=node.findChildById(id);if(nodeChildren!=null)return nodeChildren;}}
return null;};HTMLTreeview.prototype.elementAdded=function(node){this.length++;};HTMLTreeview.prototype.elementRemoved=function(node){this.length--;};HTMLTreeview.prototype.focus=function(){return false;};HTMLTreeview.prototype.blur=function(){return false;};HTMLTreeview.prototype.addChild=function(parentElement,caption,link,target,isOpen){if(!this.children){this.children=new Array();this.length=0;}
if(parentElement===null||parentElement===undefined){interactionError(safeGetLocaleMessage("ERROR.TREEVIEW_NULL_PARENT"));return null;}
if(parentElement===this){var child=new HTMLTreeviewNode(this.sys,this.formID,this.code,0,0,0,0,this.idCount++,this,this,caption,link,target,this.length==0?true:isOpen);this.children.push(child);this.elementAdded(child);this._children=this.children;child.design(this.nodesDiv,this.tabControl);return child;}else{return parentElement.addChild(caption,link,target,isOpen);}};HTMLTreeview.prototype.associateRuleToElement=function(element,ruleName,ruleParams){var _sys=this.sys;var _formID=this.formID;var _params=ruleParams?ruleParams:"";var _ruleName=ruleName;element.onclick=function(){executeJSRuleNoField(_sys,_formID,_ruleName,_params);};};HTMLTreeview.prototype.addChildByElement=function(parentElement,element){var elementParent=(parentElement)?parentElement:this.getActiveElement();return elementParent.addChild(element);};HTMLTreeview.prototype.createElement=function(caption,link,target){return this.addChild(null,caption,link,target,false);};HTMLTreeview.prototype.getDataContainer=function(element){if(element)return element.dataContainer;};HTMLTreeview.prototype.removeElement=function(element){if(this.children&&element){for(var i=0;i<this.children.length;i++){var node=this.children[i];if(node&&node.id==element.id){node.deleteSelf();break;}}}};HTMLTreeview.prototype.useRadioControl=function(bool){this.radio=bool;if(bool)this.check=false;};HTMLTreeview.prototype.useCheckBox=function(bool){this.check=bool;if(bool)this.radio=false;};HTMLTreeview.prototype.useAutoCollapse=function(bool){this.autoCollapse=bool;};HTMLTreeview.prototype.removeAllChilds=function(){if(this.children&&this.children.length>0){for(var i=0;i<this.children.length;i++){var node=this.children[i];node.deleteSelf();}}
this.children=new Array();this.length=0;this._children=this.children;};HTMLTreeview.prototype.removeAllChildsOf=function(element){if(element)element.removeAllChilds();};HTMLTreeview.prototype.getMaxCode=function(){return this.maxCode=this.findMaxCode(this.getRoot());};HTMLTreeview.prototype.findMaxCode=function(element){var maxCode=0;for(var i=0;i<element.children.length;i++){if(element.children[i].id>maxCode){maxCode=element.children[i].id;}
if(element.children[i].children.length>0){if(this.findMaxCode(element.children[i])>maxCode){maxCode=element.children[i].id;}}}
return maxCode;};HTMLTreeview.prototype.addLoadActionEvent=function(element){var key=this.getElementDBInfo(element).chave;var id=element.id;var idParent=element.parentNode?element.parentNode.id:this.id;var func=this.onbeforeopen;element.expandAction=loadActionEventHandle(this.sys,this.formID,this.code,key,id,idParent,func);};HTMLTreeview.prototype.addAfterCloseActionEvent=function(element){var key=this.getElementDBInfo(element).chave;var id=element.id;var idParent=element.parentNode?element.parentNode.id:this.id;var func=this.onafterclose;element.collapseAction=unLoadActionEventHandle(this.sys,this.formID,this.code,id,idParent,func);};HTMLTreeview.prototype.setOnClickEvt=function(element){if(element&&this.onclick)element.onclick=funcHandle(this.onclick,element.dataContainer.chave,(element.parentNode&&element.parentNode.dataContainer?element.parentNode.dataContainer.chave:null));};HTMLTreeview.prototype.setOnDblClickEvt=function(element){if(element&&this.ondblclick)element.ondblclick=funcHandle(this.ondblclick,element.dataContainer.chave,(element.parentNode&&element.parentNode.dataContainer?element.parentNode.dataContainer.chave:null));};function funcHandle(func,id,parentID){return function(){func(id,parentID);}};HTMLTreeview.prototype.setOnBeforeOpenEvt=function(element){if(element&&this.onbeforeopen)element.beforeExpandAction=funcHandle(this.onbeforeopen,element.dataContainer.chave,(element.parentNode&&element.parentNode.dataContainer?element.parentNode.dataContainer.chave:null));};HTMLTreeview.prototype.setOnAfterOpenEvt=function(element){if(element&&this.onafteropen)element.afterExpandAction=funcHandle(this.onafteropen,element.dataContainer.chave,(element.parentNode&&element.parentNode.dataContainer?element.parentNode.dataContainer.chave:null));};HTMLTreeview.prototype.setOnBeforeCloseEvt=function(element){if(element&&this.onbeforeclose)element.beforeCollapseAction=funcHandle(this.onbeforeclose,element.dataContainer.chave,(element.parentNode&&element.parentNode.dataContainer?element.parentNode.dataContainer.chave:null));};HTMLTreeview.prototype.setOnAfterCloseEvt=function(element){if(element&&this.onafterclose)element.afterCollapseAction=funcHandle(this.onafterclose,element.dataContainer.chave,(element.parentNode&&element.parentNode.dataContainer?element.parentNode.dataContainer.chave:null));};HTMLTreeview.prototype.setCaptionBgColor=function(color){};loadActionEventHandle=function(sys,formID,code,key,id,idParent,func){return function(){var url="treeViewLoad.do?sys="+sys+"&formID="+formID+"&comID="+code+"&nodeKey="+key+"&nodeId="+id;getAndEvalSync(url);if(func){var nodeSelected=treeView.getElement(id);func=funcHandle(func,nodeSelected.dataContainer.chave,(nodeSelected.parentNode&&nodeSelected.parentNode.dataContainer?nodeSelected.parentNode.dataContainer.chave:null));func();}}};unLoadActionEventHandle=function(sys,formID,code,id,idParent,func){return function(){var treeView=eval("d.c_"+code);var nodeSelected=treeView.getElement(id);treeView.removeAllChildsOf(nodeSelected);var nodeLoading=treeView.addChild(nodeSelected,getLocaleMessage("LABEL.LOADING"));treeView.setIcon(nodeLoading,'loading');if(func){func=funcHandle(func,nodeSelected.dataContainer.chave,(nodeSelected.parent&&nodeSelected.parent.dataContainer?nodeSelected.parent.dataContainer.chave:null));func();}}};HTMLTreeview.prototype.getPermissionDescription=function(){if(!isNullable(this.permissionDescription))
return this.permissionDescription;return this.callMethod(HTMLElementBase,"getPermissionDescription");};function HTMLTreeviewNode(sys,formID,code,posX,posY,width,height,value,parentNode,treeview,caption,link,target,isOpen){this.create(sys,formID,code,posX,posY,width,height,'',value);this.treeview=treeview;this.tree=treeview;this._tree=treeview;this.parentNode=parentNode;this.id=value;this.length=0;this.caption=caption;this.link=link;this.target=target;this.isOpen=isOpen;this.padding=3;}
HTMLTreeviewNode.inherits(HTMLElementBase);HTMLTreeviewNode.prototype.name="HTMLTreeviewNode";HTMLTreeviewNode.prototype.tabable=false;HTMLTreeviewNode.prototype.design=function(doc,tabControl){this.div=document.createElement("div");this.div.className="list-group-item py-2 w-100";if(this.parentNode){this.div.className+=" rounded-0";this.div.style.paddingLeft=this.parentNode.padding+"rem";}
doc.appendChild(this.div);this.contentDiv=document.createElement("div");this.contentDiv.className="d-flex align-items-center";this.div.appendChild(this.contentDiv);if(this.treeview&&this.treeview.draggable){this.div.id=this.treeview._objectId+'_e_'+this.id+'_drag';}else if(this.treeview){this.div.id=this.treeview._objectId+'_e_'+this.id;}
var object=this;this.attachEvent(this.div,"contextmenu",this.contextMenuAction)
this.attachEvent(this.div,"click",this.clickAction);this.attachEvent(this.div,"dblclick",this.dblClickAction);this.div.addEventListener("mouseover",function(event){if(object.treeview)object.treeview.hoveredElement=this;});if(this.caption&&this.caption.length>0){this.label=document.createElement("label");this.label.className="mb-0";this.label.innerHTML=stringToHTMLString(this.caption);this.contentDiv.appendChild(this.label);}
this.doc=doc;this.tabControl=tabControl;this.context=this.div;this.children=new Array();this.length=0;this._children=this.children;this.designComponent(doc,tabControl);this.init(tabControl);};HTMLTreeviewNode.prototype.designComponent=function(doc){};HTMLTreeviewNode.prototype.attachEvent=function(obj,type,fn,owner,params){this.callMethod(HTMLObject,"attachEvent",[obj,type,fn,owner,params]);if(obj==this&&this.div)this.callMethod(HTMLObject,"attachEvent",[this.div,type,fn,owner,params]);};HTMLTreeviewNode.prototype.getRoot=function(){if(!this.parentNode||this.parentNode==this.treeview)return this.treeview.getRoot();return this.parentNode;};HTMLTreeviewNode.prototype.addChild=function(caption,link,target,isOpen){if(!this.childrenDiv){this.childrenDiv=document.createElement("div");this.childrenDiv.className="list-group list-group-flush border-top";if(this.isOpen)this.childrenDiv.style.display="block";else this.childrenDiv.style.display="none";if(this.div.nextSibling)this.doc.insertBefore(this.childrenDiv,this.div.nextSibling);else this.doc.appendChild(this.childrenDiv);}
if(!this.expandIconBaseDiv){this.expandIconBaseDiv=document.createElement("div");this.expandIconBaseDiv.className="d-flex align-items-center justify-content-center mr-1";this.expandIconBaseDiv.style.width="1rem";this.expandIcon=document.createElement("i");if(this.isOpen)this.expandIcon.className="generic-btn mr-2 fas fa-chevron-down";else this.expandIcon.className="generic-btn mr-2 fas fa-chevron-right";this.expandIconBaseDiv.appendChild(this.expandIcon);this.attachEvent(this.expandIconBaseDiv,'click',this.toggleExpand);if(this.iconDiv)this.contentDiv.insertBefore(this.expandIconBaseDiv,this.iconDiv);else if(this.label)this.contentDiv.insertBefore(this.expandIconBaseDiv,this.label);else this.contentDiv.appendChild(this.expandIconBaseDiv);}
var child=new HTMLTreeviewNode(this.sys,this.formID,this.code,0,0,0,0,this.treeview.idCount++,this,this.treeview,caption,link,target,isOpen);child.padding=this.padding+2;this.children.push(child);if(this.parentNode)this.parentNode.length++;else this.treeview.length++;this.length++;child.design(this.childrenDiv,this.tabControl);return child;};HTMLTreeviewNode.prototype.setIcon=function(icon){this.icon=icon;if(!icon||icon===undefined||icon===null||icon===""||(icon.length&&icon.length==0)){this.removeIcon();}else if(icon.toLowerCase()=="loading"){if(this.iconDiv)this.removeIcon();this.iconDiv=document.createElement("div");this.iconDiv.className="spinner-border text-dark mr-2";this.iconDiv.innerHTML='<span class="sr-only">'+getLocaleMessage("LABEL.LOADING")+'...</span>';this.iconDiv.style.width=(this.treeview.imageHeight-4)+"px";this.iconDiv.style.height=(this.treeview.imageHeight-4)+"px";if(this.label)this.contentDiv.insertBefore(this.iconDiv,this.label);else this.contentDiv.appendChild(this.iconDiv);}else if(icon.toLowerCase().indexOf("fa-")!=-1){if(this.iconDiv)this.removeIcon();this.iconDiv=document.createElement("i");this.iconDiv.className="mr-2 "+icon;this.iconDiv.style.fontSize=this.treeview.imageHeight+"px";this.iconDiv.style.lineHeight=this.treeview.imageHeight+"px";if(this.label)this.contentDiv.insertBefore(this.iconDiv,this.label);else this.contentDiv.appendChild(this.iconDiv);}else if(icon.indexOf("/")!==-1||icon.indexOf("\\")!==-1||icon.indexOf(".")!==-1){if(this.iconDiv)this.removeIcon();this.iconDiv=document.createElement("img");this.iconDiv.className="mr-2";this.iconDiv.src=icon;this.iconDiv.width=this.treeview.imageHeight;this.iconDiv.height=this.treeview.imageHeight;this.iconDiv.style.width=this.treeview.imageHeight+"px";this.iconDiv.style.height=this.treeview.imageHeight+"px";if(this.label)this.contentDiv.insertBefore(this.iconDiv,this.label);else this.contentDiv.appendChild(this.iconDiv);}};HTMLTreeviewNode.prototype.removeIcon=function(){this.icon=null;if(this.iconDiv){if(this.iconDiv.remove)this.iconDiv.remove();else this.iconDiv.parentElement.removeChild(this.iconDiv);this.iconDiv=null;}};HTMLTreeviewNode.prototype.findChildById=function(id){if(this.children&&this.children.length>0){for(var i=0;i<this.children.length;i++){var node=this.children[i];if(node&&node.id==id)return node;var nodeChildren=node.findChildById(id);if(nodeChildren!=null)return nodeChildren;}}
return null;};HTMLTreeviewNode.prototype.findChildByCaption=function(caption){if(this.children&&this.children.length>0){for(var i=0;i<this.children.length;i++){var node=this.children[i];if(node&&node.caption==caption)return node;var nodeChildren=node.findChildByCaption(caption);if(nodeChildren!=null)return nodeChildren;}}
return null;};HTMLTreeviewNode.prototype.getChildIndexById=function(id){if(this.children&&this.children.length>0){for(var i=0;i<this.children.length;i++){var node=this.children[i];if(node&&node.id==id)return i;else if(node&&node.getChildIndexById){var result=node.getChildIndexById(id);if(result!=-1)return result;}}}
return-1;};HTMLTreeviewNode.prototype.removeAllChilds=function(){if(this.children&&this.children.length>0){for(var i=0;i<this.children.length;i++){var node=this.children[i];node.deleteSelf();}}
if(this.childrenDiv){if(this.childrenDiv.remove){this.childrenDiv.remove();}else this.childrenDiv.parentElement.removeChild(this.childrenDiv);}
if(this.expandIconBaseDiv){if(this.expandIconBaseDiv.remove){this.expandIconBaseDiv.remove();}else this.expandIconBaseDiv.parentElement.removeChild(this.expandIconBaseDiv);}
this.children=new Array();this.length=0;this.childrenDiv=null;this.expandIconBaseDiv=null;this.expandIcon=null;this._children=this.children;};HTMLTreeviewNode.prototype.deleteSelf=function(){if(this.parentNode){if(this.parentNode.name=='HTMLTreeviewNode'){if(this.parentNode.children&&this.parentNode.children.length>0){var index=this.parentNode.getChildIndexById(this.id);this.parentNode.children.splice(index,1);this.parentNode.elementRemoved(this);}}else if(this.parentNode.tree){var index=this.parentNode.getChildIndexById(this.id);this.parentNode.children.splice(index,1);this.parentNode.elementRemoved(this);}}
this.removeAllChilds();this.removeIcon();if(this.div){if(this.div.remove){this.div.remove();}else this.div.parentElement.removeChild(this.div);}
if(this.treeview&&this.treeview.getActiveElement()==this){this.treeview.setActiveElement(this);}
this.treeview=null;this.tree=null;this._tree=null;this.parentNode=null;this.children=null;this._children=null;this.div=null;this.icon=null;this.caption=null;this.link=null;this.target=null;this.isOpen=null;};HTMLTreeviewNode.prototype.setElementDBInfo=function(arrInfo){this.dataContainer=arrInfo;};HTMLTreeviewNode.prototype.getElementDBInfo=function(element){return this.dataContainer;};HTMLTreeviewNode.prototype.setOpenState=function(isOpen){if(this.isOpen==isOpen)return;this.isOpen=isOpen;if(this.isOpen&&this.beforeExpandAction){this.beforeExpandAction.call(this);}else if(!this.isOpen&&this.beforeCollapseAction){this.beforeCollapseAction.call(this);}
if(this.childrenDiv){if(this.isOpen)this.childrenDiv.style.display="block";else this.childrenDiv.style.display="none";}
if(this.expandIcon){if(this.isOpen)this.expandIcon.className="generic-btn mr-2 fas fa-chevron-down";else this.expandIcon.className="generic-btn mr-2 fas fa-chevron-right";}
if(this.isOpen&&this.expandAction){this.expandAction.call(this);}else if(!this.isOpen&&this.collapseAction){this.collapseAction.call(this);}
if(this.isOpen&&this.afterExpandAction){this.afterExpandAction.call(this);}else if(!this.isOpen&&this.afterCollapseAction){this.afterCollapseAction.call(this);}};HTMLTreeviewNode.prototype.open=function(){this.expandAll();};HTMLTreeviewNode.prototype.close=function(){this.collapseAll();};HTMLTreeviewNode.prototype.expandAll=function(){this.setOpenState(true);if(this.children&&this.children.length>0){for(var i=0;i<this.children.length;i++){var node=this.children[i];node.setOpenState(true);}}};HTMLTreeviewNode.prototype.collapseAll=function(){this.setOpenState(false);if(this.children&&this.children.length>0){for(var i=0;i<this.children.length;i++){var node=this.children[i];node.setOpenState(false);}}};HTMLTreeviewNode.prototype.toggleExpand=function(){this.setOpenState(!this.isOpen);};HTMLTreeviewNode.prototype.clickAction=function(e,o){this.callMethod(HTMLElementBase,"clickAction",[e,o]);if(this.enabled&&this.treeview){this.treeview.setActiveElement(this);}};HTMLTreeviewNode.prototype.dblClickAction=function(e,o){if(this.enabled&&this.ondblclick){this.ondblclick.call(this,e);}};HTMLTreeviewNode.prototype.contextMenuAction=function(e){e.preventDefault();if(this.enabled&&this.treeview){this.treeview.setActiveElement(this);}};HTMLTreeviewNode.prototype.elementAdded=function(node){if(this.parentNode)this.parentNode.elementAdded(node);else if(this.treeview)this.treeview.elementAdded(node);this._children=this.children;this.length++;};HTMLTreeviewNode.prototype.elementRemoved=function(node){if(this.parentNode)this.parentNode.elementRemoved(node);else if(this.treeview)this.treeview.elementRemoved(node);this._children=this.children;this.length--;};function HTMLMultiSelect(sys,formID,code,posX,posY,width,height,description,value,showValue){this.create(sys,formID,code,posX,posY,width,height,description,value);this.values=[];this.keys=[];this.selected=[];this.options=[];this.isDropdownOpen=false;}
HTMLMultiSelect.inherits(HTMLComboBox);HTMLMultiSelect.prototype.name='HTMLMultiSelect';HTMLMultiSelect.prototype.tabable=true;HTMLMultiSelect.prototype.setValue=function(value,checkDependences){if(value!==undefined&&value!==null&&typeof value==='string')value=value.trim();if(value&&value.length>0){if(value.indexOf(",")!=-1){this.selected=[];var items=value.split(",");for(var i=0;i<items.length;i++){this.selected.push(items[i].trim());}}else{this.selected=[value.trim()];}}else{this.selected=[];}
this.hidden.setValue(value);this.updateLayout();};HTMLMultiSelect.prototype.designComponent=function(doc){this.div.className+=" dropdown";this.divClass=this.div.className;if(this.Lista&&this.Lista.length&&this.Lista.length>0&&!this.hasQuery){var rawValues=this.Lista.trim();if(rawValues.indexOf("\n")!=-1){this.values=[];var tvalues=rawValues.split("\n");for(var i=0;i<tvalues.length;i++){this.values.push(tvalues[i].trim());}}else{this.values=[rawValues];}}
if(this.Valores&&this.Valores.length&&this.Valores.length>0&&!this.hasQuery){var rawKeys=this.Valores.trim();if(rawKeys.indexOf("\n")!=-1){this.keys=[];var tkeys=rawKeys.split("\n");for(var i=0;i<tkeys.length;i++){this.keys.push(tkeys[i].trim());}}else{this.keys=[rawKeys];}}
this.callMethod(HTMLComboBox,"designComponent",[doc]);if(this.placeholderOption){this.placeholderOption.setAttribute("hidden","hidden");this.valueOption=document.createElement("option");this.valueOption.value=this.value?this.value:"";this.input.insertBefore(this.valueOption,this.placeholderOption);}else{this.valueOption=this.emptyOption;this.valueOption.value=this.value?this.value:"";}
this.dropdownMenu=document.createElement("div");this.dropdownMenu.className="dropdown-menu";this.dropdownMenu.style.zIndex=this.div.style.zIndex;this.dropdownMenuClass=this.dropdownMenu.className;this.div.appendChild(this.dropdownMenu);if(this.keys&&this.keys.length>0){for(var i=0;i<this.keys.length;i++){this.designDropdownItem(i,this.keys[i],this.values[i]);}}
if(!this.input.id||this.input.id.length==0)this.input.id="multiselect-"+this.code;if(!this.div.id||this.div.id.length==0)this.div.id=this.id;this.dropdownMenu.setAttribute("aria-labelledby",this.input.id);this.input.setAttribute("data-toggle","dropdown");this.input.setAttribute("aria-haspopup","true");this.input.setAttribute("aria-expanded","false");this.input.style.setProperty("-webkit-appearance","none");this.input.style.setProperty("-moz-appearance","none");this.input.style.setProperty("appearance","none");this.attachEvent(this.input,'mousedown',this.mouseDownAction);this.attachEvent(this.div,'keydown',this.keydownAction);var object=this;$(this.div).on('show.bs.dropdown',function(){object.dropdownMenu.style.width=object.div.offsetWidth+"px";object.dropdownMenu.style.maxHeight=(object.tab.div.offsetHeight-object.div.offsetHeight)+"px";object.dropdownMenu.style.overflowY="auto";object.isDropdownOpen=true;object.div.style.setProperty("z-index",999991);if(object.hint){try{$(object.div).tooltip("dispose");}catch(e){}}});$(this.div).on('hide.bs.dropdown',function(){object.dropdownMenu.style.width=object.div.offsetWidth+"px";object.isDropdownOpen=false;object.lastFocusedOption=null;object.div.style.setProperty("z-index",object.zIndex?object.zIndex:2);if(object.hint){bootstrapInitTooltip(object.div);}});};HTMLMultiSelect.prototype.designDropdownItem=function(i,key,value){var dropdownMenuItem=document.createElement("div");dropdownMenuItem.className="dropdown-item";dropdownMenuItem.setAttribute("data-value",key);this.dropdownMenu.appendChild(dropdownMenuItem);var checkboxId="option-check"+this.code+"-"+i;var itemCheckbox=document.createElement("div");itemCheckbox.className="custom-control custom-checkbox w-100";dropdownMenuItem.appendChild(itemCheckbox);var itemCheckboxInput=document.createElement("input");itemCheckboxInput.type="checkbox";itemCheckboxInput.className="custom-control-input";itemCheckboxInput.id=checkboxId;itemCheckbox.appendChild(itemCheckboxInput);this.attachEvent(itemCheckboxInput,'keydown',this.keydownAction);var itemCheckboxLabel=document.createElement("label");itemCheckboxLabel.className="custom-control-label w-100";itemCheckboxLabel.setAttribute("for",checkboxId);itemCheckboxLabel.style.overflow="visible";itemCheckboxLabel.innerHTML=replaceAll(replaceAll(value,'>','&gt;'),'<','&lt;');itemCheckbox.appendChild(itemCheckboxLabel);var object=this;dropdownMenuItem.onclick=function(e){e.stopPropagation();e.preventDefault();itemCheckboxInput.click();};itemCheckboxLabel.onclick=function(e){e.stopPropagation();};itemCheckbox.onclick=function(e){e.stopPropagation();};itemCheckboxInput.onchange=function(e){if(e.target.checked)object.selectOption(key);else object.unselectOption(key);};itemCheckboxInput.onfocus=function(){object.lastFocusedOption=i;};this.options.push({key:key,checkbox:itemCheckboxInput});};HTMLMultiSelect.prototype.add=function(key,value){this.callMethod(HTMLComboBox,"add",[key,value]);this.designDropdownItem(this.keys.length-1,key,value);};HTMLMultiSelect.prototype.clean=function(){this.keys=new Array();this.values=new Array();this.selected=new Array();if(this.input){this.input.innerHTML="";this.value="";var myNode=this.dropdownMenu.parentElement.childNodes[2]
while(myNode.firstChild){myNode.removeChild(myNode.lastChild);}
this.designPlaceholder();}};HTMLMultiSelect.prototype.designPlaceholder=function(){this.emptyOption=document.createElement("option");this.valueOption=this.emptyOption;this.valueOption.value=this.value?this.value:"";this.input.appendChild(this.valueOption);};HTMLMultiSelect.prototype.click=function(){if(this.div.onclick)this.div.onclick.call(this);};HTMLMultiSelect.prototype.keydownAction=function(e){e.preventDefault();e.stopPropagation();this.callMethod(HTMLElementBase,"keydownAction",[e]);if(e.which===32||e.code==="Space"){if(isFirefox){var object=this;this.input.disabled=true;setTimeout(function(){object.input.disabled=false;object.input.click();},0);}else{this.input.click();}}else if(e.which===40||e.code==="ArrowDown"||e.which===39||e.code==="ArrowRight"||e.which===34||e.code==="PageDown"){if(isFirefox){var object=this;this.input.disabled=true;setTimeout(function(){object.input.disabled=false;object.focusNextOption();},0);}else{this.focusNextOption();}}else if(e.which===37||e.code==="ArrowLeft"||e.which===38||e.code==="ArrowUp"||e.which===33||e.code==="PageUp"){if(isFirefox){var object=this;this.input.disabled=true;setTimeout(function(){object.input.disabled=false;object.focusPreviousOption();},0);}else{this.focusPreviousOption();}}else if(e.which===36||e.code==="Home"){this.focusFirstOption();}else if(e.which===35||e.code==="End"){this.focusLastOption();}else if(e.which===13||e.code==="Enter"){if(this.isDropdownOpen){if(e.shiftKey){this.toggleAllOptions();}else{this.toggleFocusedOption();}}else{this.openDropdown();}}else if(e.which===27||e.code==="Escape"){this.closeDropdown();}};HTMLMultiSelect.prototype.focusNextOption=function(){if(this.options==null||this.options.length==0)return false;this.openDropdown();if(this.lastFocusedOption===undefined||this.lastFocusedOption===null||this.lastFocusedOption>=this.options.length-1){this.lastFocusedOption=0;}else{this.lastFocusedOption++;}
try{this.options[this.lastFocusedOption].checkbox.focus();}catch(e){}};HTMLMultiSelect.prototype.focusPreviousOption=function(){if(this.options==null||this.options.length==0)return false;this.openDropdown();if(this.lastFocusedOption===undefined||this.lastFocusedOption===null||this.lastFocusedOption<=0){this.lastFocusedOption=this.options.length-1;}else{this.lastFocusedOption--;}
try{this.options[this.lastFocusedOption].checkbox.focus();}catch(e){}};HTMLMultiSelect.prototype.focusFirstOption=function(){if(this.options==null||this.options.length==0)return false;this.openDropdown();this.lastFocusedOption=0;try{if(this.lastFocusedOption!==undefined&&this.lastFocusedOption!==null){this.options[this.lastFocusedOption].checkbox.focus();}}catch(e){}};HTMLMultiSelect.prototype.focusLastOption=function(){if(this.options==null||this.options.length==0)return false;this.openDropdown();this.lastFocusedOption=this.options.length-1;try{this.options[this.lastFocusedOption].checkbox.focus();}catch(e){}};HTMLMultiSelect.prototype.toggleFocusedOption=function(){if(this.options==null||this.options.length==0)return false;try{this.options[this.lastFocusedOption].checkbox.click();}catch(e){}};HTMLMultiSelect.prototype.toggleAllOptions=function(){if(this.options==null||this.options.length==0)return false;try{for(var i=0;i<this.options.length;i++){this.options[i].checkbox.click();}}catch(e){}};HTMLMultiSelect.prototype.openDropdown=function(){if(this.input)bootstrapOpenDropdown(this.input);};HTMLMultiSelect.prototype.closeDropdown=function(){if(this.input)bootstrapCloseDropdown(this.input);};HTMLMultiSelect.prototype.mouseDownAction=function(e,o){e.preventDefault();};HTMLMultiSelect.prototype.changeAction=function(e,o,dontCheckDependences){if(e)e.preventDefault();};HTMLMultiSelect.prototype.itemAddedAction=function(key,value){this.callMethod(HTMLComboBox,"itemAddedAction",[key,value]);};HTMLMultiSelect.prototype.itemRemovedAction=function(key,value){this.callMethod(HTMLComboBox,"itemRemovedAction",[key,value]);};HTMLMultiSelect.prototype.setHint=function(hint){this.callMethod(HTMLElementBase,"setHint",[hint,this.div]);};HTMLMultiSelect.prototype.updateLayout=function(){if(this.selected.length>0){var value="",text="";for(var i=0;i<this.selected.length;i++){value+=this.selected[i];if(i<this.selected.length-1)value+=",";for(var j=0;j<this.keys.length;j++){if(this.keys[j]==this.selected[i]){text+=this.values[j];if(i<this.selected.length-1)text+=", ";break;}}}
this.valueOption.value=value;this.valueOption.innerHTML=text;this.valueOption.selected=true;if(this.value!=value){this.value=value;this.hidden.setValue(value);this.changeAction(null,this,true);}
if(this.options&&this.options.length>0){for(var i=0;i<this.options.length;i++){if(this.options[i].checkbox)this.options[i].checkbox.checked=(this.selected.indexOf(this.options[i].key)!=-1);}}}else{if(this.valueOption){this.valueOption.value="";this.valueOption.innerHTML="";}
if(this.value!=""){this.value="";this.hidden.setValue("");this.changeAction(null,this,true);}
if(this.placeholderOption){this.placeholderOption.selected=true;}else if(this.emptyOption){this.emptyOption.selected=true;}else{this.input.value="";}
if(this.options&&this.options.length>0){for(var i=0;i<this.options.length;i++){if(this.options[i].checkbox)this.options[i].checkbox.checked=false;}}}};HTMLMultiSelect.prototype.selectOption=function(key){if(this.selected.indexOf(key)==-1)
this.selected.push(key);this.updateLayout();if(this.AoSelecionar)this.AoSelecionar.call(this,key);};HTMLMultiSelect.prototype.unselectOption=function(key){if(this.selected.indexOf(key)!=-1)
this.selected.remove(key);this.updateLayout();if(this.AoRemover)this.AoRemover.call(this,key);};function HTMLProgressBar(sys,code,description){this.create(sys,null,code,null,null,null,null,description,null);this.percent=0;this.closeable=true;this.closed=false;}
HTMLProgressBar.inherits(HTMLElementBase);HTMLProgressBar.prototype.name='HTMLProgressBar';HTMLProgressBar.prototype.minValue=0;HTMLProgressBar.prototype.maxValue=100;HTMLProgressBar.prototype.design=function(doc){this.modal=bootstrapCreateModal(this.getDescription(),this.closeable);var object=this;$(this.modal[0]).on('shown.bs.modal',function(e){if(object.closed)object.close();});this.modal[1].className+=" px-2 pt-1 pb-2";this.modal[2].className+=" p-3";this.modal[3].className+=" d-none";this.modal[4].className+=" modal-sm";this.modalTitle=this.modal[0].getElementsByClassName("modal-title");if(this.modalTitle.length>0)this.modalTitle=this.modalTitle[0];else this.modalTitle=null;if(this.modalTitle)this.modalTitle.className+=" mt-1 h6";var initialValue=this.percent?Math.min(Math.max(this.percent,this.minValue),this.maxValue):this.minValue;this.progressBar=document.createElement("div");this.progressBar.className="progress";this.progressBar.style.height="1.5rem";this.modal[2].appendChild(this.progressBar);this.progressBarInner=document.createElement("div");this.progressBarInner.className="progress-bar progress-bar-striped progress-bar-animated";this.progressBarInner.setAttribute("role","progressbar");this.progressBarInner.setAttribute("aria-valuenow",initialValue);this.progressBarInner.setAttribute("aria-valuemin",this.minValue);this.progressBarInner.setAttribute("aria-valuemax",this.maxValue);this.progressBarInner.style.width=initialValue+"%";this.progressBarInner.innerHTML=initialValue+"%";this.progressBar.appendChild(this.progressBarInner);};HTMLProgressBar.prototype.setPercent=function(percent){this.percent=Math.min(Math.max(percent,this.minValue),this.maxValue);if(this.progressBarInner){this.progressBarInner.setAttribute("aria-valuenow",this.percent);this.progressBarInner.innerHTML=this.percent+"%";this.progressBarInner.style.width=this.percent+"%";}};HTMLProgressBar.prototype.getPercent=function(){return this.percent;};HTMLProgressBar.prototype.setDescription=function(description){this.description=description;if(this.modalTitle)this.modalTitle.innerHTML=description;};HTMLProgressBar.prototype.getDescription=function(){return this.description;};HTMLProgressBar.prototype.getForm=function(){return this.form;};HTMLProgressBar.prototype.close=function(){this.closed=true;if(this.modal)bootstrapCloseModal(this.modal[0]);};function HTMLWait(sys,formID,code,posX,posY,width,height,value){this.create(sys,formID,code,posX,posY,width,height,'',value);this.designComponent();}
HTMLWait.inherits(HTMLElementBase);HTMLWait.prototype.name='HTMLWait';HTMLWait.prototype.tabable=false;HTMLWait.prototype.designComponent=function(doc){(this.posX)?posX=this.posX:posX=(document.documentElement.offsetWidth-this.width);(this.posY)?posY=this.posY:posY=0;this.div=this.getDiv('WFRWait'+this.code,posX,posY,this.width,this.height,10,true);this.div.innerHTML='<div class="spinner-border text-primary center-center" role="status">'+'<span class="sr-only">'+this.value+'</span>'+'</div>';document.body.appendChild(this.div);this.show();}
HTMLWait.prototype.show=function(){this.div.style.display="block";};HTMLWait.prototype.hide=function(){this.div.style.display="none";};HTMLWait.prototype.setIcon=function(url){};function FlowFunctions(){this.code;this.name;this.description;this.realName;this.resum;this.params=new Array;this.returnValue;this.type;}
FlowFunctions.prototype.name='';FlowFunctions.prototype.getCode=function(){return this.code;}
FlowFunctions.prototype.getResum=function(){return this.resum;}
FlowFunctions.prototype.getName=function(){return this.name;}
FlowFunctions.prototype.getDescription=function(){return this.description;}
FlowFunctions.prototype.getRealName=function(){return this.realName;}
FlowFunctions.prototype.getReturnValue=function(){return this.returnValue;}
FlowFunctions.prototype.getType=function(){return this.type;}
FlowFunctions.prototype.setCode=function(codeValue){this.code=codeValue;}
FlowFunctions.prototype.setName=function(nameValue){this.name=nameValue;}
FlowFunctions.prototype.setDescription=function(descriptionValue){this.description=descriptionValue;}
FlowFunctions.prototype.setRealName=function(realNameValue){this.realName=realNameValue;}
FlowFunctions.prototype.setResum=function(resumValue){this.resum=resumValue;}
FlowFunctions.prototype.setReturnValue=function(returnValue){this.returnValue=returnValue;}
FlowFunctions.prototype.setType=function(typeValue){this.type=typeValue;}
FlowFunctions.prototype.addParam=function(param){this.params.push(param);}
FlowFunctions.prototype.getParam=function(index){return this.params[index];}
function HTMLShapeBase(sys,formID,code,bevel,type){this.create(sys,formID,code,0,0,0,0,'','');this.strokeColor="#000000";this.textColor="#000000";this.bgColor="#FFFF00";this.shapes=new Array();this.type=type;this.stroke=1;this.bevel=bevel;this.designComponent();initExCanvas();var canvasTemp=document.getElementById("Canvas"+this.code);this.ctx=canvasTemp.getContext("2d");}
HTMLShapeBase.inherits(HTMLElementBase);HTMLShapeBase.prototype.designComponent=function(){try{this.otherDiv=document.getElementById("HTMLGroupBox"+$c(this.bevel).code);this.canvas=document.createElement("<canvas>");this.canvas.setAttribute("id","Canvas"+this.code);this.canvas.setAttribute("width",this.otherDiv.parentNode.parentNode.parentNode.getAttribute("width"));this.canvas.setAttribute("height",this.otherDiv.parentNode.parentNode.parentNode.getAttribute("height"));this.otherDiv.appendChild(this.canvas);}catch(e){throw e;}}
HTMLShapeBase.prototype.beginPath=function(){this.ctx.beginPath();}
HTMLShapeBase.prototype.toStroke=function(){this.ctx.stroke();}
HTMLShapeBase.prototype.toFill=function(){this.ctx.fill();}
HTMLShapeBase.prototype.drawLineBase=function(x1,y1,color,lineWidth){if(color)
this.ctx.strokeStyle=color;else this.ctx.strokeStyle='black';if(lineWidth)
this.ctx.lineWidth=lineWidth;else this.ctx.lineWidth=0;this.ctx.lineTo(x1,y1);}
HTMLShapeBase.prototype.toMove=function(x,y){this.ctx.moveTo(x,y);}
HTMLShapeBase.prototype.drawLine=function(x1,y1,x2,y2,color,lineWidth){this.ctx.beginPath();this.ctx.moveTo(x1,y1);this.drawLineBase(x2,y2,color,lineWidth);this.ctx.stroke();}
HTMLShapeBase.prototype.drawRect=function(x,y,width,height,fill,color,line,colorLine,lineWidth){if(colorLine)
this.ctx.strokeStyle=colorLine;else this.ctx.strokeStyle='black';if(color)
this.ctx.fillStyle=color;else this.ctx.fillStyle='black';if(lineWidth)
this.ctx.lineWidth=lineWidth;else this.ctx.lineWidth=0;var mapname="name";var map=mainform.document.createElement("map");mainform.document.body.appendChild(map);var area=mainform.document.createElement("area");area.shape="poly";area.id="area1";area.coords=x+","+y+","+eval(x+width)+","+y+","+eval(x+width)+","+eval(y+height)+","+x+","+eval(y+height);var div=document.createElement("div");div.setAttribute("id","divMap");div.innerHTML="<map name=\"map\">"+"<area shape=\"poly\" coords=\"10,10,20,50,30,10\" href=\"#\">"+"</map>";document.body.appendChild(div);if(fill){this.ctx.fillRect(x,y,width,height);}
if(line){this.ctx.strokeRect(x,y,width,height);}}
HTMLShapeBase.prototype.drawCircle=function(x,y,radio,fill,color,line,colorLine,lineWidth){if(colorLine)
this.ctx.strokeStyle=colorLine;else this.ctx.strokeStyle='black';if(color)
this.ctx.fillStyle=color;else this.ctx.fillStyle='black';if(lineWidth)
this.ctx.lineWidth=lineWidth;else this.ctx.lineWidth=0;this.ctx.beginPath();this.ctx.arc(x,y,radio,0,Math.PI*2,true);if(fill){this.ctx.fill();}
if(IE)
this.ctx.arc(x,y,radio,0,Math.PI*2,true);if(line){this.ctx.stroke();}}
HTMLShapeBase.prototype.drawArc=function(x,y,radio,startAngleDegrees,endAngleDegrees,fill,color,line,colorLine,lineWidth,anticlockwise){var startAngleRadians=(Math.PI*startAngleDegrees)/180;var endAngleRadians=(Math.PI*endAngleDegrees)/180;if(!anticlockwise){anticlockwise=false;}
if(colorLine)
this.ctx.strokeStyle=colorLine;else this.ctx.strokeStyle='black';if(color)
this.ctx.fillStyle=color;else this.ctx.fillStyle='black';if(lineWidth)
this.ctx.lineWidth=lineWidth;else this.ctx.lineWidth=0;this.ctx.beginPath();this.ctx.arc(x,y,radio,startAngleRadians,endAngleRadians,anticlockwise);if(fill){this.ctx.fill();}
if(IE)
this.ctx.arc(x,y,radio,startAngleRadians,endAngleRadians,anticlockwise);if(line){this.ctx.stroke();}}
HTMLShapeBase.prototype.drawQuadraticCurveBase=function(x1,y1,x2,y2,color,colorLine,lineWidth){if(colorLine)
this.ctx.strokeStyle=colorLine;else this.ctx.strokeStyle='black';if(color)
this.ctx.fillStyle=color;else this.ctx.fillStyle='black';if(lineWidth)
this.ctx.lineWidth=lineWidth;else this.ctx.lineWidth=0;this.ctx.quadraticCurveTo(x1,y1,x2,y2);}
HTMLShapeBase.prototype.drawQuadraticCurve=function(x1,y1,x2,y2,x3,y3,fill,color,line,colorLine,lineWidth){this.ctx.beginPath();this.ctx.moveTo(x1,y1);this.drawQuadraticCurveBase(x2,y2,x3,y3,color,colorLine,lineWidth);if(fill){this.ctx.fill();}
if(IE){this.ctx.moveTo(x1,y1);this.drawQuadraticCurveBase(x2,y2,x3,y3,color,colorLine,lineWidth);}
if(line){this.ctx.stroke();}}
HTMLShapeBase.prototype.drawBezierCurveBase=function(x1,y1,x2,y2,x3,y3,color,colorLine,lineWidth){if(colorLine)
this.ctx.strokeStyle=colorLine;else this.ctx.strokeStyle='black';if(color)
this.ctx.fillStyle=color;else this.ctx.fillStyle='black';if(lineWidth)
this.ctx.lineWidth=lineWidth;else this.ctx.lineWidth=0;this.ctx.bezierCurveTo(x1,y1,x2,y2,x3,y3);}
HTMLShapeBase.prototype.drawBezierCurve=function(x1,y1,x2,y2,x3,y3,fill,color,line,colorLine,lineWidth){this.ctx.beginPath();this.ctx.moveTo(x1,y1);this.drawBezierCurveBase(x1,y1,x2,y2,x3,y3,color,colorLine,lineWidth);if(fill){this.ctx.fill();}
if(IE){this.ctx.beginPath();this.ctx.moveTo(x1,y1);this.drawBezierCurveBase(x1,y1,x2,y2,x3,y3,color,colorLine,lineWidth);}
if(line){this.ctx.stroke();this.drawLine(x1,y1,x3,y3,colorLine,lineWidth);}}
HTMLShapeBase.prototype.drawRhombus=function(x1,y1,d1,d2,fill,color,line,colorLine,lineWidth){if(colorLine)
this.ctx.strokeStyle=colorLine;else this.ctx.strokeStyle='black';if(color)
this.ctx.fillStyle=color;else this.ctx.fillStyle='black';if(lineWidth)
this.ctx.lineWidth=lineWidth;else this.ctx.lineWidth=0;this.ctx.beginPath();this.ctx.moveTo(x1,y1);var a=d1/2;var b=d2/2;this.ctx.lineTo((a+x1),(y1-b));this.ctx.lineTo((d1+x1),y1);this.ctx.lineTo((a+x1),(y1+b));this.ctx.lineTo(x1,y1);if(fill){this.ctx.fill();}
if(IE){this.ctx.beginPath();this.ctx.moveTo(x1,y1);var a=d1/2;var b=d2/2;this.ctx.lineTo((a+x1),(y1-b));this.ctx.lineTo((d1+x1),y1);this.ctx.lineTo((a+x1),(y1+b));this.ctx.lineTo(x1,y1);}
if(line){this.ctx.stroke();}}
HTMLShapeBase.prototype.drawEllipse=function(x1,y1,a,b,fill,color,line,colorLine,lineWidth){if(colorLine)
this.ctx.strokeStyle=colorLine;else this.ctx.strokeStyle='black';if(color)
this.ctx.fillStyle=color;else this.ctx.fillStyle='black';if(lineWidth)
this.ctx.lineWidth=lineWidth;else this.ctx.lineWidth=0;this.ctx.beginPath();this.ctx.moveTo(x1,(y1+b));this.drawBezierCurveBase(x1,(y1+b),x1,y1,(x1+a),y1,color,colorLine,lineWidth);this.drawBezierCurveBase((x1+a),y1,(x1+2*a),y1,(x1+2*a),(y1+b),color,colorLine,lineWidth);this.drawBezierCurveBase((x1+2*a),(y1+b),(x1+2*a),(y1+2*b),(x1+a),(y1+2*b),color,colorLine,lineWidth);this.drawBezierCurveBase((x1+a),(y1+2*b),x1,(y1+2*b),x1,(y1+b),color,colorLine,lineWidth);this.ctx.closePath();if(fill){this.ctx.fill();}
if(IE){this.ctx.beginPath();this.ctx.moveTo(x1,(y1+b));this.drawBezierCurveBase(x1,(y1+b),x1,y1,(x1+a),y1,color,colorLine,lineWidth);this.drawBezierCurveBase((x1+a),y1,(x1+2*a),y1,(x1+2*a),(y1+b),color,colorLine,lineWidth);this.drawBezierCurveBase((x1+2*a),(y1+b),(x1+2*a),(y1+2*b),(x1+a),(y1+2*b),color,colorLine,lineWidth);this.drawBezierCurveBase((x1+a),(y1+2*b),x1,(y1+2*b),x1,(y1+b),color,colorLine,lineWidth);this.ctx.closePath();}
if(line){this.ctx.stroke();}}
function initExCanvas(){if(!mainform.document.CanvasRenderingContext2D){var m=Math;var mr=m.round;var ms=m.sin;var mc=m.cos;var Z=10;var Z2=Z/2;var G_vmlCanvasManager_={init:function(opt_doc){var doc=opt_doc||mainform.document;if(/MSIE/.test(navigator.userAgent)&&!window.opera){var self=this;self.init_(doc);doc.attachEvent("onreadystatechange",function(){self.init_(doc);});}},init_:function(doc){if(doc.readyState=="complete"){if(!doc.namespaces["g_vml_"]){doc.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml");}else{}
var ss=doc.createStyleSheet();ss.cssText="canvas{display:inline-block;overflow:hidden;"+"text-align:left;width:300px;height:150px}"+"g_vml_\\:*{behavior:url(#default#VML)}";var els=doc.getElementsByTagName("canvas");for(var i=0;i<els.length;i++){if(!els[i].getContext){this.initElement(els[i]);}}}},fixElement_:function(el){var outerHTML=el.outerHTML;var newEl=el.ownerDocument.createElement(outerHTML);if(outerHTML.slice(-2)!="/>"){var tagName="/"+el.tagName;var ns;while((ns=el.nextSibling)&&ns.tagName!=tagName){ns.removeNode();}
if(ns){ns.removeNode();}}
el.parentNode.replaceChild(newEl,el);return newEl;},initElement:function(el){el=this.fixElement_(el);el.getContext=function(){if(this.context_){return this.context_;}
return this.context_=new CanvasRenderingContext2D_(this);};el.attachEvent('onpropertychange',onPropertyChange);el.attachEvent('onresize',onResize);var attrs=el.attributes;if(attrs.width&&attrs.width.specified){el.style.width=attrs.width.nodeValue+"px";}else{el.width=el.clientWidth;}
if(attrs.height&&attrs.height.specified){el.style.height=attrs.height.nodeValue+"px";}else{el.height=el.clientHeight;}
return el;}};function onPropertyChange(e){var el=e.srcElement;switch(e.propertyName){case'width':el.style.width=el.attributes.width.nodeValue+"px";el.getContext().clearRect();break;case'height':el.style.height=el.attributes.height.nodeValue+"px";el.getContext().clearRect();break;}}
function onResize(e){var el=e.srcElement;if(el.firstChild){el.firstChild.style.width=el.clientWidth+'px';el.firstChild.style.height=el.clientHeight+'px';}}
G_vmlCanvasManager_.init();var dec2hex=[];for(var i=0;i<16;i++){for(var j=0;j<16;j++){dec2hex[i*16+j]=i.toString(16)+j.toString(16);}}
function createMatrixIdentity(){return[[1,0,0],[0,1,0],[0,0,1]];}
function matrixMultiply(m1,m2){var result=createMatrixIdentity();for(var x=0;x<3;x++){for(var y=0;y<3;y++){var sum=0;for(var z=0;z<3;z++){sum+=m1[x][z]*m2[z][y];}
result[x][y]=sum;}}
return result;}
function copyState(o1,o2){o2.fillStyle=o1.fillStyle;o2.lineCap=o1.lineCap;o2.lineJoin=o1.lineJoin;o2.lineWidth=o1.lineWidth;o2.miterLimit=o1.miterLimit;o2.shadowBlur=o1.shadowBlur;o2.shadowColor=o1.shadowColor;o2.shadowOffsetX=o1.shadowOffsetX;o2.shadowOffsetY=o1.shadowOffsetY;o2.strokeStyle=o1.strokeStyle;o2.arcScaleX_=o1.arcScaleX_;o2.arcScaleY_=o1.arcScaleY_;}
function processStyle(styleString){var str,alpha=1;styleString=String(styleString);if(styleString.substring(0,3)=="rgb"){var start=styleString.indexOf("(",3);var end=styleString.indexOf(")",start+1);var guts=styleString.substring(start+1,end).split(",");str="#";for(var i=0;i<3;i++){str+=dec2hex[Number(guts[i])];}
if((guts.length==4)&&(styleString.substr(3,1)=="a")){alpha=guts[3];}}else{str=styleString;}
return[str,alpha];}
function processLineCap(lineCap){switch(lineCap){case"butt":return"flat";case"round":return"round";case"square":default:return"square";}}
function CanvasRenderingContext2D_(surfaceElement){this.m_=createMatrixIdentity();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.strokeStyle="#000";this.fillStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=Z*1;this.globalAlpha=1;this.canvas=surfaceElement;var el=surfaceElement.ownerDocument.createElement('div');el.style.width=surfaceElement.clientWidth+'px';el.style.height=surfaceElement.clientHeight+'px';el.style.overflow='hidden';el.style.position='absolute';surfaceElement.appendChild(el);this.element_=el;this.arcScaleX_=1;this.arcScaleY_=1;};var contextPrototype=CanvasRenderingContext2D_.prototype;contextPrototype.clearRect=function(){this.element_.innerHTML="";this.currentPath_=[];};contextPrototype.beginPath=function(){this.currentPath_=[];};contextPrototype.moveTo=function(aX,aY){this.currentPath_.push({type:"moveTo",x:aX,y:aY});this.currentX_=aX;this.currentY_=aY;};contextPrototype.lineTo=function(aX,aY){this.currentPath_.push({type:"lineTo",x:aX,y:aY});this.currentX_=aX;this.currentY_=aY;};contextPrototype.bezierCurveTo=function(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){this.currentPath_.push({type:"bezierCurveTo",cp1x:aCP1x,cp1y:aCP1y,cp2x:aCP2x,cp2y:aCP2y,x:aX,y:aY});this.currentX_=aX;this.currentY_=aY;};contextPrototype.quadraticCurveTo=function(aCPx,aCPy,aX,aY){var cp1x=this.currentX_+2.0/3.0*(aCPx-this.currentX_);var cp1y=this.currentY_+2.0/3.0*(aCPy-this.currentY_);var cp2x=cp1x+(aX-this.currentX_)/3.0;var cp2y=cp1y+(aY-this.currentY_)/3.0;this.bezierCurveTo(cp1x,cp1y,cp2x,cp2y,aX,aY);};contextPrototype.arc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){aRadius*=Z;var arcType=aClockwise?"at":"wa";var xStart=aX+(mc(aStartAngle)*aRadius)-Z2;var yStart=aY+(ms(aStartAngle)*aRadius)-Z2;var xEnd=aX+(mc(aEndAngle)*aRadius)-Z2;var yEnd=aY+(ms(aEndAngle)*aRadius)-Z2;if(xStart==xEnd&&!aClockwise){xStart+=0.125;}
this.currentPath_.push({type:arcType,x:aX,y:aY,radius:aRadius,xStart:xStart,yStart:yStart,xEnd:xEnd,yEnd:yEnd});};contextPrototype.rect=function(aX,aY,aWidth,aHeight){this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();};contextPrototype.strokeRect=function(aX,aY,aWidth,aHeight){this.beginPath();this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();this.stroke();};contextPrototype.fillRect=function(aX,aY,aWidth,aHeight){this.beginPath();this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();this.fill();};contextPrototype.createLinearGradient=function(aX0,aY0,aX1,aY1){var gradient=new CanvasGradient_("gradient");return gradient;};contextPrototype.createRadialGradient=function(aX0,aY0,aR0,aX1,aY1,aR1){var gradient=new CanvasGradient_("gradientradial");gradient.radius1_=aR0;gradient.radius2_=aR1;gradient.focus_.x=aX0;gradient.focus_.y=aY0;return gradient;};contextPrototype.drawImage=function(image,var_args){var dx,dy,dw,dh,sx,sy,sw,sh;var oldRuntimeWidth=image.runtimeStyle.width;var oldRuntimeHeight=image.runtimeStyle.height;image.runtimeStyle.width='auto';image.runtimeStyle.height='auto';var w=image.width;var h=image.height;image.runtimeStyle.width=oldRuntimeWidth;image.runtimeStyle.height=oldRuntimeHeight;if(arguments.length==3){dx=arguments[1];dy=arguments[2];sx=sy=0;sw=dw=w;sh=dh=h;}else if(arguments.length==5){dx=arguments[1];dy=arguments[2];dw=arguments[3];dh=arguments[4];sx=sy=0;sw=w;sh=h;}else if(arguments.length==9){sx=arguments[1];sy=arguments[2];sw=arguments[3];sh=arguments[4];dx=arguments[5];dy=arguments[6];dw=arguments[7];dh=arguments[8];}else{throw"Invalid number of arguments";}
var d=this.getCoords_(dx,dy);var w2=sw/2;var h2=sh/2;var vmlStr=[];var W=10;var H=10;vmlStr.push(' <g_vml_:group',' coordsize="',Z*W,',',Z*H,'"',' coordorigin="0,0"',' style="width:',W,';height:',H,';position:absolute;');if(this.m_[0][0]!=1||this.m_[0][1]){var filter=[];filter.push("M11='",this.m_[0][0],"',","M12='",this.m_[1][0],"',","M21='",this.m_[0][1],"',","M22='",this.m_[1][1],"',","Dx='",mr(d.x/Z),"',","Dy='",mr(d.y/Z),"'");var max=d;var c2=this.getCoords_(dx+dw,dy);var c3=this.getCoords_(dx,dy+dh);var c4=this.getCoords_(dx+dw,dy+dh);max.x=Math.max(max.x,c2.x,c3.x,c4.x);max.y=Math.max(max.y,c2.y,c3.y,c4.y);vmlStr.push("padding:0 ",mr(max.x/Z),"px ",mr(max.y/Z),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",filter.join(""),", sizingmethod='clip');")}else{vmlStr.push("top:",mr(d.y/Z),"px;left:",mr(d.x/Z),"px;")}
vmlStr.push(' ">','<g_vml_:image src="',image.src,'"',' style="width:',Z*dw,';',' height:',Z*dh,';"',' cropleft="',sx/w,'"',' croptop="',sy/h,'"',' cropright="',(w-sx-sw)/w,'"',' cropbottom="',(h-sy-sh)/h,'"',' />','</g_vml_:group>');this.element_.insertAdjacentHTML("BeforeEnd",vmlStr.join(""));};contextPrototype.stroke=function(aFill){var lineStr=[];var lineOpen=false;var a=processStyle(aFill?this.fillStyle:this.strokeStyle);var color=a[0];var opacity=a[1]*this.globalAlpha;var W=10;var H=10;lineStr.push('<g_vml_:shape',' fillcolor="',color,'"',' filled="',Boolean(aFill),'"',' style="position:absolute;width:',W,';height:',H,';"',' coordorigin="0 0" coordsize="',Z*W,' ',Z*H,'"',' stroked="',!aFill,'"',' strokeweight="',this.lineWidth,'"',' strokecolor="',color,'"',' path="');var newSeq=false;var min={x:null,y:null};var max={x:null,y:null};for(var i=0;i<this.currentPath_.length;i++){var p=this.currentPath_[i];if(p.type=="moveTo"){lineStr.push(" m ");var c=this.getCoords_(p.x,p.y);lineStr.push(mr(c.x),",",mr(c.y));}else if(p.type=="lineTo"){lineStr.push(" l ");var c=this.getCoords_(p.x,p.y);lineStr.push(mr(c.x),",",mr(c.y));}else if(p.type=="close"){lineStr.push(" x ");}else if(p.type=="bezierCurveTo"){lineStr.push(" c ");var c=this.getCoords_(p.x,p.y);var c1=this.getCoords_(p.cp1x,p.cp1y);var c2=this.getCoords_(p.cp2x,p.cp2y);lineStr.push(mr(c1.x),",",mr(c1.y),",",mr(c2.x),",",mr(c2.y),",",mr(c.x),",",mr(c.y));}else if(p.type=="at"||p.type=="wa"){lineStr.push(" ",p.type," ");var c=this.getCoords_(p.x,p.y);var cStart=this.getCoords_(p.xStart,p.yStart);var cEnd=this.getCoords_(p.xEnd,p.yEnd);lineStr.push(mr(c.x-this.arcScaleX_*p.radius),",",mr(c.y-this.arcScaleY_*p.radius)," ",mr(c.x+this.arcScaleX_*p.radius),",",mr(c.y+this.arcScaleY_*p.radius)," ",mr(cStart.x),",",mr(cStart.y)," ",mr(cEnd.x),",",mr(cEnd.y));}
if(c){if(min.x==null||c.x<min.x){min.x=c.x;}
if(max.x==null||c.x>max.x){max.x=c.x;}
if(min.y==null||c.y<min.y){min.y=c.y;}
if(max.y==null||c.y>max.y){max.y=c.y;}}}
lineStr.push(' ">');if(typeof this.fillStyle=="object"){var focus={x:"50%",y:"50%"};var width=(max.x-min.x);var height=(max.y-min.y);var dimension=(width>height)?width:height;focus.x=mr((this.fillStyle.focus_.x/width)*100+50)+"%";focus.y=mr((this.fillStyle.focus_.y/height)*100+50)+"%";var colors=[];if(this.fillStyle.type_=="gradientradial"){var inside=(this.fillStyle.radius1_/dimension*100);var expansion=(this.fillStyle.radius2_/dimension*100)-inside;}else{var inside=0;var expansion=100;}
var insidecolor={offset:null,color:null};var outsidecolor={offset:null,color:null};this.fillStyle.colors_.sort(function(cs1,cs2){return cs1.offset-cs2.offset;});for(var i=0;i<this.fillStyle.colors_.length;i++){var fs=this.fillStyle.colors_[i];colors.push((fs.offset*expansion)+inside,"% ",fs.color,",");if(fs.offset>insidecolor.offset||insidecolor.offset==null){insidecolor.offset=fs.offset;insidecolor.color=fs.color;}
if(fs.offset<outsidecolor.offset||outsidecolor.offset==null){outsidecolor.offset=fs.offset;outsidecolor.color=fs.color;}}
colors.pop();lineStr.push('<g_vml_:fill',' color="',outsidecolor.color,'"',' color2="',insidecolor.color,'"',' type="',this.fillStyle.type_,'"',' focusposition="',focus.x,', ',focus.y,'"',' colors="',colors.join(""),'"',' opacity="',opacity,'" />');}else if(aFill){lineStr.push('<g_vml_:fill color="',color,'" opacity="',opacity,'" />');}else{lineStr.push('<g_vml_:stroke',' opacity="',opacity,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',processLineCap(this.lineCap),'"',' weight="',this.lineWidth,'px"',' color="',color,'" />');}
lineStr.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",lineStr.join(""));this.currentPath_=[];};contextPrototype.fill=function(){this.stroke(true);}
contextPrototype.closePath=function(){this.currentPath_.push({type:"close"});};contextPrototype.getCoords_=function(aX,aY){return{x:Z*(aX*this.m_[0][0]+aY*this.m_[1][0]+this.m_[2][0])-Z2,y:Z*(aX*this.m_[0][1]+aY*this.m_[1][1]+this.m_[2][1])-Z2}};contextPrototype.save=function(){var o={};copyState(this,o);this.aStack_.push(o);this.mStack_.push(this.m_);this.m_=matrixMultiply(createMatrixIdentity(),this.m_);};contextPrototype.restore=function(){copyState(this.aStack_.pop(),this);this.m_=this.mStack_.pop();};contextPrototype.translate=function(aX,aY){var m1=[[1,0,0],[0,1,0],[aX,aY,1]];this.m_=matrixMultiply(m1,this.m_);};contextPrototype.rotate=function(aRot){var c=mc(aRot);var s=ms(aRot);var m1=[[c,s,0],[-s,c,0],[0,0,1]];this.m_=matrixMultiply(m1,this.m_);};contextPrototype.scale=function(aX,aY){this.arcScaleX_*=aX;this.arcScaleY_*=aY;var m1=[[aX,0,0],[0,aY,0],[0,0,1]];this.m_=matrixMultiply(m1,this.m_);};contextPrototype.clip=function(){};contextPrototype.arcTo=function(){};contextPrototype.createPattern=function(){return new CanvasPattern_;};function CanvasGradient_(aType){this.type_=aType;this.radius1_=0;this.radius2_=0;this.colors_=[];this.focus_={x:0,y:0};}
CanvasGradient_.prototype.addColorStop=function(aOffset,aColor){aColor=processStyle(aColor);this.colors_.push({offset:1-aOffset,color:aColor});};function CanvasPattern_(){}
G_vmlCanvasManager=G_vmlCanvasManager_;CanvasRenderingContext2D=CanvasRenderingContext2D_;CanvasGradient=CanvasGradient_;CanvasPattern=CanvasPattern_;}}
function HTMLTimer(sys,formID,code,posX,posY,width,height,description,value,showValue){this.create(sys,formID,code,posX,posY,width,height,description,value);this.STOPPED=1;this.STARTED=2;this.PAUSED=3;this.status=this.STOPPED;this.time=0;}
HTMLTimer.inherits(HTMLElementBase);HTMLTimer.prototype.name='HTMLTimer';HTMLTimer.prototype.tabable=true;HTMLTimer.prototype.setEnabled=function(v){this.callMethod(HTMLElementBase,"setEnabled",[v]);this.updateLayout();};HTMLTimer.prototype.designComponent=function(doc){this.div.className+=" fixed-height";this.divClass=this.div.className;if(this.tipoTimer&&this.tipoTimer.length){switch(this.tipoTimer.toLowerCase()){case"p":this.tipoTimer=0;break;case"r":this.tipoTimer=1;break;default:this.tipoTimer=0;break;}}else this.tipoTimer=0;if(this.continuo&&this.continuo.length){this.continuo=(this.continuo.toLowerCase()==="true");}else this.continuo=false;if(this.voltarValor&&this.voltarValor.length){this.voltarValor=(this.voltarValor.toLowerCase()==="true");}else this.voltarValor=false;if(this.formatoTimer&&this.formatoTimer.length>0){this.timeFormat=this.formatoTimer;}else if(mainform&&mainform.TIME_PATTERN){this.timeFormat=mainform.TIME_PATTERN;}else this.timeFormat="HH:mm:ss";webrun.include("assets/moment.min.js");var definedLocale=resources_locale.toLowerCase();if(definedLocale=='en_us')this.locale='en';else if(definedLocale=='pt_br')this.locale='pt-br';else if(definedLocale=='es_es')this.locale='es';else if(definedLocale=='fr_fr')this.locale='fr';else this.locale='en';moment.locale(this.locale);this.cardDiv=document.createElement("div");this.cardDiv.className="card bg-light overflow-auto w-100 h-100";this.div.appendChild(this.cardDiv);this.label=document.createElement("div");this.label.className="w-100 h-100 font-weight-bold d-flex align-items-center justify-content-center";this.label.style.fontSize="2rem";this.cardDiv.appendChild(this.label);var createStartButton=(this.mostrarIniciar&&this.mostrarIniciar.length&&this.mostrarIniciar.toLowerCase()=="true");var createPauseButton=(this.mostrarPausar&&this.mostrarPausar.length&&this.mostrarPausar.toLowerCase()=="true");var createStopButton=(this.mostrarParar&&this.mostrarParar.length&&this.mostrarParar.toLowerCase()=="true");var createResetButton=(this.mostrarReiniciar&&this.mostrarReiniciar.length&&this.mostrarReiniciar.toLowerCase()==="true");if(createStartButton||createPauseButton||createStopButton||createResetButton){this.buttonGroup=document.createElement("div");this.buttonGroup.className="btn-group";this.buttonGroup.style.flex="0 0 auto";this.buttonGroup.setAttribute("role","group");this.cardDiv.appendChild(this.buttonGroup);this.buttonClass="btn btn-light";}
if(createStartButton){this.startButton=document.createElement("button");this.startButton.type="button";this.startButton.className=this.buttonClass;this.buttonGroup.appendChild(this.startButton);var startButtonIcon=document.createElement("i");startButtonIcon.className="fas fa-play";this.startButton.appendChild(startButtonIcon);this.attachEvent(this.startButton,"click",this.start);}
if(createPauseButton){this.pauseButton=document.createElement("button");this.pauseButton.type="button";this.pauseButton.className=this.buttonClass;this.buttonGroup.appendChild(this.pauseButton);var pauseButtonIcon=document.createElement("i");pauseButtonIcon.className="fas fa-pause";this.pauseButton.appendChild(pauseButtonIcon);this.attachEvent(this.pauseButton,"click",this.pause);}
if(createStopButton){this.stopButton=document.createElement("button");this.stopButton.type="button";this.stopButton.className=this.buttonClass;this.buttonGroup.appendChild(this.stopButton);var stopButtonIcon=document.createElement("i");stopButtonIcon.className="fas fa-stop";this.stopButton.appendChild(stopButtonIcon);this.attachEvent(this.stopButton,"click",this.stop);}
if(createResetButton){this.resetButton=document.createElement("button");this.resetButton.type="button";this.resetButton.className=this.buttonClass;this.buttonGroup.appendChild(this.resetButton);var resetButtonIcon=document.createElement("i");resetButtonIcon.className="fas fa-redo";this.resetButton.appendChild(resetButtonIcon);this.attachEvent(this.resetButton,"click",this.reset);}
if(this.autoIniciar&&this.autoIniciar.length&&this.autoIniciar.toLowerCase()==="true"){this.start();}else{this.setStartTime();this.setValue(this.getTimerString());this.updateLayout();}};HTMLTimer.prototype.setWeight=function(w){this.weight=w;if(this.label){if(w){if(this.label.classList.contains("font-weight-normal"))
this.label.classList.remove("font-weight-normal");if(!this.label.classList.contains("font-weight-bold"))
this.label.classList.add("font-weight-bold");}else{if(this.label.classList.contains("font-weight-bold"))
this.label.classList.remove("font-weight-bold");if(!this.label.classList.contains("font-weight-normal"))
this.label.classList.add("font-weight-normal");}}};HTMLTimer.prototype.getTimerNumeric=function(){return(this.tipoTimer==1)?this.startTime.diff(moment()):moment().diff(this.startTime);};HTMLTimer.prototype.getTimerMoment=function(){return(this.tipoTimer==1)?moment.utc(this.overridenStartTime?this.overridenStartTime:this.startTime.diff(moment())):moment.parseZone(this.overridenStartTime?this.overridenStartTime:moment().diff(this.startTime));};HTMLTimer.prototype.getTimerString=function(){return this.getTimerMoment().format(this.timeFormat);};HTMLTimer.prototype.setStartTime=function(){var startOffset=(this.status==this.PAUSED)?this.pausedTime:this.valorInicial;if(startOffset&&startOffset.length){try{if(this.tipoTimer==1){this.startTime=moment().add(moment.duration(startOffset));}else{this.startTime=moment.parseZone(moment().diff(moment(startOffset,this.timeFormat)));}}catch(e){this.startTime=moment();}}else{this.startTime=moment();}};HTMLTimer.prototype.setValue=function(value,checkDependences){this.callMethod(HTMLElementBase,"setValue",[value,checkDependences]);if(this.label)this.label.innerText=value;if(this.parent&&this.parent.setValue){this.parent.setValue(value);}};HTMLTimer.prototype.start=function(){if(this.isStarted())return;this.setStartTime();this.overridenStartTime=null;this.status=this.STARTED;this.updateLayout();var object=this;this.updateTimer=setInterval(function(){if(object.tipoTimer==1&&!object.continuo&&object.getTimerNumeric()<=0){if(object.voltarValor){object.status=object.STOPPED;object.start();}else{object.overridenStartTime=100;object.stop();}}
var newValue=object.getTimerString();if(object.getValue()!=newValue){object.setValue(newValue);}},100);if(this.AoIniciar)this.AoIniciar.call(this);};HTMLTimer.prototype.isStopped=function(){return(this.status==this.STOPPED);};HTMLTimer.prototype.isPaused=function(){return(this.status==this.PAUSED);};HTMLTimer.prototype.isStarted=function(){return(this.status==this.STARTED);};HTMLTimer.prototype.pause=function(){if(this.isPaused()){this.start();}else{this.status=this.PAUSED;this.updateLayout();if(this.updateTimer){clearInterval(this.updateTimer);this.updateTimer=null;}
this.pausedTime=this.getTimerString();if(this.AoPausar)this.AoPausar.call(this);}};HTMLTimer.prototype.stop=function(){if(this.isStopped())return;this.status=this.STOPPED;this.updateLayout();if(this.updateTimer){clearInterval(this.updateTimer);this.updateTimer=null;}
if(this.AoParar)this.AoParar.call(this);};HTMLTimer.prototype.reset=function(){this.status=this.STOPPED;this.updateLayout();if(this.updateTimer){clearInterval(this.updateTimer);this.updateTimer=null;}
this.setValue(this.valorInicial);};HTMLTimer.prototype.updateLayout=function(){if(this.startButton)this.startButton.disabled=!this.enabled||(this.status==this.STARTED);if(this.pauseButton)this.pauseButton.disabled=!this.enabled||(this.status==this.PAUSED||this.status==this.STOPPED);if(this.stopButton)this.stopButton.disabled=!this.enabled||(this.status==this.STOPPED||this.status==this.PAUSED);if(this.resetButton)this.resetButton.disabled=!this.enabled||(this.status==this.STARTED);};var legendSummary={1:"left",2:"right",3:"top",4:"bottom"}
var currencies={'BRL':'pt-BR','EUR':'en-ES','USD':'en-US',}
function HTMLChart(sys,formID,code,posX,posY,width,height,alt,value){this.create(sys,formID,code,posX,posY,width,height,'',value);this.report=false;this.alt=alt;this.viewMode="Estender";this.url="";this.hasImage=true;this.legendSeries=[];}
HTMLChart.inherits(HTMLElementBase);HTMLChart.prototype.name='HTMLChart';HTMLChart.prototype.tabable=false;HTMLChart.prototype.zindex=2;HTMLChart.prototype.setUrl=function(url){this.url=url;this.context.innerHTML="";var actionClick=null;if(this.onclick){actionClick=this.getAction('doOnClick');}
this.img=new ImageObject().getImage(this.url,this.alt,actionClick,this.height,this.width);this.context.appendChild(this.img);}
HTMLChart.prototype.setHint=function(hint){this.callMethod(HTMLElementBase,"setHint",[hint]);if(this.img){let init=this.img.hint?false:true;if(this.img.getAttribute("data-original-title")){this.img.setAttribute("data-original-title",hint.replace(/(?:\r\n|\r|\n)/g,'<br />'));}else{this.img.hint=hint;this.img.alt=hint;this.img.title=hint.replace(/(?:\r\n|\r|\n)/g,'<br />');this.img.setAttribute("data-toggle","tooltip");this.img.setAttribute("data-html","true");if(init)bootstrapInitTooltip(this.img);}}};HTMLChart.prototype.designComponent=function(){this.div.className+=' fixed-height';this.divClass=this.div.className;var obj=this;this.table=document.createElement("div");this.table.className="h-100 w-100";this.context.appendChild(this.table);this.myChart=echarts.init(this.table);this.processSeries();this.option=this.processOption();if(this.option&&typeof this.option==="object"){this.myChart.setOption(this.option,true);}
if(this.onclick){this.myChart.on('click',function(){var values=arguments[0];obj.onclick.apply(obj,[values.seriesName,values.name,values.value]);});}
if(!this.resizeEventSet){mainform.addEventListener("resize",function(){if(obj)chartResize(obj.div);},false);this.resizeEventSet=true;}
if(this.doc.tab){this.doc.tab.addShownListener(function(){chartResize(obj.div);});}
setTimeout(chartResize,1);}
HTMLChart.prototype.doOnClick=function(){if(this.onclick){this.onclick.call(this);}}
HTMLChart.prototype.setVisible=function(v){this.callMethod(HTMLElementBase,"setVisible",[v]);this.myChart.resize();};HTMLChart.prototype.getPermissionDescription=function(){if(!isNullable(this.permissionDescription)){return this.permissionDescription;}
return this.callMethod(HTMLElementBase,"getPermissionDescription");}
HTMLChart.prototype.processSeries=function(){for(let index=0;index<this.series.length;index++){const element=this.series[index];element.color=element.randomColor?null:element.color;element.type=element.type.replace("h","");if(element.type==='area'){element.type=element.type.replace("area","line");element.areaStyle={};}
if(element.disposition){element.stack=element.disposition==2?element.type:'';}
if(element.showBrands&&!(element.type==='pie')){var tempLabel=element.label.concat();element.label={data:tempLabel,normal:{show:true,position:'inside',formatter:function(params){return getLabelTextBrands(params,element);}}};}
if(element.showLegend&&!(element.type==='pie')){this.legendSeries.push(element.name);}
if(element.matriz){element.data=element.data.sort(function(a,b){return parseFloat(a.value[0])-parseFloat(b.value[0]);});}
this.series[index]=element;}}
HTMLChart.prototype.processOption=function(){var option=null;var obj=this;var serie=this.series[0];if(serie.type==='pie'){option=this.getOptionByType(serie.type);option.legend.data=serie.label;option.legend.formatter=function(name){return getLabelTextLegend(name,serie,obj);}
if(serie.largestSliceDistance&&serie.data.length>0){let i=Math.max.apply(Math,serie.data.map(function(o,i){return i;}));serie.data[i].selected=true;}
if(serie.showBrands){delete serie.label;serie.label={};serie.label.formatter=function(params){return getLabelTextBrands(params,serie);};}}else{option=this.getOptionByType('multi');option.yAxis.splitLine={show:this.showGrid};option.xAxis.splitLine={show:this.showGrid};option.legend.data=this.legendSeries;option.grid.left=this.legendPosition==1&&this.showLegend&&this.legendOrientation.toLowerCase()!='horizontal'?'15%':option.grid.left;option.grid.right=this.legendPosition==2&&this.showLegend&&this.legendOrientation.toLowerCase()!='horizontal'?'15%':option.grid.right;option.grid.top=(this.legendPosition==1||this.legendPosition==3)&&this.showLegend&&this.legendOrientation.toLowerCase()=='horizontal'?'28%':'16%';option.grid.bottom=(this.legendPosition==4&&this.showLegend)?'20%':'10%';}
option.legend[legendSummary[this.legendPosition]]=5;option.legend.show=this.showLegend;option.legend.orient=this.legendOrientation?this.legendOrientation.toLowerCase():'horizontal';option.legend.type='scroll';option.legend.top=this.legendPosition<=3?'10%':null;if(this.groupLegend){option.tooltip.trigger=serie.type==='pie'?'item':'axis';}
if(!this.showTooltip)
option.tooltip.show=false;option.title={text:this.titulo,subtext:'',left:'center'};this.series[0]=serie;if(!option.series)
option.series=this.series;return option;}
HTMLChart.prototype.getAxisLabelFormat=function(){var element=this.series[0];if(element.matriz){return{formatter:function(value){var result=element.data.find(function(objData){return objData.value[0]===value;});return result&&result.name?result.name:"";}}}else{return{}}}
HTMLChart.prototype.getXAxis=function(){var object=this;var element=this.series[0];var xAxis={};if(element){if(element.horizontal){xAxis={type:'value',axisLabel:{formatter:function(data){return serieFormatter(data,element.decimalPrecision,'xAxis',object);}}};}else{xAxis={type:'category',data:element.label.data?element.label.data:element.label,axisLabel:this.getAxisLabelFormat()};}}
if(element.matriz)
delete xAxis.data;return xAxis;}
HTMLChart.prototype.getYAxis=function(){var object=this;var element=this.series[0];var yAxis;if(element){if(element.horizontal){yAxis={type:'category',data:element.label.data?element.label.data:element.label,axisLabel:this.getAxisLabelFormat()};}else{yAxis={type:'value',axisLabel:{formatter:function(data){return serieFormatter(data,element.decimalPrecision,'yAxis',object);}}};}}
if(element.matriz)
delete yAxis.data;return yAxis;}
HTMLChart.prototype.getOptionByType=function(type){var object=this;if(type==='multi')
return{theme:'light',tooltip:{axisPointer:{type:'shadow'},formatter:function(data){return serieFormatter(data,object.series[0].decimalPrecision,null,object);},confine:true,},grid:{left:'3%',right:'4%',bottom:'3%',containLabel:true},legend:{selected:{}},xAxis:this.getXAxis(),yAxis:this.getYAxis()};if(type==='pie')
return{theme:'dark',tooltip:{axisPointer:{type:'shadow'},formatter:function(data){return serieFormatter(data,object.series[0].decimalPrecision,null,object);},confine:true,},legend:{}};}
HTMLChart.prototype.refreshChart=function(){this.processSeries();this.option=this.processOption();if(this.option&&typeof this.option==="object"){this.myChart.setOption(this.option,true);}}
function getLabelTextBrands(params,serie){let data=serie.data;var name=params.name;var objSerie=serie;var result=data.find(function(x){return x.name===name;}),valueX,valueY;if(serie.matriz){valueX=result.value[0];valueY=result.value[1]}else{valueX=serie.type==='pie'?data.findIndex(function(x){return x.name===name;}):name;valueY=result.value;}
if(objSerie.contentBrands==1){return name;}else if(objSerie.contentBrands==2){return name+" "+getPercentByData(data,name,serie);}else if(objSerie.contentBrands==3){return name+" "+getPercentByData(data,name,serie)+" "+
data.map(function(item){return item.value;}).reduce(function(prev,next){return prev+next;});}else if(objSerie.contentBrands==4){return name+" "+valueY.toFixed(serie.decimalPrecision);}else if(objSerie.contentBrands==5){return data.findIndex(function(x){return x.name===name;});}else if(objSerie.contentBrands==6){return getPercentByData(data,name,serie);}else if(objSerie.contentBrands==7){return getPercentByData(data,name,serie)+" "+
data.map(function(item){return item.value;}).reduce(function(prev,next){return prev+next;});}else if(objSerie.contentBrands==8){return valueY.toFixed(serie.decimalPrecision);}else if(objSerie.contentBrands==9){return valueX.toFixed(serie.decimalPrecision);}else if(objSerie.contentBrands==10){return valueX.toFixed(serie.decimalPrecision)+" "+valueY.toFixed(serie.decimalPrecision);}else{return name;}};function getLabelTextLegend(name,serie,obj){let data=serie.data,zero={"value":0};var valueX=data.findIndex(function(item){return item.name===name;});if(obj.styleTextLegend==1){return getPercentByData(data,name,serie)+" "+name;}else if(obj.styleTextLegend==2){var result=data.filter(function(obj){return obj.name===name?obj.value:null});return chartsFormatNumber(result.length>0?result[0].value:zero.value,serie.decimalPrecision,serie.currency)+" "+name;}else if(obj.styleTextLegend==3){return getPercentByData(data,name,serie);}else if(obj.styleTextLegend==4){return name;}else if(obj.styleTextLegend==5){return name+" "+getPercentByData(data,name,serie);}else if(obj.styleTextLegend==6){var result=data.filter(function(obj){return obj.name===name?obj.value:null});return name+" "+chartsFormatNumber(result.length>0?result[0].value:zero.value,serie.decimalPrecision,serie.currency);}else if(obj.styleTextLegend==7){var result=data.filter(function(obj){return obj.name===name?obj.value:null});return chartsFormatNumber(result.length>0?result[0].value:zero.value,serie.decimalPrecision,serie.currency);}else if(obj.styleTextLegend==8){return valueX+" "+getPercentByData(data,name,serie);}else if(obj.styleTextLegend==9){var result=data.filter(function(obj){return obj.name===name?obj.value:null;});return valueX+" "+chartsFormatNumber(result.length>0?result[0].value:zero.value,serie.decimalPrecision,serie.currency);}else if(obj.styleTextLegend==10){return valueX;}else{return name;}};function getPercentByData(data,name,serie){var total=0;var target;for(var i=0,l=data.length;i<l;i++){total+=serie.matriz?data[i].value[1]:data[i].value;if(data[i].name==name){target=serie.matriz?data[i].value[1]:data[i].value;}}
var arr=[((target/total)*100).toFixed(2)+'%']
return arr.join('\n')}
function chartResize(element){let chartsTab=element?[element]:d.t.getSelectedTab().div.querySelectorAll("[webrun-type='HTMLChart']");for(let i=0;i<chartsTab.length;i++){chart=$c(chartsTab[i].id);if(chart===undefined||chart===null)continue;chart.myChart.resize();}
return false;}
function serieFormatter(registers,decimalPrecision,type,object){let ticket='';let seriesName='';let value='';let color='';let htmlBody='';type=type?type.toLocaleLowerCase():"";if(type==='yaxis'||type==='xaxis'){return chartsFormatNumber(registers,decimalPrecision);}else if(Array.isArray(registers)){ticket=registers[0].data.name;let size=registers.length;for(let serie=0;serie<size;serie++){seriesName=registers[serie].seriesName;if(object.series[0].matriz){ticket=registers[serie].data.value[0];value=registers[serie].data.value[1];}else{value=registers[serie].data.value;}
color=registers[serie].color;value=chartsFormatNumber(value,decimalPrecision,object.series[serie].currency);var addBreakLine=!(serie===size-1);htmlBody+=embededBody(color,seriesName,value,addBreakLine);}
return ticket?(embededHeader(ticket)+htmlBody):htmlBody;}else{ticket=registers.data.name;seriesName=registers.seriesName;value=registers.data.value;color=registers.color;value=parseFloat(value);value=chartsFormatNumber(value,decimalPrecision,object.series[0].currency);htmlBody+=embededBody(color,seriesName,value,false);return embededHeader(ticket)+htmlBody;}}
function chartsFormatNumber(value,decimalPrecision,currencyLocale){if(value!==null||value!==undefined||value!=='undefined'||value!==''){let options={minimumFractionDigits:decimalPrecision,maximumFractionDigits:decimalPrecision};let currentLocale=resources_locale.replace('_','-');if(currencyLocale){options.style='currency';options.currency=currencyLocale;currentLocale=currencies[currencyLocale];}
value=parseFloat(value);return value.toLocaleString(currentLocale,options);}}
function embededHeader(ticket){return'<span style="font-size:14px; color:#666; font-weight:400; line-height:1">'+ticket+'</span><br>';}
function embededBody(color,seriesName,value,addBreakLine){let embededBody='';embededBody+='<span style="display:inline-block; margin-right:4px; border-radius:10px; width:10px; height:10px; background-color:'+color+';"></span>';embededBody+='<span style="font-size: 14px; margin-left:2px; font-weight: 400; color:#666">'+seriesName+'</span>';embededBody+='<span style="float: right; margin-left: 20px; font-size: 14px; font-weight: 900; color:#666">'+value+'</span>';return addBreakLine?(embededBody+'<br>'):embededBody;}
function HTMLSerie(sys,formID,code,posX,posY,width,height,alt,value){this.create(sys,formID,code,posX,posY,width,height,'',value);}
HTMLSerie.inherits(HTMLElementBase);HTMLSerie.prototype.name='HTMLSerie';HTMLSerie.prototype.tabable=false;HTMLSerie.prototype.zindex=0;HTMLSerie.prototype.designComponent=function(doc){if(this.div){this.div.className="d-none";this.divClass=this.div.className;}};HTMLSerie.prototype.toPermissionMode=function(){};function HTMLDualList(sys,formID,code,posX,posY,width,height,descriptionLeft,descriptionRight,labels,values,labelsRIGHT,valuesRIGHT,duploClicar,btAddItem,btAddAll,btRemItem,btRemAll){this.create(sys,formID,code,posX,posY,width,height,descriptionLeft,descriptionRight,labels,values,labelsRIGHT,valuesRIGHT,duploClicar,btAddItem,btAddAll,btRemItem,btRemAll);this.labels=labels;this.values=values;if(!this.values)this.values=this.labels;this.labelsRIGHT=labelsRIGHT;this.valuesRIGHT=valuesRIGHT;if(!this.valuesRIGHT)this.valuesRIGHT=this.labelsRIGHT;this.descPrincipal=descriptionLeft;this.descSelecionados=descriptionRight;this.duploClicar=duploClicar;this.btAddItem=btAddItem;this.btAddAll=btAddAll;this.btRemItem=btRemItem;this.btRemAll=btRemAll;this.search=true;this.leftSearching=false;this.rightSearching=false;}
HTMLDualList.inherits(HTMLElementBase);HTMLDualList.prototype.name='HTMLDualList';HTMLDualList.prototype.tabable=true;HTMLDualList.prototype.tagName='duallist';HTMLDualList.prototype.zIndex=301;HTMLDualList.prototype.fieldsLEFT=function(){return this.leftSelect;};HTMLDualList.prototype.fieldsRIGHT=function(){return this.rightSelect;};HTMLDualList.prototype.moveAllOptions=function(event,side,param){document.hasRuleException=false;if(!this.visible||!this.enabled||this.readonly)return;var selectIN=(side=="LEFT")?this.leftSelect:this.rightSelect;var selectOUT=(side=="LEFT")?this.rightSelect:this.leftSelect;var arrElements=[];if((side=="LEFT"&&this.leftSearching)||(side=="RIGHT"&&this.rightSearching)){var searchSelectIn=(side=="LEFT")?this.leftSearchSelect:this.rightSearchSelect;var queryOptions=[],i=0;for(i=0;i<searchSelectIn.options.length;i++){queryOptions.push(searchSelectIn.options[i].value);}
if(queryOptions.length>0){for(i=0;i<selectIN.options.length;i++){if(queryOptions.indexOf(selectIN.options[i].value)!=-1){arrElements.push([i,selectIN.options[i].value,selectIN.options[i].text]);}}}}else{for(var i=0;i<selectIN.options.length;i++){arrElements.push([i,selectIN.options[i].value,selectIN.options[i].text]);}}
var auxiliar=0;if(arrElements.length>0){var eventException=(side=="LEFT")?!this.invokeEventsBeforeAddAll():!this.invokeEventsBeforeRemAll();if(eventException)return;for(var i=0;i<=arrElements.length-1;i++){var element=arrElements[i];var index=element[0];var value=element[1];var text=element[2];if(this.includeOption(selectOUT,value,text,param)){this.deleteOption(selectIN,index-auxiliar);auxiliar++;}}
eventException=(side=="LEFT")?!this.invokeEventsAfterAddAll():!this.invokeEventsAfterRemAll();if(eventException)return;}
this.searchOption("LEFT",this.leftSearchInput.value);this.searchOption("RIGHT",this.rightSearchInput.value);};HTMLDualList.prototype.moveOption=function(event,side,param){document.hasRuleException=false;if(!this.visible||!this.enabled||this.readonly)return;var selectIN=(side=="LEFT")?this.leftSelect:this.rightSelect;var selectOUT=(side=="LEFT")?this.rightSelect:this.leftSelect;var arrElements=[];if((side=="LEFT"&&this.leftSearching)||(side=="RIGHT"&&this.rightSearching)){var searchSelectIn=(side=="LEFT")?this.leftSearchSelect:this.rightSearchSelect;var selectedOptions=[],i=0;for(i=0;i<searchSelectIn.options.length;i++){if(searchSelectIn.options[i].selected){selectedOptions.push(searchSelectIn.options[i].value);}}
if(selectedOptions.length>0){for(i=0;i<selectIN.options.length;i++){if(selectedOptions.indexOf(selectIN.options[i].value)!=-1){arrElements.push([i,selectIN.options[i].value,selectIN.options[i].text]);}}}}else{for(var i=0;i<selectIN.options.length;i++){if(selectIN.options[i].selected){arrElements.push([i,selectIN.options[i].value,selectIN.options[i].text]);}}}
var auxiliar=0;for(var i=0;i<arrElements.length;i++){var element=arrElements[i];var index=element[0];var value=element[1];var text=element[2];var canContinue=this.includeOption(selectOUT,value,text,param);if(canContinue){this.deleteOption(selectIN,index-auxiliar);auxiliar++;}}
this.searchOption("LEFT",this.leftSearchInput.value);this.searchOption("RIGHT",this.rightSearchInput.value);}
HTMLDualList.prototype.invertSide=function(side){return(side=="LEFT")?"RIGHT":"LEFT";};HTMLDualList.prototype.includeOption=function(select,value,text,param){var side=this.invertSide(select.getAttribute("SIDE"));var status=false;if(param=="double"){this.invokeEventsDoubleClick(value,text);if(!document.hasRuleException){this.addItem(select,value,text);status=true;}}else if(side=="LEFT"){this.invokeEventsBeforeAdd(value,text,param);if(!document.hasRuleException){this.addItem(select,value,text);status=true;}
this.invokeEventsAfterAdd(value,text,param);}else{this.invokeEventsBeforeRem(value,text,param);if(!document.hasRuleException){this.addItem(select,value,text);status=true;}
this.invokeEventsAfterRem(value,text,param);}
return status;};HTMLDualList.prototype.addItem=function(select,value,text){var side=select.getAttribute("SIDE");var option=this.createOption(value,text,side);var length=select.options.length;select.options[length]=option;this.inputOption(value,this.invertSide(side));};HTMLDualList.prototype.contains=function(array,value){return arrayIndexOf(array,value)>=0;};HTMLDualList.prototype.getInputValue=function(array){var first=true;var inputValue="";if(array!=null&&array.length>0){for(index=0;index<array.length;index++){var value=array[index];if(first){inputValue=value;first=false;}else{inputValue+=("|"+value);}}}
return inputValue;};HTMLDualList.prototype.inputOption=function(value,side){if(side=="LEFT"){if(this.contains(this.elementsToRemove,value)){arrayRemove(this.elementsToRemove,value);}else{this.elementsToAdd.push(value);}}else{if(this.contains(this.elementsToAdd,value)){arrayRemove(this.elementsToAdd,value);}else{this.elementsToRemove.push(value);}}
this.inputInclude.value=this.getInputValue(this.elementsToAdd);this.inputDelete.value=this.getInputValue(this.elementsToRemove);};HTMLDualList.prototype.deleteOption=function(select,index){if(select.options.length>0){value=select.options[index].value;text=select.options[index].text;select.options[index]=null;}};HTMLDualList.prototype.designComponent=function(doc){var object=this;this.div.className+=" card fixed-height p-3";this.divClass=this.div.className;this.elementsToAdd=new Array();this.elementsToRemove=new Array();this.rowDiv=document.createElement("div");this.rowDiv.className="row no-gutters w-100 h-100 flex-fill";this.div.appendChild(this.rowDiv);this.leftColDiv=document.createElement("div");this.leftColDiv.className="col h-100 d-flex flex-column";this.rowDiv.appendChild(this.leftColDiv);this.middleColDiv=document.createElement("div");this.middleColDiv.className="col h-100 mx-3 d-flex flex-column align-items-center justify-content-center flex-nowrap";this.middleColDiv.style.maxWidth="1.5rem";this.rowDiv.appendChild(this.middleColDiv);this.rightColDiv=document.createElement("div");this.rightColDiv.className="col h-100 d-flex flex-column";this.rowDiv.appendChild(this.rightColDiv);if(this.descPrincipal&&this.descPrincipal.length>0){this.descPrincipalLabel=document.createElement("label");this.descPrincipalLabel.className="text-break mt-0 mb-2 w-100";this.descPrincipalLabel.innerHTML=this.descPrincipal;this.leftColDiv.appendChild(this.descPrincipalLabel);}
if(this.descSelecionados&&this.descSelecionados.length>0){this.descSelecionadosLabel=document.createElement("label");this.descSelecionadosLabel.className="text-break mt-0 mb-2 w-100";this.descSelecionadosLabel.innerHTML=this.descSelecionados;this.rightColDiv.appendChild(this.descSelecionadosLabel);}
this.buttonsClass="generic-btn mb-2";if(this.btAddItem){this.addOptionButton=document.createElement("div");this.addOptionButton.className=this.buttonsClass;this.addOptionButton.title=getLocaleMessage("LABEL.ADD_ITEM");this.addOptionButton.setAttribute("data-toggle","tooltip");this.middleColDiv.appendChild(this.addOptionButton);var addOptionButtonIcon=document.createElement("i");addOptionButtonIcon.className="fas fa-chevron-right";this.addOptionButton.appendChild(addOptionButtonIcon);this.attachEvent(this.addOptionButton,'click',this.moveOption,this,["LEFT","item"]);}
if(this.btAddAll){this.addAllOptionsButton=document.createElement("div");this.addAllOptionsButton.className=this.buttonsClass;this.addAllOptionsButton.title=getLocaleMessage("LABEL.ADD_ALL");this.addAllOptionsButton.setAttribute("data-toggle","tooltip");this.middleColDiv.appendChild(this.addAllOptionsButton);var addAllOptionsButtonIcon=document.createElement("i");addAllOptionsButtonIcon.className="fas fa-angle-double-right";this.addAllOptionsButton.appendChild(addAllOptionsButtonIcon);this.attachEvent(this.addAllOptionsButton,'click',this.moveAllOptions,this,["LEFT","all"]);}
if(this.btRemAll){this.removeAllOptionsButton=document.createElement("div");this.removeAllOptionsButton.className=this.buttonsClass;this.removeAllOptionsButton.title=getLocaleMessage("LABEL.REMOVE_ALL");this.removeAllOptionsButton.setAttribute("data-toggle","tooltip");this.middleColDiv.appendChild(this.removeAllOptionsButton);var removeAllOptionsButtonIcon=document.createElement("i");removeAllOptionsButtonIcon.className="fas fa-angle-double-left";this.removeAllOptionsButton.appendChild(removeAllOptionsButtonIcon);this.attachEvent(this.removeAllOptionsButton,'click',this.moveAllOptions,this,["RIGHT","all"]);}
if(this.btRemItem){this.removeOptionButton=document.createElement("div");this.removeOptionButton.className=this.buttonsClass;this.removeOptionButton.title=getLocaleMessage("LABEL.REMOVE_ITEM");this.removeOptionButton.setAttribute("data-toggle","tooltip");this.middleColDiv.appendChild(this.removeOptionButton);var removeOptionButtonIcon=document.createElement("i");removeOptionButtonIcon.className="fas fa-chevron-left";this.removeOptionButton.appendChild(removeOptionButtonIcon);this.attachEvent(this.removeOptionButton,'click',this.moveOption,this,["RIGHT","item"]);}
this.inputInclude=document.createElement("input");this.inputInclude.setAttribute("type","hidden");this.inputInclude.id="WFRInputInclude"+this.code;this.inputInclude.name="WFRInputInclude"+this.code;this.div.appendChild(this.inputInclude);this.inputDelete=document.createElement("input");this.inputDelete.setAttribute("type","hidden");this.inputDelete.id="WFRInputDelete"+this.code;this.inputDelete.name="WFRInputDelete"+this.code;this.div.appendChild(this.inputDelete);if(this.search){this.leftSearchInput=document.createElement("input");this.leftSearchInput.type="text";this.leftSearchInput.className="form-control mb-2";this.leftSearchInput.style.fontSize="0.8rem";this.leftSearchInput.disabled=!this.enabled;this.leftSearchInput.readOnly=this.readonly;this.leftColDiv.appendChild(this.leftSearchInput);this.leftSearchSelect=this.createSelect("LEFT"+"Results");this.leftSearchSelectClass=this.leftSearchSelect.className;this.leftSearchSelect.className="d-none";this.leftColDiv.appendChild(this.leftSearchSelect);this.rightSearchInput=document.createElement("input");this.rightSearchInput.type="text";this.rightSearchInput.className="form-control mb-2";this.rightSearchInput.style.fontSize="0.8rem";this.rightSearchInput.disabled=!this.enabled;this.rightSearchInput.readOnly=this.readonly;this.rightColDiv.appendChild(this.rightSearchInput);this.rightSearchSelect=this.createSelect("RIGHT"+"Results");this.rightSearchSelectClass=this.rightSearchSelect.className;this.rightSearchSelect.className="d-none";this.rightColDiv.appendChild(this.rightSearchSelect);this.attachEvent(this.leftSearchInput,"input",function(){object.searchOption("LEFT",object.leftSearchInput.value);});this.attachEvent(this.rightSearchInput,"input",function(){object.searchOption("RIGHT",object.rightSearchInput.value);});}
this.leftSelect=this.createSelect("LEFT");this.leftSelectClass=this.leftSelect.className;this.setOptions(this.leftSelect,this.labels,this.values);this.leftColDiv.appendChild(this.leftSelect);this.rightSelect=this.createSelect("RIGHT");this.rightSelectClass=this.rightSelect.className;this.setOptions(this.rightSelect,this.labelsRIGHT,this.valuesRIGHT);this.rightColDiv.appendChild(this.rightSelect);};HTMLDualList.prototype.createSelect=function(side){var select=document.createElement("select");var selectId="WFRInput"+side+this.code;select.id=selectId;select.name=selectId;select.disabled=!this.enabled;select.readOnly=this.readonly;select.className="form-control w-100 h-100 flex-fill";select.setAttribute("side",side);select.setAttribute("multiple","multiple");this.setDecorationObject(select);if(this.descPrincipalLabel)this.setDecorationLabelPrincipal(this.descPrincipalLabel);if(this.descSelecionadosLabel)this.setDecorationLabelSelecionados(this.descSelecionadosLabel);if(this.duploClicar)this.attachEvent(select,"dblclick",this.doubleClickAction,this,[side]);if(this.tabable)this.attachEvent(select,"keypress",this.selectKeyPressAction,this,[side]);return select;};HTMLDualList.prototype.getOptionsArrays=function(side){var labels=[],values=[];var selectElement=(side=="LEFT")?this.leftSelect:this.rightSelect;for(var i=0;i<selectElement.children.length;i++){var item=selectElement.children[i];labels.push(item.innerHTML);values.push(item.value);}
return{labels:labels,values:values};};HTMLDualList.prototype.searchOption=function(side,query){var arrays=this.getOptionsArrays(side);if(side=="LEFT"){this.leftSearchSelect.innerHTML="";this.leftSearching=false;if(query&&query.trim().length>0){this.leftSearching=true;this.leftSelect.className="d-none";this.leftSearchSelect.className=this.leftSearchSelectClass;this.setOptions(this.leftSearchSelect,arrays.labels,arrays.values,query);}else{this.leftSelect.className=this.leftSelectClass;this.leftSearchSelect.className="d-none";}}else if(side=="RIGHT"){this.rightSearchSelect.innerHTML="";this.rightSearching=false;if(query&&query.trim().length>0){this.rightSearching=true;this.rightSelect.className="d-none";this.rightSearchSelect.className=this.rightSearchSelectClass;this.setOptions(this.rightSearchSelect,arrays.labels,arrays.values,query);}else{this.rightSelect.className=this.rightSelectClass;this.rightSearchSelect.className="d-none";}}};HTMLDualList.prototype.selectKeyPressAction=function(evt,side){var altKey=false;var ctrlKey=false;var shiftKey=false;var target=evt.target||evt.srcElement;var keyCode=evt.keyCode||evt.which;var chr=String.fromCharCode(keyCode).toUpperCase();if(w3c){if(document.layers){altKey=((evt.modifiers&Event.ALT_MASK)>0);ctrlKey=((evt.modifiers&Event.CONTROL_MASK)>0);shiftKey=((evt.modifiers&Event.SHIFT_MASK)>0);}else{altKey=evt.altKey;ctrlKey=evt.ctrlKey;shiftKey=evt.shiftKey;}}else{altKey=evt.altKey;ctrlKey=evt.ctrlKey;shiftKey=evt.shiftKey;}
var r=true;if(!shiftKey&&keyCode==9){r=false;if(side=="LEFT"){this.rightSelect.focus();}else{controller.next(this);}}else if(shiftKey&&keyCode==9){r=false;if(side=="LEFT"){controller.focusFirst();}else{this.leftSelect.focus();}}else if(!this.readonly&&!altKey&&ctrlKey&&(chr=='A')){r=false;this.selectAll(target);}else if(!this.readonly&&keyCode==13){r=false;this.moveOption(target,evt,side,"enter");}
if(!r){document.disableEvents=true;if(evt.preventDefault){evt.preventDefault();evt.stopPropagation();}else{evt.keyCode=0;evt.returnValue=false;}
return false;}else return true;};HTMLDualList.prototype.selectAll=function(select){for(var i=0;i<select.options.length;i++){select.options[i].selected=true;}};HTMLDualList.prototype.setDecorationObject=function(obj){if(this.font)obj.style.fontFamily=this.font;if(this.size)obj.style.fontSize=this.size;if(this.weight)obj.style.fontWeight="bold";if(this.italic)obj.style.fontStyle="italic";var textDecoration="";if(this.underline||this.strikeout){if(this.underline)textDecoration+="underline";if(this.strikeout)textDecoration+=" line-through";}else textDecoration="none";obj.style.textDecoration=textDecoration;if(this.color){obj.style.color=this.color;}};HTMLDualList.prototype.setDecorationLabelPrincipal=function(obj){if(this.fontPrincipal)obj.style.fontFamily=this.fontPrincipal;if(this.sizePrincipal)obj.style.fontSize=this.sizePrincipal;if(this.weightPrincipal)obj.style.fontWeight="bold";if(this.italicPrincipal)obj.style.fontStyle="italic";var textDecoration="";if(this.underlinePrincipal||this.strikeoutPrincipal){if(this.underlinePrincipal)textDecoration+="underline";if(this.strikeoutPrincipal)textDecoration+=" line-through";}else textDecoration="none";obj.style.textDecoration=textDecoration;if(this.colorPrincipal){obj.style.color=this.colorPrincipal;}};HTMLDualList.prototype.setDecorationLabelSelecionados=function(obj){if(this.fontSelecionados)obj.style.fontFamily=this.fontSelecionados;if(this.sizeSelecionados)obj.style.fontSize=this.sizeSelecionados;if(this.weightSelecionados)obj.style.fontWeight="bold";if(this.italicSelecionados)obj.style.fontStyle="italic";var textDecoration="";if(this.underlineSelecionados||this.strikeoutSelecionados){if(this.underlineSelecionados)textDecoration+="underline";if(this.strikeoutSelecionados)textDecoration+=" line-through";}else textDecoration="none";obj.style.textDecoration=textDecoration;if(this.colorSelecionados){obj.style.color=this.colorSelecionados;}};HTMLDualList.prototype.setDecorationDescriptionLEFT=function(f,s,w,i,u,st,c){this.fontPrincipal=f;this.sizePrincipal=s;this.weightPrincipal=w;this.italicPrincipal=i;this.underlinePrincipal=u;this.strikeoutPrincipal=st;this.colorPrincipal=c;};HTMLDualList.prototype.setDecorationDescriptionRIGHT=function(f,s,w,i,u,st,c){this.fontSelecionados=f;this.sizeSelecionados=s;this.weightSelecionados=w;this.italicSelecionados=i;this.underlineSelecionados=u;this.strikeoutSelecionados=st;this.colorSelecionados=c;};HTMLDualList.prototype.doubleClickAction=function(target,side){if(!d.n.visible||edit||insert){this.moveOption(target,side,"double");}};HTMLDualList.prototype.validateSelect=function(select){if(select==null||(typeof select=="undefined")){throw"Undefined "+this.name+".";}};HTMLDualList.prototype.createOption=function(value,text,side,query){var formattedText=replaceAll(replaceAll(text,'>','&gt;'),'<','&lt;');if(query){var queryIndex=text.toLowerCase().indexOf(query);formattedText=text.substring(0,queryIndex)+"<b>"+text.substring(queryIndex,queryIndex+query.length)+"</b>"+
text.substring(queryIndex+query.length,text.length);}
var option=document.createElement("option");option.className="p-1";option.value=value;option.innerHTML=formattedText;option.title=text;return option;};HTMLDualList.prototype.setOptions=function(select,labels,values,query){this.validateSelect(select);if(query&&query.length>0)query=query.trim().toLowerCase();for(var i=0;i<values.length;i++){if(!query||query.length==0||labels[i].trim().toLowerCase().indexOf(query)!=-1){select.appendChild(this.createOption(values[i],labels[i],select.getAttribute("SIDE"),query));}}};HTMLDualList.prototype.setReadOnly=function(v){this.callMethod(HTMLElementBase,"setReadOnly",[v]);if(this.leftSelect)this.leftSelect.readOnly=this.readonly;if(this.rightSelect)this.rightSelect.readOnly=this.readonly;if(this.leftSearchSelect)this.leftSearchSelect.readOnly=this.readonly;if(this.rightSearchSelect)this.rightSearchSelect.readOnly=this.readonly;if(this.leftSearchInput)this.leftSearchInput.readOnly=this.readonly;if(this.rightSearchInput)this.rightSearchInput.readOnly=this.readonly;};HTMLDualList.prototype.setEnabled=function(enable){this.callMethod(HTMLElementBase,"setEnabled",[enable]);if(this.leftSelect)this.leftSelect.disabled=!this.enabled;if(this.rightSelect)this.rightSelect.disabled=!this.enabled;if(this.leftSearchSelect)this.leftSearchSelect.disabled=!this.enabled;if(this.rightSearchSelect)this.rightSearchSelect.disabled=!this.enabled;if(this.leftSearchInput)this.leftSearchInput.disabled=!this.enabled;if(this.rightSearchInput)this.rightSearchInput.disabled=!this.enabled;if(this.addOptionButton)this.addOptionButton.className=this.buttonsClass+(this.enabled?"":" disabled");if(this.addAllOptionsButton)this.addAllOptionsButton.className=this.buttonsClass+(this.enabled?"":" disabled");if(this.removeAllOptionsButton)this.removeAllOptionsButton.className=this.buttonsClass+(this.enabled?"":" disabled");if(this.removeOptionButton)this.removeOptionButton.className=this.buttonsClass+(this.enabled?"":" disabled");};HTMLDualList.prototype.focus=function(){if(this.enabled&&this.visible&&(!this.readonly)){if(isVisibleDiv(this.leftSelect))this.leftSelect.focus();return true;}
return false;}
HTMLDualList.prototype.clearInput=function(){this.elementsToAdd=new Array();this.elementsToRemove=new Array();if(this.inputInclude)this.inputInclude.value='';if(this.inputDelete)this.inputDelete.value='';};HTMLDualList.prototype.clearBoth=function(){this.oldLeftSelect=this.backup(this.leftSelect);this.oldRightSelect=this.backup(this.rightSelect);this.clear(this.leftSelect);this.clear(this.rightSelect);};HTMLDualList.prototype.backup=function(select){this.validateSelect(select);var selectSaved=new Array();for(var i=select.options.length-1;i>=0;i--)
selectSaved.push(select.options[i].value);return selectSaved;};HTMLDualList.prototype.clear=function(select){this.validateSelect(select);for(var i=select.options.length-1;i>=0;i--){select.options[i]=null;}};HTMLDualList.prototype.invokeEventsDoubleClick=function(value,text){if(this.ondblclick)this.ondblclick(value,text);};HTMLDualList.prototype.invokeEventsBeforeAdd=function(value,text,param,movingAll){if((param=="item"||param=="enter")&&this.onBeforeAddItem){this.onBeforeAddItem(value,text);}};HTMLDualList.prototype.invokeEventsBeforeAddAll=function(){if(this.onBeforeAddAll){this.onBeforeAddAll();return!document.hasRuleException;}
return true;};HTMLDualList.prototype.invokeEventsAfterAdd=function(value,text,param){if((param=="item"||param=="enter")&&this.onAfterAddItem){this.onAfterAddItem(value,text);}};HTMLDualList.prototype.invokeEventsAfterAddAll=function(){if(this.onAfterAddAll){this.onAfterAddAll();return!document.hasRuleException;}
return true;};HTMLDualList.prototype.invokeEventsBeforeRem=function(value,text,param){if((param=="item"||param=="enter")&&this.onBeforeRemItem){this.onBeforeRemItem(value,text);}};HTMLDualList.prototype.invokeEventsBeforeRemAll=function(){if(this.onBeforeRemAll){this.onBeforeRemAll();return!document.hasRuleException;}
return true;};HTMLDualList.prototype.invokeEventsAfterRem=function(value,text,param){if((param=="item"||param=="enter")&&this.onAfterRemItem){this.onAfterRemItem(value,text);}};HTMLDualList.prototype.invokeEventsAfterRemAll=function(){if(this.onAfterRemAll){this.onAfterRemAll();return!document.hasRuleException;}
return true;};HTMLDualList.prototype.getPermissionDescription=function(){var componentDescription=!isNullable(this.descPrincipal)?this.descPrincipal:(this.code+" - "+this.id);if(!isNullable(this.descSelecionados))componentDescription+=(" / "+this.descSelecionados);return componentDescription;};HTMLDualList.prototype.flush=function(){var i;if(this.oldLeftSelect&&this.oldLeftSelect.options){for(i=this.oldLeftSelect.options.length-1;i>=0;i--)this.oldLeftSelect.options[i]=null;this.oldLeftSelect=null;}
if(this.oldRightSelect&&this.oldRightSelect.options){for(i=this.oldRightSelect.options.length-1;i>=0;i--)this.oldRightSelect.options[i]=null;this.oldRightSelect=null;}
if(this.leftSelect&&this.leftSelect.options){for(i=this.leftSelect.options.length-1;i>=0;i--)this.leftSelect.options[i]=null;this.leftSelect=null;}
if(this.rightSelect&&this.rightSelect.options){for(i=this.rightSelect.options.length-1;i>=0;i--)this.rightSelect.options[i]=null;this.rightSelect=null;}
this.img=null;this.inputInclude=null;this.inputDelete=null;this.elementsToAdd=null;this.elementsToRemove=null;this.duallist=null;this.divWFRComponentRIGHT=null;this.divWFRComponentLEFT=null;this.labels=null;this.values=null;this.labelsRIGHT=null;this.valuesRIGHT=null;this.callMethod(HTMLElementBase,"flush");};function HTMLTreeViewLevel(sys,formID,code,posX,posY,width,height,value){this.create(sys,formID,code,posX,posY,width,height,'',value);this.type=1;this.autoCollapse=false;this.check=false;this.radio=false;this.maxCode=0;this.id=value;this.color="";this.border=false;this.selectedColor="";}
HTMLTreeViewLevel.inherits(HTMLElementBase);HTMLTreeViewLevel.prototype.name='HTMLTreeViewLevel';HTMLTreeViewLevel.prototype.tabable=false;HTMLTreeViewLevel.prototype.zindex=99999;HTMLTreeViewLevel.prototype.designComponent=function(doc){};function HTMLMakerFlowComponent(sys,formID,code,posX,posY,width,height,description){this.sys=sys;this.formID=formID;this.code=code;this.posX=parseFloat(posX);this.posY=parseFloat(posY);this.width=parseFloat(width);this.height=parseFloat(height);this.description=description;}
HTMLMakerFlowComponent.inherits(HTMLElementBase);HTMLMakerFlowComponent.prototype.name='HTMLMakerFlowComponent';HTMLMakerFlowComponent.prototype.tabKeys=[9];HTMLMakerFlowComponent.prototype.tabable=true;HTMLMakerFlowComponent.prototype.zindex=100000;HTMLMakerFlowComponent.prototype.isBinary=true;var makerFlowComponentsDesign=[];HTMLMakerFlowComponent.prototype.design=function(ruleName,componentParameters){this.init();makerFlowComponentsDesign.push(function design(){executeRuleFromJS(ruleName,componentParameters);});if(this.field){let id=this.id;let code=this.code;let component=this;setTimeout(function(){let elem=mainform.document.getElementById(id);if(elem){let input=mainform.document.createElement('input');input.type="hidden";input.name="WFRInput"+code;input.id="WFRInput"+code;elem.appendChild(input);component.input=input;}},100);}};HTMLMakerFlowComponent.prototype.inner=function(ruleName,componentParameters,action){var reducedName=reduceVariable(ruleName);if(typeof window[reducedName]==="function"){setTimeout(function inner(){try{executeRuleFromJS(ruleName,componentParameters,action);}catch(e){interactionError(e.toString());}},0);}};HTMLMakerFlowComponent.prototype.init=function(){controller.addNotTabable(this);}
HTMLMakerFlowComponent.prototype.free=function(){var element=$mainform().document.getElementById(this.id);if(element){element.parentElement.removeChild(element);controller.remove(this);}};HTMLMakerFlowComponent.prototype.setVisible=function(v){this.visible=parseBoolean(v);var element=$mainform().document.getElementById(this.id);if(element){element.style.display=this.visible?"block":"none";element.style.visibility=this.visible?"visible":"hidden";}};HTMLMakerFlowComponent.prototype.setEnabled=function(v){this.enabled=parseBoolean(v);var element=$mainform().document.getElementById(this.id);if(element)element.style.pointerEvents=this.enabled?"all":"none";};HTMLMakerFlowComponent.prototype.getVisible=function(){var element=$mainform().document.getElementById(this.id);var display=window.getComputedStyle(element).display==='block'?true:false;var visible=window.getComputedStyle(element).visibility==='visible'?true:false;return(display&&visible);};HTMLMakerFlowComponent.prototype.setX=function(x){var element=$mainform().document.getElementById(this.id);if(element)element.style.left=x+'px';};HTMLMakerFlowComponent.prototype.setY=function(y){var element=$mainform().document.getElementById(this.id);if(element)element.style.top=y+'px';};HTMLMakerFlowComponent.prototype.getHeight=function(){var element=$mainform().document.getElementById(this.id);if(element)return parseInt(window.getComputedStyle(element).height);};HTMLMakerFlowComponent.prototype.getWidth=function(){var element=$mainform().document.getElementById(this.id);if(element)return parseInt(window.getComputedStyle(element).width);};HTMLMakerFlowComponent.prototype.getX=function(){var element=$mainform().document.getElementById(this.id);if(element)return parseInt(window.getComputedStyle(element).left);};HTMLMakerFlowComponent.prototype.getY=function(){var element=$mainform().document.getElementById(this.id);if(element)return parseInt(window.getComputedStyle(element).top);};HTMLMakerFlowComponent.prototype.setValue=function(value,checkDependences){value=normalizeRuleParam(value,true);var temp=this.getValue();this.value=value;if(this.input)this.input.value=value;if(trim(this.value)!=trim(temp))this.changeAction(null,this,!checkDependences);return false;};function HTMLNavigationButton(sys,formID,code,posX,posY,width,height,description,src,additionalClassName){this.create(sys,formID,code,posX,posY,width,height,description,src);this.src=src;this.hint="";this.tabindex=90000;this.tabKeys=[9];}
HTMLNavigationButton.inherits(HTMLElementBase);HTMLNavigationButton.prototype.name="HTMLNavigationButton";HTMLNavigationButton.prototype.design=function(doc,tabControl){this.div=document.createElement("li");this.div.name="WFRComponent"+this.code;this.divClass="nav-item";this.div.className=this.divClass;this.doc=doc;this.context=this.div;this.designComponent(doc,tabControl);doc.appendChild(this.div);this.init(tabControl);};HTMLNavigationButton.prototype.designComponent=function(doc){if(this.src.indexOf("/")!==-1||this.src.indexOf("\\")!==-1||this.src.indexOf(".")!==-1){this.img=document.createElement("img");this.imgType=0;this.img.src=this.src;this.img.width=this.width;this.img.height=this.height;this.img.style.width=this.width;this.img.style.height=this.height;}else{this.img=document.createElement("i");this.imgType=1;this.img.className=this.src;this.img.style.fontSize="1.5rem";}
this.input=document.createElement("a");this.inputClass="nav-link generic-btn p-3 text-dark outline-0";this.input.href="#!";if(this.description){if(this.imgType==0)this.img.alt=this.description;this.inputClass+=" nav-tooltip";this.input.title=this.description;this.input.setAttribute("data-toggle","tooltip");this.haveTooltips=true;}else this.haveTooltips=false;this.input.className=this.inputClass;this.input.appendChild(this.img);this.context.appendChild(this.input);};HTMLNavigationButton.prototype.clickAction=function(e,o){if(this.input)bootstrapCloseTooltip(this.input);this.callMethod(HTMLElementBase,"clickAction",[e,o]);};HTMLNavigationButton.prototype.click=function(e){if(this.input)this.input.click();};HTMLNavigationButton.prototype.setVisible=function(v){this.visible=v;this.div.style.display=v?"inline-block":"none";};HTMLNavigationButton.prototype.setEnabled=function(v){this.enabled=v;if(this.input)this.input.className=this.inputClass+(v?"":" disabled");if(this.div)this.div.className=this.divClass+(v?"":" disabled");if(this.img){this.img.disabled=!v;if(!this.hideImage){if(this.enabled&&this.input){this.input.setAttribute("href","#!");}else{this.input.removeAttribute("href");}}}};function HTMLNavigationButtonSingleImage(sys,formID,code,posX,posY,width,height,description,src,additionalClassName){this.create(sys,formID,code,posX,posY,width,height,description,src);if(src){this.src=index!=-1?src.substring(0,index):src;var index=src.lastIndexOf(".gif");this.src=index!=-1?src.substring(0,index):src;}else{this.src="";}
this.hint="";}
HTMLNavigationButtonSingleImage.inherits(HTMLImageButton);HTMLNavigationButtonSingleImage.prototype.name="HTMLNavigationButton";HTMLNavigationButtonSingleImage.prototype.design=function(doc,tabControl){this.doc=doc;this.div=document.createElement("div");this.div.name="WFRComponent"+this.code;this.div.zIndex=this.zindex;this.div.className=this.className+" ";this.div.className+=this.className+"-"+resources_locale+" ";this.div.className+=this.className+"-"+this.additionalClassName;this.context=this.div;this.designComponent(doc,tabControl);doc.appendChild(this.div);this.init(tabControl);}
HTMLNavigationButtonSingleImage.prototype.designComponent=function(doc){if(!this.hideImage){preload(this.src+".gif?locale="+resources_locale);}
this.img=document.createElement("img");this.img.setAttribute('border','0');this.img.alt=this.description;this.img.title=this.description;this.img.src=this.src+".gif?locale="+resources_locale;this.attachEvent(this.img,'mouseover',this.onmouseover);this.attachEvent(this.img,'mouseout',this.onmouseout);this.img.style.height=this.height;this.img.style.width=this.width;this.input=document.createElement("a");this.input.href="javascript:;";this.onclickCatch=this.onclick;this.onclick=this.onclickActionWrapper;this.input.appendChild(this.img);this.context.appendChild(this.input);}
HTMLNavigationButtonSingleImage.prototype.onmouseover=function(e){if(!this.hideImage){if(this.canFocus()){this.div.className=this.className+" ";this.div.className+=this.className+"-"+resources_locale+" ";this.div.className+=this.className+"-"+this.additionalClassName+"-Over";}}}
HTMLNavigationButtonSingleImage.prototype.onmouseout=function(){if(!this.hideImage){if(this.canFocus()){this.div.className=this.className+" ";this.div.className+=this.className+"-"+resources_locale+" ";this.div.className+=this.className+"-"+this.additionalClassName;}}}
HTMLNavigationButtonSingleImage.prototype.setVisible=function(v){this.visible=v;if(v){this.div.style.display="inline-block";}else{this.div.className=this.className+" ";this.div.className+=this.className+"-"+resources_locale+" ";this.div.className+=this.className+"-"+this.additionalClassName;this.div.style.display="none";}}
HTMLNavigationButtonSingleImage.prototype.setEnabled=function(v){this.enabled=v;if(this.img){this.img.disabled=!v;if(!this.hideImage){if(this.enabled&&this.input){this.div.className=this.className+" ";this.div.className+=this.className+"-"+resources_locale+" ";this.div.className+=this.className+"-"+this.additionalClassName;this.input.setAttribute("href","javascript:;");}else{this.div.className=this.className+" ";this.div.className+=this.className+"-"+resources_locale+" ";this.div.className+=this.className+"-"+this.additionalClassName+"-Des";this.input.removeAttribute("href");}}}}
function HTMLMessage(title,message,timer,type,alignment,confirmButton,cancelButton){this.code=Math.floor(Math.random()*1000000)+1;this.title=title;this.message=message;this.timer=timer;this.cancelButton=(cancelButton!=null)?cancelButton:true;this.cancelButtonDiv=null;this.confirmButton=(confirmButton!=null)?confirmButton:true;this.confirmButtonDiv=null;this.inputText=false;this.inputPlaceholder=null;this.details=null;this.type=type;this.callOk=null;this.callCancel=null;this.alignment=alignment;this.modalDiv=null;this.shown=false;}
HTMLMessage.prototype.name='HTMLMessage';HTMLMessage.prototype.showWarningMessage=function(title,message,timer,alignment){alignment=(this.checkNullOrEmpty(alignment))?messageConfig["position"]:alignment;timer=(timer==0||this.checkNullOrEmpty(timer))?messageConfig["timer"]:timer;this.alignment=alignment;this.title=(title===undefined||title===null)?"":title;this.message=message;this.type="Warning";this.cancelButton=false;this.inputText=false;if(timer){this.confirmButton=false;this.timer=(timer*1000);}
if(!showMessageAsLegacy)this.showWithSweetAlert(this.type.toLowerCase())
else this.showMessage();};HTMLMessage.prototype.showSuccessMessage=function(title,message,timer,alignment){alignment=(this.checkNullOrEmpty(alignment))?messageConfig["position"]:alignment;timer=(timer==0||this.checkNullOrEmpty(timer))?messageConfig["timer"]:timer;this.alignment=alignment;this.title=(title===undefined||title===null)?"":title;this.message=message;this.type="Success";this.cancelButton=false;this.inputText=false;if(timer){this.confirmButton=false;this.timer=(timer*1000);}
if(!showMessageAsLegacy)this.showWithSweetAlert(this.type.toLowerCase())
else this.showMessage();};HTMLMessage.prototype.showInfoMessage=function(title,message,timer,alignment,extended){alignment=(this.checkNullOrEmpty(alignment))?messageConfig["position"]:alignment;timer=(timer==0||this.checkNullOrEmpty(timer))?messageConfig["timer"]:timer;this.alignment=alignment;this.title=(title===undefined||title===null)?"":title;this.message=message;this.type="Info";this.cancelButton=false;this.inputText=false;this.extended=extended;if(timer){this.confirmButton=false;this.timer=(timer*1000);}
if(!showMessageAsLegacy)this.showWithSweetAlert(this.type.toLowerCase());else this.showMessage();};HTMLMessage.prototype.showErrorMessage=function(title,message,timer,details,alignment,extended){alignment=(this.checkNullOrEmpty(alignment))?messageConfig["position"]:alignment;timer=(timer==0||this.checkNullOrEmpty(timer))?messageConfig["timer"]:timer;document.hasRuleErrors=true;document.hasRuleException=true;this.alignment=alignment;this.title=(title===undefined||title===null)?"":title;this.details=(details===undefined||details===null)?"":details;this.message=message;this.type="Error";this.timer=timer;this.inputText=false;this.extended=extended;if(timer){this.timer=(timer*1000);this.confirmButton=false;this.cancelButton=false;}else{this.confirmButton=true;this.cancelButton=false;}
if(!showMessageAsLegacy)this.showWithSweetAlert(this.type.toLowerCase());else this.showMessage();};HTMLMessage.prototype.showPromptMessage=function(title,message,placeholder,funcOk,paramsOk,funcCancel,paramsCancel){this.title=(title===undefined||title===null)?"":title;this.message=message;this.inputPlaceholder=placeholder;this.inputText=true;this.callOk=funcOk;this.callCancel=funcCancel;this.type="Prompt";this.paramsOk=(paramsOk!==undefined&&paramsOk!==null)?paramsOk:[];this.paramsCancel=(paramsCancel!==undefined&&paramsCancel!==null)?paramsCancel:[];if(!showMessageAsLegacy)this.embeddedSweetalert('question',"");else this.showMessage();};HTMLMessage.prototype.showInteractionConfirmMessage=function(title,message,funcOk,paramsOk,funcCancel,paramsCancel,alignment,labelOk,labelCancel){this.alignment=alignment;this.title=(title===undefined||title===null)?"":title;this.message=message;this.inputText=false;this.callOk=funcOk;this.callCancel=funcCancel;this.type="Interaction";this.paramsOk=(paramsOk!==undefined&&paramsOk!==null)?paramsOk:[];this.paramsCancel=(paramsCancel!==undefined&&paramsCancel!==null)?paramsCancel:[];if(!showMessageAsLegacy)this.embeddedSweetalert('warning','interaction');else this.showMessage();if(labelOk&&this.confirmButtonDiv)this.confirmButtonDiv.innerHTML=labelOk;if(labelCancel&&this.cancelButtonDiv)this.cancelButtonDiv.innerHTML=labelCancel;};HTMLMessage.prototype.clickOk=function(div,params,type){if(this.callOk){var paramsTwo;if(params){paramsTwo=new Array();for(i=0;i<params.length;i++){paramsTwo.push(params[i]);}}
if(paramsTwo){if(type==="Prompt"){paramsTwo[0]=this.modalInput.value;}else if(type==="Interaction"){paramsTwo[0]="true";}}
this.closeMessage(div);if(typeof this.callOk==="function"){this.callOk.apply(this,paramsTwo);}else{ebfFlowExecute(this.callOk,paramsTwo);}}else{this.closeMessage(div);}
if(this.callFunctionComponent){if(this.callFunctionComponentParams){this.callFunctionComponent.apply(window,this.callFunctionComponentParams);}else{this.callFunctionComponent.call(window);}}
return true;};HTMLMessage.prototype.clickCancel=function(div,params,type){if(this.callCancel){var paramsTwo;if(params){paramsTwo=new Array();for(i=0;i<params.length;i++){paramsTwo.push(params[i]);}}
if(paramsTwo){if(type==="Prompt"){paramsTwo[0]="";}else if(type==="Interaction"){paramsTwo[0]="false";}}
this.closeMessage(div);if(typeof this.callCancel==="function"){this.callCancel.apply(this,paramsTwo);}else{ebfFlowExecute(this.callCancel,paramsTwo);}}else{this.closeMessage(div);}
return false;};HTMLMessage.prototype.showMessage=function(){var object=this;this.checkBody();try{if((mainform.parent.parent.document.getElementById("tab0")&&this.timer!=0&&this.alignment!=null&&this.alignment.length>0)){var showMsg=new mainform.parent.parent.HTMLMessage(this.title,this.message,this.timer,this.type,this.alignment,this.confirmButton,this.cancelButton);showMsg.showMessage();return;}else if(!isPopup){var locationMessage=$mainform();if(locationMessage)locationMessage.document.body.setAttribute("onunload","$('.message-modal').modal('hide');"+"$('.message-toast').toast('hide');");}}catch(e){}
if(this.alignment&&this.alignment.length>0){this.context=null;this.setAlignment(this.alignmet);if(this.context&&!this.toastDiv){this.toastDiv=this.doc.createElement("div");this.toastDiv.className="toast message-toast";this.toastDiv.id="toast"+this.code;this.toastDiv.setAttribute("role","alert");this.toastDiv.setAttribute("data-autohide","false");this.toastDiv.setAttribute("data-delay","1000");this.toastDiv.style.pointerEvents="all";this.toastHeader=this.doc.createElement("div");this.toastHeader.className="toast-header";this.toastDiv.appendChild(this.toastHeader);if(this.type=="Error"){this.toastHeader.className+=" bg-danger text-white";}else if(this.type=="Warning"){this.toastHeader.className+=" bg-warning text-dark";}else if(this.type=="Prompt"){this.toastHeader.className+=" bg-info text-white";}else if(this.type=="Success"){this.toastHeader.className+=" bg-success text-white";}
if(this.title){this.toastTitle=this.doc.createElement("strong");this.toastTitle.className="mr-auto";this.toastTitle.id="toastTitle"+this.code;this.toastTitle.innerHTML=this.title;if(this.extended===true){this.toastTitle.style.whiteSpace="normal";this.toastTitle.className+=" p-1";}
this.toastHeader.appendChild(this.toastTitle);}
try{if(!this.doc.momentImported){webrun.include("assets/moment.min.js");var lang=resources_locale.replace("_","-");if(lang.indexOf("en")!=-1)lang="en";else if(lang.indexOf("es")!=-1)lang="es";else if(lang.indexOf("fr")!=-1)lang="fr";moment.locale(lang);this.doc.momentImported=true;}
var startTime=moment();this.toastTimestamp=this.doc.createElement("small");this.toastTimestamp.className="pl-2 ml-auto";this.toastTimestamp.innerHTML=moment(startTime).fromNow();this.toastHeader.appendChild(this.toastTimestamp);this.toastTimer=setInterval(function(){if(object.toastTimestamp)object.toastTimestamp.innerHTML=moment(startTime).fromNow();},5000);}catch(e){}
if(this.timer){this.toastProgressBarBase=this.doc.createElement("div");this.toastProgressBarBase.className="progress w-100";this.toastProgressBarBase.style.height="2px";this.toastDiv.appendChild(this.toastProgressBarBase);this.toastHeader.style.borderBottom="0";this.toastProgressBar=this.doc.createElement("div");this.toastProgressBar.className="progress-bar bg-secondary";this.toastProgressBar.id="toastProgressBar"+this.code;this.toastProgressBar.style.width="100%";this.toastProgressBar.setAttribute("role","progressbar");this.toastProgressBar.setAttribute("aria-valuenow","0");this.toastProgressBar.setAttribute("aria-valuemin","0");this.toastProgressBar.setAttribute("aria-valuemax","100");this.toastProgressBarBase.appendChild(this.toastProgressBar);var startTime=new Date();var updateProgressBar=function(){setTimeout(function(){if(object.toastProgressBar){var currentTime=new Date();var elapsedMilliseconds=currentTime-startTime;var percent=100-((elapsedMilliseconds/object.timer)*100);object.toastProgressBar.style.width=percent+"%";object.toastProgressBar.setAttribute("aria-valuenow",percent);if(percent>0)updateProgressBar();}},100);};updateProgressBar();setTimeout(function(){try{object.clickCancel([object.toastDiv],object.paramsCancel,object.type);}catch(e){}},this.timer);}else{this.toastClose=this.doc.createElement("button");this.toastClose.type="button";this.toastClose.id="toastButton"+this.code;this.toastClose.className="ml-2 mb-1 close";this.toastClose.setAttribute("aria-label",getLocaleMessage("LABEL.CLOSE"));this.toastClose.style.outline="0";this.toastClose.style.zIndex="1";this.toastClose.innerHTML='<span aria-hidden="true">&times;</span>';this.toastHeader.appendChild(this.toastClose);this.toastClose.onclick=function(e){e.preventDefault();e.stopPropagation();object.closeMessage();return false;};this.documentKeyDown=this.doc.body.onkeydown;this.doc.body.onkeydown=function(evt){if(evt&&(evt.which===27||evt.code==="Escape")){object.doc.body.onkeydown=object.documentKeyDown;try{object.clickOk([object.modalDiv],object.paramsCancel,object.type);}catch(e){}}};}
if(this.message){this.toastBody=this.doc.createElement("div");this.toastBody.className="toast-body";this.toastBody.innerHTML=this.message.replace(/\n+/g,'<br>');this.toastDiv.appendChild(this.toastBody);}
if(this.callClick){this.toastDiv.onclick=this.callClick;if(this.toastTitle)this.toastTitle.onclick=this.callClick;if(this.toastIcon)this.toastIcon.onclick=this.callClick;if(this.toastTimestamp)this.toastTimestamp.onclick=this.callClick;this.toastDiv.style.cursor="pointer";}
this.context.appendChild(this.toastDiv);$('#toast'+this.code).toast('show');$('#toast'+this.code).on('shown.bs.toast',function(e){object.shown=true;if(object.closeRequired===true){object.closeMessage();}});$('#toast'+this.code).on('hidden.bs.toast',function(){object.shown=false;if(object.toastTimer){clearInterval(object.toastTimer);object.toastTimer=null;}
$(this).toast('dispose');$(this).remove();object.toastDiv=null;object.toastHeader=null;object.toastIcon=null;object.toastTitle=null;object.toastTimestamp=null;object.toastClose=null;});return;}}
var btcontentCancel,btcontentOk;try{btcontentCancel=$mainform().getLocaleMessage("LABEL.CANCEL");}
catch(e){btcontentCancel="Cancel";}
try{btcontentOk=$mainform().getLocaleMessage("LABEL.OK");}
catch(f){btcontentOk="Ok";}
var modal=bootstrapCreateModal();this.modalDiv=modal[0];this.modalDiv.className+=" message-modal";this.shown=true;if(this.closeRequired===true){this.closeMessage();}
$(this.modalDiv).on("hidden.bs.modal",function(e){if(object.shown)object.closeMessage();object.shown=false;});if(this.timer){var modalProgress=document.createElement("div");modalProgress.className="progress w-100";modalProgress.style.height="2px";modal[2].parentElement.insertBefore(modalProgress,modal[2])
this.modalProgressInner=document.createElement("div");this.modalProgressInner.className="progress-bar bg-secondary rounded-0";this.modalProgressInner.id="modalProgressBar"+this.code;this.modalProgressInner.style.width=this.timer+"%";this.modalProgressInner.style.height="2px";this.modalProgressInner.setAttribute("role","progressbar");this.modalProgressInner.setAttribute("aria-valuenow",this.timer.toString());this.modalProgressInner.setAttribute("aria-valuemin","0");this.modalProgressInner.setAttribute("aria-valuemax","100");modalProgress.appendChild(this.modalProgressInner);}
modal[1].className+=" border-bottom-0";modal[1].style.padding="0.8rem";var mediaDiv=document.createElement("div");mediaDiv.className="media px-2 py-1";modal[2].appendChild(mediaDiv);var iconSpan=document.createElement("span");switch(this.type){case"Error":modal[1].className+=" bg-danger";iconSpan.className="fas fa-times text-danger";break;case"Warning":modal[1].className+=" bg-warning";iconSpan.className="fas fa-exclamation-triangle text-warning";break;case"Success":modal[1].className+=" bg-success";iconSpan.className="fas fa-check text-success";break;case"Prompt":case"Interaction":modal[1].className+=" bg-primary";iconSpan.className="fas fa-question-circle text-primary";break;default:modal[1].className+=" bg-dark";break;}
if(iconSpan.className&&iconSpan.className.length>0)
iconSpan.className+=" align-self-start ml-2 mr-4";iconSpan.style.fontSize="3rem";mediaDiv.appendChild(iconSpan);var mediaBody=this.doc.createElement("div");mediaBody.className="media-body";mediaDiv.appendChild(mediaBody);if(this.title&&this.title.length>0){var modalTitle=this.doc.createElement("h5");modalTitle.className="mt-0 text-wrap";modalTitle.style.wordBreak="break-word";modalTitle.innerHTML=this.title;mediaBody.appendChild(modalTitle);}
if(this.message&&this.message.length>0){var modalMessage=this.doc.createElement("p");modalMessage.className="text-wrap";modalMessage.style.wordBreak="break-word";modalMessage.style.wordWrap="break-word";modalMessage.innerHTML=this.message.replace(/\n+/g,'<br>');mediaBody.appendChild(modalMessage);}
if(this.details&&this.details.length>0){var modalDetails=this.doc.createElement("textarea");modalDetails.className="form-control";modalDetails.value=this.details;modalDetails.readOnly=true;modalDetails.style.fontSize="0.7rem";modalDetails.style.minHeight="30vh";mediaBody.appendChild(modalDetails);}
if(this.cancelButton){this.cancelButtonDiv=this.doc.createElement("button");this.cancelButtonDiv.className="btn "+((this.type=="Error")?"btn-danger":(this.type=="Success")?"btn-success":(this.type=="Warning")?"btn-warning text-white":(this.type=="Prompt")?"btn-dark":"btn-primary");this.cancelButtonDiv.type="button";this.cancelButtonDiv.id="modalCancel"+this.code;this.cancelButtonDiv.innerHTML=btcontentCancel;modal[3].appendChild(this.cancelButtonDiv);this.cancelButtonDiv.onclick=function(e){return object.clickCancel([object.modalDiv],object.paramsCancel,object.type);};}
if(this.confirmButton){this.confirmButtonDiv=this.doc.createElement("button");this.confirmButtonDiv.className="btn "+((this.type=="Error")?"btn-danger":(this.type=="Success")?"btn-success":(this.type=="Warning")?"btn-warning text-white":(this.type=="Prompt")?"btn-dark":"btn-primary");this.confirmButtonDiv.type="button";this.confirmButtonDiv.id="modalConfirm"+this.code;this.confirmButtonDiv.innerHTML=btcontentOk;modal[3].appendChild(this.confirmButtonDiv);this.confirmButtonDiv.onclick=function(e){return object.clickOk([object.modalDiv],object.paramsOk,object.type);};}
if(this.inputText){this.modalInput=this.doc.createElement("input");this.modalInput.className="form-control";this.modalInput.type="text";this.modalInput.id="modalInput"+this.code;if(this.inputPlaceholder)this.modalInput.placeholder=this.inputPlaceholder;if(modalMessage)modalMessage.className+=" mb-2";mediaBody.appendChild(this.modalInput);this.modalInput.focus();if(this.confirmButton){this.modalInput.onkeydown=function(evt){if(evt&&(evt.which===13||evt.code==="Enter")){try{object.clickOk([object.modalDiv],object.paramsOk,object.type);}catch(e){}}};}}else{if(this.cancelButton&&this.cancelButtonDiv)this.cancelButtonDiv.focus();else if(this.confirmButton&&this.confirmButtonDiv)this.confirmButtonDiv.focus();}
if(this.cancelButton){this.documentKeyDown=this.doc.body.onkeydown;this.doc.body.onkeydown=function(evt){if(evt&&(evt.which===27||evt.code==="Escape")){object.doc.body.onkeydown=object.documentKeyDown;try{object.clickCancel([object.modalDiv],object.paramsCancel,object.type);}catch(e){}}};}else if(this.confirmButton){this.documentKeyDown=this.doc.body.onkeydown;this.doc.body.onkeydown=function(evt){if(evt&&(evt.which===27||evt.code==="Escape")){object.doc.body.onkeydown=object.documentKeyDown;try{object.clickOk([object.modalDiv],object.paramsCancel,object.type);}catch(e){}}};}
if(this.timer){var startTime=new Date();var updateProgressBar=function(){setTimeout(function(){if(object.modalProgressInner){var currentTime=new Date();var elapsedMilliseconds=currentTime-startTime;var percent=100-((elapsedMilliseconds/object.timer)*100);object.modalProgressInner.style.width=percent+"%";object.modalProgressInner.setAttribute("aria-valuenow",percent);if(percent>0)updateProgressBar();}},100);};updateProgressBar();setTimeout(function(){try{object.clickCancel([object.modalDiv],object.paramsCancel,object.type);}catch(e){}},this.timer);}
var closeAllNotifies=this.closeAllNotifies;};HTMLMessage.prototype.setAlignment=function(){switch(this.alignment.toUpperCase()){case'DT':this.context=this.doc.getElementById("toast-container-tr");if(!this.context){this.context=this.doc.createElement("div");this.context.id="toast-container-tr";this.context.className="toast-container position-fixed mt-3 mr-3";this.context.style.pointerEvents="none";this.context.style.top="0px";this.context.style.right="0px";this.doc.body.appendChild(this.context);}
break;case'ET':this.context=this.doc.getElementById("toast-container-tl");if(!this.context){this.context=this.doc.createElement("div");this.context.id="toast-container-tl";this.context.className="toast-container position-fixed mt-3 ml-3";this.context.style.pointerEvents="none";this.context.style.top="0px";this.context.style.left="0px";this.doc.body.appendChild(this.context);}
break;case'DB':this.context=this.doc.getElementById("toast-container-br");if(!this.context){this.context=this.doc.createElement("div");this.context.id="toast-container-br";this.context.className="toast-container position-fixed mb-3 mr-3";this.context.style.pointerEvents="none";this.context.style.bottom="0px";this.context.style.right="0px";this.doc.body.appendChild(this.context);}
break;case'EB':this.context=this.doc.getElementById("toast-container-bl");if(!this.context){this.context=this.doc.createElement("div");this.context.id="toast-container-bl";this.context.className="toast-container position-fixed mb-3 ml-3";this.context.style.pointerEvents="none";this.context.style.bottom="0px";this.context.style.left="0px";this.doc.body.appendChild(this.context);}
break;}};HTMLMessage.prototype.getParentNotifyDiv=function(alignment){return this.context;};HTMLMessage.prototype.closeAllNotifies=function(){$('.message-modal').modal('hide');$('.message-toast').toast('hide');};HTMLMessage.prototype.closeMessage=function(div){if(!this.shown){this.closeRequired=true;return;}
this.shown=false;this.enabled=false;this.visible=false;if(this.toastDiv){$(this.toastDiv).toast("hide");}else{$(div).modal("hide");}
if(this.documentKeyDown){document.body.onkeydown=this.documentKeyDown;}};HTMLMessage.prototype.showWithSweetAlert=function(type){let object=this;this.checkBody();this.alignment=this.parseAlignment(this.alignment);if((type==="success"||type==="error"||type==="warning"||type==="info")&&this.timer){this.toastMessage(this.title,this.message,type,this.alignment,this.timer);return;}
let textConfirm='Ok',textCancel='Cancel';try{textCancel=$mainform().getLocaleMessage("LABEL.CANCEL");}
catch(e){textCancel="Cancel";}
try{textConfirm=$mainform().getLocaleMessage("LABEL.OK");}
catch(f){textConfirm="Ok";}
let jsonConf={title:this.title,html:this.message&&this.message.length>0?this.message.replace(/(?:\r\n|\r|\n)/g,'<br />'):'',position:this.alignment,confirmButtonText:textConfirm,cancelButtonText:textCancel,showConfirmButton:this.timer?false:true,timer:this.timer,icon:type,heightAuto:false};if(type==='error'&&this.details&&this.details.length>0){jsonConf.input='textarea';jsonConf.inputAttributes={'style':'font-size:1rem;white-space: normal!important;word-break: break-word;overflow-wrap: break-word;','readonly':'true'};jsonConf.inputValue=this.details;}
Swal.fire(jsonConf).then(function(response){if(response.isConfirmed){if(object.callFunctionComponent){if(object.callFunctionComponentParams)
setTimeout(function(){object.callFunctionComponent.apply(this,object.callFunctionComponentParams)},350);else setTimeout(function(){object.callFunctionComponent.call(this);},350);}}});};HTMLMessage.prototype.embeddedSweetalert=function(type,mod){const callbackOk=this.callOk;const callbackCancel=this.callCancel;let paramsOk=this.paramsOk;let paramsCancel=this.paramsCancel;let jsonConf=null;let textConfirm='Ok',textCancel='Cancel';this.message=this.message.replace(/(?:\r\n|\r|\n)/g,'<br />');this.checkBody();try{textCancel=$mainform().getLocaleMessage("LABEL.CANCEL");}
catch(e){textCancel="Cancel";}
try{textConfirm=$mainform().getLocaleMessage("LABEL.OK");}
catch(f){textConfirm="Ok";}
if(mod==='interaction'){jsonConf={title:this.title,html:this.message,icon:type,showCancelButton:true,confirmButtonText:textConfirm,cancelButtonText:textCancel,};}else{jsonConf={title:this.title,html:this.message,icon:type,input:'text',inputPlaceholder:this.inputPlaceholder?this.inputPlaceholder:"",showCancelButton:true,confirmButtonText:textConfirm,cancelButtonText:textCancel,};}
Swal.fire(jsonConf).then(function(response){if(response.isConfirmed){if(callbackOk){var parseParams=new Array();if(paramsOk){for(i=0;i<paramsOk.length;i++){parseParams.push(paramsOk[i]);}}
parseParams[0]=response.value?response.value.toString():"";ebfFlowExecute(callbackOk,parseParams);}}else{if(callbackCancel){var parseParams=new Array();if(paramsCancel){for(i=0;i<paramsCancel.length;i++){parseParams.push(paramsCancel[i]);}}
parseParams[0]=mod==='interaction'?response.isConfirmed.toString():response.value?response.value.toString():"";ebfFlowExecute(callbackCancel,parseParams);}}});};HTMLMessage.prototype.toastMessage=function(title,message,type,position,timer){type=type?type:"success";position=position?position:"center";timer=timer?timer:3000;const Toast=Swal.mixin({toast:true,position:position,showConfirmButton:false,timer:timer,timerProgressBar:true,didOpen:(toast)=>{toast.addEventListener('mouseenter',Swal.stopTimer);toast.addEventListener('mouseleave',Swal.resumeTimer);}});if(message&&message.length>0){title="<span style=\"text-align: left; padding-bottom: 0.25rem; padding-left: 0.25rem; display: flex; flex-direction: column;\">"+"<span style=\"margin-bottom: 0.25rem;\">"+title+"</span>"+"<span style=\"font-size: 1rem; font-weight: normal;\">"+message+"</span>"+"</span>";}else{title="<span style=\"text-align: left;\">"+title+"</span>";}
let object=this;Toast.fire({icon:type,title:title}).then(()=>{if(object.callFunctionComponent&&typeof object.callFunctionComponent==='function'){if(object.callFunctionComponentParams){object.callFunctionComponent.apply(window,object.callFunctionComponentParams);}else{object.callFunctionComponent.call(window);}}});};HTMLMessage.prototype.parseAlignment=function(align){if(align){switch(align){case'DT':align='top-end';break;case'DB':align='bottom-end';break;case'ET':align='top-start';break;case'EB':align='bottom-start';break;default:align='center';break;}}else{align='center';}
return align;};HTMLMessage.prototype.checkBody=function(){try{this.doc=mainform&&mainform.document?mainform.document:document;}
catch(e){this.doc=document;}
if(!this.doc.body)this.doc.writeln("<body></body>");};HTMLMessage.prototype.checkNullOrEmpty=function(value){return(value==='null'||value==null||value===""||value=='undefined'||value===undefined)};function HTMLActionButton(sys,formID,code,posX,posY,width,height,description,value,showValue){this.create(sys,formID,code,posX,posY,width,height,description,value);this.mouseOver=false;}
HTMLActionButton.inherits(HTMLElementBase);HTMLActionButton.prototype.name='HTMLActionButton';HTMLActionButton.prototype.tabable=true;HTMLActionButton.prototype.setEnabled=function(v){this.callMethod(HTMLElementBase,"setEnabled",[v]);if(this.div)this.div.style.cursor=this.enabled?"pointer":"default";if(this.img)this.img.style.opacity=this.enabled?"1":"0.5";this.updateImage();};HTMLActionButton.prototype.setVisible=function(v){this.visible=parseBoolean(v);if(this.visible){this.div.classList.remove("d-none");this.div.classList.add("d-inline-flex");}else{this.div.classList.remove("d-inline-flex");this.div.classList.add("d-none");}};HTMLActionButton.prototype.setHeight=function(height){this.callMethod(HTMLElementBase,"setHeight",[height]);if(this.ImageViewMode!="1")this.img.style.maxHeight=this.div.style.height;};HTMLActionButton.prototype.designComponent=function(doc){this.div.className="form-action d-inline-flex align-items-center justify-content-center ml-1 mr-1";this.divClass=this.div.className;if(this.beforeComponentDesign){this.beforeComponentDesign(doc);}
this.img=document.createElement("img");this.img.alt="";if(this.ImageViewMode!="1"){this.img.className="img-fluid";this.img.style.maxHeight=this.div.style.height;}
this.div.appendChild(this.img);if(this.Image&&this.Image.length>0){this.img.src=this.getImageSourceURL(this.Image);}else if(this.URLImage&&this.URLImage.length>0){this.img.src=this.URLImage;}
if(this.hint)this.setHint(this.hint);this.setEnabled(this.enabled);this.attachEvent(this.div,'click',this.clickAction);this.attachEvent(this.div,'mousedown',this.mouseDownAction);this.attachEvent(this.div,'mouseup',this.mouseUpAction);this.attachEvent(this.div,'mouseenter',this.mouseEnterAction);this.attachEvent(this.div,'mouseleave',this.mouseLeaveAction);if(this.Acessivel==1||this.Acessivel=='1'){this.zindex=1000000;this.div.style.zIndex=this.zindex;}
if(this.afterComponentDesign){this.afterComponentDesign(doc);}};HTMLActionButton.prototype.click=function(){if(!this.enabled)return false;if(this.div.onclick)return this.div.onclick.call(this);};HTMLActionButton.prototype.mouseDownAction=function(e,o){if(!this.enabled)return false;this.mouseDown=true;this.updateImage();};HTMLActionButton.prototype.mouseUpAction=function(e,o){this.mouseDown=false;this.updateImage();};HTMLActionButton.prototype.clickAction=function(e,o){if(!this.enabled)return false;if(this.callMethod(HTMLElementBase,"clickAction",[e,o])===false)return false;if(this.AcoesPreDefinida&&this.AcoesPreDefinida.length&&this.AcoesPreDefinida.length>0){ebfActionExecute(this.AcoesPreDefinida);}};HTMLActionButton.prototype.mouseEnterAction=function(e,o){if(!this.enabled)return false;this.mouseOver=true;this.updateImage();};HTMLActionButton.prototype.mouseLeaveAction=function(e,o){this.mouseOver=false;this.updateImage();};HTMLActionButton.prototype.setImages=function(img,imgOver,imgOnClick,imgURL,imgOverURL,imgOnClickURL){this.Image=img;this.ImageMouseOver=imgOver;this.ImageOnClick=imgOnClick;this.URLImage=imgURL;this.URLImageMouseOver=imgOverURL;this.URLImageOnClick=imgOnClickURL;this.updateImage();};HTMLActionButton.prototype.updateImage=function(){if(this.img){if(this.mouseDown){if(this.ImageOnClick||this.URLImageOnClick){if(this.ImageOnClick&&this.ImageOnClick.length>0){this.img.src=this.getImageSourceURL(this.ImageOnClick);}else{this.img.src=this.URLImageOnClick;}}}else if(this.mouseOver){if(this.ImageMouseOver||this.URLImageMouseOver){if(this.ImageMouseOver&&this.ImageMouseOver.length>0){this.img.src=this.getImageSourceURL(this.ImageMouseOver);}else{this.img.src=this.URLImageMouseOver;}}}else{if(this.Image||this.URLImage){if(this.Image&&this.Image.length>0){this.img.src=this.getImageSourceURL(this.Image);}else{this.img.src=this.URLImage;}}else{this.img.src="";}}}};HTMLActionButton.prototype.setHint=function(hint){this.callMethod(HTMLElementBase,"setHint",[hint]);if(this.img){let init=this.img.hint?false:true;if(this.img.getAttribute("data-original-title")){this.img.setAttribute("data-original-title",hint.replace(/(?:\r\n|\r|\n)/g,'<br />'));}else{this.img.hint=hint;this.img.alt=hint;this.img.title=hint.replace(/(?:\r\n|\r|\n)/g,'<br />');this.img.setAttribute("data-toggle","tooltip");this.img.setAttribute("data-html","true");if(init)bootstrapInitTooltip(this.img);}}};HTMLActionButton.prototype.toPermissionMode=function(){this.callMethod(HTMLElementBase,"toPermissionMode",[]);this.divPermission.className="d-none";this.editPermissionsButton=document.createElement("button");this.editPermissionsButton.type="button";this.editPermissionsButton.className="btn btn-secondary d-flex align-items-center justify-content-center p-1 position-absolute";this.editPermissionsButton.style.bottom="0px";this.editPermissionsButton.style.right="0px";this.editPermissionsButton.zIndex="10";this.editPermissionsButton.setAttribute("data-toggle","popover");this.editPermissionsButton.setAttribute("title",this.name);this.editPermissionsButton.setAttribute("data-content",this.divPermission.getAttribute("data-content"));this.div.appendChild(this.editPermissionsButton);var editPermissionsButtonIcon=document.createElement("i");editPermissionsButtonIcon.className="fas fa-key";editPermissionsButtonIcon.style.fontSize="0.7rem";this.editPermissionsButton.appendChild(editPermissionsButtonIcon);$(this.editPermissionsButton).popover({template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body p-0"></div></div>',html:true,trigger:"hover",delay:200});this.editPermissionsButton.onclick=function(e){e.stopPropagation();};this.attachEvent(this.editPermissionsButton,'click',this.permissionClick);};function HTMLSlider(sys,formID,code,posX,posY,width,height,description,value,showValue){this.create(sys,formID,code,posX,posY,width,height,description,value);}
HTMLSlider.inherits(HTMLLabeledComponent);HTMLSlider.prototype.name='HTMLSlider';HTMLSlider.prototype.tabable=true;HTMLSlider.prototype.designInput=function(doc,name,value){this.input=document.createElement("input");this.input.type="range";this.input.className="custom-range";this.input.id=name?name:'WFRInput'+this.code;this.input.disabled=!this.enabled;this.input.readOnly=this.readonly;if(this.ValorInicio){var min=parseFloat(this.ValorInicio);this.input.min=min;this.input.setAttribute("min",min);}
if(this.ValorFim){var max=parseFloat(this.ValorFim);this.input.max=max;this.input.setAttribute("max",max);}
if(this.Precisao){var precisao=parseFloat(this.Precisao);if(precisao>0){this.input.step=precisao;this.input.setAttribute("step",precisao);}}
if(this.ValorInicialMarcador||this.ValorInicialMarcador==0){this.input.value=parseFloat(this.ValorInicialMarcador);}else if(value){this.input.value=parseFloat(value);}
this.context.appendChild(this.input);this.attachEvent(this.input,'change',this.changeAction);this.attachEvent(this.input,'input',this.inputAction);if(this.ExibirNumeracao=="1"){this.numberSpan=document.createElement("span");this.numberSpan.className="ml-3 text-muted";this.numberSpan.innerHTML=this.input.value;this.context.appendChild(this.numberSpan);}};HTMLSlider.prototype.designComponent=function(doc){if(this.report){this.designReport();return"";}
this.div.className+=" d-flex align-items-center";this.divClass=this.div.className;this.designInput(doc);};HTMLSlider.prototype.updateSpan=function(){if(this.numberSpan){this.numberSpan.innerHTML=this.input.value;}};HTMLSlider.prototype.inputAction=function(e,o){this.updateSpan();};HTMLSlider.prototype.changeAction=function(e,o){this.updateSpan();if(this.AoFinalizarMovimentacao){return this.AoFinalizarMovimentacao.call(this,this.input.value);}};HTMLSlider.prototype.getValue=function(){return this.input.value;};function HTMLSliderPanel(sys,formID,code,posX,posY,width,height,description,value,showValue){this.create(sys,formID,code,posX,posY,width,height,description,value);}
HTMLSliderPanel.inherits(HTMLElementBase);HTMLSliderPanel.prototype.name='HTMLSliderPanel';HTMLSliderPanel.prototype.tabable=true;HTMLSliderPanel.prototype.designComponent=function(doc){this.updateProperties();this.div.className+=" d-flex carousel slide";this.divClass=this.div.className;this.div.setAttribute("data-ride","carousel");this.div.id=this.id?this.id:"carousel"+this.code;this.attachEvent(this.div,'click',this.clickAction);if(this.TabelaImagem&&this.TabelaImagem.length&&this.TabelaImagem.length>0){this.carouselData=this.parseData(this.TabelaImagem);}else this.carouselData=null;if(this.CorRodapeAtivo&&this.CorRodapeAtivo.length&&this.CorRodapeAtivo.length>0){var lowerCaseColor=this.CorRodapeAtivo.trim().toLowerCase();if(lowerCaseColor=='primary')this.CorRodapeAtivo="var(--primary)";else if(lowerCaseColor=='secondary')this.CorRodapeAtivo="var(--secondary)";this.carouselStyle=document.createElement("style");this.carouselStyle.innerHTML=".carousel-indicators li.active { background-color: "+this.CorRodapeAtivo+"; }";this.div.appendChild(this.carouselStyle);}
if(this.carouselData!=null&&this.carouselData.size>0){this.carouselIndicators=document.createElement("ol");this.carouselIndicators.className="carousel-indicators";this.div.appendChild(this.carouselIndicators);for(var i=0;i<this.carouselData.size;i++){var slideIndicator=document.createElement("li");slideIndicator.setAttribute("data-target","#"+this.div.id);slideIndicator.setAttribute("data-slide-to",i.toString());if(i==0)slideIndicator.className="active";this.carouselIndicators.appendChild(slideIndicator);}
this.carouselInner=document.createElement("div");this.carouselInner.className="carousel-inner";this.div.appendChild(this.carouselInner);for(var i=0;i<this.carouselData.size;i++){var item=this.carouselData.get((i+1).toString());var slideDiv=document.createElement("div");slideDiv.className=(i==0)?"carousel-item active":"carousel-item";this.carouselInner.appendChild(slideDiv);var slideImg=document.createElement("img");slideImg.src=item.get("path");slideImg.className="d-block w-100";slideImg.alt=item.get("description");slideImg.height=this.height;slideDiv.appendChild(slideImg);var slideCaption=document.createElement("div");slideCaption.className="carousel-caption d-none d-md-block";slideDiv.appendChild(slideCaption);if(item.has("title")&&item.get("title").length>0){var slideTitle=document.createElement("h5");slideTitle.innerHTML=item.get("title");slideCaption.appendChild(slideTitle);}
var slideDescription;if(item.has("link")&&item.get("link").length>0){slideDescription=document.createElement("a");slideDescription.href=item.get("link");slideDescription.innerHTML=item.get("description");}else{slideDescription=document.createElement("p");slideDescription.innerHTML=item.get("description");}
slideCaption.appendChild(slideDescription);if(this.CorFonteTexto&&this.CorFonteTexto.length&&this.CorFonteTexto.length>0){slideDescription.style.color=this.CorFonteTexto;}
if(this.TamanhoFonte&&this.TamanhoFonte.length&&this.TamanhoFonte.length>0){slideDescription.style.fontSize=(this.TamanhoFonte.indexOf("px")!=-1||this.TamanhoFonte.indexOf("pt")!=-1||this.TamanhoFonte.indexOf("em")!=-1||this.TamanhoFonte.indexOf("rem")!=-1)?this.TamanhoFonte:this.TamanhoFonte+"px";}}
this.carouselPrev=document.createElement("a");this.carouselPrev.className="carousel-control-prev";this.carouselPrev.href="#"+this.div.id;this.carouselPrev.setAttribute("role","button");this.carouselPrev.setAttribute("data-slide","prev");this.div.appendChild(this.carouselPrev)
this.carouselPrevIcon=document.createElement("span");this.carouselPrevIcon.className="carousel-control-prev-icon";this.carouselPrevIcon.setAttribute("aria-hidden","true");this.carouselPrev.appendChild(this.carouselPrevIcon);this.carouselPrevText=document.createElement("span");this.carouselPrevText.className="sr-only";this.carouselPrevText.innerHTML=getMessage("LABEL.PREVIOUS_PAGE");this.carouselPrev.appendChild(this.carouselPrevText);this.carouselNext=document.createElement("a");this.carouselNext.className="carousel-control-next";this.carouselNext.href="#"+this.div.id;this.carouselNext.setAttribute("role","button");this.carouselNext.setAttribute("data-slide","next");this.div.appendChild(this.carouselNext)
this.carouselNextIcon=document.createElement("span");this.carouselNextIcon.className="carousel-control-next-icon";this.carouselNextIcon.setAttribute("aria-hidden","true");this.carouselNext.appendChild(this.carouselNextIcon);this.carouselNextText=document.createElement("span");this.carouselNextText.className="sr-only";this.carouselNextText.innerHTML=getMessage("LABEL.NEXT_PAGE");this.carouselNext.appendChild(this.carouselNextText);}};HTMLSliderPanel.prototype.parseData=function(data){if(typeof data==='string'){data=data.replace(/\+/g,' ').replace(/(\r\n|\n|\r)/gm,'');data=ebfURLDecoder(data);data=ebfConvertJSONToVariant(data);if(data.has("sliderpanel"))return data.get("sliderpanel");}
return null;};HTMLSliderPanel.prototype.updateProperties=function(){this.enabled=parseBoolean(this.Habilitado);this.visible=parseBoolean(this.Visivel);};function HTMLImageGallery(sys,formID,code,posX,posY,width,height,description,value,showValue){this.create(sys,formID,code,posX,posY,width,height,description,value);this.selectedImage=null;this.criptografado=false;this.skipContextMenu=false;this.mobile=isMobile();}
HTMLImageGallery.inherits(HTMLElementBase);HTMLImageGallery.prototype.name='HTMLImageGallery';HTMLImageGallery.prototype.tabable=true;HTMLImageGallery.prototype.setEnabled=function(v){this.callMethod(HTMLElementBase,"setEnabled",[v]);if((!this.enabled||this.readonly)&&this.selectedImage!=null)this.unselectImage();};HTMLImageGallery.prototype.setReadOnly=function(v){this.callMethod(HTMLElementBase,"setReadOnly",[v]);if((!this.enabled||this.readonly)&&this.selectedImage!=null)this.unselectImage();};HTMLImageGallery.prototype.getCriptografado=function(){return this.criptografado?"1":"0";};HTMLImageGallery.prototype.setCriptografado=function(criptografado){this.criptografado=criptografado;};HTMLImageGallery.prototype.getSelectedImage=function(){return this.selectedImage;};HTMLImageGallery.prototype.getSelectedImageId=function(){return this.selectedImage?this.selectedImage.serverId:"";};HTMLImageGallery.prototype.getSelectedImageUrl=function(){return this.selectedImage?this.selectedImage.serverUrl:"";};HTMLImageGallery.prototype.designComponent=function(doc){var object=this;this.thumbWidth=(this.TamanhoMiniatura&&this.TamanhoMiniatura.length&&this.TamanhoMiniatura.length>0)?parseInt(this.TamanhoMiniatura):0;this.thumbHeight=(this.AlturaMiniatura&&this.AlturaMiniatura.length&&this.AlturaMiniatura.length>0)?parseInt(this.AlturaMiniatura):0;this.borders=(this.Bordas&&this.Bordas.length&&this.Bordas.toLowerCase()=="true");this.expandOnClick=(this.ExpandirAoClicar&&this.ExpandirAoClicar.length&&this.ExpandirAoClicar.toLowerCase()=="true");this.allowDownload=(this.PermitirDownload&&this.PermitirDownload.length&&this.PermitirDownload.toLowerCase()=="true");this.allowUpload=(this.PermitirUpload&&this.PermitirUpload.length&&this.PermitirUpload.toLowerCase()=="true");this.allowDelete=(this.PermitirExclusao&&this.PermitirExclusao.length&&this.PermitirExclusao.toLowerCase()=="true");this.div.className+=(this.borders?" card":"")+" fixed-height";this.div.style.overflow="visible";this.divClass=this.div.className;this.div.id=this.id?this.id:"gallery"+this.code;this.preloader=bootstrapCreateSpinner(this.div,"text-primary",true)[0];this.preloader.style.zIndex="10";this.preloaderClass=this.preloader.className;this.contentDiv=document.createElement("div");this.contentDiv.className="w-100 h-100"+(this.borders?" p-1":"");this.contentDiv.id=this.div.id+"-content";if(this.BarraRolagem&&this.BarraRolagem.length&&this.BarraRolagem.length>0){switch(this.BarraRolagem){case"H":{this.contentDiv.style.maxHeight=this.height+"px";this.contentDiv.style.whiteSpace="nowrap";this.contentDiv.className="w-auto h-100"+(this.borders?" p-1":"");this.contentDivClass=this.contentDiv.className;this.overflowDiv=document.createElement("div");this.overflowDiv.className="w-100 h-100";this.overflowDiv.style.overflowX="auto";this.overflowDiv.style.overflowY="hidden";this.overflowDiv.appendChild(this.contentDiv);this.overflowDiv.onscroll=function(){object.unselectImage();};this.div.appendChild(this.overflowDiv);break;}
case"V":{this.contentDiv.style.overflowX="hidden";this.contentDiv.style.overflowY="auto";this.contentDiv.onscroll=function(){object.unselectImage();};this.contentDivClass=this.contentDiv.className;this.div.appendChild(this.contentDiv);break;}
default:{this.contentDiv.className+=" overflow-hidden";this.contentDivClass=this.contentDiv.className;this.div.appendChild(this.contentDiv);break;}}}else{this.contentDiv.className+=" overflow-hidden";this.contentDivClass=this.contentDiv.className;this.div.appendChild(this.contentDiv);}
this.contentDiv.onclick=function(e){if(object.mobile&&(!object.images||object.images.length==0)){object.uploadAction(e);}};this.dropdownMenu=document.createElement("div");this.dropdownMenu.className="dropdown-menu ml-2";this.dropdownMenu.id="dropdown"+this.code;this.dropdownMenuClass=this.dropdownMenu.className;document.body.appendChild(this.dropdownMenu);this.dropdownHeader=document.createElement("h6");this.dropdownHeader.className="dropdown-header";this.dropdownHeader.innerHTML=getLocaleMessage("LABEL.ACTIONS");this.dropdownMenu.appendChild(this.dropdownHeader);var dropdownView=document.createElement("a");dropdownView.href="#";dropdownView.className="dropdown-item";dropdownView.innerHTML=getLocaleMessage("LABEL.GALLERY_VIEW");this.dropdownMenu.appendChild(dropdownView);this.dropdownMenu.viewButton=dropdownView;this.attachEvent(dropdownView,'click',this.viewAction);if(this.allowDelete){var dropdownDelete=document.createElement("a");dropdownDelete.href="#";dropdownDelete.className="dropdown-item";dropdownDelete.innerHTML=getLocaleMessage("LABEL.GALLERY_DELETE");this.dropdownMenu.appendChild(dropdownDelete);this.dropdownMenu.deleteButton=dropdownDelete;this.attachEvent(dropdownDelete,'click',this.deleteAction);}
if(this.allowDownload){var dropdownDownload=document.createElement("a");dropdownDownload.href="#";dropdownDownload.className="dropdown-item";dropdownDownload.innerHTML=getLocaleMessage("LABEL.GALLERY_DOWNLOAD");this.dropdownMenu.appendChild(dropdownDownload);this.dropdownMenu.downloadButton=dropdownDownload;this.attachEvent(dropdownDownload,'click',this.downloadAction);}
var dropdownDivider=document.createElement("div");dropdownDivider.className="dropdown-divider";this.dropdownMenu.dropdownDivider=dropdownDivider;this.dropdownMenu.appendChild(dropdownDivider);var dropdownRefresh=document.createElement("a");dropdownRefresh.href="#";dropdownRefresh.className="dropdown-item";dropdownRefresh.innerHTML=getLocaleMessage("LABEL.GALLERY_UPDATE");this.dropdownMenu.appendChild(dropdownRefresh);this.dropdownMenu.refreshButton=dropdownRefresh;this.attachEvent(dropdownRefresh,'click',this.refreshAction);if(this.allowUpload){var dropdownUpload=document.createElement("a");dropdownUpload.href="#";dropdownUpload.className="dropdown-item";dropdownUpload.innerHTML=getLocaleMessage("LABEL.GALLERY_UPLOAD");this.dropdownMenu.appendChild(dropdownUpload);this.dropdownMenu.uploadButton=dropdownUpload;this.attachEvent(dropdownUpload,'click',this.uploadAction);}
this.attachEvent(this.div,'click',this.clickAction);this.attachEvent(this.div,'contextmenu',this.contextMenuAction);this.attachEvent(document.body,'click',function(){if(object)object.closeDropdownMenu();});if(this.ExpandirAoClicar&&this.ExpandirAoClicar.length&&this.ExpandirAoClicar.toLowerCase()=="true"){if(!document.getElementById("fancybox-css")){var head=document.getElementsByTagName('head')[0];var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='assets/jquery.fancybox.min.css';link.id='fancybox-css';head.appendChild(link);}
webrun.include("assets/jquery.fancybox.min.js");}
this.showPreloader();};HTMLImageGallery.prototype.setVisible=function(v){this.callMethod(HTMLElementBase,"setVisible",[v]);v?this.div.classList.remove("d-none"):this.div.classList.add("d-none")};HTMLImageGallery.prototype.refresh=function(){this.updateList();};HTMLImageGallery.prototype.onFormLoadAction=function(){if(!this.loaded)
this.updateList();this.loaded=true;};HTMLImageGallery.prototype.showPreloader=function(){if(this.contentDiv)this.contentDiv.className="d-none";if(this.preloader)this.preloader.className=this.preloaderClass;if(this.div)this.div.className=this.divClass+" align-items-center justify-content-center"+(!this.visible?" d-none":"");};HTMLImageGallery.prototype.hidePreloader=function(){if(this.contentDiv)this.contentDiv.className=this.contentDivClass;if(this.preloader)this.preloader.className="d-none";if(this.div)this.div.className=this.divClass+(!this.visible?" d-none":"");};HTMLImageGallery.prototype.getRequestURL=function(){var params="";if(d.t&&d.t.dependences){var components=d.t.dependences[this.code];if(components&&components.length>0){for(var code in components){if(isNumeric(code)){var component=eval("$mainform().d.c_"+components[code]);if(component){params+=("&WFRInput"+component.getCode()+"="+URLEncode(component.getValue(),"GET"));}}}}}
return getAbsolutContextPath()+"componentData.do?action=componentData&sys="+URLEncode(this.sys,'GET')+"&formID="+URLEncode(this.formID,'GET')+"&comID="+URLEncode(this.code,'GET')+params;};HTMLImageGallery.prototype.updateList=function(){var object=this;this.showPreloader();this.images=[];this.contentDiv.innerHTML="";this.contentDiv.className=this.contentDivClass;this.addButton=null;$.post(this.getRequestURL()+"&type=l",{},function(response){if(response&&typeof response==='object'){if(response.success){if(response.data)object.images=response.data;if(object.images&&object.images.length>0){for(var i=0;i<object.images.length;i++){if(object.images[i]===null||object.images[i].length==0)continue;object.designItem(i,object.images[i]);}}
if(object.expandOnClick){$("#"+object.contentDiv.id+" a").fancybox({closeExisting:true,loop:true,keyboard:true,arrows:true,protect:!object.allowDownload});object.fancybox=$.fancybox.getInstance();}}else{var error=new HTMLMessage();error.showErrorMessage(null,getLocaleMessage("ERROR.OPERATION_ERROR"),null,response.details,null);}}
object.postUpdateList();}).fail(function(){object.postUpdateList();});};HTMLImageGallery.prototype.designItem=function(index,id){var object=this;var url=this.getRequestURL()+"&req="+URLEncode(id,"GET");var imageDiv=document.createElement("img");imageDiv.className="rounded";imageDiv.src=url+"&type=m";imageDiv.alt="";if(this.thumbWidth&&this.thumbWidth>0)imageDiv.width=this.thumbWidth;if(this.thumbHeight&&this.thumbHeight>0)imageDiv.height=this.thumbHeight;if(this.expandOnClick){var imageLink=document.createElement("a");imageLink.className="d-inline-block p-1";imageLink.id=this.div.id+"-image-"+index;imageLink.href=url;imageLink.setAttribute("rel","gallery");imageLink.setAttribute("data-fancybox","gallery");imageLink.style.outline="0";imageLink.appendChild(imageDiv);this.contentDiv.appendChild(imageLink);imageDiv=imageLink;}else{imageDiv.className="d-inline-block p-1";this.contentDiv.appendChild(imageDiv);}
imageDiv.defaultClass=imageDiv.className;imageDiv.serverId=id;imageDiv.serverUrl=url;if(!this.allowDownload){imageDiv.ondragstart=function(){return false;};}
imageDiv.onclick=function(e){if(!object.enabled||(!object.skipContextMenu&&!object.expandOnClick)||(!object.skipContextMenu&&object.mobile)){e.stopPropagation();e.preventDefault();object.skipContextMenu=false;if(object.enabled)object.selectImage(imageDiv,true);return false;}else{object.selectImage(imageDiv,false);}};imageDiv.oncontextmenu=function(e){e.stopPropagation();e.preventDefault();if(object.enabled)object.selectImage(imageDiv,true);return false;};};HTMLImageGallery.prototype.postUpdateList=function(){this.hidePreloader();if(this.allowUpload){this.addButton=document.createElement("a");this.addButton.className=(!this.images||this.images.length==0)?"d-none":"d-inline-block p-1 text-muted align-middle";this.addButton.style.textDecoration="none";this.addButton.href="#";this.contentDiv.appendChild(this.addButton);var addButtonInner=document.createElement("div");addButtonInner.className="d-flex align-items-center justify-content-center border rounded";addButtonInner.style.setProperty("border-style","dashed","important");addButtonInner.style.width=this.thumbWidth+"px";addButtonInner.style.height=this.thumbHeight+"px";this.addButton.appendChild(addButtonInner);var addButtonIcon=document.createElement("i");addButtonIcon.className="fas fa-plus";addButtonIcon.style.fontSize="1.5rem";addButtonInner.appendChild(addButtonIcon);this.attachEvent(this.addButton,'click',this.uploadAction);}
if(!this.images||this.images.length==0){var emptyList=document.createElement("p");emptyList.className="text-muted";emptyList.innerHTML=getLocaleMessage("LABEL.GALLERY_EMPTY");this.contentDiv.appendChild(emptyList);this.contentDiv.className="w-100 h-100 p-4 d-flex align-items-center justify-content-center text-center";}};HTMLImageGallery.prototype.unselectImage=function(){if(this.selectedImage!=null){this.selectedImage.className=this.selectedImage.defaultClass;this.selectedImage.removeAttribute("data-event","show");this.selectedImage=null;}
this.closeDropdownMenu();};HTMLImageGallery.prototype.selectImage=function(imageDiv,contextMenu){if(this.selectedImage!=null&&this.selectedImage!=imageDiv){this.unselectImage();}
if(imageDiv){imageDiv.className+=" border rounded";imageDiv.setAttribute("data-event","show");var lastSelectedImage=this.selectedImage;this.selectedImage=imageDiv;if(contextMenu){this.openDropdownMenu((this.overflowDiv)?(imageDiv.offsetLeft+imageDiv.offsetWidth-this.overflowDiv.scrollLeft+this.div.offsetLeft):(imageDiv.offsetLeft+imageDiv.offsetWidth+this.div.offsetLeft),(imageDiv.offsetTop-this.contentDiv.scrollTop+this.div.offsetTop));if(this.dropdownHeader)this.dropdownHeader.innerHTML=getLocaleMessage("LABEL.ACTIONS");if(this.dropdownMenu.viewButton)this.dropdownMenu.viewButton.className="dropdown-item";if(this.dropdownMenu.deleteButton)this.dropdownMenu.deleteButton.className="dropdown-item";if(this.dropdownMenu.dropdownDivider)this.dropdownMenu.dropdownDivider.className="dropdown-divider";if(this.dropdownMenu.downloadButton){this.dropdownMenu.downloadButton.className="dropdown-item";this.dropdownMenu.downloadButton.href=imageDiv.serverUrl;this.dropdownMenu.downloadButton.setAttribute("download","image.png");}}
if(this.AoSelecionar&&lastSelectedImage!=this.selectedImage){return this.AoSelecionar.call(this,this.getSelectedImageId());}}else this.selectedImage=null;};HTMLImageGallery.prototype.openDropdownMenu=function(x,y){if(this.dropdownMenu){this.dropdownMenu.style.top=y+"px";this.dropdownMenu.style.left=x+"px";if(this.zindex)this.dropdownMenu.style.zIndex=this.zindex+1;this.dropdownMenu.className=this.dropdownMenuClass+" show";}};HTMLImageGallery.prototype.closeDropdownMenu=function(){if(this.dropdownMenu){this.dropdownMenu.style="";this.dropdownMenu.className=this.dropdownMenuClass;}};HTMLImageGallery.prototype.click=function(){if(this.div.onclick)this.div.onclick.call(this);};HTMLImageGallery.prototype.clickAction=function(e,o){this.callMethod(HTMLElementBase,"clickAction",[e,o]);this.unselectImage();};HTMLImageGallery.prototype.viewAction=function(e,o){e.preventDefault();e.stopPropagation();if(!this.enabled){this.unselectImage();return false;}
if(this.selectedImage!=null){this.skipContextMenu=true;this.selectedImage.click();this.unselectImage();}};HTMLImageGallery.prototype.downloadAction=function(e,o){if(!this.enabled){e.preventDefault();e.stopPropagation();this.unselectImage();return false;}};HTMLImageGallery.prototype.deleteAction=function(e,o){e.preventDefault();e.stopPropagation();if(!this.enabled)return false;if(this.selectedImage!=null){var object=this;interaction(getLocaleMessage("LABEL.GALLERY_DELETE_CONFIRM"),[],[function(){$.post(object.selectedImage.serverUrl+"&type=d",{},function(response){if(response&&typeof response==='object'){if(!response.success){var error=new HTMLMessage();error.showErrorMessage(null,getLocaleMessage("LABEL.GALLERY_DELETE_ERROR"),null,response.details,null);}}
object.unselectImage();object.updateList();}).fail(function(){interactionError(getLocaleMessage("LABEL.GALLERY_DELETE_ERROR"));object.unselectImage();object.updateList();});}],[],[]);}};HTMLImageGallery.prototype.refreshAction=function(e,o){e.preventDefault();e.stopPropagation();this.unselectImage();if(!this.enabled)return false;this.updateList();};HTMLImageGallery.prototype.contextMenuAction=function(e,o){e.preventDefault();e.stopPropagation();this.unselectImage();if(!this.enabled)return false;if(this.dropdownMenu){this.openDropdownMenu(e.pageX,e.pageY);if(this.dropdownHeader)this.dropdownHeader.innerHTML=getLocaleMessage("LABEL.GALLERY");if(this.dropdownMenu.viewButton)this.dropdownMenu.viewButton.className="dropdown-item d-none";if(this.dropdownMenu.deleteButton)this.dropdownMenu.deleteButton.className="dropdown-item d-none";if(this.dropdownMenu.dropdownDivider)this.dropdownMenu.dropdownDivider.className="dropdown-divider d-none";if(this.dropdownMenu.downloadButton){this.dropdownMenu.downloadButton.className="dropdown-item d-none";this.dropdownMenu.downloadButton.href="#";this.dropdownMenu.downloadButton.removeAttribute("download");}}};HTMLImageGallery.prototype.uploadAction=function(e,o){e.preventDefault();e.stopPropagation();if(!this.enabled||!this.allowUpload)return false;this.unselectImage();this.uploadWindow=openUpload(this.sys,this.formID,this.code,this.getCriptografado(),false,true);};HTMLImageGallery.prototype.refresh=function(hasImage,fileName,fileMD5){try{if(this.uploadWindow){this.uploadWindow.close();this.uploadWindow=null;}}catch(e){}
this.updateList();};function HTMLAccordion(sys,formID,code,posX,posY,width,height,description,value,showValue){this.create(sys,formID,code,posX,posY,width,height,description,value);this.sections=[];this.formsInfo=null;this.activeSection=null;}
HTMLAccordion.inherits(HTMLLabeledComponent);HTMLAccordion.prototype.name='HTMLAccordion';HTMLAccordion.prototype.tabable=true;HTMLAccordion.prototype.designComponent=function(doc){this.limitContent=((this.LimitarConteudo&&this.LimitarConteudo.toLowerCase()==="true")||this.LimitarConteudo===true);this.autoExpand=((this.ExpandirAuto&&this.ExpandirAuto.toLowerCase()==="true")||this.ExpandirAuto===true);this.div.className+=" card d-flex flex-column accordion"+(this.limitContent===true?" overflow-auto":"");this.divClass=this.div.className;var object=this;$(this.div).on('show.bs.collapse',function(e){object.expandAction(e.target);});$(this.div).on('hide.bs.collapse',function(e){object.collapseAction(e.target);});};HTMLAccordion.prototype.onFormLoadAction=function(){if(!this.loaded)
this.updateSections();this.loaded=true;};HTMLAccordion.prototype.refresh=function(){this.updateSections();};HTMLAccordion.prototype.showPreloader=function(){if(this.div)this.div.className=this.divClass+" align-items-center justify-content-center";this.preloader=bootstrapCreateSpinner(this.div,"text-primary",true)[0];try{this.preloader.style.backgroundColor=window.getComputedStyle(document.body).backgroundColor;}catch(e){}};HTMLAccordion.prototype.hidePreloader=function(){if(this.preloader){this.div.removeChild(this.preloader);this.preloader=null;}
if(this.div)this.div.className=this.divClass;};HTMLAccordion.prototype.checkServerResponse=function(response){if(response&&response.success==="0"){interactionError(safeGetLocaleMessage("ERROR.OPERATION_ERROR"),null,null,null,response.details?response.details:null);return false;}
return true;};HTMLAccordion.prototype.updateSections=function(){if(this.div)this.div.innerHTML="";var object=this;this.sendRequest(null,function(response){if(response&&response.length>0){response=JSON.parse(response);if(object.checkServerResponse(response)){object.designSections(response);}}},function(){object.designSections();});};HTMLAccordion.prototype.designSections=function(serverData){this.sections=[];if(serverData&&serverData.type){if(serverData.type.toLowerCase()=="content"&&serverData.content){for(var i=0;i<serverData.content.length;i++){var sectionData=serverData.content[i];this.designSection(i,"Linha da Tabela",sectionData[0],sectionData[1]);}
return;}else if(serverData.type.toLowerCase()=="form"&&serverData.content){this.formsInfo=serverData.content;}}
if(this.ListaTitulo&&this.ListaTitulo.length&&this.ListaTitulo.length>0){var sectionsData=unescape(this.ListaTitulo).trim();if(sectionsData.indexOf("|")!=-1){sectionsData=sectionsData.split("|");for(var i=0;i<sectionsData.length;i++){var sectionData=sectionsData[i].split("=");this.designSection(i,sectionData[0],sectionData[1]);}}else if(sectionsData.indexOf("=")!=-1){var sectionData=sectionsData.split("=");this.designSection(0,sectionData[0],sectionData[1]);}}
if(this.autoExpand){try{if(this.sections&&this.sections.length>0){this.sections[0].button.click();}}catch(e){}}};HTMLAccordion.prototype.designSection=function(i,type,title,content){var collapseId="collapse"+this.code+"-"+i;var shownText=title;var lURI="";var sectionDiv=document.createElement("div");this.context.appendChild(sectionDiv);var sectionHeaderDiv=document.createElement("div");sectionHeaderDiv.className="card-header";sectionHeaderDiv.id="heading"+this.code+"-"+i;sectionDiv.appendChild(sectionHeaderDiv);var sectionTitleDiv=document.createElement("h2");sectionTitleDiv.className="my-0 p-0 d-flex align-items-center";sectionHeaderDiv.appendChild(sectionTitleDiv);var sectionTitleButton=document.createElement("button");sectionTitleButton.className="btn btn-link w-100 p-0 text-left";sectionTitleButton.type="button";sectionTitleButton.setAttribute("data-toggle","collapse");sectionTitleButton.setAttribute("data-target","#"+collapseId);sectionTitleButton.setAttribute("aria-expanded","false");sectionTitleButton.setAttribute("aria-controls",collapseId);sectionTitleDiv.appendChild(sectionTitleButton);if(this.corFonteElemento&&this.corFonteElemento.length&&this.corFonteElemento.length>0){sectionTitleButton.style.color=this.corFonteElemento;}
var formattedType=translateAcentos(type.toLowerCase().trim());if(this.formsInfo&&formattedType==="formulario"&&this.formsInfo[title]){shownText=this.formsInfo[title][0];}else if(formattedType==="url"){var jsonInfo=this.separateTitleParts(title);shownText=jsonInfo.title;lURI=jsonInfo.lURL;}
sectionTitleButton.innerHTML=shownText;var sectionCollapseDiv=document.createElement("div");sectionCollapseDiv.id=collapseId;sectionCollapseDiv.className="collapse";sectionCollapseDiv.setAttribute("aria-labelledby",sectionHeaderDiv.id);sectionCollapseDiv.setAttribute("data-parent","#"+this.id);sectionDiv.appendChild(sectionCollapseDiv);var sectionBody=document.createElement("div");sectionBody.className="card-body p-0";sectionBody.id="section-body"+this.code+"-"+i;if(content)sectionBody.innerHTML=content;sectionCollapseDiv.appendChild(sectionBody);sectionCollapseDiv.bodyElement=sectionBody;sectionCollapseDiv.titleElement=sectionTitleButton;sectionCollapseDiv.sectionIndex=this.sections.length;this.sections.push({type:formattedType,title:title,lURL:lURI,div:sectionDiv,shownText:shownText,button:sectionTitleButton});};HTMLAccordion.prototype.separateTitleParts=function(title){try{let regex=new RegExp(/\(([^)]+)\)/g);if(regex.test(title)){let arr=title.match(regex);if(arr){let lTitle=arr[0].replace("(","").replace(")","");let url=title.replace(arr[0],"");return{title:lTitle,lURL:url};}}}catch(e){}
return{title:title,lURL:title};};HTMLAccordion.prototype.click=function(){if(this.div.onclick)this.div.onclick.call(this);};HTMLAccordion.prototype.expandAction=function(sectionDiv){var sectionData=this.sections[sectionDiv.sectionIndex];sectionData.div.className="d-flex flex-column flex-fill";this.activeSection=sectionData;if(sectionData.type=="formulario"){var formInfo=this.formsInfo[sectionData.title];if(!sectionDiv.sectionFrame){var iframe=document.createElement("iframe");iframe.className="w-100 h-100 border-0 m-0";iframe.style.minHeight=formInfo[3]+"px";iframe.style.outline="0";sectionDiv.bodyElement.className="card-body p-0 overflow-auto";sectionDiv.bodyElement.appendChild(iframe);sectionDiv.sectionFrame=iframe;}
if(sectionDiv.sectionFrame.src==null||sectionDiv.sectionFrame.src.length==0){sectionDiv.sectionFrame.src="form"+PAGES_EXTENSION+"?sys="+this.sys+"&action=openform&formID="+URLEncode(formInfo[1],'GET')+"&align=0&mode=-1&goto=-1&filter=&scrolling=false";}}else if(sectionData.type=="url"){if(!sectionDiv.sectionFrame){var iframe=document.createElement("iframe");iframe.className="w-100 h-100 border-0 m-0";iframe.style.outline="0";sectionDiv.bodyElement.className="card-body p-0 overflow-auto";sectionDiv.bodyElement.appendChild(iframe);sectionDiv.sectionFrame=iframe;}
if(sectionDiv.sectionFrame.src==null||sectionDiv.sectionFrame.src.length==0){sectionDiv.sectionFrame.src=sectionData.lURL;}}
if(this.AoExpandir){this.AoExpandir.call(this,sectionDiv.bodyElement.id,sectionData.shownText,sectionDiv.sectionIndex);}};HTMLAccordion.prototype.collapseAction=function(sectionDiv){var sectionData=this.sections[sectionDiv.sectionIndex];sectionData.div.className="";if(this.AoContrair&&this.AoContrair.call(this,sectionDiv.bodyElement.id,sectionData.shownText,sectionDiv.sectionIndex)===false){return false;}
if(this.activeSection==sectionData)this.activeSection=null;};HTMLAccordion.prototype.sendRequest=function(params,cbSuccess,cbError){var object=this;var params="";this.showPreloader();var xhr=new XMLHttpRequest();if(d.t&&d.t.dependences){var components=d.t.dependences[this.code];if(components&&components.length>0){for(var code in components){if(isNumeric(code)){var component=eval("$mainform().d.c_"+components[code]);if(component){params+=("&WFRInput"+component.getCode()+"="+URLEncode(component.getValue(),"GET"));}}}}}
xhr.open("POST","componentData.do?action=componentData&sys="+URLEncode(this.sys,'GET')+"&formID="+URLEncode(this.formID,'GET')+"&comID="+URLEncode(this.code,'GET')+params,true);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.onload=function(e){object.hidePreloader();if(xhr.readyState===4||xhr.status===200){if(cbSuccess)cbSuccess(xhr.responseText);}};xhr.onerror=function(e){object.hidePreloader();if(cbError)cbError(e);interactionError(safeGetLocaleMessage("ERROR.CONNECTION_FAIL"));};var data=null;if(params){data="";var keys=Object.keys(params);for(var i=0;i<keys.length;i++){data+=keys[i]+"="+URLEncode(params[keys[i]]);if(i<keys.length)data+="&";}}
xhr.send(data);};function HTMLCalendar(sys,formID,code,posX,posY,width,height,description,value,showValue){this.create(sys,formID,code,posX,posY,width,height,description,value);this.selectedDate=null;this.selectedTime=null;this.hoveredDate=null;this.hoveredTime=null;this.selectedDateTime=null;this.mobile=isMobile();if(mainform&&mainform.DATE_PATTERN){this.dateTimeFormat=mainform.DATE_PATTERN.toUpperCase()+" "+mainform.TIME_PATTERN;this.dateFormat=mainform.DATE_PATTERN.toUpperCase();this.timeFormat=mainform.TIME_PATTERN;}else{this.dateTimeFormat=utcDateFormat+" "+utcTimeFormat;this.dateFormat=utcDateFormat;this.timeFormat=utcTimeFormat;}}
HTMLCalendar.inherits(HTMLElementBase);HTMLCalendar.prototype.name='HTMLCalendar';HTMLCalendar.prototype.tabable=true;HTMLCalendar.prototype.instance=HTMLCalendar;HTMLCalendar.prototype.utcDateFormat='YYYY-MM-DD';HTMLCalendar.prototype.utcTimeFormat='HH:mm:ss';HTMLCalendar.prototype.requestDateTimeFormat='yyyy-MM-dd HH:mm:ss';HTMLCalendar.prototype.designComponent=function(doc){if(this.Navegacao&&this.Navegacao.length){this.navigation=(this.Navegacao.toLowerCase()=="true");}else this.navigation=true;if(this.Editavel&&this.Editavel.length){this.editable=(this.Editavel.toLowerCase()=="true");}else this.editable=true;if(this.ExibirNumerosDosDias&&this.ExibirNumerosDosDias.length){this.weekNumbers=(this.ExibirNumerosDosDias.toLowerCase()=="true");}else this.weekNumbers=true;if(this.ExibirBotaoHoje&&this.ExibirBotaoHoje.length){this.showTodayButton=(this.ExibirBotaoHoje.toLowerCase()=="true");}else this.showTodayButton=true;if(this.ExibirTitulo&&this.ExibirTitulo.length){this.showCalendarTitle=(this.ExibirTitulo.toLowerCase()=="true");}else this.showCalendarTitle=true;if(this.DestacarHorarioComercial&&this.DestacarHorarioComercial.length){this.businessHours=(this.DestacarHorarioComercial.toLowerCase()=="true");}else this.businessHours=true;if(this.DestacarDiaAtual&&this.DestacarDiaAtual.length){this.nowIndicator=(this.DestacarDiaAtual.toLowerCase()=="true");}else this.nowIndicator=true;if(this.PermitirAlterarModoDeVisualizacao&&this.PermitirAlterarModoDeVisualizacao.length){this.canChangeViewMode=(this.PermitirAlterarModoDeVisualizacao.toLowerCase()=="true");}else this.canChangeViewMode=true;if(this.MenuDeContexto&&this.MenuDeContexto.length){this.hasDropdownMenu=(this.MenuDeContexto.toLowerCase()=="true");}else this.hasDropdownMenu=true;if(this.ModoDeVisualizacao&&this.ModoDeVisualizacao.length){switch(this.ModoDeVisualizacao){case"1":this.defaultView="dayGridMonth";break;case"2":this.defaultView="timeGridWeek";break;case"3":this.defaultView="timeGridDay";break;default:this.defaultView="dayGridMonth";break;}}else this.defaultView="dayGridMonth";this.calendarDiv=document.createElement("div");this.context.appendChild(this.calendarDiv);webrun.include("assets/moment.min.js");if(!document.getElementById("datetimepicker-css")){var head=document.getElementsByTagName('head')[0];var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='assets/bootstrap-datetimepicker.min.css';link.id='datetimepicker-css';head.appendChild(link);}
webrun.include("assets/bootstrap-datetimepicker.min.js");if(!document.getElementById("fullcalendar-css")){var head=document.getElementsByTagName('head')[0];var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='components/fullcalendar/core/main.min.css';link.id='fullcalendar-css';head.appendChild(link);}
if(!document.getElementById("fullcalendar-bootstrap-css")){var head=document.getElementsByTagName('head')[0];var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='components/fullcalendar/bootstrap/main.min.css';link.id='fullcalendar-bootstrap-css';head.appendChild(link);}
if(!document.getElementById("fullcalendar-daygrid-css")){var head=document.getElementsByTagName('head')[0];var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='components/fullcalendar/daygrid/main.min.css';link.id='fullcalendar-daygrid-css';head.appendChild(link);}
if(!document.getElementById("fullcalendar-timegrid-css")){var head=document.getElementsByTagName('head')[0];var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='components/fullcalendar/timegrid/main.min.css';link.id='fullcalendar-timegrid-css';head.appendChild(link);}
webrun.include("components/fullcalendar/core/main.min.js");webrun.include("components/fullcalendar/core/locales-all.min.js");webrun.include("components/fullcalendar/bootstrap/main.min.js");webrun.include("components/fullcalendar/interaction/main.min.js");webrun.include("components/fullcalendar/daygrid/main.min.js");webrun.include("components/fullcalendar/timegrid/main.min.js");var definedLocale=resources_locale.toLowerCase();if(definedLocale=='en_us')this.locale='en';else if(definedLocale=='pt_br')this.locale='pt-br';else if(definedLocale=='es_es')this.locale='es';else if(definedLocale=='fr_fr')this.locale='fr';else this.locale='en';moment.locale(this.locale);this.calendar=new FullCalendar.Calendar(this.calendarDiv,{plugins:['interaction','dayGrid','timeGrid','bootstrap'],themeSystem:'bootstrap',defaultView:this.defaultView,editable:this.canEdit(),eventLimit:true,eventResizableFromStart:this.canEditResizing(),eventStartEditable:this.canEditDragging(),eventDurationEditable:this.canEditResizing(),droppable:this.canEditDragging(),nowIndicator:this.nowIndicator,selectable:true,weekNumbers:this.weekNumbers,navLinks:this.canChangeViewMode?true:false,businessHours:this.businessHours,height:this.height,titleRangeSeparator:" - ",header:(this.navigation?{left:this.showTodayButton?'prev,next today':'prev,next',center:this.showCalendarTitle?'title':'',right:this.canChangeViewMode?'dayGridMonth,timeGridWeek,timeGridDay':''}:false),locale:this.locale});var object=this;this.calendar.on("select",function(info){object.selectDateAction(info);});this.calendar.on("dateClick",function(info){if(object.AoClicarNoDia){object.AoClicarNoDia.call(this,moment(info.date).format(object.dateFormat));}else if(object.mobile){object.addEventAction();}});this.calendar.on("datesRender",function(info){object.hoveredDate=null;object.hoveredTime=null;var previousDate=object.currentDate,dateChanged=false;object.currentDate=info.view.props.dateProfile.currentRange.end;if(previousDate&&object.currentDate.getFullYear()!=previousDate.getFullYear()){dateChanged=true;if(object.AoModificarAno){object.AoModificarAno.call(object,object.currentDate.getFullYear());}}
if(previousDate&&object.currentDate.getMonth()!=previousDate.getMonth()){dateChanged=true;if(object.AoModificarMes){object.AoModificarMes.call(object,(object.currentDate.getMonth()+1));}}
if(dateChanged){object.updateData();}
if(info.view.dayGrid){var dayCells=info.el.querySelectorAll("td.fc-day, td.fc-day-top");for(var i=0;i<dayCells.length;i++){var dayCell=dayCells[i];if(dayCell){dayCell.onmouseenter=function(e){var date=e.target.getAttribute("data-date");if(date!=null)object.hoveredDate=date;};dayCell.onmouseleave=function(e){var date=e.target.getAttribute("data-date");if(date!=null&&date==object.hoveredDate)object.hoveredDate=null;};}}}
if(info.view.timeGrid){var timeCells=info.view.timeGrid.slatEls;for(var i=0;i<timeCells.length;i++){var timeCell=timeCells[i];if(timeCell){timeCell.onmouseenter=function(e){var time=e.target.getAttribute("data-time");if(time!=null)object.hoveredTime=time;};timeCell.onmouseleave=function(e){var time=e.target.getAttribute("data-time");if(time!=null&&time==object.hoveredTime)object.hoveredTime=null;};}}}
var bgEvents=info.el.getElementsByClassName("fc-bgevent-skeleton");for(var i=0;i<bgEvents.length;i++){var bgEvent=bgEvents[i];if(bgEvent)bgEvent.style.pointerEvents="none";}
setTimeout(function(){object.calendar.updateSize();},500);object.updateLayout();});this.calendar.on("eventRender",function(info){info.el.onmouseenter=function(e){object.hoveredEvent=info.event;object.lastHoveredEvent=object.hoveredEvent;};info.el.onmouseleave=function(e){if(info.event==object.hoveredEvent)object.hoveredEvent=null;};if(object.hasActionInEvents()){info.el.style.cursor="pointer";}});this.calendar.on("eventDrop",function(info){if(object.canEditDragging()){if(object.AoMoverEvento){object.AoMoverEvento.call(object,info.event);}else{object.editEvent(info.event,info.event.title,info.event.start,info.event.end,2);}}});this.calendar.on("eventResize",function(info){if(object.canEditResizing()){if(object.AoRedimensionarEvento){object.AoRedimensionarEvento.call(object,info.event);}else{object.editEvent(info.event,info.event.title,info.event.start,info.event.end,2);}}});this.calendar.on("eventClick",function(info){if(object.AoClicarNoEvento){object.AoClicarNoEvento.call(object,info.event);}else{object.createEventModal(1,info.event.start,info.event.end,info.event.allDay,info.event);}});if(this.hasDropdownMenu){this.dropdownMenu=document.createElement("div");this.dropdownMenu.className="dropdown-menu";this.dropdownMenu.id="dropdown"+this.code+"-1";this.dropdownMenuClass=this.dropdownMenu.className;document.body.appendChild(this.dropdownMenu);this.dropdownHeader=document.createElement("h6");this.dropdownHeader.className="dropdown-header";this.dropdownHeader.innerHTML=getLocaleMessage("LABEL.CALENDAR");this.dropdownMenu.appendChild(this.dropdownHeader);this.dropdownRefresh=document.createElement("a");this.dropdownRefresh.href="#";this.dropdownRefresh.className="dropdown-item";this.dropdownRefresh.innerHTML=getLocaleMessage("LABEL.CALENDAR_UPDATE");this.dropdownMenu.appendChild(this.dropdownRefresh);this.attachEvent(this.dropdownRefresh,'click',this.updateCalendarAction);this.dropdownViewEvents=document.createElement("a");this.dropdownViewEvents.href="#";this.dropdownViewEvents.className="dropdown-item";this.dropdownViewEvents.innerHTML=getLocaleMessage("LABEL.CALENDAR_VIEW_EVENTS");this.dropdownMenu.appendChild(this.dropdownViewEvents);this.attachEvent(this.dropdownViewEvents,'click',this.viewEventsAction);if(this.editable){this.dropdownAddEvent=document.createElement("a");this.dropdownAddEvent.href="#";this.dropdownAddEvent.className="dropdown-item";this.dropdownAddEvent.innerHTML=getLocaleMessage("LABEL.CALENDAR_ADD_EVENT");this.dropdownMenu.appendChild(this.dropdownAddEvent);this.attachEvent(this.dropdownAddEvent,'click',this.addEventAction);this.eventDropdownMenu=document.createElement("div");this.eventDropdownMenu.className="dropdown-menu";this.eventDropdownMenu.id="dropdown"+this.code+"-2";this.eventDropdownMenuClass=this.eventDropdownMenu.className;document.body.appendChild(this.eventDropdownMenu);this.eventDropdownHeader=document.createElement("h6");this.eventDropdownHeader.className="dropdown-header";this.eventDropdownHeader.innerHTML=getLocaleMessage("LABEL.CALENDAR_EVENT");this.eventDropdownTimeSpan=document.createElement("span");this.eventDropdownTimeSpan.className="badge badge-light";this.eventDropdownHeader.appendChild(this.eventDropdownTimeSpan);this.eventDropdownMenu.appendChild(this.eventDropdownHeader);this.dropdownEditEvent=document.createElement("a");this.dropdownEditEvent.href="#";this.dropdownEditEvent.className="dropdown-item";this.dropdownEditEvent.innerHTML=getLocaleMessage("LABEL.CALENDAR_EDIT_EVENT");this.eventDropdownMenu.appendChild(this.dropdownEditEvent);this.attachEvent(this.dropdownEditEvent,'click',this.editEventAction);this.dropdownDeleteEvent=document.createElement("a");this.dropdownDeleteEvent.href="#";this.dropdownDeleteEvent.className="dropdown-item";this.dropdownDeleteEvent.innerHTML=getLocaleMessage("LABEL.CALENDAR_DELETE_EVENT");this.eventDropdownMenu.appendChild(this.dropdownDeleteEvent);this.attachEvent(this.dropdownDeleteEvent,'click',this.removeEventAction);}}
this.preloaderDiv=document.createElement("div");this.preloaderDiv.className="d-none";this.preloaderDivClass="position-absolute w-100 h-100 d-flex align-items-center justify-content-center text-center";this.preloaderDiv.style.top="0";this.preloaderDiv.style.zIndex="2";this.div.appendChild(this.preloaderDiv);this.preloader=document.createElement("div");this.preloader.className="spinner-border text-primary";this.preloader.setAttribute("role","status");this.preloaderDiv.appendChild(this.preloader);var preloaderSpan=document.createElement("span");preloaderSpan.className="sr-only";preloaderSpan.innerHTML=getLocaleMessage("LABEL.LOADING")+"...";this.preloader.appendChild(preloaderSpan);this.attachEvent(this.div,'contextmenu',this.contextMenuAction);this.attachEvent(this.calendarDiv,'contextmenu',this.contextMenuAction);this.attachEvent(document.body,'click',function(){if(object)object.closeDropdownMenu();});this.attachEvent(this.div,'click',function(){if(object)object.closeDropdownMenu();});this.attachEvent(window,'resize',function(){if(object)object.updateLayout();});};HTMLCalendar.prototype.onFormLoadAction=function(){if(!this.loaded)
this.updateCalendarAction();this.loaded=true;};HTMLCalendar.prototype.afterInit=function(){this.callMethod(HTMLElementBase,"afterInit",[]);if(this.tab){var object=this;var shownCallback=function(tabPane){object.calendar.render();object.tab.removeShownListener(shownCallback);};this.tab.addShownListener(shownCallback);}
this.calendar.render();};HTMLCalendar.prototype.updateLayout=function(){if(this.div.offsetWidth==0)return false;try{var toolbarDiv=this.div.getElementsByClassName("fc-toolbar")[0];var toolbarRightDiv=toolbarDiv.getElementsByClassName("fc-right")[0];var calendarTitle=toolbarDiv.getElementsByTagName("h2")[0];var todayButton=toolbarDiv.getElementsByClassName("fc-today-button")[0];if(this.div.offsetWidth<=330)calendarTitle.style.fontSize="1.25rem";else if(this.div.offsetWidth<=620)calendarTitle.style.fontSize="1.5rem";else calendarTitle.style.fontSize=null;if(this.div.offsetWidth<=300)calendarTitle.style.padding="0.5rem";else calendarTitle.style.padding=null;if(this.div.offsetWidth<=576)todayButton.style.display="none";else todayButton.style.display=null;if(this.div.offsetWidth<=520)toolbarRightDiv.style.display="none";else toolbarRightDiv.style.display=null;}catch(e){}};HTMLCalendar.prototype.updateData=function(){var object=this;var params="";var firstDay="";var lastDay="";this.showPreloader();var y=this.calendar.view.currentStart.getFullYear();var m=this.calendar.view.currentStart.getMonth();if(this.calendar.view.type=="dayGridMonth"){firstDay=this.calendar.view.activeStart.toISOString();lastDay=this.calendar.view.activeEnd.toISOString();}else{firstDay=new Date(y,m,1,0,0,0).toISOString();lastDay=(this.calendar.view.type=="timeGridWeek")?new Date(y,m+2,1,0,0,0).toISOString():new Date(y,m+1,1,0,0,0).toISOString();}
if(d.t&&d.t.dependences){var components=d.t.dependences[this.code];if(components&&components.length>0){for(var code in components){if(isNumeric(code)){var component=eval("$mainform().d.c_"+components[code]);if(component){params+=("&WFRInput"+component.getCode()+"="+URLEncode(component.getValue(),"GET"));}}}}}
$.get(getAbsolutContextPath()+"componentData.do?action=componentData&sys="+URLEncode(this.sys,'GET')+"&formID="+URLEncode(this.formID,'GET')+"&comID="+URLEncode(this.code,'GET')+"&start="+URLEncode(firstDay,"GET")+"&end="+URLEncode(lastDay,"GET")+params,function(response){object.calendar.batchRendering(function(){object.clearEvents();if(response&&response.events){for(var i=0;i<response.events.length;i++){var event=response.events[i];object.addEvent(event.title,event.start,event.end,event.id,false,event.eventColor,event.textColor);}}
if(response&&response.holidays){for(var i=0;i<response.holidays.length;i++){var holiday=response.holidays[i];var holidayDate=moment(holiday.date);object.calendar.addEvent({title:holiday.title,start:holidayDate.toISOString(),end:holidayDate.toISOString(),allDay:true,overlap:false,rendering:'background',color:'#ff9f89'});}}});if(object.AoAtualizar!==undefined&&object.AoAtualizar!==null){object.AoAtualizar.call(object);}
object.hidePreloader();}).fail(function(){object.hidePreloader();});};HTMLCalendar.prototype.hasEditForm=function(){return this.FormularioDeEdicao!==undefined&&this.FormularioDeEdicao!==null&&this.FormularioDeEdicao.length>0;};HTMLCalendar.prototype.canDelete=function(){return this.canEdit()&&!this.hasEditForm();};HTMLCalendar.prototype.isEditViable=function(){return(!this.hasMoreTables&&!this.hasEditForm())||(this.hasMoreTables&&this.hasEditForm())||(!this.hasMoreTables&&this.hasEditForm());};HTMLCalendar.prototype.canAdd=function(){return(this.editable&&this.enabled&&!this.readonly)&&((!this.hasMoreTables&&!this.hasEditForm())||(this.hasMoreTables&&this.hasEditForm())||(!this.hasMoreTables&&this.hasEditForm()));};HTMLCalendar.prototype.canEdit=function(){return this.hasEventsIds&&(this.editable&&this.enabled&&!this.readonly)&&((!this.hasMoreTables&&!this.hasEditForm())||(this.hasMoreTables&&this.hasEditForm())||(!this.hasMoreTables&&this.hasEditForm()));};HTMLCalendar.prototype.canEditViaModal=function(){return this.canEdit()&&!this.hasMoreTables&&!this.hasEditForm();};HTMLCalendar.prototype.canEditDragging=function(){return this.canEditViaModal()||(this.AoMoverEvento!==undefined&&this.AoMoverEvento!==null);};HTMLCalendar.prototype.canEditResizing=function(){return this.canEditViaModal()||(this.AoRedimensionarEvento!==undefined&&this.AoRedimensionarEvento!==null);};HTMLCalendar.prototype.hasActionInEvents=function(){return this.editable||(this.AoClicarNoEvento!==undefined&&this.AoClicarNoEvento!==null);};HTMLCalendar.prototype.clearEvents=function(){var events=this.calendar.getEvents();if(events&&events.length>0){for(var i=0;i<events.length;i++){events[i].remove();}}};HTMLCalendar.prototype.click=function(){if(this.div.onclick)this.div.onclick.call(this);};HTMLCalendar.prototype.clickAction=function(e){this.closeDropdownMenu();};HTMLCalendar.prototype.selectDateAction=function(e){var dateMoment=moment(e.start);var dateStr=dateMoment.format(this.utcDateFormat);var timeStr=dateMoment.format(this.utcTimeFormat);this.hoveredDate=dateStr;this.selectedDate=dateStr;this.hoveredTime=timeStr;this.selectedTime=timeStr;this.selectedDateTime=e.start;this.closeDropdownMenu();};HTMLCalendar.prototype.contextMenuAction=function(e){if(this.hasDropdownMenu){e.preventDefault();e.stopPropagation();}
if(this.calendar){var targetDateTime="";if(this.hoveredDate!==null){targetDateTime+=this.hoveredDate;this.selectedDate=this.hoveredDate;}else if(this.selectedDate!==null){targetDateTime+=this.selectedDate;}
if(this.hoveredTime!==null){targetDateTime+='T'+this.hoveredTime;this.selectedTime=this.hoveredTime;}else if(this.selectedTime!==null){targetDateTime+='T'+this.selectedTime;}
this.calendar.select(targetDateTime,targetDateTime);if(!this.editable||this.hoveredEvent==null){this.openDropdownMenu(0,e.pageX,e.pageY);}else{this.selectedEvent=this.hoveredEvent;this.openDropdownMenu(1,e.pageX,e.pageY);}}};HTMLCalendar.prototype.openDropdownMenu=function(type,x,y){if(!this.hasDropdownMenu)return false;if(this.AoAbrirMenuDeContexto!==undefined&&this.AoAbrirMenuDeContexto!==null){return this.AoAbrirMenuDeContexto.call(this,type,x,y);}
if(this.editable&&type==1){if(this.eventDropdownMenu){this.eventDropdownMenu.style.top=y+"px";this.eventDropdownMenu.style.left=x+"px";this.eventDropdownMenu.style.zIndex=100001;this.eventDropdownMenu.className=this.eventDropdownMenuClass+" show";this.eventDropdownTimeSpan.innerHTML=this.selectedEvent?moment(this.selectedEvent.start).format('L'):"(...)";if(this.dropdownEditEvent)this.dropdownEditEvent.className=(!this.canEdit()||this.hoveredEvent==null)?"dropdown-item disabled":"dropdown-item";if(this.dropdownDeleteEvent)this.dropdownDeleteEvent.className=(!this.canDelete()||this.hoveredEvent==null)?"dropdown-item disabled":"dropdown-item";}}else{if(this.dropdownMenu){this.dropdownMenu.style.top=y+"px";this.dropdownMenu.style.left=x+"px";this.dropdownMenu.style.zIndex=100001;this.dropdownMenu.className=this.dropdownMenuClass+" show";if(this.dropdownViewEvents)this.dropdownViewEvents.className=this.isTimeline()?"dropdown-item disabled":"dropdown-item";if(this.dropdownAddEvent)this.dropdownAddEvent.className=!this.canAdd()?"dropdown-item disabled":"dropdown-item";}}};HTMLCalendar.prototype.closeDropdownMenu=function(){if(!this.hasDropdownMenu)return false;if(this.AoFecharMenuDeContexto!==undefined&&this.AoFecharMenuDeContexto!==null){return this.AoFecharMenuDeContexto.call(this);}
if(this.dropdownMenu){this.dropdownMenu.style="";this.dropdownMenu.className=this.dropdownMenuClass;}
if(this.eventDropdownMenu){this.eventDropdownMenu.style="";this.eventDropdownMenu.className=this.eventDropdownMenuClass;}};HTMLCalendar.prototype.showPreloader=function(){if(this.preloaderDiv)this.preloaderDiv.className=this.preloaderDivClass;};HTMLCalendar.prototype.hidePreloader=function(){if(this.preloaderDiv)this.preloaderDiv.className="d-none";};HTMLCalendar.prototype.isTimeline=function(){return this.calendar&&this.calendar.view&&this.calendar.view.type=="timeGridDay";};HTMLCalendar.prototype.openTimeline=function(date){if(this.calendar)this.calendar.changeView("timeGridDay",date?date:this.selectedDate);this.closeDropdownMenu();};HTMLCalendar.prototype.refresh=function(){this.updateCalendarAction();};HTMLCalendar.prototype.updateCalendarAction=function(){this.updateData();this.closeDropdownMenu();};HTMLCalendar.prototype.viewEventsAction=function(){this.openTimeline();};HTMLCalendar.prototype.checkServerResponse=function(response){try{if(response&&response.length>0){response=JSON.parse(response);if(response.success==="0"){interactionError(safeGetLocaleMessage("ERROR.OPERATION_ERROR"),null,null,null,response.details?response.details:null);return false;}}}catch(e){}
return true;};HTMLCalendar.prototype.addEvent=function(title,start,end,id,save,color,textColor){var object=this;var eventStart=moment(start);var eventEnd=end?moment(end):null;var allDay=(end===undefined||end===null||(eventStart.hour()==0&&eventStart.minute()==0&&eventStart.second()==0&&eventEnd.hour()==0&&eventEnd.minute()==0&&eventEnd.second()==0));this.calendar.addEvent({id:id,title:title,start:eventStart.toISOString(),end:eventEnd?eventEnd.toISOString():eventStart.toISOString(),allDay:allDay,backgroundColor:color,textColor:textColor});if(save&&this.editable){this.showPreloader();this.sendRequest("a",null,{title:title,start:eventStart.toDate().format(this.requestDateTimeFormat),end:(eventEnd===undefined||eventEnd===null)?eventStart.toDate().format(this.requestDateTimeFormat):eventEnd.toDate().format(this.requestDateTimeFormat),allDay:allDay},function(response){object.checkServerResponse(response);object.updateData();},function(){object.hidePreloader();});}};HTMLCalendar.prototype.editEvent=function(event,title,start,end,save){var object=this;var eventStart=moment(start);var eventEnd=end?moment(end):null;var allDay=(end===undefined||end===null||(eventStart.hour()==0&&eventStart.minute()==0&&eventStart.second()==0&&eventEnd.hour()==0&&eventEnd.minute()==0&&eventEnd.second()==0));if(save!=2){event.setStart(start);event.setEnd(end);event.setAllDay(allDay);event.setProp('title',title);}
if(save>=1&&this.editable){this.showPreloader();this.sendRequest("e",null,{id:event.id,title:title,start:eventStart.toDate().format(this.requestDateTimeFormat),end:(eventEnd===undefined||eventEnd===null)?eventStart.toDate().format(this.requestDateTimeFormat):eventEnd.toDate().format(this.requestDateTimeFormat),allDay:allDay},function(response){object.checkServerResponse(response);object.updateData();},function(){object.hidePreloader();});}};HTMLCalendar.prototype.removeEvent=function(event){var object=this;if(this.editable){this.sendRequest("d",null,{id:event.id,title:event.title},function(response){object.checkServerResponse(response);object.updateData();},function(){object.hidePreloader();});}else{event.remove();}};HTMLCalendar.prototype.addEventAction=function(){this.closeDropdownMenu();if(!this.editable)return;this.createEventModal(0,this.selectedDateTime,this.isTimeline()?this.selectedDateTime:null);};HTMLCalendar.prototype.editEventAction=function(){this.closeDropdownMenu();if(!this.editable)return false;this.createEventModal(1,this.lastHoveredEvent.start,this.lastHoveredEvent.end,this.lastHoveredEvent.allDay,this.lastHoveredEvent);};HTMLCalendar.prototype.createEventModal=function(type,startDate,endDate,allDay,event){var object=this;if(this.hasEditForm()){let url=getAbsolutContextPath()
+"componentData.do?action=componentData&sys="+URLEncode(this.sys,'GET')
+"&formID="+URLEncode(this.formID,'GET')
+"&comID="+URLEncode(this.code,'GET');if(type==0)url+="&type=a"
else if(type==1)url+="&req="+URLEncode(event.id,'GET')+"&type=e"
getAndEvalSync2(url);}else if(this.canEditViaModal()){var modal=ebfBootstrapCreateModal(!this.editable?getLocaleMessage("LABEL.CALENDAR_EVENT"):type==0?getLocaleMessage("LABEL.CALENDAR_ADD_EVENT"):getLocaleMessage("LABEL.CALENDAR_EDIT_EVENT"),true,null,null,null,document.body);var modalDiv=modal[0];var modalBody=modal[2];var modalFooter=modal[3];var dateRow=document.createElement("div");dateRow.className="form-row";modalBody.appendChild(dateRow);var dateRowCol1=document.createElement("div");dateRowCol1.className="col-6";dateRow.appendChild(dateRowCol1);var dateRowCol2=document.createElement("div");dateRowCol2.className="col-6";dateRow.appendChild(dateRowCol2);var dateStartLabel=document.createElement("label");dateStartLabel.setAttribute("for",modalDiv.id+"-date-start");dateStartLabel.innerHTML=getLocaleMessage("LABEL.CALENDAR_DATE_START");dateRowCol1.appendChild(dateStartLabel);var dateStartInput=document.createElement("input");dateStartInput.type="text";dateStartInput.className="form-control";dateStartInput.id=modalDiv.id+"-date-start";dateStartInput.setAttribute("placeholder",getLocaleMessage("LABEL.CALENDAR_DATE_START"));dateStartInput.readOnly=!this.editable;dateRowCol1.appendChild(dateStartInput);var dateEndCheckboxDiv=document.createElement("div");dateEndCheckboxDiv.className="custom-control custom-checkbox mb-2";dateRowCol2.appendChild(dateEndCheckboxDiv);var dateEndCheckboxInput=document.createElement("input");dateEndCheckboxInput.type="checkbox";dateEndCheckboxInput.className="custom-control-input";dateEndCheckboxInput.id=modalDiv.id+"-date-end-checkbox";dateEndCheckboxInput.checked=(startDate!=endDate&&(endDate!=null||allDay===false));dateEndCheckboxInput.disabled=!this.editable;dateEndCheckboxDiv.appendChild(dateEndCheckboxInput);var dateEndLabel=document.createElement("label");dateEndLabel.className="custom-control-label";dateEndLabel.setAttribute("for",modalDiv.id+"-date-end-checkbox");dateEndLabel.innerHTML=getLocaleMessage("LABEL.CALENDAR_DATE_END");dateEndLabel.style.overflow="visible";dateEndCheckboxDiv.appendChild(dateEndLabel);var dateEndInput=document.createElement("input");dateEndInput.type="text";dateEndInput.className="form-control";dateEndInput.id=modalDiv.id+"-date-end";dateEndInput.setAttribute("placeholder",getLocaleMessage("LABEL.CALENDAR_DATE_END"));dateEndInput.readOnly=!this.editable||!dateEndCheckboxInput.checked;dateRowCol2.appendChild(dateEndInput);if(this.editable){var datetimepickerprops={date:moment(startDate),locale:this.locale,format:this.dateTimeFormat,ignoreReadonly:false,showTodayButton:true,allowInputToggle:true,icons:{time:"fas fa-clock",},};$(dateStartInput).datetimepicker(datetimepickerprops);if(endDate!=null)datetimepickerprops.date=moment(endDate);$(dateEndInput).datetimepicker(datetimepickerprops);}else{dateStartInput.value=moment(startDate).format(dateTimeFormat);dateEndInput.value=endDate==null?dateStartInput.value:moment(endDate).format(dateTimeFormat);}
var descriptionFormGroup=document.createElement("div");descriptionFormGroup.className="mt-3";modalBody.appendChild(descriptionFormGroup);var descriptionLabel=document.createElement("label");descriptionLabel.setAttribute("for",modalDiv.id+"-description");descriptionLabel.innerHTML=getLocaleMessage("LABEL.DESCRIPTION")+":";descriptionFormGroup.appendChild(descriptionLabel);var descriptionInput=document.createElement("input");descriptionInput.type="text";descriptionInput.className="form-control";descriptionInput.id=modalDiv.id+"-description";if(event&&event.title)descriptionInput.value=event.title;descriptionInput.setAttribute("placeholder",getLocaleMessage("LABEL.DESCRIPTION"));descriptionInput.readOnly=!this.editable;descriptionFormGroup.appendChild(descriptionInput);var cancelButton=document.createElement("button");cancelButton.type="button";cancelButton.className="btn btn-secondary float-right";cancelButton.innerHTML=this.editable?getLocaleMessage("LABEL.CANCEL"):getLocaleMessage("LABEL.CLOSE");cancelButton.setAttribute("data-dismiss","modal");modalFooter.appendChild(cancelButton);if(this.editable){if(type==1){var removeButton=document.createElement("button");removeButton.type="button";removeButton.className="btn btn-danger float-right";removeButton.innerHTML=getLocaleMessage("LABEL.DELETE");modalFooter.appendChild(removeButton);removeButton.onclick=function(){object.removeEvent(event);cancelButton.click();};}
var addButton=document.createElement("button");addButton.type="button";addButton.className="btn btn-primary float-right mr-2";if(!event||event.title.length==0)addButton.setAttribute("disabled","disabled");addButton.innerHTML=type==0?getLocaleMessage("LABEL.ADD"):getLocaleMessage("LABEL.EDIT");modalFooter.appendChild(addButton);addButton.onclick=function(){if(type==0){object.addEvent(descriptionInput.value,$(dateStartInput).datetimepicker('viewDate').format(object.utcDateFormat+" "+object.utcTimeFormat),$(dateEndInput).datetimepicker('viewDate').format(object.utcDateFormat+" "+object.utcTimeFormat),null,true);}else if(type==1){object.editEvent(event,descriptionInput.value,$(dateStartInput).datetimepicker('viewDate').format(object.utcDateFormat+" "+object.utcTimeFormat),$(dateEndInput).datetimepicker('viewDate').format(object.utcDateFormat+" "+object.utcTimeFormat),1);}
ebfBootstrapCloseModal(modalDiv);};var shortcutKeysEvent=function(e){if(e.key==='Enter'||e.which===13)addButton.click();else if(e.key==='Escape'||e.which===27)cancelButton.click();};dateStartInput.onkeydown=shortcutKeysEvent;dateEndInput.onkeydown=shortcutKeysEvent;descriptionInput.onkeydown=shortcutKeysEvent;}
dateEndCheckboxInput.onchange=function(){dateEndInput.readOnly=!dateEndCheckboxInput.checked;if(!dateEndCheckboxInput.checked){dateEndInput.value=dateStartInput.value;$(dateEndInput).datetimepicker("date",$(dateStartInput).datetimepicker("date"));}};descriptionInput.oninput=function(){if(this.value==null||this.value.length==0){var disabledAttr=addButton.getAttribute("disabled");if(disabledAttr==null||disabledAttr!="disabled"){addButton.setAttribute("disabled","disabled");}}else{var disabledAttr=addButton.getAttribute("disabled");if(disabledAttr!=null&&disabledAttr.length>0){addButton.removeAttribute("disabled");}}};}};HTMLCalendar.prototype.removeEventAction=function(){this.closeDropdownMenu();if(!this.editable)return false;this.removeEvent(this.selectedEvent);this.selectedEvent=null;};HTMLCalendar.prototype.setEnabled=function(v){this.callMethod(HTMLElementBase,"setEnabled",[v]);this.updateCalendarEditable();};HTMLCalendar.prototype.setVisible=function(v){this.callMethod(HTMLElementBase,"setVisible",[v]);this.updateCalendarEditable();};HTMLCalendar.prototype.setReadOnly=function(v){this.callMethod(HTMLElementBase,"setReadOnly",[v]);this.updateCalendarEditable();};HTMLCalendar.prototype.updateCalendarEditable=function(){if(this.calendar){this.calendar.setOption("editable",this.editable&&this.enabled&&!this.readonly);this.calendar.setOption("eventStartEditable",this.editable&&this.enabled&&!this.readonly);this.calendar.setOption("eventDurationEditable",this.editable&&this.enabled&&!this.readonly);}};HTMLCalendar.prototype.getYear=function(){if(this.calendar)return this.calendar.getDate().getFullYear();return null;};HTMLCalendar.prototype.getMonth=function(monthName){if(this.calendar){if(parseBoolean(monthName))return this.calendar.getDate().getMonthName();return(this.calendar.getDate().getMonth()+1);}
return null;};HTMLCalendar.prototype.goToday=function(){if(this.calendar)this.calendar.today();};HTMLCalendar.prototype.nextMonth=function(){if(this.calendar)this.calendar.next();};HTMLCalendar.prototype.prevMonth=function(){if(this.calendar)this.calendar.prev();};HTMLCalendar.prototype.goToMonth=function(month,year){if(this.calendar){let nDate=new Date();nDate.setDate(1);nDate.setMonth(month-1);nDate.setYear(year);nDate.setHours(0);nDate.setMinutes(0);nDate.setSeconds(0);nDate.setMilliseconds(0);this.calendar.gotoDate(nDate);}};HTMLCalendar.prototype.nextYear=function(){if(this.calendar)this.calendar.nextYear();};HTMLCalendar.prototype.prevYear=function(){if(this.calendar)this.calendar.prevYear();};HTMLCalendar.prototype.sendRequest=function(type,req,params,cbSuccess,cbError){var xhr=new XMLHttpRequest();xhr.open("POST","componentData.do?action=componentData&sys="+URLEncode(this.sys,'GET')+"&formID="+URLEncode(this.formID,'GET')+"&comID="+URLEncode(this.code,'GET')+"&type="+type+
(req?"&req="+URLEncode(req,'GET'):""),true);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.onload=function(e){if(xhr.readyState===4||xhr.status===200){if(cbSuccess)cbSuccess(xhr.responseText);}};xhr.onerror=function(e){if(cbError)cbError(e);interactionError(safeGetLocaleMessage("ERROR.CONNECTION_FAIL"));};var data=null;if(params){data="";var keys=Object.keys(params);for(var i=0;i<keys.length;i++){data+=keys[i]+"="+URLEncode(params[keys[i]]);if(i<keys.length)data+="&";}}
xhr.send(data);};function HTMLChat(sys,formID,code,posX,posY,width,height,description,value,showValue){this.create(sys,formID,code,posX,posY,width,height,description,value);this.cachedContainers=[];this.connectionError=false;this.activeScreen=0;this.mobile=isMobile();if(mainform&&mainform.DATE_PATTERN){this.dateTimeFormat=mainform.DATE_PATTERN.toUpperCase()+" "+mainform.TIME_PATTERN;this.dateFormat=mainform.DATE_PATTERN.toUpperCase();this.timeFormat=mainform.TIME_PATTERN.replace(":ss","");}else{this.dateTimeFormat=utcDateFormat+" "+utcTimeFormat;this.dateFormat=utcDateFormat;this.timeFormat=utcTimeFormat.replace(":ss","");}
$.ajaxSetup({xhrFields:{withCredentials:true}});}
HTMLChat.inherits(HTMLGroupBox);HTMLChat.prototype.name='HTMLChat';HTMLChat.prototype.tabable=true;HTMLChat.prototype.utcDateFormat='YYYY-MM-DD';HTMLChat.prototype.utcTimeFormat='HH:mm:ss';HTMLChat.prototype.imageMimeType="image/png";HTMLChat.prototype.imageFileExtension=".png";HTMLChat.prototype.audioMimeType="audio/webm";HTMLChat.prototype.audioFileExtension=".webm";HTMLChat.prototype.protocol=getAbsolutContextPath().startsWith("https://")?"wss://":"ws://";HTMLChat.prototype.dragItemActionInterval=250;HTMLChat.prototype.setEnabled=function(v){this.callMethod(HTMLElementBase,"setEnabled",[v]);if((!this.enabled||this.readonly)&&this.selectedImage!=null)this.unselectImage();this.updateLayout();};HTMLChat.prototype.setVisible=function(v){this.callMethod(HTMLElementBase,"setVisible",[v]);this.updateLayout();};HTMLChat.prototype.setReadOnly=function(v){this.callMethod(HTMLElementBase,"setReadOnly",[v]);if((!this.enabled||this.readonly)&&this.selectedImage!=null)this.unselectImage();this.updateLayout();};HTMLChat.prototype.designComponent=function(doc){this.divClass=this.div.className;this.photoSize=(this.TamanhoDasFotos&&this.TamanhoDasFotos.length&&this.TamanhoDasFotos.length>0)?parseInt(this.TamanhoDasFotos):48;if(this.ConfirmacaoLeitura&&this.ConfirmacaoLeitura.length){this.showReadConfirmation=(this.ConfirmacaoLeitura.toLowerCase()=="true");this.ConfirmacaoLeitura=null;}else this.showReadConfirmation=true;if(this.ExibirEstados&&this.ExibirEstados.length){this.showUserStates=(this.ExibirEstados.toLowerCase()=="true");this.ExibirEstados=null;}else this.showUserStates=true;if(this.ExibirVistoPorUltimo&&this.ExibirVistoPorUltimo.length){this.showLastSeen=(this.ExibirVistoPorUltimo.toLowerCase()=="true");this.ExibirVistoPorUltimo=null;}else this.showLastSeen=true;if(this.ExibirPesquisa&&this.ExibirPesquisa.length){this.showSearch=(this.ExibirPesquisa.toLowerCase()=="true");this.ExibirPesquisa=null;}else this.showSearch=true;if(this.ExibirNotificacoesAreaDeTrabalho&&this.ExibirNotificacoesAreaDeTrabalho.length){this.showDesktopNotifications=(this.ExibirNotificacoesAreaDeTrabalho.toLowerCase()=="true");this.ExibirNotificacoesAreaDeTrabalho=null;}else this.showDesktopNotifications=true;this.showSendToEveryone=(this.EnviarTodos&&this.EnviarTodos.length&&this.EnviarTodos.toLowerCase()=="true");this.fullscreen=(this.TelaCheia&&this.TelaCheia.length&&this.TelaCheia.toLowerCase()=="true");this.allowExport=(this.PermitirExportacao&&this.PermitirExportacao.length&&this.PermitirExportacao.toLowerCase()=="true");this.allowSendMedia=(this.PermitirEnvioDeMidias&&this.PermitirEnvioDeMidias.length&&this.PermitirEnvioDeMidias.toLowerCase()=="true");this.allowCreateGroups=(this.PermitirCriacaoDeGrupos&&this.PermitirCriacaoDeGrupos.length&&this.PermitirCriacaoDeGrupos.toLowerCase()=="true");this.EnviarTodos=null;this.TelaCheia=null;this.PermitirExportacao=null;this.PermitirEnvioDeMidias=null;this.PermitirCriacaoDeGrupos=null;if(this.ExpandirFotoAoClicar&&this.ExpandirFotoAoClicar.length){this.expandOnClick=(this.ExpandirFotoAoClicar.toLowerCase()=="true");this.ExpandirFotoAoClicar=null;}else this.expandOnClick=true;if(this.ModoDeVisualizacao==="1"||this.ModoDeVisualizacao===1){this.viewMode=1;}else if(this.ModoDeVisualizacao==="2"||this.ModoDeVisualizacao===2){this.viewMode=2;}else if(this.ModoDeVisualizacao==="3"||this.ModoDeVisualizacao===3){this.viewMode=3;}else this.viewMode=1;this.ModoDeVisualizacao=null;if(this.QuantMensagensCarregadas&&this.QuantMensagensCarregadas.length){this.loadedMessagesAmount=parseInt(this.QuantMensagensCarregadas);this.QuantMensagensCarregadas=null;}else this.loadedMessagesAmount=15;webrun.include("assets/moment.min.js");var definedLocale=resources_locale.toLowerCase();if(definedLocale=='en_us')this.locale='en';else if(definedLocale=='pt_br')this.locale='pt-br';else if(definedLocale=='es_es')this.locale='es';else if(definedLocale=='fr_fr')this.locale='fr';else this.locale='en';moment.locale(this.locale);if(!document.getElementById("fancybox-css")){var head=document.getElementsByTagName('head')[0];var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='assets/jquery.fancybox.min.css';link.id='fancybox-css';head.appendChild(link);}
webrun.include("assets/jquery.fancybox.min.js");if(this.allowExport){if(!document.getElementById("datetimepicker-css")){var head=document.getElementsByTagName('head')[0];var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='assets/bootstrap-datetimepicker.min.css';link.id='datetimepicker-css';head.appendChild(link);}
webrun.include("assets/bootstrap-datetimepicker.min.js");}
var object=this;if(this.fullscreen){this.divClass="chat-layout chat-layout-fullscreen position-relative d-flex w-100 h-100 mb-0";this.div.className=this.divClass;this.div.style.left=null;this.div.style.top=null;}else{this.divClass+=" chat-layout card overflow-hidden d-flex";this.div.className=this.divClass;}
this.contentDiv=document.createElement("div");this.contentDivClass="chat-layout-content row no-gutters w-100 mh-100 flex-fill m-0";this.contentDiv.className=this.contentDivClass;this.contentDivClass=this.contentDiv.className;this.div.appendChild(this.contentDiv);this.leftColumn=document.createElement("div");this.leftColumnClass="chat-layout-left-col col-sm-5 col-md-4 col-lg-3 p-0 d-flex flex-column h-100 border-right";this.leftColumn.className=this.leftColumnClass;this.contentDiv.appendChild(this.leftColumn);this.leftNavbar=document.createElement("nav");this.leftNavbar.className="chat-layout-left-nav navbar navbar-light bg-white mb-0 flex-nowrap";if(!this.showSearch)this.leftNavbar.className+=" border-bottom";this.leftColumn.appendChild(this.leftNavbar);var userDiv=document.createElement("div");userDiv.className="d-flex flex-row align-items-center mr-auto text-truncate";this.leftNavbar.appendChild(userDiv);if(this.ImagemSemFoto&&this.ImagemSemFoto.length>0){this.userPicture=document.createElement("img");this.userPicture.className="rounded-circle bg-light";this.userPicture.width=this.photoSize;this.userPicture.height=this.photoSize;this.userPicture.style.minWidth=this.photoSize+"px";this.userPicture.setAttribute("alt","");if(this.expandOnClick){this.userPictureLink=document.createElement("a");this.userPictureLink.href="#";this.userPictureLink.appendChild(this.userPicture);userDiv.appendChild(this.userPictureLink);try{$(this.userPictureLink).fancybox({closeExisting:true,keyboard:true,arrows:true,protect:true});}catch(e){}}else{userDiv.appendChild(this.userPicture);}}else{this.userPicture=document.createElement("div");this.userPicture.className="rounded-circle bg-light border d-flex align-items-center justify-content-center";this.userPicture.style.width=this.photoSize+"px";this.userPicture.style.minWidth=this.photoSize+"px";this.userPicture.style.height=this.photoSize+"px";userDiv.appendChild(this.userPicture);var userPictureIcon=document.createElement("i");userPictureIcon.className="fas fa-user text-dark";userPictureIcon.style.opacity="0.5";userPictureIcon.style.fontSize="1.25rem";this.userPicture.appendChild(userPictureIcon);}
this.userName=document.createElement("h6");this.userName.className="text-center mb-0 ml-3 text-truncate";userDiv.appendChild(this.userName);var leftDropdownArea=document.createElement("div");leftDropdownArea.className="dropdown";this.leftNavbar.appendChild(leftDropdownArea);this.leftOptionsButton=document.createElement("button");this.leftOptionsButton.type="button";this.leftOptionsButton.id="chat-options-left-"+this.code;this.leftOptionsButton.className="btn btn-link text-muted";this.leftOptionsButton.setAttribute("data-toggle","dropdown");this.leftOptionsButton.setAttribute("aria-haspopup","true");this.leftOptionsButton.setAttribute("aria-expanded","false");leftDropdownArea.appendChild(this.leftOptionsButton);var leftOptionsButtonIcon=document.createElement("span");leftOptionsButtonIcon.className="fas fa-ellipsis-v";this.leftOptionsButton.appendChild(leftOptionsButtonIcon);this.leftDropdownMenu=document.createElement("div");this.leftDropdownMenu.className="dropdown-menu dropdown-menu-right mt-2";this.leftDropdownMenu.style.zIndex="20000000";this.leftDropdownMenu.setAttribute("aria-labelledby",this.leftOptionsButton.id);leftDropdownArea.appendChild(this.leftDropdownMenu);var refreshChat=document.createElement("a");refreshChat.href="#";refreshChat.className="dropdown-item d-flex align-items-center";this.leftDropdownMenu.appendChild(refreshChat);var refreshChatIcon=document.createElement("span");refreshChatIcon.className="fas fa-sync-alt mr-3";refreshChat.appendChild(refreshChatIcon);var refreshChatText=document.createElement("span");refreshChatText.innerText=getLocaleMessage("LABEL.REFRESH");refreshChat.appendChild(refreshChatText);this.attachEvent(refreshChat,"click",function(){object.updateData();});if(this.allowCreateGroups){var createGroup=document.createElement("a");createGroup.href="#";createGroup.className="dropdown-item d-flex align-items-center";this.leftDropdownMenu.appendChild(createGroup);var createGroupIcon=document.createElement("span");createGroupIcon.className="fas fa-user-plus mr-3";createGroup.appendChild(createGroupIcon);var createGroupText=document.createElement("span");createGroupText.innerText=getLocaleMessage("LABEL.CHAT_CREATE_GROUP");createGroup.appendChild(createGroupText);this.attachEvent(createGroup,"click",function(){object.openGroupModal();});}
this.chatMessageDiv=document.createElement("div");this.chatMessageDivClass="chat-layout-alert d-flex flex-row align-items-center w-100 bg-light py-3";if(!this.showSearch)this.chatMessageDivClass+=" border-bottom";else this.chatMessageDivClass+=" border-top";this.chatMessageDiv.className="d-none";this.leftColumn.appendChild(this.chatMessageDiv);var chatMessageIconBase=document.createElement("div");chatMessageIconBase.className="px-3 h-100";this.chatMessageDiv.appendChild(chatMessageIconBase);this.chatMessageIcon=document.createElement("i");this.chatMessageIcon.className="fas fa-exclamation-triangle";this.chatMessageIcon.style.fontSize="1.5rem";chatMessageIconBase.appendChild(this.chatMessageIcon);var chatMessageContainer=document.createElement("div");chatMessageContainer.className="w-100 h-auto";this.chatMessageDiv.appendChild(chatMessageContainer);this.chatMessageTitle=document.createElement("h6");this.chatMessageTitle.className="w-100 mt-0 mb-0";this.chatMessageTitle.style.fontWeight="600";chatMessageContainer.appendChild(this.chatMessageTitle);this.chatMessageContent=document.createElement("p");this.chatMessageContent.className="w-100 mt-0 mb-0";chatMessageContainer.appendChild(this.chatMessageContent);this.hideChatMessage();this.listScrollDiv=document.createElement("div");this.listScrollDiv.className=(this.fullscreen?"h-auto":"flex-fill")+" overflow-auto";this.leftColumn.appendChild(this.listScrollDiv);this.usersListClass="list-group list-group-flush h-auto flex-fill overflow-auto";if(this.showSendToEveryone){var topList=document.createElement("ul");topList.className=this.usersListClass;this.listScrollDiv.appendChild(topList);this.sendToEveryoneButton=document.createElement("button");this.sendToEveryoneButton.type="button";this.sendToEveryoneButton.className="chat-container-everyone-item list-group-item list-group-item-action d-flex flex-row align-items-center h-auto";this.sendToEveryoneButton.style.outline="0";topList.appendChild(this.sendToEveryoneButton);var sendToEveryoneButtonText=document.createElement("h6");sendToEveryoneButtonText.className="mb-0 w-100 text-center";sendToEveryoneButtonText.innerText=getLocaleMessage("LABEL.CHAT_SEND_TO_EVERYONE");this.sendToEveryoneButton.appendChild(sendToEveryoneButtonText);this.attachEvent(this.sendToEveryoneButton,'click',this.sendMessageToEveryoneAction);}
if(this.showSearch){this.searchDiv=document.createElement("div");this.searchDiv.className="chat-search d-flex flex-row w-100 bg-light border-top border-bottom overflow-hidden";this.searchDiv.style.flex="0 0 auto";if(this.showSendToEveryone)this.searchDiv.className+=" border-bottom";this.leftColumn.insertBefore(this.searchDiv,this.listScrollDiv);var searchIconBase=document.createElement("div");searchIconBase.className="px-3 py-2";this.searchDiv.appendChild(searchIconBase);var lineHeight="1.5";try{var bodyLineHeight=window.getComputedStyle(document.body).lineHeight;if(bodyLineHeight!==null&&bodyLineHeight.length>0){lineHeight=bodyLineHeight;}}catch(e){}
var searchIcon=document.createElement("i");searchIcon.className="fas fa-search text-muted";searchIcon.style.lineHeight=lineHeight;searchIconBase.appendChild(searchIcon);this.searchInput=document.createElement("input");this.searchInput.type="text";this.searchInput.className="form-control-plaintext w-100";this.searchInput.placeholder=getLocaleMessage("LABEL.CHAT_SEARCH")+"...";this.searchInput.style.outline="0";this.searchDiv.appendChild(this.searchInput);this.attachEvent(this.searchInput,'input',function(){object.searchAction(object.searchInput,object.usersList,object.searchResults,object.usersListClass,null);});this.searchInput.addEventListener('keydown',function(event){if(event.keyCode===13||event.which===13||event.key==='Enter'){event.preventDefault();event.stopPropagation();return false;}
return true;},true);this.searchResults=document.createElement("ul");this.searchResults.className="d-none";this.listScrollDiv.appendChild(this.searchResults);}
this.usersList=document.createElement("ul");this.usersList.className=this.usersListClass;this.listScrollDiv.appendChild(this.usersList);this.rightColumn=document.createElement("div");this.rightColumn.className="d-none";this.rightColumnClass="chat-layout-right-col col-sm-7 col-md-8 col-lg-9 p-0 d-flex flex-column h-100 border-0";this.contentDiv.appendChild(this.rightColumn);this.rightNavbar=document.createElement("nav");this.rightNavbar.className="chat-layout-right-nav navbar navbar-light bg-white border-bottom mb-0 flex-nowrap";this.rightColumn.appendChild(this.rightNavbar);this.backButton=document.createElement("i");this.backButtonClass="generic-btn fas fa-arrow-left mr-3";this.backButton.className="d-none";this.rightNavbar.appendChild(this.backButton);this.attachEvent(this.backButton,'click',this.backScreenAction);this.activeConvUserDiv=document.createElement("div");this.activeConvUserDiv.className="d-flex flex-row flex-fill align-items-center mr-auto text-truncate";this.rightNavbar.appendChild(this.activeConvUserDiv);this.activeConvUserPicture=document.createElement("img");this.activeConvUserPicture.className="rounded-circle";this.activeConvUserPicture.width=this.photoSize;this.activeConvUserPicture.height=this.photoSize;this.activeConvUserPicture.style.minWidth=this.photoSize+"px";this.activeConvUserPicture.src="";if(this.expandOnClick){this.activeConvUserPictureLink=document.createElement("a");this.activeConvUserPictureLink.href=this.activeConvUserPicture.src;this.activeConvUserDiv.appendChild(this.activeConvUserPictureLink);this.activeConvUserPictureLink.appendChild(this.activeConvUserPicture);try{$(this.activeConvUserPictureLink).fancybox({closeExisting:true,keyboard:true,arrows:true,protect:true});}catch(e){}}else{this.activeConvUserDiv.appendChild(this.activeConvUserPicture);}
if((!this.ImagemGrupoSemFoto||this.ImagemGrupoSemFoto.length==0)||(!this.ImagemSemFoto||this.ImagemSemFoto.length==0)){this.activeConvUserPictureDefault=document.createElement("div");this.activeConvUserPictureDefault.className="d-none";this.activeConvUserPictureDefaultClass="rounded-circle bg-light border d-flex align-items-center justify-content-center";this.activeConvUserPictureDefault.style.width=this.photoSize+"px";this.activeConvUserPictureDefault.style.height=this.photoSize+"px";this.activeConvUserPictureDefault.style.minWidth=this.photoSize+"px";this.activeConvUserDiv.appendChild(this.activeConvUserPictureDefault);this.activeConvUserPictureIcon=document.createElement("i");this.activeConvUserPictureIcon.className="fas fa-user text-dark";this.activeConvUserPictureIcon.style.opacity="0.5";this.activeConvUserPictureIcon.style.fontSize="1.25rem";this.activeConvUserPictureDefault.appendChild(this.activeConvUserPictureIcon);}
this.activeConvUserWrapper=document.createElement("div");this.activeConvUserWrapper.className="d-flex flex-fill flex-column justify-content-center ml-3 overflow-hidden";this.activeConvUserWrapper.style.cursor="pointer";this.activeConvUserDiv.appendChild(this.activeConvUserWrapper);this.activeConvUserWrapper.addEventListener("click",function(){if(object.activeContainer)object.activeContainer.toggleDetails();});this.activeConvUserName=document.createElement("h6");this.activeConvUserName.className="mb-0 text-truncate";this.activeConvUserWrapper.appendChild(this.activeConvUserName);this.activeConvUserState=document.createElement("p");this.activeConvUserState.className="text-muted text-truncate mb-0";this.activeConvUserWrapper.appendChild(this.activeConvUserState);this.activeDetailsDiv=document.createElement("div");this.activeDetailsDiv.className="chat-layout-view-details position-relative bg-light w-100 h-100 overflow-auto";this.activeDetailsDiv.style.setProperty("display","none","important");this.rightColumn.appendChild(this.activeDetailsDiv);this.activeConvDiv=document.createElement("div");this.activeConvDiv.className="chat-layout-view-container position-relative bg-light w-100 h-100 p-3 overflow-auto flex-fill";this.rightColumn.appendChild(this.activeConvDiv);this.activeConvBottomDiv=document.createElement("div");this.activeConvBottomDiv.className="d-flex align-items-end bg-white w-100 px-3 py-2 border-top";this.rightColumn.appendChild(this.activeConvBottomDiv);this.inputGroup=document.createElement("div");this.inputGroup.className="chat-message-input input-group";this.activeConvBottomDiv.appendChild(this.inputGroup);this.input=document.createElement("textarea");this.input.className="form-control";this.input.style.minHeight="2.5rem";this.input.style.height="2.5rem";this.input.style.outline="0";this.input.style.resize="none";this.inputGroup.appendChild(this.input);this.attachEvent(this.input,'input',this.updateInputLayout);this.attachEvent(this.input,'change',this.updateInputLayout);this.input.addEventListener("keydown",function(e){if(object.authError===true)return false;if(e.keyCode===13||e.which===13||e.key==='Enter'){e.preventDefault();e.stopImmediatePropagation();if(e.shiftKey)object.input.value+="\n";else object.sendButton.click();}});if(this.allowSendMedia){this.mediaForm=document.createElement("form");this.mediaForm.className="d-none";this.mediaForm.method="post";this.mediaForm.action="";this.div.appendChild(this.mediaForm);this.createMediaFileInput=function(acceptTypes){if(object.mediaFilesInput){object.mediaForm.removeChild(object.mediaFilesInput);}
object.mediaFilesInput=document.createElement("input");object.mediaFilesInput.type="file";object.mediaFilesInput.name="files"+object.code;object.mediaFilesInput.id="chat-files-"+object.code;object.mediaFilesInput.multiple=true;if(acceptTypes)object.mediaFilesInput.accept=acceptTypes;object.mediaForm.appendChild(object.mediaFilesInput);object.mediaFilesInput.addEventListener("change",function(){if(object.activeContainer)object.activeContainer.enqueueFiles(object.mediaFilesInput.files);});return object.mediaFilesInput;};if(this.isRecordingSupported()){this.recordAudioButton=document.createElement("button");this.recordAudioButton.type="button";this.recordAudioButton.className="chat-nav-button chat-nav-button-record btn btn-light rounded ml-3 d-flex align-items-center justify-content-center";this.activeConvBottomDiv.appendChild(this.recordAudioButton);var recordAudioButtonIcon=document.createElement("span");recordAudioButtonIcon.className="fas fa-microphone my-1";this.recordAudioButton.appendChild(recordAudioButtonIcon);this.attachEvent(this.recordAudioButton,'click',this.recordAudioAction);}
var mediaButtonDropdownDiv=document.createElement("div");mediaButtonDropdownDiv.className="btn-group dropup";this.activeConvBottomDiv.appendChild(mediaButtonDropdownDiv);this.mediaButton=document.createElement("button");this.mediaButton.type="button";this.mediaButton.id="chat-media-"+this.code;this.mediaButton.className="chat-nav-button chat-nav-button-media btn btn-light rounded ml-3 d-flex align-items-center justify-content-center";this.mediaButton.setAttribute("data-toggle","dropdown");this.mediaButton.setAttribute("aria-haspopup","true");this.mediaButton.setAttribute("aria-expanded","false");mediaButtonDropdownDiv.appendChild(this.mediaButton);var mediaButtonIcon=document.createElement("span");mediaButtonIcon.className="fas fa-paperclip my-1";this.mediaButton.appendChild(mediaButtonIcon);var mediaDropdownDiv=document.createElement("div");mediaDropdownDiv.className="dropdown-menu dropdown-menu-right p-0";mediaDropdownDiv.style.minWidth="15rem";mediaDropdownDiv.style.zIndex="10000000";mediaDropdownDiv.setAttribute("aria-labelledby",this.mediaButton.id);mediaButtonDropdownDiv.appendChild(mediaDropdownDiv);var mediaDropdownWrapperDiv=document.createElement("div");mediaDropdownWrapperDiv.className="row no-gutters";mediaDropdownDiv.appendChild(mediaDropdownWrapperDiv);var designMediaButton=function(icon,text,action){var mediaButtonCol=document.createElement("div");mediaButtonCol.className="col-4";mediaDropdownWrapperDiv.appendChild(mediaButtonCol);var sendMediaButton=document.createElement("a");sendMediaButton.href="#";sendMediaButton.className="dropdown-item w-auto d-flex flex-column align-items-center justify-content-center p-3";mediaButtonCol.appendChild(sendMediaButton);var sendMediaButtonIcon=document.createElement("i");sendMediaButtonIcon.className=icon+" mb-2";sendMediaButtonIcon.style.fontSize="2rem";sendMediaButton.appendChild(sendMediaButtonIcon);var sendMediaButtonText=document.createElement("span");sendMediaButtonText.innerText=text;sendMediaButton.appendChild(sendMediaButtonText);if(action)sendMediaButton.addEventListener("click",action);return sendMediaButton;}
designMediaButton("fas fa-file",getLocaleMessage("LABEL.FILE"),function(){var fileInput=object.createMediaFileInput("*");fileInput.click();});designMediaButton("fas fa-image",getLocaleMessage("LABEL.IMAGE"),function(){var fileInput=object.createMediaFileInput("image/*");fileInput.click();});var webcamElement=designMediaButton("fas fa-camera",getLocaleMessage("LABEL.CAMERA"),function(){object.takePhotoAction();});this.isWebcamSupported().then(function(result){if(result===false)webcamElement.className+=" disabled";});designMediaButton("fas fa-film",getLocaleMessage("LABEL.VIDEO"),function(){var fileInput=object.createMediaFileInput("video/*");fileInput.click();});designMediaButton("fas fa-volume-up",getLocaleMessage("LABEL.AUDIO"),function(){var fileInput=object.createMediaFileInput("audio/*");fileInput.click();});}
this.sendButton=document.createElement("button");this.sendButton.type="button";this.sendButton.disabled=true;this.sendButton.className="chat-nav-button chat-nav-button-send btn btn-light rounded ml-3 d-flex align-items-center justify-content-center";this.sendButton.title=getLocaleMessage("LABEL.SEND");this.sendButton.setAttribute("data-toggle","tooltip");this.activeConvBottomDiv.appendChild(this.sendButton);var sendButtonIcon=document.createElement("span");sendButtonIcon.className="fas fa-paper-plane my-1";this.sendButton.appendChild(sendButtonIcon);this.attachEvent(this.sendButton,"click",this.sendMessageAction);if(this.allowExport||this.allowCreateGroups){this.rightDropdownArea=document.createElement("div");this.rightDropdownArea.className="dropdown";this.rightNavbar.appendChild(this.rightDropdownArea);this.rightOptionsButton=document.createElement("button");this.rightOptionsButton.type="button";this.rightOptionsButton.id="chat-options-"+this.code;this.rightOptionsButton.className="btn btn-link text-muted";this.rightOptionsButton.setAttribute("data-toggle","dropdown");this.rightOptionsButton.setAttribute("aria-haspopup","true");this.rightOptionsButton.setAttribute("aria-expanded","false");this.rightDropdownArea.appendChild(this.rightOptionsButton);var rightOptionsButtonIcon=document.createElement("span");rightOptionsButtonIcon.className="fas fa-ellipsis-v";this.rightOptionsButton.appendChild(rightOptionsButtonIcon);this.rightDropdownMenu=document.createElement("div");this.rightDropdownMenu.className="dropdown-menu dropdown-menu-right mt-2";this.rightDropdownMenu.style.zIndex="20000000";this.rightDropdownMenu.setAttribute("aria-labelledby",this.rightOptionsButton.id);this.rightDropdownArea.appendChild(this.rightDropdownMenu);if(this.allowCreateGroups){this.editGroupButton=document.createElement("a");this.editGroupButton.href="#";this.editGroupButton.className="dropdown-item d-flex align-items-center";this.editGroupButton.style.setProperty("display","none","important");this.rightDropdownMenu.appendChild(this.editGroupButton);var editGroupButtonIcon=document.createElement("span");editGroupButtonIcon.className="fas fa-pencil-alt mr-3";this.editGroupButton.appendChild(editGroupButtonIcon);var editGroupButtonText=document.createElement("span");editGroupButtonText.innerText=getLocaleMessage("LABEL.CHAT_EDIT_GROUP");this.editGroupButton.appendChild(editGroupButtonText);this.attachEvent(this.editGroupButton,"click",function(){if(object.activeContainer&&object.activeContainer.isGroup()){object.openGroupModal(object.activeContainer.data,0);}});this.deleteGroupButton=document.createElement("a");this.deleteGroupButton.href="#";this.deleteGroupButton.className="dropdown-item d-flex align-items-center";this.deleteGroupButton.style.setProperty("display","none","important");this.rightDropdownMenu.appendChild(this.deleteGroupButton);var deleteGroupButtonIcon=document.createElement("span");deleteGroupButtonIcon.className="fas fa-trash-alt mr-3";this.deleteGroupButton.appendChild(deleteGroupButtonIcon);var deleteGroupButtonText=document.createElement("span");deleteGroupButtonText.innerText=getLocaleMessage("LABEL.CHAT_DELETE_GROUP");this.deleteGroupButton.appendChild(deleteGroupButtonText);if(this.hasGroupsForm()){this.deleteGroupButton.className+=" disabled";}else{this.attachEvent(this.deleteGroupButton,"click",function(){if(object.activeContainer&&object.activeContainer.isGroup()){object.activeContainer.groupDelete();}});}
if(this.allowExport){this.groupDropdownDivider=document.createElement("div");this.groupDropdownDivider.className="dropdown-divider";this.groupDropdownDivider.style.display="none";this.rightDropdownMenu.appendChild(this.groupDropdownDivider);}}
if(this.allowExport){var exportConversation=document.createElement("a");exportConversation.href="#";exportConversation.className="dropdown-item d-flex align-items-center"+(!this.canExport?" disabled":"");this.rightDropdownMenu.appendChild(exportConversation);var exportConversationIcon=document.createElement("span");exportConversationIcon.className="fas fa-comments mr-3";exportConversation.appendChild(exportConversationIcon);var exportConversationText=document.createElement("span");exportConversationText.innerText=getLocaleMessage("LABEL.CHAT_EXPORT_CONVERSATION");exportConversation.appendChild(exportConversationText);this.attachEvent(exportConversation,"click",this.openExportModal);}}
this.preloader=document.createElement("div");this.preloader.className="d-none";this.preloaderClass="spinner-border text-primary";this.preloader.setAttribute("role","status");this.div.appendChild(this.preloader);var preloaderSpan=document.createElement("span");preloaderSpan.className="sr-only";preloaderSpan.innerText=getLocaleMessage("LABEL.LOADING")+"...";this.preloader.appendChild(preloaderSpan);var docHiddenProp,visibilityChange;if(typeof document.hidden!=="undefined"){docHiddenProp="hidden";visibilityChange="visibilitychange";}else if(typeof document.msHidden!=="undefined"){docHiddenProp="msHidden";visibilityChange="msvisibilitychange";}else if(typeof document.webkitHidden!=="undefined"){docHiddenProp="webkitHidden";visibilityChange="webkitvisibilitychange";}
this.pageVisible=true;try{if(visibilityChange){document.addEventListener(visibilityChange,function(){if(object){object.pageVisible=!document[docHiddenProp];if(object.shouldSendReadConfirmations()){object.sendAllPendingReadConfirmations();}}},false);}
window.addEventListener('pageshow',function(){if(object){object.pageVisible=!document[docHiddenProp];if(object.shouldSendReadConfirmations()){object.sendAllPendingReadConfirmations();}}},false);window.addEventListener('pagehide',function(){if(object){object.pageVisible=false;if(object.shouldSendReadConfirmations()){object.sendAllPendingReadConfirmations();}}},false);}catch(e){}
window.addEventListener("resize",function(){if(object.authError===true)return false;if(object)object.updateLayout();});this.div.addEventListener("dragover",function(e){e.preventDefault();});this.div.addEventListener("drop",function(e){e.preventDefault();if(object.activeContainer!=null&&object.activeContainer.active){var files=[];if(e.dataTransfer.items){for(var i=0;i<e.dataTransfer.items.length;i++){if(e.dataTransfer.items[i].kind==='file'){files.push(e.dataTransfer.items[i].getAsFile());}}}else{for(var i=0;i<e.dataTransfer.files.length;i++){files.push(e.dataTransfer.files[i]);}}
if(files.length>0){object.activeContainer.enqueueFiles(files);}}});this.updateLayout();this.showPreloader();};HTMLChat.prototype.afterInit=function(){this.callMethod(HTMLElementBase,"afterInit",[]);var object=this;if((this.EstiloCss&&this.EstiloCss.length>0)&&((this.viewMode==1&&!isMobile())||(this.viewMode===2))){if(this.styleElem){this.styleElem.innerHTML=this.EstiloCss;}else{this.styleElem=document.createElement("style");this.styleElem.innerHTML=this.EstiloCss;document.body.appendChild(this.styleElem);}}else if((this.EstiloMobileCss&&this.EstiloMobileCss.length>0)&&((this.viewMode==1&&isMobile())||(this.viewMode===3))){if(this.styleElem){this.styleElem.innerHTML=this.EstiloMobileCss;}else{this.styleElem=document.createElement("style");this.styleElem.innerHTML=this.EstiloMobileCss;document.body.appendChild(this.styleElem);}}
if(this.tab){this.tab.addShownListener(function(tabPane){object.updateLayout();});}};HTMLChat.prototype.onFormLoadAction=function(){try{if(d&&d.n&&d.n.div){var navbarCollapse=d.n.div.getElementsByClassName("navbar-collapse");if(navbarCollapse&&navbarCollapse.length>0){var object=this;var updateLayoutCallback=function(){try{if(object)object.updateLayout();}catch(e){}};$(navbarCollapse).on("show.bs.collapse",updateLayoutCallback);$(navbarCollapse).on("shown.bs.collapse",updateLayoutCallback);$(navbarCollapse).on("hide.bs.collapse",updateLayoutCallback);$(navbarCollapse).on("hidden.bs.collapse",updateLayoutCallback);}}}catch(e){}
this.updateData();this.updateLayout();};HTMLChat.prototype.getRequestURL=function(){var params="";if(d.t&&d.t.dependences){var components=d.t.dependences[this.code];if(components&&components.length>0){for(var code in components){if(isNumeric(code)){var component=eval("$mainform().d.c_"+components[code]);if(component){params+=("&WFRInput"+component.getCode()+"="+URLEncode(component.getValue(),"GET"));}}}}}
return"componentData.do?action=componentData&sys="+URLEncode(this.sys,'GET')+"&formID="+URLEncode(this.formID,'GET')+"&comID="+URLEncode(this.code,'GET')+params;};HTMLChat.prototype.getFileUploadURL=function(){return"UploadFile.do?action=UploadFile&sys="+URLEncode(this.sys,"GET")+"&formID="+URLEncode(this.formID,"GET")+"&comID="+URLEncode(this.code,"GET");};HTMLChat.prototype.updateData=function(silent){var object=this;var previousActiveContainerId=this.activeContainer&&this.activeContainer.data?this.activeContainer.data.id:null;var previousActiveContainerType=this.activeContainer&&this.activeContainer.data?this.activeContainer.data.type:null;if(!silent){if(this.activeContainer){this.activeContainer.setActive(false);this.activeContainer=null;this.updateLayout();}
this.showPreloader();}
this.hideChatMessage();var baseURL=this.getRequestURL();$.get(baseURL+"&type=l",function(response){if(response){if(response===undefined||response===null||(typeof response==='string'&&response.length==0)||(typeof response==='object'&&!response.success)){object.hidePreloader();if(!silent){object.clearCachedContainers();if(response&&response.status===-59207){object.designAuthError();}else{object.designUnknownError();}
if(response&&response.details&&response.details.length>0){new HTMLMessage().showErrorMessage(getLocaleMessage("ERROR.OPERATION_ERROR"),null,null,response.details);}}}else{object.clearCachedContainers();object.saveHistory=response.saveHistory;if(response.containers&&response.containers.length&&response.containers.length>0){try{response.containers=response.containers.sort(function(a,b){var aHasMessageTime=(a.lastMessage&&a.lastMessage.time);var bHasMessageTime=(b.lastMessage&&b.lastMessage.time);if(!aHasMessageTime&&!bHasMessageTime)return 0;else if(aHasMessageTime&&!bHasMessageTime)return-1;else if(!aHasMessageTime&&bHasMessageTime)return 1;return moment(b.lastMessage.time).local().diff(moment(a.lastMessage.time).local());});}catch(e){}
for(var i=0;i<response.containers.length;i++){var container=response.containers[i];if(container.type==0&&container.id==response.userCode){object.userName.innerText=object.formatName(container.name);object.userPicture.src=(container.photo==="false")?object.getImageSourceURL(object.ImagemSemFoto):baseURL+"&type=p&req="+URLEncode(container.id,'GET')+"&reqType="+URLEncode(container.type,'GET');if(object.userPictureLink)object.userPictureLink.href=object.userPicture.src;object.user=new HTMLChatContainer(object,i,container,null,object.userPicture,object.userName,null);object.cachedContainers.push(object.user);}else{var items=object.designContainerItem(object.usersList,container,i);var containerInstance=new HTMLChatContainer(object,i,container,items[0],items[1],items[2],items[3],items[4]);if(container.lastMessage)containerInstance.setLastMessageContent(container.lastMessage);object.cachedContainers.push(containerInstance);if(container.unreadMessages)containerInstance.setTotalUnreadMessages(container.unreadMessages);}}
if(object.showSendToEveryone){object.sendToEveryoneContainer=new HTMLChatContainer(object);object.sendToEveryoneContainer.isSendToEveryone=true;object.cachedContainers.push(object.sendToEveryoneContainer);}}
if(response.endpoint&&response.endpoint.length&&response.endpoint.length>0){if(response.containers.filter(function(container){return container.type===0&&container.id===response.userCode;}).length>0)object.connect(response.endpoint);}
for(var i=0;i<object.cachedContainers.length;i++){var container=object.cachedContainers[i];if(container.data&&container.data.lastMessage){container.setLastMessageContent(container.data.lastMessage);}}
object.hidePreloader();if(silent&&previousActiveContainerId!==null&&previousActiveContainerType!==null){if(previousActiveContainerType==1){var groupContainer=object.getGroupById(previousActiveContainerId);if(groupContainer)groupContainer.setActive(true);else{object.activeContainer=null;object.updateLayout();}}else{var userContainer=object.getUserById(previousActiveContainerId);if(userContainer)userContainer.setActive(true);else{object.activeContainer=null;object.updateLayout();}}
previousActiveContainerId=null;previousActiveContainerType=null;}}}else{object.hidePreloader();}}).fail(function(){object.hidePreloader();if(!silent){object.clearCachedContainers();object.designAuthError();}});};HTMLChat.prototype.designAuthError=function(){var fullscreen=this.fullscreen;this.authError=true;this.flush();if(!this.authErrorDiv){if(fullscreen){this.divClass="chat-layout chat-layout-fullscreen position-relative w-100 vh-100";this.div.className=this.divClass;this.div.style.minHeight=null;}
this.authErrorDiv=document.createElement("div");this.authErrorDiv.className="chat-layout-error d-flex flex-column align-items-center justify-content-center w-100 h-100 text-center text-muted";this.div.appendChild(this.authErrorDiv);var authErrorIcon=document.createElement("i");authErrorIcon.className="fas fa-lock";authErrorIcon.style.fontSize="4rem";this.authErrorDiv.appendChild(authErrorIcon);var authErrorMessage=document.createElement("span");authErrorMessage.className="my-4";authErrorMessage.style.maxWidth="17rem";authErrorMessage.innerText=getLocaleMessage("INFO.CHAT_AUTHENTICATION_ERROR");this.authErrorDiv.appendChild(authErrorMessage);}};HTMLChat.prototype.designUnknownError=function(){var fullscreen=this.fullscreen;this.unknownError=true;this.flush();if(!this.unknownErrorDiv){if(fullscreen){this.divClass="chat-layout chat-layout-fullscreen position-relative w-100 vh-100";this.div.className=this.divClass;this.div.style.minHeight=null;}
this.unknownErrorDiv=document.createElement("div");this.unknownErrorDiv.className="chat-layout-error d-flex flex-column align-items-center justify-content-center w-100 h-100 text-center text-muted";this.div.appendChild(this.unknownErrorDiv);var unknownErrorIcon=document.createElement("i");unknownErrorIcon.className="fas fa-exclamation-triangle";unknownErrorIcon.style.fontSize="4rem";this.unknownErrorDiv.appendChild(unknownErrorIcon);var unknownErrorMessage=document.createElement("span");unknownErrorMessage.className="my-4";unknownErrorMessage.style.maxWidth="17rem";unknownErrorMessage.innerText=getLocaleMessage("ERROR.OPERATION_ERROR");this.unknownErrorDiv.appendChild(unknownErrorMessage);}};HTMLChat.prototype.clearCachedContainers=function(){if(this.activeContainer!=null){this.activeContainer.setActive(false);this.activeContainer=null;}
if(this.usersList)this.usersList.innerHTML="";if(this.searchInput)this.searchInput.value="";if(this.searchResults)this.searchResults.innerHTML="";if(this.input)this.input.value="";this.cachedContainers=[];};HTMLChat.prototype.designContainerItem=function(doc,container,index,query,action){var object=this;var isGroup=(container.type===1);var containerItem=document.createElement("button");containerItem.type="button";containerItem.className="chat-container-item "+(isGroup?"chat-container-item-group":"chat-container-item-user")+" list-group-item list-group-item-action d-flex flex-row align-items-center h-auto";containerItem.style.outline="0";containerItem.style.flex="0 0 auto";doc.appendChild(containerItem);if((!container.photo||container.photo==="false"||container.photo.length==0)&&((isGroup&&(!this.ImagemGrupoSemFoto||this.ImagemGrupoSemFoto.length==0))||(!isGroup&&(!this.ImagemSemFoto||this.ImagemSemFoto.length==0)))){var containerPicture=document.createElement("div");containerPicture.className="rounded-circle bg-light border d-flex align-items-center justify-content-center";containerPicture.style.width=this.photoSize+"px";containerPicture.style.height=this.photoSize+"px";containerPicture.style.flex="0 0 auto";containerItem.appendChild(containerPicture);var containerPictureIcon=document.createElement("i");containerPictureIcon.className="fas fa-"+(isGroup?"users":"user")+" text-dark";containerPictureIcon.style.opacity="0.5";containerPictureIcon.style.fontSize="1.25rem";containerPicture.appendChild(containerPictureIcon);}else{var containerPicture=document.createElement("img");containerPicture.className="rounded-circle bg-light";containerPicture.width=this.photoSize;containerPicture.height=this.photoSize;containerPicture.setAttribute("alt","");containerPicture.src=(!container.photo||container.photo==="false"||container.photo.length==0)?this.getImageSourceURL(isGroup?this.ImagemGrupoSemFoto:this.ImagemSemFoto):this.getRequestURL()+"&type=p"+"&req="+URLEncode(container.id,"GET")+"&reqType="+URLEncode(container.type,"GET");if(this.expandOnClick&&(action===undefined||action===null)){var containerPictureLink=document.createElement("a");containerPictureLink.href=containerPicture.src;containerItem.appendChild(containerPictureLink);containerPictureLink.appendChild(containerPicture);containerPictureLink.addEventListener("click",function(e){e.stopPropagation();});try{$(containerPictureLink).fancybox({closeExisting:true,keyboard:true,arrows:true,protect:true});}catch(e){}}else{containerItem.appendChild(containerPicture);}}
var itemWrapper=document.createElement("div");itemWrapper.className="d-flex flex-fill flex-column justify-content-center ml-3 overflow-hidden";containerItem.appendChild(itemWrapper);var itemNameElem=document.createElement("h6");itemNameElem.className="mb-0 text-truncate";itemNameElem.style.fontWeight="600";itemWrapper.appendChild(itemNameElem);if(query&&query.length>0){var name=(container.type==1)?container.name:this.formatName(container.name);var lowerCaseName=name.toLowerCase();var queryIndex=lowerCaseName.indexOf(query);itemNameElem.innerHTML=name.substring(0,queryIndex)+"<b>"+name.substring(queryIndex,queryIndex+query.length)+"</b>"+
name.substring(queryIndex+query.length,name.length);}else{itemNameElem.innerText=(container.type==1)?container.name:this.formatName(container.name);}
var userLastMessage=document.createElement("p");userLastMessage.className="position-relative w-100 d-flex align-items-center mb-0";itemWrapper.appendChild(userLastMessage);var userLastMessageBadge=document.createElement("span");userLastMessageBadge.className="badge bg-dark d-inline-flex align-items-center text-white my-1 mr-2";userLastMessageBadge.style.setProperty("display","none","important");userLastMessage.appendChild(userLastMessageBadge);var userLastMessageContent=document.createElement("span");userLastMessageContent.className="d-inline-block text-truncate text-muted mb-0";userLastMessage.appendChild(userLastMessageContent);if(action!==undefined&&action!==null){if(action!==false){containerItem.addEventListener("click",action);}}else{var isDragging=false;var dragTimerStarted=false;action=function(){if(!object.activeContainer||object.activeContainer.index!=index){object.openConversation(index);}
if(object.showSearch){object.searchInput.value="";object.searchAction(object.searchInput,object.usersList,object.searchResults,object.usersListClass,null);}};containerItem.addEventListener("click",action);containerItem.addEventListener("dragleave",function(){isDragging=false;});containerItem.addEventListener("dragover",function(){isDragging=true;if(!dragTimerStarted){dragTimerStarted=true;setTimeout(function(){dragTimerStarted=false;if(isDragging){if(action)action();}},object.dragItemActionInterval);}});}
return[containerItem,containerPicture,itemNameElem,userLastMessageContent,userLastMessageBadge];};HTMLChat.prototype.showPreloader=function(){if(this.contentDiv)this.contentDiv.className="d-none";if(this.preloader)this.preloader.className=this.preloaderClass;if(this.div)this.div.className=this.divClass+" d-flex align-items-center justify-content-center";};HTMLChat.prototype.hidePreloader=function(){if(this.contentDiv)this.contentDiv.className=this.contentDivClass;if(this.preloader)this.preloader.className="d-none";if(this.div)this.div.className=this.divClass;};HTMLChat.prototype.showChatMessage=function(title,message,icon){if(this.chatMessageDiv){this.chatMessageTitle.innerText=title;this.chatMessageContent.innerText=message;this.chatMessageIcon.className=(icon?icon:"fas fa-exclamation-circle")+" pt-1";this.chatMessageDiv.className=this.chatMessageDivClass;this.chatMessageDiv.onclick=null;}};HTMLChat.prototype.hideChatMessage=function(){if(this.chatMessageDiv){if(this.showDesktopNotifications&&this.supportsDesktopNotifications()&&!this.isDesktopNotificationsGranted()&&!this.isDesktopNotificationsDenied()){this.showChatMessage(getLocaleMessage("INFO.CHAT_NOTIFICATIONS_NOTICE"),getLocaleMessage("INFO.CHAT_ENABLE_NOTIFICATIONS"),"fas fa-bell");this.chatMessageDiv.className="chat-layout-alert btn btn-light rounded-0 text-left d-flex flex-row align-items-center w-100 border-top py-3";var object=this;this.chatMessageDiv.onclick=function(){Notification.requestPermission().then(function(permission){if(permission==='granted')object.hideChatMessage();});};}else{this.chatMessageDiv.className="d-none";this.chatMessageDiv.onclick=null;this.chatMessageTitle.innerHTML="";this.chatMessageContent.innerHTML="";}}};HTMLChat.prototype.openConversation=function(index){this.cachedContainers[index].setActive(true);};HTMLChat.prototype.getUserById=function(id){for(var i=0;i<this.cachedContainers.length;i++){if(this.cachedContainers[i].isUser()&&this.cachedContainers[i].data&&this.cachedContainers[i].data.id==id){return this.cachedContainers[i];}}};HTMLChat.prototype.getGroupById=function(id){for(var i=0;i<this.cachedContainers.length;i++){if(this.cachedContainers[i].isGroup()&&this.cachedContainers[i].data&&this.cachedContainers[i].data.id==id){return this.cachedContainers[i];}}};HTMLChat.prototype.connect=function(endpoint){if(this.authError===true||this.socketEndpoint===endpoint)return;this.socketEndpoint=endpoint;var object=this;var indice=location.pathname.lastIndexOf('/');var path=location.pathname.substring(0,indice+1);if(this.socket){try{this.socket.removeEventListener("open",this.onConnectedEvent);this.socket.removeEventListener("close",this.onDisconnectedEvent);this.socket.removeEventListener("message",this.onMessageReceivedEvent);this.socket.removeEventListener("error",this.onErrorThrownEvent);}catch(e){}
try{this.socket.close();}catch(e){}}
this.socket=new WebSocket(this.protocol+location.host+path+endpoint);this.onConnectedEvent=function(){object.onConnected.apply(object,arguments);};this.socket.addEventListener("open",this.onConnectedEvent);this.onDisconnectedEvent=function(){object.onDisconnected.apply(object,arguments);};this.socket.addEventListener("close",this.onDisconnectedEvent);this.onMessageReceivedEvent=function(){object.onMessageReceived.apply(object,arguments);};this.socket.addEventListener("message",this.onMessageReceivedEvent);this.onErrorThrownEvent=function(){object.onErrorThrown.apply(object,arguments);};this.socket.addEventListener("error",this.onErrorThrownEvent);};HTMLChat.prototype.onConnected=function(e){if(this.connectionError){this.hideChatMessage();this.connectionError=false;}
if(!this.aliveRoutineSet){this.aliveRoutine(this);}
if(this.AoConectar&&this.user&&this.user.data)this.AoConectar.call($mainform(),this.user.data.id);};HTMLChat.prototype.onDisconnected=function(e){this.connectionError=true;this.showChatMessage(getLocaleMessage("ERROR.CONNECTION_FAIL"),getLocaleMessage("INFO.CONNECTION_RETRY")+"...");this.updateLayout();if(this.AoDesconectar&&this.user&&this.user.data)this.AoDesconectar.call($mainform(),this.user.data.id);var endpoint=this.socketEndpoint;this.sockedEndPoint=null;this.connect(endpoint);};HTMLChat.prototype.onMessageReceived=function(e){try{if(e&&e.data&&e.data.length>0){var message=JSON.parse(e.data);if(message.type=="message"){if(message.group){var group=this.getGroupById(message.group);if(group)group.handleMessage(message);}else{var user=this.getUserById(message.from);if(user){user.handleMessage(message);if(message.time)user.setState(null,message.time);}}
if(this.AoReceberMensagem)this.AoReceberMensagem.call($mainform(),message.id,message.from,message.group?message.group:message.destination,message.group?true:false,message.message);}else if(message.type=="received"){if(message.group){var group=this.getGroupById(message.group);if(group)group.setMessageStatus(message.messageId,1);}else{var user=this.getUserById(message.destination);if(user)user.setMessageStatus(message.messageId,1);}}else if(message.type=="userreceived"){if(message.group){var group=this.getGroupById(message.group);if(group)group.setMessageStatus(message.messageId,2);}else{var user=this.getUserById(message.messageDestination);if(user){user.setMessageStatus(message.messageId,2);user.setState(1);}}}else if(message.type=="read"){if(this.showReadConfirmation){if(message.group){var group=this.getGroupById(message.group);if(group)group.setMessageStatus(message.messageId,3);}else{var user=this.getUserById(message.from);if(user)user.setMessageStatus(message.messageId,3);}}}else if(message.type=="connected"){if(this.showUserStates){var user=this.getUserById(message.from);if(user)user.setState(1);}
if(this.AoConectar)this.AoConectar.call($mainform(),message.from);}else if(message.type=="disconnected"){if(this.showUserStates){var user=this.getUserById(message.from);if(user)user.setState(2,message.lastSeen);}
if(this.AoDesconectar)this.AoDesconectar.call($mainform(),message.from);}else if(message.type=="action"){if(message.action=="update"){this.updateData(true);}}
if(message.id){this.socket.send(JSON.stringify({type:"received",id:message.id,from:message.from,destination:message.destination}));}}}catch(e){}};HTMLChat.prototype.onErrorThrown=function(e){this.connectionError=true;this.showChatMessage(getLocaleMessage("ERROR.CONNECTION_FAIL"),getLocaleMessage("INFO.CONNECTION_RETRY")+"...");this.updateLayout();var endpoint=this.socketEndpoint;this.sockedEndPoint=null;this.connect(endpoint);};HTMLChat.prototype.backScreenAction=function(){if(this.activeContainer&&this.activeContainer.isDetailsOpen){this.activeContainer.toggleDetails();}else{this.activeScreen=0;if(this.activeContainer){this.activeContainer.setActive(false);}}
this.updateLayout();};HTMLChat.prototype.sendMessageAction=function(){bootstrapCloseTooltip(this.sendButton);if(!this.activeContainer||this.input.value===undefined||this.input.value===null||this.input.value.length==0||this.input.value.trim().length==0){this.sendButton.disabled=true;return false;}
var messageContent=this.input.value.trim();this.input.value="";this.input.style.height="2.5rem";this.sendButton.disabled=true;if(this.activeContainer.isSendToEveryone){for(var i=0;i<this.cachedContainers.length;i++){var currentContainer=this.cachedContainers[i];if(currentContainer.isUser()&&!currentContainer.isSendToEveryone&&currentContainer.data&&currentContainer.data.id!=this.user.data.id){this.sendMessage(currentContainer.data.id,false,messageContent);}}
if(this.sendToEveryoneContainer){this.sendToEveryoneContainer.handleMessage({type:"message",id:this.getUniqueId()+"-g",from:this.user.data.id,destination:this.user.data.id,time:moment().utc().toISOString(),message:messageContent,everyone:true},false);this.sendToEveryoneContainer.scrollToBottom();}}else{this.sendMessage(this.activeContainer.data.id,this.activeContainer.isGroup(),messageContent);}};HTMLChat.prototype.sendMessage=function(entityId,entityIsGroup,messageContent){var entityInstance=null;var messageData={type:"message",id:this.getUniqueId(),from:this.user.data.id,time:moment().utc().toISOString(),message:messageContent};if(entityIsGroup){messageData.group=entityId;entityInstance=this.getGroupById(entityId);}else{messageData.destination=entityId;entityInstance=this.getUserById(entityId);}
if(entityInstance){entityInstance.handleMessage(messageData);if(entityInstance.active){entityInstance.scrollToBottom();}}
this.socket.send(JSON.stringify(messageData));if(this.AoEnviarMensagem)this.AoEnviarMensagem.call($mainform(),messageData.id,messageData.from,entityIsGroup?messageData.group:messageData.destination,entityIsGroup,messageContent);return messageData;};HTMLChat.prototype.sendMessageToEveryoneAction=function(){if(!this.showSendToEveryone||!this.sendToEveryoneContainer)return;this.sendToEveryoneContainer.setActive(true);if(this.showSearch){this.searchInput.value="";this.searchAction(this.searchInput,this.usersList,this.searchResults,this.usersListClass,null);}};HTMLChat.prototype.searchAction=function(searchInput,usersList,resultsList,usersListClass,listItemAction,wrapperList){var list=wrapperList?wrapperList:this.cachedContainers;var items=[];if(searchInput.value==null||searchInput.value.length==0){resultsList.className="chat-search-results d-none";resultsList.innerHTML="";usersList.className=usersListClass;}else{resultsList.className="chat-search-results "+usersListClass;resultsList.innerHTML="";usersList.className="d-none";for(var i=0;i<list.length;i++){var userContainer=list[i];if(!userContainer.isSendToEveryone&&userContainer.data&&userContainer.data.id!=this.user.data.id){var lowerCaseQuery=searchInput.value.toLowerCase().trim();var lowerCaseName=userContainer.data.name.toLowerCase().trim();if(lowerCaseName==lowerCaseQuery||lowerCaseName.indexOf(lowerCaseQuery)>=0){var containerItem=this.designContainerItem(resultsList,userContainer.data,userContainer.index,lowerCaseQuery,listItemAction);items.push({id:userContainer.data.id,element:containerItem[0]});}}}
if(items.length==0){resultsList.className="chat-search-results "+usersListClass+" border-top";var noResultsText=document.createElement("span");noResultsText.className="text-muted text-center w-100 h-auto p-4";noResultsText.innerText=getLocaleMessage("LABEL.CHAT_SEARCH_NO_RESULTS");resultsList.appendChild(noResultsText);}}
return items;};HTMLChat.prototype.getInstanceId=function(){return this.sys+"$"+this.formID+"$"+this.code;};HTMLChat.prototype.aliveRoutine=function(context){if(context.socket&&context.socket.readyState==1){context.socket.send(JSON.stringify({type:"alive",chatInstance:this.getInstanceId(),from:context.user.data.id}));}
setTimeout(function(){context.aliveRoutine(context);},5000);this.aliveRoutineSet=true;};HTMLChat.prototype.canChat=function(){return(this.enabled&&!this.connectionError&&!this.unknownError&&!this.authError);};HTMLChat.prototype.supportsDesktopNotifications=function(){return typeof Notification!=="undefined"&&typeof Notification.requestPermission==="function";};HTMLChat.prototype.isDesktopNotificationsGranted=function(){return this.supportsDesktopNotifications()&&Notification.permission==="granted";};HTMLChat.prototype.isDesktopNotificationsDenied=function(){return!this.supportsDesktopNotifications()||Notification.permission==="denied";};HTMLChat.prototype.shouldShowDesktopNotifications=function(){return(this.showDesktopNotifications&&!this.pageVisible&&this.supportsDesktopNotifications()&&this.isDesktopNotificationsGranted());};HTMLChat.prototype.showDesktopNotification=function(title,icon,image,body,time){return new Notification(title,{icon:icon,image:image,body:body,timestamp:time});};HTMLChat.prototype.updateInputLayout=function(){if(this.authError===true)return false;if(this.sendButton)this.sendButton.disabled=!this.allowEmptyMessages&&(!this.input||this.input.value===undefined||this.input.value===null||this.input.value.trim().length==0);if(this.sendButton&&!this.sendButton.disabled){if(this.rightColumn&&this.rightColumn.offsetHeight>0&&this.input){this.input.style.height=null;var targetHeight=this.input.scrollHeight;this.input.style.height=Math.min(Math.max(targetHeight,this.rightColumn.offsetHeight*0.50),0)+"px";}}else{if(this.input)this.input.style.height=this.input.style.minHeight;}};HTMLChat.prototype.updateLayout=function(){if(!this.canChat()){if(this.sendButton)this.sendButton.disabled=true;if(this.mediaButton)this.mediaButton.disabled=true;if(this.recordAudioButton)this.recordAudioButton.disabled=true;if(this.input){this.input.disabled=true;this.input.value="";}}else{if(this.sendButton)this.sendButton.disabled=(!this.input.value||this.input.value.length==0);if(this.mediaButton)this.mediaButton.disabled=false;if(this.recordAudioButton)this.recordAudioButton.disabled=false;if(this.input)this.input.disabled=false;}
if(this.fullscreen&&this.tab){var distanceFromTop=this.tab.getDistanceFromTop();var targetHeight=(distanceFromTop>0)?"calc(100vh - "+distanceFromTop+"px)":"100vh";if(this.tab.div)this.tab.div.style.setProperty("min-height",targetHeight,"important");if(this.div){this.div.style.setProperty("min-height",targetHeight,"important");this.div.style.maxHeight=targetHeight;}
if(this.leftColumn)this.leftColumn.style.maxHeight=this.div.style.maxHeight;if(this.rightColumn)this.rightColumn.style.maxHeight=this.div.style.maxHeight;}
if(this.viewMode==3||(this.viewMode==1&&this.div.offsetWidth<=576)){if(this.backButton)this.backButton.className=this.backButtonClass;if(this.contentDiv){this.contentDiv.className=this.contentDivClass;this.contentDiv.style.height=null;}
switch(this.activeScreen){case 0:if(this.leftColumn)this.leftColumn.className="chat-layout-left-col chat-layout-active col-12 p-0 d-flex flex-column flex-fill";if(this.rightColumn)this.rightColumn.className="chat-layout-right-col chat-layout-inactive d-none";break;case 1:if(this.leftColumn)this.leftColumn.className="chat-layout-left-col chat-layout-inactive d-none";if(this.rightColumn)this.rightColumn.className="chat-layout-right-col chat-layout-active col-12 p-0 d-flex flex-column flex-fill";break;}
if(this.activeContainer){if(this.activeContainer.item)this.activeContainer.item.className=this.activeContainer.itemClass;if(this.activeContainer.itemLast)this.activeContainer.itemLast.className="d-inline-block text-truncate text-muted mb-0";if(this.activeContainer.itemLastBadge)this.activeContainer.itemLastBadge.className="d-none";}}else{if(this.backButton){if(this.activeContainer&&this.activeContainer.isDetailsOpen){this.backButton.className=this.backButtonClass;}else{this.backButton.className="d-none";}}
if(this.leftColumn){this.leftColumn.className=this.leftColumnClass;this.leftColumn.style.cssText=null;}
if(this.rightColumn)this.rightColumn.style.cssText=null;if(this.activeContainer){if(this.rightColumn)this.rightColumn.className=this.rightColumnClass;if(this.activeContainer.item)this.activeContainer.item.className=this.activeContainer.itemClass+" active";if(this.activeContainer.itemLast)this.activeContainer.itemLast.className="d-inline-block text-truncate text-white mb-0";if(this.activeContainer.itemLastBadge)this.activeContainer.itemLastBadge.className="d-none";}else{if(this.rightColumn)this.rightColumn.className="d-none";}}
this.updateInputLayout();};HTMLChat.prototype.formatLastSeen=function(lastSeen){if(!this.showLastSeen||lastSeen===null||lastSeen===undefined)
return getLocaleMessage("LABEL.CHAT_OFFLINE");var now=moment();if(lastSeen.date()==now.date()&&lastSeen.month()==now.month()&&lastSeen.year()==now.year()){return getLocaleMessage("LABEL.CHAT_LAST_SEEN_TIME")+" "+lastSeen.seconds(0).milliseconds(0).format(this.timeFormat);}else{return getLocaleMessage("LABEL.CHAT_LAST_SEEN_DATE")+" "+lastSeen.seconds(0).milliseconds(0).format(this.dateTimeFormat);}};HTMLChat.prototype.formatName=function(name){if(name&&name.indexOf(" ")!=-1){var names=name.split(" ");return((names.length>1)?names[0]+" "+(names.length>2&&names[1].length<=3?names[1]+" "+names[2]:names[1]):names[0]).trim();}
return name;};HTMLChat.prototype.openExportModal=function(){if(!this.allowExport||!this.canExport||!this.enabled||this.activeContainer==null)return false;var object=this;var modal=ebfBootstrapCreateModal(getLocaleMessage("LABEL.CHAT_EXPORT_CONVERSATION"),true,null,null,null,document.body);var modalDiv=modal[0];var modalBody=modal[2];var modalFooter=modal[3];modalDiv.className="chat-modal "+modalDiv.className;var dateRow=document.createElement("div");dateRow.className="form-row";modalBody.appendChild(dateRow);var dateRowCol1=document.createElement("div");dateRowCol1.className="col-6";dateRow.appendChild(dateRowCol1);var dateRowCol2=document.createElement("div");dateRowCol2.className="col-6";dateRow.appendChild(dateRowCol2);var dateStartCheckboxDiv=document.createElement("div");dateStartCheckboxDiv.className="custom-control custom-checkbox mb-2";dateRowCol1.appendChild(dateStartCheckboxDiv);var dateStartCheckboxInput=document.createElement("input");dateStartCheckboxInput.type="checkbox";dateStartCheckboxInput.className="custom-control-input";dateStartCheckboxInput.id=modalDiv.id+"-date-start-checkbox";dateStartCheckboxDiv.appendChild(dateStartCheckboxInput);var dateStartLabel=document.createElement("label");dateStartLabel.className="custom-control-label";dateStartLabel.setAttribute("for",modalDiv.id+"-date-start-checkbox");dateStartLabel.innerText=getLocaleMessage("LABEL.CALENDAR_DATE_START");dateStartLabel.style.overflow="visible";dateStartCheckboxDiv.appendChild(dateStartLabel);var dateStartInput=document.createElement("input");dateStartInput.type="text";dateStartInput.className="form-control";dateStartInput.id=modalDiv.id+"-date-start";dateStartInput.setAttribute("placeholder",getLocaleMessage("LABEL.CALENDAR_DATE_START"));dateStartInput.readOnly=!dateStartCheckboxInput.checked;dateRowCol1.appendChild(dateStartInput);var dateEndCheckboxDiv=document.createElement("div");dateEndCheckboxDiv.className="custom-control custom-checkbox mb-2";dateRowCol2.appendChild(dateEndCheckboxDiv);var dateEndCheckboxInput=document.createElement("input");dateEndCheckboxInput.type="checkbox";dateEndCheckboxInput.className="custom-control-input";dateEndCheckboxInput.id=modalDiv.id+"-date-end-checkbox";dateEndCheckboxDiv.appendChild(dateEndCheckboxInput);var dateEndLabel=document.createElement("label");dateEndLabel.className="custom-control-label";dateEndLabel.setAttribute("for",modalDiv.id+"-date-end-checkbox");dateEndLabel.innerText=getLocaleMessage("LABEL.CALENDAR_DATE_END");dateEndLabel.style.overflow="visible";dateEndCheckboxDiv.appendChild(dateEndLabel);var dateEndInput=document.createElement("input");dateEndInput.type="text";dateEndInput.className="form-control";dateEndInput.id=modalDiv.id+"-date-end";dateEndInput.setAttribute("placeholder",getLocaleMessage("LABEL.CALENDAR_DATE_END"));dateEndInput.readOnly=!dateEndCheckboxInput.checked;dateRowCol2.appendChild(dateEndInput);var datetimepickerprops={locale:this.locale,format:this.dateTimeFormat,ignoreReadonly:false,showTodayButton:true,allowInputToggle:true};$(dateStartInput).datetimepicker(datetimepickerprops);$(dateEndInput).datetimepicker(datetimepickerprops);var messagesOrderDiv=document.createElement("div");messagesOrderDiv.className="mt-3";modalBody.appendChild(messagesOrderDiv);var messagesOrderLabel=document.createElement("label");messagesOrderLabel.setAttribute("for",modalDiv.id+"-order");messagesOrderLabel.innerText=getLocaleMessage("LABEL.CHAT_ORDER");messagesOrderDiv.appendChild(messagesOrderLabel);var messagesOrderSelect=document.createElement("select");messagesOrderSelect.id=modalDiv.id+"-order";messagesOrderSelect.className="custom-select";messagesOrderDiv.appendChild(messagesOrderSelect);var olderToNewer=document.createElement("option");olderToNewer.value="0";olderToNewer.innerText=getLocaleMessage("LABEL.CHAT_ORDER_OLDER_TO_NEWER");olderToNewer.setAttribute("selected","selected");messagesOrderSelect.appendChild(olderToNewer);var newerToOlder=document.createElement("option");newerToOlder.value="1";newerToOlder.innerText=getLocaleMessage("LABEL.CHAT_ORDER_NEWER_TO_OLDER");messagesOrderSelect.appendChild(newerToOlder);var optionsRow=document.createElement("div");optionsRow.className="form-row mt-3";modalBody.appendChild(optionsRow);var optionsRowCol1=document.createElement("div");optionsRowCol1.className="col-6";optionsRow.appendChild(optionsRowCol1);var optionsRowCol2=document.createElement("div");optionsRowCol2.className="col-6";optionsRow.appendChild(optionsRowCol2);var pageLayoutLabel=document.createElement("label");pageLayoutLabel.setAttribute("for",modalDiv.id+"-page-layout");pageLayoutLabel.innerText=getLocaleMessage("LABEL.PAGE_DIMENSIONS");optionsRowCol1.appendChild(pageLayoutLabel);var pageLayoutSelect=document.createElement("select");pageLayoutSelect.id=modalDiv.id+"-page-layout";pageLayoutSelect.className="custom-select";optionsRowCol1.appendChild(pageLayoutSelect);for(var i=1;i<=6;i++){var pageLayoutAi=document.createElement("option");pageLayoutAi.value=i.toString();pageLayoutAi.innerText="A"+i;if(i==4)pageLayoutAi.setAttribute("selected","selected");pageLayoutSelect.appendChild(pageLayoutAi);}
var pageStyleLabel=document.createElement("label");pageStyleLabel.setAttribute("for",modalDiv.id+"-page-style");pageStyleLabel.innerText=getLocaleMessage("LABEL.STYLE");optionsRowCol2.appendChild(pageStyleLabel);var pageStyleSelect=document.createElement("select");pageStyleSelect.id=modalDiv.id+"-page-style";pageStyleSelect.className="custom-select";optionsRowCol2.appendChild(pageStyleSelect);var pageStyleSimple=document.createElement("option");pageStyleSimple.value="0";pageStyleSimple.innerText=getLocaleMessage("LABEL.SIMPLE");pageStyleSelect.appendChild(pageStyleSimple);var pageStyleDark=document.createElement("option");pageStyleDark.value="1";pageStyleDark.setAttribute("selected","selected");pageStyleDark.innerText=getLocaleMessage("LABEL.DARK");pageStyleSelect.appendChild(pageStyleDark);var rotatedCheckboxDiv=document.createElement("div");rotatedCheckboxDiv.className="custom-control custom-checkbox mt-3";modalBody.appendChild(rotatedCheckboxDiv);var rotatedCheckboxInput=document.createElement("input");rotatedCheckboxInput.type="checkbox";rotatedCheckboxInput.className="custom-control-input";rotatedCheckboxInput.id=modalDiv.id+"-rotated-checkbox";rotatedCheckboxInput.checked=true;rotatedCheckboxDiv.appendChild(rotatedCheckboxInput);var rotatedLabel=document.createElement("label");rotatedLabel.className="custom-control-label";rotatedLabel.setAttribute("for",modalDiv.id+"-rotated-checkbox");rotatedLabel.innerText=getLocaleMessage("LABEL.ROTATE_PAGE");rotatedLabel.style.overflow="visible";rotatedCheckboxDiv.appendChild(rotatedLabel);var bordersCheckboxDiv=document.createElement("div");bordersCheckboxDiv.className="custom-control custom-checkbox mt-3";modalBody.appendChild(bordersCheckboxDiv);var bordersCheckboxInput=document.createElement("input");bordersCheckboxInput.type="checkbox";bordersCheckboxInput.className="custom-control-input";bordersCheckboxInput.id=modalDiv.id+"-borders-checkbox";bordersCheckboxInput.checked=false;bordersCheckboxDiv.appendChild(bordersCheckboxInput);var bordersLabel=document.createElement("label");bordersLabel.className="custom-control-label";bordersLabel.setAttribute("for",modalDiv.id+"-borders-checkbox");bordersLabel.innerText=getLocaleMessage("LABEL.BORDERED_TABLE");bordersLabel.style.overflow="visible";bordersCheckboxDiv.appendChild(bordersLabel);var cancelButton=document.createElement("button");cancelButton.type="button";cancelButton.className="btn btn-secondary float-right";cancelButton.innerText=this.editable?getLocaleMessage("LABEL.CANCEL"):getLocaleMessage("LABEL.CLOSE");cancelButton.setAttribute("data-dismiss","modal");modalFooter.appendChild(cancelButton);var exportButton=document.createElement("button");exportButton.type="button";exportButton.className="btn btn-primary float-right mr-2";exportButton.innerText=getLocaleMessage("LABEL.EXPORT");modalFooter.appendChild(exportButton);exportButton.addEventListener("click",function(){var dateStartValue=$(dateStartInput).datetimepicker('date');var dateEndValue=$(dateEndInput).datetimepicker('date');object.exportConversation(object.activeContainer.data.id,object.activeContainer.data.type,"PDF",messagesOrderSelect.value,pageLayoutSelect.value,rotatedCheckboxInput.checked,pageStyleSelect.value,bordersCheckboxInput.checked,dateStartCheckboxInput.checked&&dateStartValue!=null?dateStartValue.utc().toISOString():null,dateEndCheckboxInput.checked&&dateEndValue!=null?dateEndValue.utc().toISOString():null);ebfBootstrapCloseModal(modalDiv);});dateStartCheckboxInput.addEventListener("change",function(){dateStartInput.readOnly=!dateStartCheckboxInput.checked;});dateEndCheckboxInput.addEventListener("change",function(){dateEndInput.readOnly=!dateEndCheckboxInput.checked;});};HTMLChat.prototype.openGroupModal=function(group,mode){if(!this.allowCreateGroups||!this.cachedContainers)return false;if(this.hasGroupsForm()){$.post(this.getRequestURL()+"&type=g"+(group?"&req="+URLEncode(group.id,"GET")+"&reqType="+URLEncode(group.type,"GET")+"&typeAction=edit":""),{},function(response){if(response&&response.success&&response.command&&response.command.length>0){eval(response.command);}else{new HTMLMessage().showErrorMessage(getLocaleMessage("ERROR.OPERATION_ERROR"),null,null,response.details);failCallback();}});}else{var object=this;var wrapperUsersList=[];var selectedUsers=group&&group.users?group.users:[];var groupImageFile=null;var groupImageFileName=null;var modal=ebfBootstrapCreateModal(group?(mode===1)?getLocaleMessage("LABEL.CHAT_ADD_USERS"):getLocaleMessage("LABEL.CHAT_EDIT_GROUP"):getLocaleMessage("LABEL.CHAT_CREATE_GROUP"),true,null,null,null,document.body);var modalDiv=modal[0];var modalBody=modal[2];var modalFooter=modal[3];var modalDialog=modal[4];modalDiv.className="chat-modal "+modalDiv.className;if(mode!==1)modalBody.className+=" p-sm-4";else modalBody.className+=" p-0";modalDialog.className+=" modal-dialog-scrollable";var groupForm=document.createElement("form");groupForm.className="d-flex flex-column flex-fill";groupForm.method="post";groupForm.action="";modalBody.appendChild(groupForm);if(mode!==1){var nameFormGroup=document.createElement("div");nameFormGroup.className="form-group row position-relative mt-0 mb-3";groupForm.appendChild(nameFormGroup);var imageColDiv=document.createElement("div");imageColDiv.className="col-2 d-flex flex-column align-items-center justify-content-center";nameFormGroup.appendChild(imageColDiv);var nameColDiv=document.createElement("div");nameColDiv.className="col-10 d-flex flex-column justify-content-center";nameFormGroup.appendChild(nameColDiv);var imageDiv=document.createElement("div");imageDiv.className="d-flex align-items-center justify-content-center rounded-circle border bg-light text-muted overflow-hidden";imageDiv.style.width="3rem";imageDiv.style.height="3rem";imageDiv.style.cursor="pointer";imageDiv.style.backgroundPosition="center center";imageDiv.style.backgroundRepeat="no-repeat";imageDiv.style.backgroundSize="cover";imageColDiv.appendChild(imageDiv);var imageIconDiv=document.createElement("i");imageIconDiv.className="fas fa-camera";imageDiv.appendChild(imageIconDiv);var imageRemoveLink=document.createElement("a");imageRemoveLink.href="#";imageRemoveLink.className="text-muted text-decoration-none mt-2 mb-0";imageRemoveLink.style.fontSize="0.8rem";imageRemoveLink.innerText=getLocaleMessage("LABEL.REMOVE");imageColDiv.appendChild(imageRemoveLink);var setGroupImage=function(url){if(url&&url.length>0){imageIconDiv.style.display="none";imageDiv.style.backgroundImage="url('"+url+"')";imageDiv.style.width="3rem";imageDiv.style.height="3rem";imageRemoveLink.style.display=null;}else{imageIconDiv.style.display=null;imageDiv.style.backgroundImage=null;imageDiv.style.width="3.5rem";imageDiv.style.height="3.5rem";imageRemoveLink.style.display="none";}};var fileInput=null;imageDiv.addEventListener("click",function(){createFileInput();fileInput.click();});var createFileInput=function(){if(fileInput)imageColDiv.removeChild(fileInput);fileInput=document.createElement("input");fileInput.type="file";fileInput.multiple=false;fileInput.accept="image/*";fileInput.name="image";fileInput.className="d-none";imageColDiv.appendChild(fileInput);fileInput.addEventListener("change",function(){if(fileInput.files&&fileInput.files.length>0){groupImageFile=fileInput.files[0];setGroupImage(window.URL.createObjectURL(groupImageFile));}});};imageRemoveLink.addEventListener("click",function(e){e.preventDefault();groupImageFile=null;groupImageFileName="false";setGroupImage(null);});setGroupImage(null);var nameInputId="group-name-"+this.code;var nameLabel=document.createElement("label");nameLabel.className="mb-2";nameLabel.innerText=getLocaleMessage("LABEL.CHAT_GROUP_NAME");nameLabel.setAttribute("for",nameInputId);nameColDiv.appendChild(nameLabel);var nameInput=document.createElement("input");nameInput.type="text";nameInput.id=nameInputId;nameInput.className="form-control";if(group)nameInput.value=group.name;nameColDiv.appendChild(nameInput);if(group&&group.photo&&group.photo.length>0&&group.photo!==false&&group.photo!=="false"){setGroupImage(this.getRequestURL()+"&type=p"+"&req="+URLEncode(group.id,"GET")+"&reqType="+URLEncode(group.type,"GET"));}}
var cancelButton=document.createElement("button");cancelButton.type="button";cancelButton.className="btn btn-secondary";cancelButton.innerText=getLocaleMessage("LABEL.CANCEL");cancelButton.setAttribute("data-dismiss","modal");modalFooter.appendChild(cancelButton);var createGroupButton=document.createElement("button");createGroupButton.type="button";createGroupButton.className="btn btn-primary";createGroupButton.innerText=group?(mode===1)?getLocaleMessage("LABEL.ADD"):getLocaleMessage("LABEL.SAVE"):getLocaleMessage("LABEL.CHAT_CREATE_GROUP");modalFooter.appendChild(createGroupButton);if(!group||mode===1){var usersListGroup=document.createElement("div");usersListGroup.className="form-group position-relative d-flex flex-column flex-fill";groupForm.appendChild(usersListGroup);if(mode!==1){var usersListLabel=document.createElement("label");usersListLabel.className="mb-2";usersListLabel.innerText=getLocaleMessage("LABEL.USERS");usersListLabel.setAttribute("for","");usersListLabel.style.flex="0 0 auto";usersListGroup.appendChild(usersListLabel);}
var usersListCard=document.createElement("div");if(mode!==1)usersListCard.className="card d-flex flex-column flex-fill p-0 overflow-hidden";else usersListCard.className="d-flex flex-column flex-fill p-0";usersListGroup.appendChild(usersListCard);var usersListSearchDiv=document.createElement("div");usersListSearchDiv.className="d-flex flex-row w-100 bg-light border-bottom overflow-hidden"+(mode===1?" sticky-top":"");usersListSearchDiv.style.flex="0 0 auto";usersListCard.appendChild(usersListSearchDiv);var searchIconBase=document.createElement("div");searchIconBase.className="px-3 py-2";usersListSearchDiv.appendChild(searchIconBase);var lineHeight="1.5";try{var bodyLineHeight=window.getComputedStyle(document.body).lineHeight;if(bodyLineHeight!==null&&bodyLineHeight.length>0){lineHeight=bodyLineHeight;}}catch(e){}
var searchIcon=document.createElement("i");searchIcon.className="fas fa-search text-muted";searchIcon.style.lineHeight=lineHeight;searchIconBase.appendChild(searchIcon);var usersListSearchInput=document.createElement("input");usersListSearchInput.type="text";usersListSearchInput.className="form-control-plaintext";usersListSearchInput.placeholder=getLocaleMessage("LABEL.CHAT_SEARCH")+"...";usersListSearchInput.style.outline="0";usersListSearchDiv.appendChild(usersListSearchInput);var usersListSearchResults=document.createElement("div");usersListSearchResults.className="d-none";usersListCard.appendChild(usersListSearchResults);var usersList=document.createElement("div");var usersListClass="list-group list-group-flush d-flex flex-column flex-fill";usersList.className=usersListClass;usersListCard.appendChild(usersList);var updateModalLayout=function(){createGroupButton.disabled=((mode!==1&&(nameInput.value.length==0||nameInput.value.trim().length==0))||((!group||mode===1)&&(!selectedUsers||selectedUsers.length==0))||(mode===1&&wrapperUsersList.length==0));};var executeUserAction=function(userId,userItem){var selectedUserIndex=selectedUsers.indexOf(userId);if(selectedUserIndex>=0){selectedUsers.splice(selectedUserIndex,1);if(userItem.classList.contains("active")){userItem.classList.remove("active");}}else{selectedUsers.push(userId);if(!userItem.classList.contains("active")){userItem.classList.add("active");}}
try{updateModalLayout();}catch(e){}};var redrawUsersList=function(){wrapperUsersList=[];usersList.innerHTML="";for(var i=0;i<object.cachedContainers.length;i++){if(mode===1&&group&&group.users&&group.users.length>0&&object.cachedContainers[i].data&&group.users.indexOf(object.cachedContainers[i].data.id)>=0){}else if(object.cachedContainers[i].isUser()&&object.cachedContainers[i].data&&object.cachedContainers[i].data.id!=object.user.data.id){wrapperUsersList.push(object.cachedContainers[i]);(function(index,userData,userItem){userItem=object.designContainerItem(usersList,userData,index,null,function(e){e.stopPropagation();e.preventDefault();executeUserAction(userData.id,userItem[0]);});if(selectedUsers.indexOf(userData.id)>=0){if(!userItem[0].classList.contains("active")){userItem[0].classList.add("active");}}else{if(userItem[0].classList.contains("active")){userItem[0].classList.remove("active");}}})(i,object.cachedContainers[i].data);}}
if(wrapperUsersList.length==0){var infoSpan=document.createElement("span");infoSpan.className="text-muted text-center flex-fill p-4";infoSpan.innerText=getLocaleMessage("INFO.CHAT_NO_USERS_AVAILABLE_ADD");usersList.appendChild(infoSpan);}
try{updateModalLayout();}catch(e){}};redrawUsersList();var searchForUsers=function(){var results=object.searchAction(usersListSearchInput,usersList,usersListSearchResults,usersListClass,false,wrapperUsersList);if(results&&results.length>0){for(var i=0;i<results.length;i++){(function(resultItem){resultItem.element.addEventListener("click",function(e){e.stopPropagation();e.preventDefault();executeUserAction(resultItem.id,resultItem.element);redrawUsersList();});if(selectedUsers.indexOf(resultItem.id)>=0){if(!resultItem.element.classList.contains("active")){resultItem.element.classList.add("active");}}else{if(resultItem.element.classList.contains("active")){resultItem.element.classList.remove("active");}}})(results[i]);}}};usersListSearchInput.addEventListener("input",searchForUsers);usersListSearchInput.addEventListener("change",searchForUsers);}
createGroupButton.addEventListener("click",function(){cancelButton.style.setProperty("display","none","important");createGroupButton.style.setProperty("display","none","important");modalBody.innerHTML="";modalBody.className="modal-body d-flex flex-column align-items-center justify-content-center p-5";var spinner=bootstrapCreateSpinner(modalBody,"text-secondary",false);spinner[0].style.fontSize="1rem";spinner[0].style.width="1.7rem";spinner[0].style.height="1.7rem";var failCallback=function(){if(spinner){modalBody.removeChild(spinner[0]);spinner=null;}
var iconSpan=document.createElement("span");iconSpan.className="fas fa-exclamation-triangle text-secondary mb-3";iconSpan.style.fontSize="3rem";modalBody.appendChild(iconSpan);var infoSpan=document.createElement("span");infoSpan.className="text-muted mb-2";infoSpan.innerText=getLocaleMessage("ERROR.CONNECTION_FAIL");modalBody.appendChild(infoSpan);var retryButton=document.createElement("button");retryButton.type="button";retryButton.className="btn btn-secondary";retryButton.innerText=getLocaleMessage("LABEL.TRY_AGAIN");modalFooter.appendChild(retryButton);retryButton.addEventListener("click",function(){modalFooter.removeChild(retryButton);createGroupButton.click();});};var postCallback=function(){$.post(object.getRequestURL()+"&type=g"+(group?"&req="+URLEncode(group.id,"GET")+"&reqType="+URLEncode(group.type,"GET")+(mode===1?"&typeAction=add":"&typeAction=edit"):""),{name:nameInput?nameInput.value.trim():null,users:selectedUsers,photo:groupImageFileName},function(response){if(response&&response.success){if(group&&mode===1){var groupContainer=object.getGroupById(group.id);if(groupContainer){if(groupContainer.isDetailsOpen){object.activeContainer.isDetailsOpen=false;object.activeContainer.toggleDetails();}
groupContainer.setState(null,null);}else{object.updateData(true);}}else{object.updateData(true);}
bootstrapCloseModal(modal[0]);}else{new HTMLMessage().showErrorMessage(getLocaleMessage("ERROR.OPERATION_ERROR"),null,null,response.details);failCallback();}}).fail(failCallback);};if(mode!==1&&groupImageFile){var formData=new FormData();formData.append("upload",fileInput.files[0]);var xhr=new XMLHttpRequest();xhr.open("POST",object.getFileUploadURL(),true);xhr.addEventListener("load",function(){try{if((xhr.readyState===4||xhr.status===200)&&xhr.responseText&&xhr.responseText.length>0){if(xhr.responseText.indexOf("Exception:")>=0){new HTMLMessage().showErrorMessage(getLocaleMessage("ERROR.OPERATION_ERROR"),null,null,xhr.responseText);failCallback();}else{var responseJson=JSON.parse(xhr.responseText.trim());if(responseJson&&responseJson.name&&responseJson.name.length>0){groupImageFileName=responseJson.name;postCallback();}else{failCallback();}}}else{failCallback();}}catch(e){failCallback(e);}});xhr.addEventListener("error",failCallback);xhr.send(formData);}else{postCallback();}});if(nameInput){nameInput.addEventListener("input",updateModalLayout);nameInput.addEventListener("change",updateModalLayout);}
try{updateModalLayout();}catch(e){}}};HTMLChat.prototype.exportConversation=function(entityId,entityType,format,order,layout,rotated,style,borders,dateStart,dateEnd){if(!this.allowExport)return false;if(!this.requestFrame){this.requestFrame=document.createElement("iframe");this.requestFrame.className="d-none";this.div.appendChild(this.requestFrame);}
this.requestFrame.src="WFRChatExport?sys="+URLEncode(this.sys,"GET")+"&formID="+URLEncode(this.formID,"GET")+"&comID="+URLEncode(this.code,"GET")+"&type="+format+"&req="+URLEncode(entityId,"GET")+"&reqType="+URLEncode(entityType,"GET")+
(order&&order.length>0?"&order="+order:"")+
(layout&&layout.length>0?"&layout="+layout:"")+
(rotated===true?"&rotated=1":"&rotated=0")+
(style&&style.length>0?"&style="+style:"")+
(borders===true?"&borders=1":"&borders=0")+
(dateStart&&dateStart.length>0?"&from="+URLEncode(dateStart,"GET"):"")+
(dateEnd&&dateEnd.length>0?"&to="+URLEncode(dateEnd,"GET"):"");};HTMLChat.prototype.getUserMedia=function(audio,video,successCallback,errorCallback){try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){var getUserMedia=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);if(getUserMedia){getUserMedia({video:true,audio:false},successCallback,errorCallback);}else{errorCallback();}}else{navigator.mediaDevices.getUserMedia({video:video,audio:audio}).then(successCallback).catch(errorCallback);}}catch(e){errorCallback(e);}};HTMLChat.prototype.hasMediaInterface=function(){return((navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)||navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);};HTMLChat.prototype.isWebcamSupported=function(){return new Promise(function(resolve,reject){if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){navigator.mediaDevices.enumerateDevices().then(function(devices){var result=false;for(var i=0;i<devices.length;i++){if(devices[i].kind==='videoinput')result=true;}
resolve(result);})}
resolve(true);});};HTMLChat.prototype.isRecordingSupported=function(){return this.hasMediaInterface()&&typeof MediaRecorder!=="undefined"&&MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported(this.audioMimeType);};HTMLChat.prototype.takePhotoAction=function(){openCapture(this.sys,this.formID,this.code);};HTMLChat.prototype.refresh=function(hasImage,hash){if(hasImage===true&&hash&&hash.length>0){if(this.activeContainer)this.activeContainer.enqueueMedia({name:hash+this.imageFileExtension,serverName:hash+this.imageFileExtension,type:"image",mimeType:this.imageMimeType,url:"chat/upload/"+hash+this.imageFileExtension,description:""});}else{this.updateData();this.updateLayout();}};HTMLChat.prototype.recordAudioAction=function(){var object=this;this.getUserMedia(true,false,function(stream){var startTime=null;var timerInterval=null;var recordDiv=null;var recordLabel=null;var inputGroupAppend=null;var sendButton=null;var cancelSendButton=null;var recordedChunks=[];var mediaRecorder=new MediaRecorder(stream,{mimeType:object.audioMimeType});mediaRecorder.addEventListener("start",function(){startTime=moment();object.input.disabled=true;if(object.sendButton)object.sendButton.style.setProperty("display","none","important");if(object.mediaButton)object.mediaButton.style.setProperty("display","none","important");if(object.recordAudioButton)object.recordAudioButton.style.setProperty("display","none","important");recordDiv=document.createElement("div");recordDiv.className="d-flex flex-row flex-nowrap align-items-center h-100 pl-3";object.activeConvBottomDiv.appendChild(recordDiv);var recordIcon=document.createElement("i");recordIcon.className="chat-nav-label chat-nav-label-record-icon fas fa-circle text-danger mr-2";recordDiv.appendChild(recordIcon);recordLabel=document.createElement("span");recordLabel.className="chat-nav-label chat-nav-label-record-time font-weight-bold mr-3";recordLabel.innerHTML=moment.utc(moment().diff(startTime)).format("mm:ss");recordDiv.appendChild(recordLabel);timerInterval=setInterval(function(){if(recordLabel)recordLabel.innerText=moment.utc(moment().diff(startTime)).format("mm:ss");},500);var confirmButton=document.createElement("button");confirmButton.type="button";confirmButton.className="chat-nav-button chat-nav-button-record-confirm btn btn-success d-flex align-items-center justify-content-center rounded-circle p-2 ml-2";confirmButton.style.width="2rem";confirmButton.style.height="2rem";confirmButton.style.fontSize="0.85rem";confirmButton.title=getLocaleMessage("LABEL.OK");confirmButton.setAttribute("data-toggle","tooltip");recordDiv.appendChild(confirmButton);var confirmButtonIcon=document.createElement("i");confirmButtonIcon.className="fas fa-check";confirmButton.appendChild(confirmButtonIcon);bootstrapInitTooltip(confirmButton);var cancelButton=document.createElement("button");cancelButton.type="button";cancelButton.className="chat-nav-button chat-nav-button-record-cancel btn btn-outline-danger d-flex align-items-center justify-content-center rounded-circle p-2 ml-2";cancelButton.style.width="2rem";cancelButton.style.height="2rem";cancelButton.style.fontSize="0.85rem";cancelButton.title=getLocaleMessage("LABEL.CANCEL");cancelButton.setAttribute("data-toggle","tooltip");recordDiv.appendChild(cancelButton);var cancelButtonIcon=document.createElement("i");cancelButtonIcon.className="fas fa-times";cancelButton.appendChild(cancelButtonIcon);bootstrapInitTooltip(cancelButton);cancelButton.addEventListener("click",function(){bootstrapCloseTooltip(cancelButton);object.input.disabled=false;if(mediaRecorder&&mediaRecorder.state!="inactive"){mediaRecorder.stop();}
recordedChunks=[];if(recordDiv){object.activeConvBottomDiv.removeChild(recordDiv);recordDiv=null;}
if(sendButton){object.activeConvBottomDiv.removeChild(sendButton);sendButton=null;}
if(cancelSendButton){object.activeConvBottomDiv.removeChild(cancelSendButton);cancelSendButton=null;}
if(inputGroupAppend){object.inputGroup.removeChild(inputGroupAppend);inputGroupAppend=null;}
if(object.sendButton)object.sendButton.style.display=null;if(object.mediaButton)object.mediaButton.style.display=null;if(object.recordAudioButton)object.recordAudioButton.style.display=null;recordDiv=null;recordLabel=null;startTime=null;});confirmButton.addEventListener("click",function(){bootstrapCloseTooltip(confirmButton);object.input.disabled=false;if(mediaRecorder&&mediaRecorder.state!="inactive"){mediaRecorder.stop();}
inputGroupAppend=document.createElement("div");inputGroupAppend.className="input-group-append";object.inputGroup.appendChild(inputGroupAppend);var inputGroupText=document.createElement("span");inputGroupText.className="input-group-text";inputGroupAppend.appendChild(inputGroupText);var audioFileIcon=document.createElement("span");audioFileIcon.className="fas fa-volume-up mr-2";inputGroupText.appendChild(audioFileIcon);var audioFileName=document.createElement("span");audioFileName.innerText=getLocaleMessage("LABEL.AUDIO");inputGroupText.appendChild(audioFileName);if(recordDiv)recordDiv.style.setProperty("display","none","important");var previousSendButton=object.sendButton;cancelSendButton=document.createElement("button");cancelSendButton.type="button";cancelSendButton.className="chat-nav-button chat-nav-button-record-delete btn btn-light ml-3 d-flex align-items-center justify-content-center";cancelSendButton.title=getLocaleMessage("LABEL.CANCEL");cancelSendButton.setAttribute("data-toggle","tooltip");object.activeConvBottomDiv.appendChild(cancelSendButton);var cancelSendButtonIcon=document.createElement("span");cancelSendButtonIcon.className="fas fa-times my-1";cancelSendButton.appendChild(cancelSendButtonIcon);cancelSendButton.addEventListener("click",function(){bootstrapCloseTooltip(cancelSendButton);if(previousSendButton){object.sendButton=previousSendButton;object.allowEmptyMessages=false;previousSendButton=null;}
cancelButton.click();});bootstrapInitTooltip(cancelSendButton);sendButton=document.createElement("button");sendButton.type="button";sendButton.className="chat-nav-button chat-nav-button-record-send btn btn-light ml-3 d-flex align-items-center justify-content-center";sendButton.title=getLocaleMessage("LABEL.SEND");sendButton.setAttribute("data-toggle","tooltip");object.activeConvBottomDiv.appendChild(sendButton);var sendButtonIcon=document.createElement("span");sendButtonIcon.className="fas fa-paper-plane my-1";sendButton.appendChild(sendButtonIcon);bootstrapInitTooltip(sendButton);object.sendButton=sendButton;object.allowEmptyMessages=true;sendButton.addEventListener("click",function(){bootstrapCloseTooltip(sendButton);if(previousSendButton){object.sendButton=previousSendButton;object.allowEmptyMessages=false;previousSendButton=null;}
var audioFile=new File([new Blob(recordedChunks,{type:object.audioMimeType})],ebfGenerateGUID()+object.audioFileExtension,{type:object.audioMimeType,lastModified:new Date()});object.activeContainer.sendFile({url:window.URL.createObjectURL(audioFile),description:object.input.value,file:audioFile});object.input.value="";cancelButton.click();});});});mediaRecorder.addEventListener("dataavailable",function(e){if(e.data.size>0)recordedChunks.push(e.data);});var stopHandler=function(){if(timerInterval!==null){clearInterval(timerInterval);timerInterval=null;}
var tracks=stream.getTracks();for(var i=0;i<tracks.length;i++){tracks[i].stop();}};mediaRecorder.addEventListener("stop",stopHandler);mediaRecorder.addEventListener("error",stopHandler);mediaRecorder.start();},function(error){});};HTMLChat.prototype.getUniqueId=function(){return moment().format("x")+"-"+(Math.floor(Math.random()*1000000)+1).toString();};HTMLChat.prototype.hasGroupsForm=function(){return this.FormularioDeGrupos!==undefined&&this.FormularioDeGrupos!==null&&this.FormularioDeGrupos.length>0&&this.FormularioDeGrupos!="0";};HTMLChat.prototype.shouldSendReadConfirmations=function(){return this.showReadConfirmation&&!this.authError&&this.socket&&this.pageVisible;};HTMLChat.prototype.sendAllPendingReadConfirmations=function(){if(this.cachedContainers&&this.cachedContainers.length>0){for(var i=0;i<this.cachedContainers.length;i++){if(!this.cachedContainers[i].isSendToEveryone){this.cachedContainers[i].sendPendingReadConfirmations();}}}};HTMLChat.prototype.flush=function(){this.activeConvBottomDiv=null;this.activeConvDiv=null;this.activeConvUserDiv=null;this.activeConvUserWrapper=null;this.activeConvUserName=null;this.activeConvUserPicture=null;this.activeConvUserPictureDefault=null;this.activeConvUserPictureDefaultClass=null;this.activeConvUserPictureIcon=null;this.activeConvUserPictureLink=null;this.activeConvUserState=null;this.activeScreen=null;this.activeContainer=null;this.allowExport=null;this.backButton=null;this.backButtonClass=null;this.cachedContainers=null;this.chatMessageContent=null;this.chatMessageDiv=null;this.chatMessageDivClass=null;this.chatMessageIcon=null;this.chatMessageTitle=null;this.connectionError=null;this.contentDiv=null;this.contentDivClass=null;this.expandOnClick=null;this.fullscreen=null;this.leftColumn=null;this.leftColumnClass=null;this.leftNavbar=null;this.listScrollDiv=null;this.loadedMessagesAmount=null;this.mobile=null;this.preloader=null;this.preloaderClass=null;this.rightColumn=null;this.rightColumnClass=null;this.rightDropdownMenu=null;this.rightNavbar=null;this.rightOptionsButton=null;this.searchDiv=null;this.searchInput=null;this.searchResults=null;this.sendButton=null;this.sendToEveryoneButton=null;this.sendToEveryoneContainer=null;this.showLastSeen=null;this.showReadConfirmation=null;this.showSearch=null;this.showSendToEveryone=null;this.showUserStates=null;this.userName=null;this.userPicture=null;this.userPictureLink=null;this.usersList=null;this.usersListClass=null;this.pageVisible=null;this.div.innerHTML="";if(this.socket){try{this.socket.close();}catch(e){}
this.socket=null;}
this.callMethod(HTMLElementBase,"flush",[]);};function HTMLChatContainer(chat,index,data,item,itemPicture,itemName,itemLast,itemLastBadge){this.chat=chat;this.index=index;this.data=data;if(item){this.item=item;this.itemClass=item.className;}
this.itemPicture=itemPicture;this.itemName=itemName;this.itemLast=itemLast;if(itemLastBadge){this.itemLastBadge=itemLastBadge;this.itemLastBadgeClass=itemLastBadge.className;}
this.sections=[];this.active=false;this.scroll=0;this.hasUnreadMessages=false;this.unreadMessages=0;this.waitingMessages=[];this.isDetailsOpen=false;this.isMediaViewOpen=false;this.historyRequested=false;this.historyHasReachedEnd=false;}
HTMLChatContainer.prototype.name='HTMLChatContainer';HTMLChatContainer.prototype.BLUR_RADIUS=5;HTMLChatContainer.prototype.setActive=function(active){this.active=active;if(this.chat.activeContainer&&(!active||this.chat.activeContainer!=this)){this.chat.activeContainer.active=false;if(this.chat.editGroupButton)this.chat.editGroupButton.style.setProperty("display","none","important");if(this.chat.deleteGroupButton)this.chat.deleteGroupButton.style.setProperty("display","none","important");if(this.chat.groupDropdownDivider)this.chat.groupDropdownDivider.style.setProperty("display","none","important");if(this.chat.activeContainer.item)this.chat.activeContainer.item.className=this.chat.activeContainer.itemClass;if(this.chat.activeContainer.itemLast)this.chat.activeContainer.itemLast.className="d-inline-block text-truncate text-muted mb-0";if(this.chat.sendToEveryoneIconDiv!==undefined&&this.chat.sendToEveryoneIconDiv!==null){this.chat.activeConvUserDiv.removeChild(this.chat.sendToEveryoneIconDiv);this.chat.sendToEveryoneIconDiv=null;}
if(this.chat.activeConvUserPicture){this.chat.activeConvUserPicture.src="";this.chat.activeConvUserPicture.alt="";}
if(this.chat.activeConvUserName)this.chat.activeConvUserName.innerHTML="";if(this.chat.activeConvUserState)this.chat.activeConvUserState.innerHTML="";this.chat.activeContainer.scroll=this.chat.activeConvDiv.scrollTop;this.chat.activeContainer.removePreloader();this.chat.activeContainer.destroyMediaView();if(this.chat.activeContainer.isDetailsOpen){this.chat.activeContainer.toggleDetails();}
this.chat.activeContainer=null;}
this.chat.activeConvDiv.innerHTML="";this.chat.activeConvUserState.innerHTML="";var lastChanged=false;if(active){this.hasUnreadMessages=false;this.unreadMessages=0;this.chat.activeContainer=this;this.chat.activeScreen=1;if(this.itemPicture&&this.itemPicture.src&&this.itemPicture.src.length>0){if(this.chat.rightOptionsButton)this.chat.rightOptionsButton.disabled=false;if(this.chat.activeConvUserPictureDefault){this.chat.activeConvUserPictureDefault.className="d-none";}
this.chat.activeConvUserPicture.className="rounded-circle";this.chat.activeConvUserPicture.src=this.itemPicture.src;if(this.chat.activeConvUserPictureLink){this.chat.activeConvUserPictureLink.href=this.chat.activeConvUserPicture.src;}}else if(this.isSendToEveryone){if(this.chat.rightOptionsButton)this.chat.rightOptionsButton.disabled=true;this.chat.activeConvUserPicture.className="d-none";this.chat.activeConvUserPicture.src="";this.chat.activeConvUserPicture.alt="";this.chat.activeConvUserPictureLink.href="#";if(this.chat.activeConvUserPictureDefault){this.chat.activeConvUserPictureDefault.className="d-none";}
if(this.chat.sendToEveryoneIconDiv===undefined||this.chat.sendToEveryoneIconDiv===null){this.chat.sendToEveryoneIconDiv=document.createElement("div");this.chat.sendToEveryoneIconDiv.className="rounded-circle bg-light border d-flex align-items-center justify-content-center";this.chat.sendToEveryoneIconDiv.style.width=this.chat.photoSize+"px";this.chat.sendToEveryoneIconDiv.style.height=this.chat.photoSize+"px";this.chat.activeConvUserDiv.insertBefore(this.chat.sendToEveryoneIconDiv,this.chat.activeConvUserDiv.firstChild);var sendToEveryoneIcon=document.createElement("i");sendToEveryoneIcon.className="fas fa-globe text-dark";sendToEveryoneIcon.style.opacity="0.5";sendToEveryoneIcon.style.fontSize="1.25rem";this.chat.sendToEveryoneIconDiv.appendChild(sendToEveryoneIcon);}}else{if(this.chat.rightOptionsButton)this.chat.rightOptionsButton.disabled=false;if((this.isGroup()&&(!this.ImagemGrupoSemFoto||this.ImagemGrupoSemFoto.length==0))||(!this.isGroup()&&(!this.ImagemSemFoto||this.ImagemSemFoto.length==0))){if(this.chat.activeConvUserPictureIcon)this.chat.activeConvUserPictureIcon.className="fas "+(this.isGroup()?"fa-users":"fa-user")+" text-dark";if(this.chat.activeConvUserPicture)this.chat.activeConvUserPicture.className="d-none";if(this.chat.activeConvUserPictureDefault)this.chat.activeConvUserPictureDefault.className=this.chat.activeConvUserPictureDefaultClass;}else{if(this.chat.activeConvUserPicture){if(this.isGroup()){this.chat.activeConvUserPicture.className="rounded-circle";this.chat.activeConvUserPicture.src=this.getImageSourceURL(this.ImagemGrupoSemFoto);}else{this.chat.activeConvUserPicture.className="rounded-circle";this.chat.activeConvUserPicture.src=this.getImageSourceURL(this.ImagemSemFoto);}}
if(this.chat.activeConvUserPictureLink)this.chat.activeConvUserPictureLink.href=this.chat.activeConvUserPicture.src;}}
if(this.itemName)this.chat.activeConvUserName.innerHTML=this.itemName.innerHTML;else if(this.isSendToEveryone)this.chat.activeConvUserName.innerText=getLocaleMessage("LABEL.CHAT_SEND_TO_EVERYONE");else this.chat.activeConvUserName.innerHTML="";if(this.isGroup()){if(this.groupIsCurrentUserAdmin()){if(this.chat.editGroupButton)this.chat.editGroupButton.style.display=null;if(this.chat.deleteGroupButton)this.chat.deleteGroupButton.style.display=null;if(this.chat.groupDropdownDivider)this.chat.groupDropdownDivider.style.display=null;}
if(!this.chat.allowExport&&this.chat.rightDropdownArea){this.chat.rightDropdownArea.style.display=null;}}else{if(!this.chat.allowExport&&this.chat.rightDropdownArea){this.chat.rightDropdownArea.style.setProperty("display","none","important");}}
var object=this;this.chat.activeConvDiv.onscroll=function(){if(object.chat&&object.chat.activeContainer){object.chat.activeContainer.scroll=object.chat.activeConvDiv.scrollTop;if(object.chat.activeConvDiv.clientHeight<object.chat.activeConvDiv.scrollHeight&&object.chat.activeConvDiv.scrollTop<=0&&!object.loadHistoryButton){object.chat.activeContainer.getHistoryMessages();}}};this.chat.updateLayout();this.setState(null,null);this.olderMessage=null;this.newerMessage=null;if(this.sections&&this.sections.length>0){for(var i=0;i<this.sections.length;i++){var section=this.sections[i];this.designSection(section.date);if(section.messages&&section.messages.length>0){for(var j=0;j<section.messages.length;j++){var message=section.messages[j];this.designMessage(message,section,false);if(i==this.sections.length-1&&j==section.messages.length-1){this.setLastMessageContent(message);this.newerMessage=message;lastChanged=true;}else if(i==0&&j==0){this.olderMessage=message;}
var internalMessage=(message.from===this.chat.user.data.id);if(!internalMessage&&this.isUser()&&!message.sentConfirmation){var readConfirmationMsg={type:"read",id:message.id+"-r",messageId:message.id,from:this.chat.user.data.id,destination:message.from};if(this.chat.shouldSendReadConfirmations()){this.chat.socket.send(JSON.stringify(readConfirmationMsg));}else{if(!this.pendingReadConfirmations)this.pendingReadConfirmations=[];this.pendingReadConfirmations.push(readConfirmationMsg);}
message.sentConfirmation=true;}}}}
if(this.scroll)this.chat.activeConvDiv.scrollTop=this.scroll;else this.scrollToBottom();}
if(!lastChanged&&this.itemLast){this.setLastMessageContent(null);}
this.designMediaView();if(!this.historyRequested){this.getHistoryMessages(true);}else if(this.hasLoadHistoryButton){this.loadHistoryButton=null;this.createLoadHistoryButton();}
if(!this.isSendToEveryone){if(this.chat.AoAbrirConversa)this.chat.AoAbrirConversa.call($mainform(),this.data.id,this.isGroup());}}else{this.chat.activeConvUserState.innerHTML="";this.chat.activeConvUserName.innerHTML="";this.chat.activeConvDiv.onscroll=null;if(this.chat.activeConvUserPicture){this.chat.activeConvUserPicture.className="d-none";this.chat.activeConvUserPicture.src="";this.chat.activeConvUserPicture.alt="";}
if(this.chat.activeConvUserPictureLink)this.chat.activeConvUserPictureLink.href="#";if(this.chat.activeConvUserPictureDefault)this.chat.activeConvUserPictureDefault.className="d-none";this.chat.activeContainer=null;this.chat.activeScreen=0;this.chat.updateLayout();}};HTMLChatContainer.prototype.toggleDetails=function(recreate){var object=this;if(recreate&&!this.isMediaViewOpen){this.isDetailsOpen=false;}
if(this.isDetailsOpen||this.isMediaViewOpen||this.isSendToEveryone){if(this.chat.activeDetailsDiv){this.chat.activeDetailsDiv.innerHTML="";this.chat.activeDetailsDiv.style.setProperty("display","none","important");}
if(!this.isMediaViewOpen){if(this.chat.activeConvUserWrapper){this.chat.activeConvUserWrapper.style.display=null;}
if(this.chat.activeConvBottomDiv){this.chat.activeConvBottomDiv.style.display=null;}
if(this.chat.activeConvUserWrapper){if(this.chat.expandOnClick){this.chat.activeConvUserPicture.parentElement.style.visibility=null;this.chat.activeConvUserPicture.parentElement.style.pointerEvents=null;}else{this.chat.activeConvUserPicture.style.visibility=null;this.chat.activeConvUserPicture.style.pointerEvents=null;}}
if(this.chat.activeConvDiv){this.chat.activeConvDiv.style.display=null;}}
this.isDetailsOpen=false;}else{var oldScrollTop=this.chat.activeDetailsDiv.scrollTop;this.chat.activeDetailsDiv.innerHTML="";if(this.chat.activeConvUserWrapper){this.chat.activeConvUserWrapper.style.setProperty("display","none","important");}
if(this.chat.activeConvBottomDiv){this.chat.activeConvBottomDiv.style.setProperty("display","none","important");}
if(this.chat.activeConvUserPicture){if(this.chat.expandOnClick){this.chat.activeConvUserPicture.parentElement.style.setProperty("visibility","hidden","important");this.chat.activeConvUserPicture.parentElement.style.pointerEvents="none";}else{this.chat.activeConvUserPicture.style.setProperty("visibility","hidden","important");this.chat.activeConvUserPicture.style.pointerEvents="none";}}
var infoWrapperDiv=document.createElement("div");infoWrapperDiv.className="d-flex flex-column align-items-center justify-content-center p-3 p-sm-4 border-bottom";this.chat.activeDetailsDiv.appendChild(infoWrapperDiv);var containerPhotoElem=document.createElement("div");containerPhotoElem.className="d-flex align-items-center justify-content-center vw-100 vh-100 bg-light text-muted border rounded-circle";containerPhotoElem.style.backgroundRepeat="no-repeat";containerPhotoElem.style.backgroundSize="cover";containerPhotoElem.style.backgroundPosition="center center";containerPhotoElem.style.maxWidth="10rem";containerPhotoElem.style.maxHeight="10rem";if(this.itemPicture&&this.itemPicture.src&&this.itemPicture.src.length>0){if(this.chat.expandOnClick){var containerPhotoElemLink=document.createElement("a");containerPhotoElemLink.href=this.itemPicture.src;containerPhotoElemLink.appendChild(containerPhotoElem);infoWrapperDiv.appendChild(containerPhotoElemLink);}else{infoWrapperDiv.appendChild(containerPhotoElem);}
containerPhotoElem.style.backgroundImage="url('"+this.itemPicture.src+"')";if(this.chat.expandOnClick){try{$(containerPhotoElemLink).fancybox({closeExisting:true,keyboard:true,arrows:true,protect:true});}catch(e){}}}else{infoWrapperDiv.appendChild(containerPhotoElem);containerPhotoElem.style.backgroundImage=null;var containerIconElem=document.createElement("i");containerIconElem.className="fas fa-"+(this.isGroup()?"users":"user");containerIconElem.style.fontSize="2rem";containerPhotoElem.appendChild(containerIconElem);}
var containerNameElem=document.createElement("h5");containerNameElem.className="mt-4 mb-0";containerNameElem.innerText=this.data?this.data.name:"";infoWrapperDiv.appendChild(containerNameElem);if(this.isGroup()){var groupIsCurrentUserAdminVal=this.groupIsCurrentUserAdmin();var usersList=document.createElement("div");usersList.className="list-group list-group-flush w-100 border-0";this.chat.activeDetailsDiv.appendChild(usersList);if(this.data&&this.data.users&&this.data.users.length>0){for(var i=0;i<this.data.users.length;i++){(function(userId){var user=object.chat.getUserById(userId);if(user&&user.data){var userItem=object.chat.designContainerItem(usersList,user.data,i,null,object.chat.allowCreateGroups&&groupIsCurrentUserAdminVal?false:null);var userItemDiv=userItem[0];userItemDiv.style.overflow="visible";if(object.groupIsUserAdmin(userId)){var adminBadge=document.createElement("div");adminBadge.className="badge badge-secondary ml-2";adminBadge.innerText=getLocaleMessage("LABEL.CHAT_ADMINISTRATOR");userItemDiv.appendChild(adminBadge);}
if(object.chat.allowCreateGroups&&groupIsCurrentUserAdminVal){var dropdownDiv=document.createElement("div");dropdownDiv.className="dropdown";userItemDiv.appendChild(dropdownDiv);var editUserButton=document.createElement("button");editUserButton.type="button";editUserButton.id="chat-"+object.chat.code+"-group-user-"+i;editUserButton.className="btn btn-secondary dropdown-toggle ml-3";editUserButton.setAttribute("data-toggle","dropdown");editUserButton.setAttribute("aria-haspopup","true");editUserButton.setAttribute("aria-expanded","false");dropdownDiv.appendChild(editUserButton);var editUserButtonIcon=document.createElement("i");editUserButtonIcon.className="fas fa-pencil-alt";editUserButton.appendChild(editUserButtonIcon);var editDropdownMenu=document.createElement("div");editDropdownMenu.className="dropdown-menu dropdown-menu-right";editDropdownMenu.setAttribute("aria-labelledby",editUserButton.id);dropdownDiv.appendChild(editDropdownMenu);if(user.data.id!=object.chat.user.data.id){var removeUserItem=document.createElement("a");removeUserItem.href="#";removeUserItem.className="dropdown-item d-flex align-items-center";editDropdownMenu.appendChild(removeUserItem);var removeUserItemIcon=document.createElement("span");removeUserItemIcon.className="fas fa-user-times mr-3";removeUserItem.appendChild(removeUserItemIcon);var removeUserItemText=document.createElement("span");removeUserItemText.innerText=getLocaleMessage("LABEL.CHAT_REMOVE_USER");removeUserItem.appendChild(removeUserItemText);removeUserItem.addEventListener("click",function(){object.groupRemoveUsers([userId]);});}else{var exitGroupItem=document.createElement("a");exitGroupItem.href="#";exitGroupItem.className="dropdown-item d-flex align-items-center";editDropdownMenu.appendChild(exitGroupItem);var exitGroupItemIcon=document.createElement("span");exitGroupItemIcon.className="fas fa-sign-out-alt mr-3";exitGroupItem.appendChild(exitGroupItemIcon);var exitGroupItemText=document.createElement("span");exitGroupItemText.innerText=getLocaleMessage("LABEL.CHAT_EXIT_GROUP");exitGroupItem.appendChild(exitGroupItemText);exitGroupItem.addEventListener("click",function(){object.groupExit();});}
var toggleAdminUserItem=document.createElement("a");toggleAdminUserItem.href="#";toggleAdminUserItem.className="dropdown-item d-flex align-items-center";editDropdownMenu.appendChild(toggleAdminUserItem);var toggleAdminUserItemIcon=document.createElement("span");toggleAdminUserItemIcon.className="fas fa-user-shield mr-3";toggleAdminUserItem.appendChild(toggleAdminUserItemIcon);var toggleAdminUserItemText=document.createElement("span");toggleAdminUserItemText.innerText=object.groupIsUserAdmin(userId)?getLocaleMessage("LABEL.CHAT_GROUP_UNSET_ADMIN"):getLocaleMessage("LABEL.CHAT_GROUP_SET_ADMIN");toggleAdminUserItem.appendChild(toggleAdminUserItemText);toggleAdminUserItem.addEventListener("click",function(){if(object.groupIsUserAdmin(userId)){object.groupUnsetAdmin([userId]);}else{object.groupSetAdmin([userId]);}});}}})(this.data.users[i]);}}
if(this.chat.allowCreateGroups){if(groupIsCurrentUserAdminVal){var addUserButton=document.createElement("button");addUserButton.type="button";addUserButton.className="list-group-item btn btn-light d-flex align-items-center justify-content-center text-center text-muted border-top-0 border-bottom border-left-0 border-right-0 p-3 mb-4";addUserButton.innerText=getLocaleMessage("LABEL.CHAT_ADD_USERS");usersList.appendChild(addUserButton);addUserButton.addEventListener("click",function(){object.chat.openGroupModal(object.data,1);});var editGroupButton=document.createElement("button");editGroupButton.type="button";editGroupButton.className="list-group-item btn btn-light d-flex align-items-center justify-content-center text-center text-muted border-top border-bottom border-left-0 border-right-0 p-3";editGroupButton.innerText=getLocaleMessage("LABEL.CHAT_EDIT_GROUP");usersList.appendChild(editGroupButton);editGroupButton.addEventListener("click",function(){object.chat.openGroupModal(object.data,0);});var deleteGroupButton=document.createElement("button");deleteGroupButton.type="button";deleteGroupButton.className="list-group-item btn btn-light d-flex align-items-center justify-content-center text-center text-muted border-top-0 border-bottom border-left-0 border-right-0 p-3 mb-4";deleteGroupButton.innerText=getLocaleMessage("LABEL.CHAT_DELETE_GROUP");usersList.appendChild(deleteGroupButton);deleteGroupButton.addEventListener("click",function(){object.groupDelete();});}
var exitGroupButton=document.createElement("button");exitGroupButton.type="button";exitGroupButton.className="list-group-item btn btn-light d-flex align-items-center justify-content-center text-center text-muted border-top border-bottom border-left-0 border-right-0 p-3 my-4";exitGroupButton.innerText=getLocaleMessage("LABEL.CHAT_EXIT_GROUP");usersList.appendChild(exitGroupButton);exitGroupButton.addEventListener("click",function(){object.groupExit();});}}else if(this.isUser()){var userInfoList=document.createElement("div");userInfoList.className="list-group list-group-flush w-100 border-bottom";this.chat.activeDetailsDiv.appendChild(userInfoList);var designUserInfoItem=function(icon,title,content){var userInfoItemDiv=document.createElement("div");userInfoItemDiv.className="list-group-item list-group-item-action d-flex flex-row flex-nowrap align-items-center";userInfoList.appendChild(userInfoItemDiv);if(icon&&icon.length>0){var userInfoIcon=document.createElement("i");userInfoIcon.className=icon+" mr-3";userInfoIcon.style.fontSize="1.5rem";userInfoItemDiv.appendChild(userInfoIcon);}
var userInfoItemWrapperDiv=document.createElement("div");userInfoItemWrapperDiv.className="d-flex flex-column justify-content-center";userInfoItemDiv.appendChild(userInfoItemWrapperDiv);var userInfoTitleElem=document.createElement("h6");userInfoTitleElem.className="font-weight-bold mb-0";userInfoTitleElem.innerText=title;userInfoItemWrapperDiv.appendChild(userInfoTitleElem);var userInfoContentElem=document.createElement("p");userInfoContentElem.className="text-muted mb-0";userInfoContentElem.innerText=content;userInfoItemWrapperDiv.appendChild(userInfoContentElem);};if(this.data){if(this.data.name&&this.data.name.length>0)designUserInfoItem("fas fa-user",getLocaleMessage("LABEL.NAME"),this.data.name);if(this.chat.showUserStates&&this.data.state){switch(this.data.state){case 1:designUserInfoItem("fas fa-clock",getLocaleMessage("LABEL.CHAT_LAST_SEEN"),getLocaleMessage("LABEL.CHAT_ONLINE"));break;case 2:designUserInfoItem("fas fa-clock",getLocaleMessage("LABEL.CHAT_LAST_SEEN"),this.chat.formatLastSeen(this.chat.showLastSeen&&this.data.lastSeen?moment(this.data.lastSeen).local():null));break;default:designUserInfoItem("fas fa-clock",getLocaleMessage("LABEL.CHAT_LAST_SEEN"),getLocaleMessage("LABEL.CHAT_OFFLINE"));break;}}}}
if(this.chat.activeDetailsDiv)this.chat.activeDetailsDiv.style.display=null;if(this.chat.activeConvDiv)this.chat.activeConvDiv.style.setProperty("display","none","important");if(recreate){if(this.chat.activeDetailsDiv)this.chat.activeDetailsDiv.scrollTop=oldScrollTop;}
this.isDetailsOpen=true;}
this.chat.updateLayout();};HTMLChatContainer.prototype.groupRemoveUsers=function(users){if(!this.isGroup()||!this.groupIsCurrentUserAdmin()||!users||users.length==0)return false;var object=this;this.requestAction("&type=g&typeAction=remove",{users:users},function(){for(var i=0;i<users.length;i++){if(object.data&&object.data.users&&object.data.users.length>0){var userIndex=object.data.users.indexOf(users[i]);if(userIndex>=0)object.data.users.splice(userIndex,1);}
if(object.data&&object.data.admins&&object.data.admins.length>0){var adminIndex=object.data.admins.indexOf(users[i]);if(adminIndex>=0)object.data.admins.splice(adminIndex,1);}}},true);};HTMLChatContainer.prototype.groupAddUsers=function(users){if(!this.isGroup()||!this.groupIsCurrentUserAdmin()||!users||users.length==0)return false;var object=this;this.requestAction("&type=g&typeAction=add",{users:users},function(){if(object.data&&object.data.users){for(var i=0;i<users.length;i++){object.data.users.push(users[i]);}}},true);};HTMLChatContainer.prototype.groupSetAdmin=function(users){if(!this.isGroup()||!this.groupIsCurrentUserAdmin()||!users||users.length==0)return false;var object=this;this.requestAction("&type=g&typeAction=setAdmin",{users:users},function(){if(object.data){if(!object.data.admins)object.data.admins=[];for(var i=0;i<users.length;i++){var adminIndex=object.data.admins.indexOf(users[i]);if(adminIndex<0)object.data.admins.push(users[i]);}}},true);};HTMLChatContainer.prototype.groupUnsetAdmin=function(users){if(!this.isGroup()||!this.groupIsCurrentUserAdmin()||!users||users.length==0)return false;var object=this;this.requestAction("&type=g&typeAction=unsetAdmin",{users:users},function(){if(object.data&&object.data.admins&&object.data.admins.length>0){for(var i=0;i<users.length;i++){var adminIndex=object.data.admins.indexOf(users[i]);if(adminIndex>=0)object.data.admins.splice(adminIndex,1);}}},true);};HTMLChatContainer.prototype.groupDelete=function(){if(!this.isGroup()||!this.groupIsCurrentUserAdmin())return false;var object=this;var confirmModal=bootstrapCreateModal(getLocaleMessage("INFO.CHAT_DELETE_GROUP_TITLE"),true,"<p class=\"mb-0\">"+getLocaleMessage("INFO.CHAT_DELETE_GROUP_NOTICE")+"</p>",null);confirmModal[0].className="chat-modal "+confirmModal[0].className;confirmModal[3].className+=" d-flex align-items-center justify-content-end";var cancelButton=document.createElement("button");cancelButton.type="button";cancelButton.className="btn btn-secondary ml-2";cancelButton.innerText=getLocaleMessage("LABEL.CANCEL");cancelButton.setAttribute("data-dismiss","modal");confirmModal[3].appendChild(cancelButton);var confirmButton=document.createElement("button");confirmButton.type="button";confirmButton.className="btn btn-danger ml-2";confirmButton.innerText=getLocaleMessage("LABEL.DELETE");confirmModal[3].appendChild(confirmButton);confirmButton.addEventListener("click",function(){bootstrapCloseModal(confirmModal[0]);confirmModal=null;object.requestAction("&type=g&typeAction=delete",{},function(){if(object.isDetailsOpen){object.toggleDetails();}
object.chat.updateData();},false);});};HTMLChatContainer.prototype.groupExit=function(){if(!this.isGroup())return false;var object=this;this.requestAction("&type=g&typeAction=exit",{},function(){if(object.isDetailsOpen){object.toggleDetails();}
object.chat.updateData();},false);};HTMLChatContainer.prototype.requestAction=function(urlParams,bodyParams,successCallback,failCallback,shouldRefresh){var object=this;$.post(this.chat.getRequestURL()+"&req="+URLEncode(this.data.id,"GET")+"&reqType="+URLEncode(this.data.type,"GET")+urlParams,bodyParams,function(response){if(response&&response.success){if(successCallback&&typeof successCallback==='function'){successCallback(response);}
if(shouldRefresh!==false){if(object.isDetailsOpen){object.toggleDetails(true);}
object.setState(null,null);}}else{if(failCallback&&typeof failCallback==='function'){failCallback(response);}
new HTMLMessage().showErrorMessage(getLocaleMessage("ERROR.OPERATION_ERROR"),null,null,response.details);}}).fail(function(e){if(failCallback&&typeof failCallback==='function'){failCallback(e);}
new HTMLMessage().showErrorMessage(getLocaleMessage("ERROR.CONNECTION_FAIL"));});};HTMLChatContainer.prototype.setState=function(state,lastSeen){if(this.isUser()){if(this.data&&state!==undefined&&state!==null)this.data.state=state;if(this.data&&lastSeen!==undefined&&lastSeen!==null)this.data.lastSeen=lastSeen;if(this.active){if(this.chat.showUserStates&&this.data&&this.data.state){switch(this.data.state){case 1:this.chat.activeConvUserState.innerText=getLocaleMessage("LABEL.CHAT_ONLINE");break;case 2:this.chat.activeConvUserState.innerText=this.chat.formatLastSeen(this.chat.showLastSeen&&this.data.lastSeen?moment(this.data.lastSeen).local():null);break;default:this.chat.activeConvUserState.innerText=getLocaleMessage("LABEL.CHAT_OFFLINE");break;}}else{this.chat.activeConvUserState.innerHTML="";}}}else if(this.isGroup()){if(this.active){if(this.data&&this.data.users&&this.data.users.length>0){var labelContent="";for(var i=0;i<this.data.users.length;i++){var user=this.chat.getUserById(this.data.users[i]);if(user&&user.data&&user.data.name){labelContent+=(user.data.name.indexOf(" ")>=0?user.data.name.split(" ")[0]:user.data.name)+
(i<this.data.users.length-1?", ":"");}}
if(labelContent.endsWith(", ")){labelContent=labelContent.substring(0,labelContent.length-2);}
this.chat.activeConvUserState.innerText=labelContent.trim();}else{this.chat.activeConvUserState.innerHTML="";}}}};HTMLChatContainer.prototype.getState=function(){return(this.data&&this.data.state!==undefined&&this.data.state!==null?this.data.state:0);};HTMLChatContainer.prototype.isOnline=function(){return this.getState()==1;};HTMLChatContainer.prototype.createPreloader=function(){try{if(!this.preloader){this.preloader=document.createElement("div");this.preloader.className="chat-container-preloader d-flex align-items-center justify-content-center py-3";var spinner=bootstrapCreateSpinner(this.preloader,"text-secondary",false);spinner[0].style.fontSize="1rem";spinner[0].style.width="1.7rem";spinner[0].style.height="1.7rem";if(this.chat.activeConvDiv.childElementCount>0){this.chat.activeConvDiv.insertBefore(this.preloader,this.chat.activeConvDiv.firstChild);}else{this.chat.activeConvDiv.appendChild(this.preloader);}
this.chat.activeConvDiv.scrollTop=0;}}catch(e){}};HTMLChatContainer.prototype.removePreloader=function(){try{if(this.preloader){this.chat.activeConvDiv.removeChild(this.preloader);this.preloader=null;}}catch(e){}};HTMLChatContainer.prototype.createLoadHistoryButton=function(){this.hasLoadHistoryButton=true;try{if(!this.loadHistoryButton){this.loadHistoryButton=document.createElement("div");this.loadHistoryButton.className="chat-container-history-button d-flex align-items-center justify-content-center py-3";var loadHistoryButtonElem=document.createElement("button");loadHistoryButtonElem.type="button";loadHistoryButtonElem.className="btn btn-outline-secondary btn-sm";loadHistoryButtonElem.innerText=getLocaleMessage("LABEL.CHAT_LOAD_MORE")+"...";this.loadHistoryButton.appendChild(loadHistoryButtonElem);var object=this;loadHistoryButtonElem.addEventListener("click",function(){object.getHistoryMessages();});if(this.chat.activeConvDiv.childElementCount>0){this.chat.activeConvDiv.insertBefore(this.loadHistoryButton,this.chat.activeConvDiv.firstChild);}else{this.chat.activeConvDiv.appendChild(this.loadHistoryButton);}}}catch(e){}};HTMLChatContainer.prototype.removeLoadHistoryButton=function(){this.hasLoadHistoryButton=false;try{if(this.loadHistoryButton){this.chat.activeConvDiv.removeChild(this.loadHistoryButton);this.loadHistoryButton=null;}}catch(e){}};HTMLChatContainer.prototype.setLastMessageContent=function(msg){var messageContent=null;if(this.data)this.data.lastMessage=msg;if(this.itemLast){if(msg!==null&&msg!==undefined){this.itemLast.innerHTML="";if(typeof msg==="object"){if(msg.attachment){var fileIcon=document.createElement("i");fileIcon.className="d-inline-block mr-2 "+this.getFileIcon(msg.attachment.mimeType);this.itemLast.appendChild(fileIcon);var messageContentElem=document.createElement("span");messageContentElem.className="d-inline-block";this.itemLast.appendChild(messageContentElem);if(msg.message&&msg.message.length>0){messageContent=msg.message.replace(/\r?\n|\r/g," ");}else{var attachmentType=msg.attachment.mimeType.toLowerCase().split('/')[0];if(attachmentType=="image")messageContent=getLocaleMessage("LABEL.IMAGE");else if(attachmentType=="video")messageContent=getLocaleMessage("LABEL.VIDEO");else if(attachmentType=="audio")messageContent=getLocaleMessage("LABEL.AUDIO");else messageContent=getLocaleMessage("LABEL.FILE");}
if(this.isGroup()&&this.chat.user&&this.chat.user.data&&msg.from!=this.chat.user.data.id){var user=this.chat.getUserById(msg.from);if(user&&user.data&&user.data.name){var firstName=user.data.name.indexOf(" ")>=0?user.data.name.split(" ")[0]:user.data.name;messageContent=firstName+": "+messageContent;}}
messageContentElem.innerText=(messageContent.length>25)?messageContent.substring(0,25)+"...":messageContent;messageContent=null;}else{messageContent=msg.message;}}else if(typeof msg==="string"){messageContent=msg;}
if(messageContent){if(this.isGroup()&&this.chat.user&&this.chat.user.data&&msg.from!=this.chat.user.data.id){var user=this.chat.getUserById(msg.from);if(user&&user.data&&user.data.name){var firstName=user.data.name.indexOf(" ")>=0?user.data.name.split(" ")[0]:user.data.name;messageContent=firstName+": "+messageContent;}}
messageContent=messageContent.replace(/\r?\n|\r/g," ");this.itemLast.innerText=(messageContent.length>25)?messageContent.substring(0,25)+"...":messageContent;}}}};HTMLChatContainer.prototype.sendPendingReadConfirmations=function(){if(this.pendingReadConfirmations&&this.pendingReadConfirmations.length>0){for(var i=0;i<this.pendingReadConfirmations.length;i++){this.chat.socket.send(JSON.stringify(this.pendingReadConfirmations[i]));if(this.unreadMessages>0)this.setTotalUnreadMessages(this.unreadMessages-1);}
this.pendingReadConfirmations=[];}};HTMLChatContainer.prototype.handleMessage=function(msg,top){var object=this;if(this.getMessageById(msg.id))return false;var messageSendReceived=function(){if((!msg.status||msg.status<2)){object.chat.socket.send(JSON.stringify({type:"received",id:msg.id,from:msg.from,destination:msg.destination}));}};var messageElem=null;var date=moment(msg.time).local();var internalMessage=(msg.from===this.chat.user.data.id);if(msg.wasHold&&!internalMessage&&this.chat.saveHistory&&!this.historyRequested){messageSendReceived();return;}
if(!this.isSendToEveryone&&!msg.everyone&&!top)this.moveToTop();if(!this.olderMessage||date.isBefore(moment(this.olderMessage.time).local())){this.olderMessage=msg;}
if(!this.newerMessage||date.isAfter(moment(this.newerMessage.time).local())){this.newerMessage=msg;this.setLastMessageContent(msg);}
var section=this.createSection(date,top);if(this.active){var onBottom=(this.chat.activeConvDiv.scrollTop>=this.chat.activeConvDiv.scrollHeight-
this.chat.activeConvDiv.clientHeight);messageElem=this.designMessage(msg,section,top);if(onBottom)this.scrollToBottom();if(!internalMessage&&!msg.sentConfirmation&&(!msg.status||msg.status<3)){messageSendReceived();var readConfirmationMsg={type:"read",id:msg.id+"-r",messageId:msg.id,from:this.chat.user.data.id,destination:msg.from};if(this.chat.shouldSendReadConfirmations()){this.chat.socket.send(JSON.stringify(readConfirmationMsg));if(this.unreadMessages>0)this.setTotalUnreadMessages(this.unreadMessages-1);}else{if(!this.pendingReadConfirmations)this.pendingReadConfirmations=[];this.pendingReadConfirmations.push(readConfirmationMsg);}
msg.sentConfirmation=true;}}else if(!internalMessage){messageSendReceived();this.setTotalUnreadMessages(this.unreadMessages+1);}
if(top)section.messages.unshift(msg);else section.messages.push(msg);if(!this.isSendToEveryone&&!internalMessage&&!top&&this.chat.shouldShowDesktopNotifications()){var attachmentUrl=msg.attachment&&msg.attachment.url?msg.attachment.url:msg.attachment&&msg.attachment.serverName?this.chat.getRequestURL()+"&type=a&req="+URLEncode(msg.attachment.serverName,"GET"):null;this.chat.showDesktopNotification(this.data.name,this.itemPicture.src,(attachmentUrl?attachmentUrl:null),msg.message,date.unix());}
return messageElem;};HTMLChatContainer.prototype.scrollToBottom=function(){this.chat.activeConvDiv.scrollTop=this.chat.activeConvDiv.scrollHeight-this.chat.activeConvDiv.clientHeight;this.scroll=this.chat.activeConvDiv.scrollTop;};HTMLChatContainer.prototype.moveToTop=function(){if(!this.isSendToEveryone&&this.item)this.chat.usersList.insertBefore(this.item,this.chat.usersList.firstChild);};HTMLChatContainer.prototype.designSection=function(date,top){var today=moment();var sectionDiv=document.createElement("div");sectionDiv.className="chat-message-section d-flex align-items-center justify-content-center my-3";var sectionDateDiv=document.createElement("div");sectionDateDiv.className="bg-secondary text-white my-1 px-3 py-1 rounded";sectionDateDiv.innerText=date.isSame(today,"day")?getLocaleMessage("LABEL.TODAY"):date.isSame(today.subtract(1,"days"),"day")?getLocaleMessage("LABEL.YESTERDAY"):date.format(this.chat.dateFormat);sectionDiv.appendChild(sectionDateDiv);if(top&&this.chat.activeConvDiv.childElementCount>0)
this.chat.activeConvDiv.insertBefore(sectionDiv,this.chat.activeConvDiv.firstChild);else this.chat.activeConvDiv.appendChild(sectionDiv);return sectionDiv;};HTMLChatContainer.prototype.designMessage=function(msg,section,top){var object=this;var internalMessage=(msg.from===this.chat.user.data.id);var messageStatusDiv=null;var messageFromElem=null;var messageRowDiv=document.createElement("div");messageRowDiv.className="w-100 d-flex flex-column "+
(internalMessage?"align-items-end":"align-items-start");var messageDiv=document.createElement("div");messageDiv.className=internalMessage?"chat-message chat-message-same-origin position-relative d-flex flex-column w-auto h-auto overflow-hidden my-1 bg-white text-dark border rounded shadow-sm mw-sm-50":"chat-message chat-message-external-origin position-relative d-flex flex-column w-auto h-auto overflow-hidden my-1 bg-dark text-white rounded shadow-sm mw-sm-50";messageDiv.style.maxWidth="75%";messageRowDiv.appendChild(messageDiv);if(!internalMessage&&this.isGroup()){var senderUser=this.chat.getUserById(msg.from);messageFromElem=document.createElement("a");messageFromElem.href="#";messageFromElem.className="chat-message-from font-weight-bold text-truncate mw-100 overflow-hidden pt-2 px-3"+
(internalMessage?" text-dark":" text-white");if(senderUser&&senderUser.data&&senderUser.data.name){messageFromElem.innerText=this.chat.formatName(senderUser.data.name);if(!this.groupContainsUser(msg.from)){messageFromElem.style.textDecoration="line-through";messageFromElem.style.opacity="0.7";}}else{messageFromElem.innerText="("+getLocaleMessage("LABEL.UNKNOWN")+")";messageFromElem.style.textDecoration="italic";}
messageDiv.appendChild(messageFromElem);messageFromElem.addEventListener("click",function(e){e.preventDefault();if(senderUser)senderUser.setActive(true);});}
if(msg.attachment&&msg.attachment.mimeType){var attachmentUrl=msg.attachment.url?msg.attachment.url:msg.attachment.serverName?this.chat.getRequestURL()+"&type=a&req="+
URLEncode(msg.attachment.serverName,"GET"):"";var attachmentType=msg.attachment.mimeType.toLowerCase().split('/')[0];var isVisualMedia=false;var visualMediaElem=null;var attachmentDiv=null;if(attachmentType=="image"||attachmentType=="video"){attachmentDiv=document.createElement("a");attachmentDiv.href=attachmentUrl;attachmentDiv.className="chat-message-attachment position-relative overflow-hidden text-decoration-none";attachmentDiv.isAttachmentLink=true;messageDiv.appendChild(attachmentDiv);}else{attachmentDiv=document.createElement("div");attachmentDiv.className="chat-message-attachment position-relative overflow-hidden";messageDiv.appendChild(attachmentDiv);}
var initFancybox=function(){if(isVisualMedia){try{$(attachmentDiv).fancybox({closeExisting:true,keyboard:true,arrows:true,protect:true});}catch(e){}}};if(this.chat.AoCarregarMidia!==undefined&&this.chat.AoCarregarMidia!==null){var removeExtension=function(filename){try{var lastDotPosition=filename.lastIndexOf(".");if(lastDotPosition===-1)return filename;return filename.substr(0,lastDotPosition);}catch(e){}
return filename;};var result=this.chat.AoCarregarMidia.call($mainform(),removeExtension(msg.attachment.serverName),msg.attachment.mimeType,msg.attachment.name);if(result!==undefined&&result!==null){attachmentUrl=result;}}
if(attachmentType=="image"){var mediaImg=document.createElement("img");if(this.BLUR_RADIUS<=0)mediaImg.className="w-100";else mediaImg.className="img-fluid w-100";mediaImg.src=attachmentUrl;attachmentDiv.appendChild(mediaImg);isVisualMedia=true;visualMediaElem=mediaImg;if(messageFromElem)messageFromElem.className+=" pb-2";}else if(attachmentType=="video"){var mediaVideo=document.createElement("video");if(this.BLUR_RADIUS<=0)mediaVideo.className="w-100";else mediaVideo.className="img-fluid w-100";mediaVideo.style.pointerEvents="none";mediaVideo.controls=false;mediaVideo.autoplay=false;mediaVideo.muted=true;mediaVideo.src=attachmentUrl;attachmentDiv.appendChild(mediaVideo);isVisualMedia=true;visualMediaElem=mediaVideo;if(messageFromElem)messageFromElem.className+=" pb-2";var videoOverlayDiv=document.createElement("div");videoOverlayDiv.className="position-absolute w-100 h-100 d-flex align-items-center justify-content-center";videoOverlayDiv.style.top="0px";videoOverlayDiv.style.bottom="0px";videoOverlayDiv.style.left="0px";videoOverlayDiv.style.right="0px";videoOverlayDiv.style.pointerEvents="none";videoOverlayDiv.style.zIndex="10000000";attachmentDiv.appendChild(videoOverlayDiv);var playButton=document.createElement("button");playButton.type="button";playButton.style.pointerEvents="all";playButton.className="btn btn-light btn-lg rounded-circle shadow px-3 py-2";playButton.style.width="3.5rem";playButton.style.height="3.5rem";videoOverlayDiv.appendChild(playButton);var playButtonIcon=document.createElement("i");playButtonIcon.className="fas fa-play my-2";playButton.appendChild(playButtonIcon);}else if(attachmentType=="audio"){var isPlaying=false;var mediaDiv=document.createElement("div");mediaDiv.className="d-flex flex-row flex-nowrap align-items-center w-100 pt-2 pl-3 pr-3";attachmentDiv.appendChild(mediaDiv);var mediaAudio=document.createElement("audio");mediaAudio.className="d-none";mediaAudio.controls=false;mediaAudio.autoplay=false;mediaAudio.src=attachmentUrl;mediaDiv.appendChild(mediaAudio);var playButton=document.createElement("button");playButton.type="button";playButton.className="btn btn-link btn-lg rounded-circle px-2 py-1 mr-3"+
(internalMessage?" text-dark":" text-white");playButton.style.overflow="visible";mediaDiv.appendChild(playButton);var playButtonIcon=document.createElement("i");playButtonIcon.className="fas fa-play";playButton.appendChild(playButtonIcon);var timeSlider=document.createElement("input");timeSlider.type="range";timeSlider.className="custom-range flex-fill";timeSlider.min="0";timeSlider.value="0";timeSlider.step="500";mediaDiv.appendChild(timeSlider);var timeLabel=document.createElement("span");timeLabel.className="ml-3";mediaDiv.appendChild(timeLabel);var timeSpinner=bootstrapCreateSpinner(timeLabel,"text-dark",false);timeSpinner[0].style.width="1.25rem";timeSpinner[0].style.height="1.25rem";timeSpinner[0].style.fontSize="0.9rem";isVisualMedia=false;visualMediaElem=mediaDiv;var updateDuration=function(){var audioDurationMs=isNaN(mediaAudio.duration)||!isFinite(mediaAudio.duration)?0:mediaAudio.duration*1000;var audioPositionMs=mediaAudio.currentTime*1000;if(isPlaying)timeLabel.innerText=moment.utc(audioPositionMs).format("mm:ss");else timeLabel.innerText=moment.utc(audioDurationMs).format("mm:ss");timeSlider.max=audioDurationMs.toString();timeSlider.value=audioPositionMs.toString();};mediaAudio.addEventListener("loadedmetadata",updateDuration);mediaAudio.addEventListener("durationchange",updateDuration);mediaAudio.addEventListener("timeupdate",updateDuration);mediaAudio.addEventListener("playing",function(){isPlaying=true;playButtonIcon.className="fas fa-pause";});mediaAudio.addEventListener("paused",function(){isPlaying=false;playButtonIcon.className="fas fa-play";});mediaAudio.addEventListener("ended",function(){isPlaying=false;playButtonIcon.className="fas fa-play";mediaAudio.currentTime=0;updateDuration();});playButton.addEventListener("click",function(){if(isPlaying){mediaAudio.pause();isPlaying=false;playButtonIcon.className="fas fa-play";}else{mediaAudio.play();}});var changeTime=function(){var isPaused=false;if(isPlaying){mediaAudio.pause();isPaused=true;}
mediaAudio.currentTime=parseInt(timeSlider.value)/1000;if(isPaused)mediaAudio.play();};if(isIE||isIE11)timeSlider.addEventListener("change",changeTime);else timeSlider.addEventListener("input",changeTime);}else{var mediaDiv=document.createElement("div");mediaDiv.className="w-100 pt-2 pl-2 pr-2";attachmentDiv.appendChild(mediaDiv);var mediaWrapperDiv=document.createElement("a");mediaWrapperDiv.className="d-flex flex-row flex-nowrap align-items-center px-3 py-2 rounded text-decoration-none"+
(internalMessage?" text-muted":" text-white");mediaWrapperDiv.href=attachmentUrl;mediaWrapperDiv.setAttribute("download",msg.attachment.name);mediaDiv.appendChild(mediaWrapperDiv);if(internalMessage){mediaWrapperDiv.className+=" bg-light border";}else{mediaWrapperDiv.style.backgroundColor="rgba(255, 255, 255, 0.2)";}
var mediaFileIcon=document.createElement("i");mediaFileIcon.className="mr-2 "+this.getFileIcon(msg.attachment.mimeType);mediaFileIcon.style.fontSize="1.5rem";mediaWrapperDiv.appendChild(mediaFileIcon);var mediaFileName=document.createElement("span");mediaFileName.className="text-truncate font-weight-bold";mediaFileIcon.style.fontSize="1.15rem";mediaFileName.innerText=msg.attachment.name;mediaWrapperDiv.appendChild(mediaFileName);isVisualMedia=false;visualMediaElem=mediaWrapperDiv;}
if(msg.attachment.inProgress){var spinner=null;var spinnerInner=null;var spinnerElem=null;var percentLabel=null;var failStatusElem=null;attachmentDiv.style.pointerEvents="none";if(isVisualMedia&&visualMediaElem){if(this.BLUR_RADIUS>0){visualMediaElem.style.filter="blur("+this.BLUR_RADIUS+"px)";visualMediaElem.style.marginLeft="-"+this.BLUR_RADIUS+"px";visualMediaElem.style.marginTop="-"+this.BLUR_RADIUS+"px";visualMediaElem.style.marginBottom="-"+this.BLUR_RADIUS+"px";visualMediaElem.style.width="calc(100% + "+(this.BLUR_RADIUS*2)+"px)";}
spinner=document.createElement("div");spinner.className="position-absolute w-100 h-100 d-flex align-items-center justify-content-center";spinner.style.top="0px";spinner.style.bottom="0px";spinner.style.left="0px";spinner.style.right="0px";spinner.style.zIndex="10000000";attachmentDiv.appendChild(spinner);spinnerInner=document.createElement("div");spinnerInner.className="bg-light rounded-circle shadow p-2";spinner.appendChild(spinnerInner);spinnerElem=bootstrapCreateSpinner(spinnerInner,"text-dark",false)[0];spinnerElem.className+=" d-flex align-items-center justify-content-center";spinnerElem.style.width="3rem";spinnerElem.style.height="3rem";percentLabel=document.createElement("small");percentLabel.className="position-absolute d-flex flex-fill align-items-center justify-content-center text-center text-dark";percentLabel.style.top="0px";percentLabel.style.left="0px";percentLabel.style.right="0px";percentLabel.style.bottom="0px";spinner.appendChild(percentLabel);}
messageRowDiv.setProgress=function(percent){msg.attachment.progress=percent;if(percentLabel){if(percent<0){percentLabel.innerHTML="";}else{percentLabel.innerText=percent+"%";}}};messageRowDiv.setStatus=function(status){msg.attachment.status=status;if(messageStatusDiv){if(status==0||status==1){messageStatusDiv.className="align-self-end ml-1 far fa-clock";}else if(status==-1){messageStatusDiv.className="align-self-end ml-1 text-danger fas fa-exclamation-triangle";}}
if(status==0||status==1){if(spinner)spinner.style.display=null;if(spinnerElem)spinnerElem.style.display=null;if(percentLabel)percentLabel.style.display=null;if(failStatusElem){if(isVisualMedia)attachmentDiv.removeChild(failStatusElem);else visualMediaElem.removeChild(failStatusElem);failStatusElem=null;}
if(status===1){attachmentDiv.style.pointerEvents=null;if(object.BLUR_RADIUS>0&&isVisualMedia&&visualMediaElem){visualMediaElem.style.filter=null;visualMediaElem.style.marginLeft=null;visualMediaElem.style.marginTop=null;visualMediaElem.style.marginBottom=null;visualMediaElem.style.width=null;}
if(spinner){attachmentDiv.removeChild(spinner);spinner=null;}
initFancybox();if(object.waitingMessages[msg.id]){object.waitingMessages=object.waitingMessages.filter(function(item){return item.id!=msg.id;});}
spinner=null;percentLabel=null;messageRowDiv.setProgress=null;messageRowDiv.setStatus=null;}else{attachmentDiv.style.pointerEvents="none";}}else if(status==-1){attachmentDiv.style.pointerEvents="none";if(spinner)spinner.style.setProperty("display","none","important");if(spinnerElem)spinnerElem.style.setProperty("display","none","important");if(percentLabel)percentLabel.style.setProperty("display","none","important");if(!failStatusElem){if(isVisualMedia){failStatusElem=document.createElement("span");failStatusElem.className="position-absolute d-flex flex-fill align-items-center justify-content-center text-center text-secondary";failStatusElem.style.top="0px";failStatusElem.style.left="0px";failStatusElem.style.right="0px";failStatusElem.style.bottom="0px";failStatusElem.style.zIndex="100";attachmentDiv.appendChild(failStatusElem);}else{failStatusElem=document.createElement("div");visualMediaElem.appendChild(failStatusElem);}
var retryButton=document.createElement("button");retryButton.type="button";retryButton.style.pointerEvents="all";var retryButtonIcon=document.createElement("i");retryButtonIcon.className="fas fa-redo-alt my-2";retryButton.appendChild(retryButtonIcon);if(isVisualMedia){retryButton.className="btn btn-light btn-lg rounded-circle shadow px-3 py-2";retryButton.style.width="3.5rem";retryButton.style.height="3.5rem";}else{retryButton.className="btn btn-light rounded-circle shadow-sm border p-0 ml-3";retryButtonIcon.style.fontSize="0.85rem";retryButton.style.width="1.75rem";retryButton.style.height="1.75rem";}
failStatusElem.appendChild(retryButton);retryButton.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();messageRowDiv.setProgress(0);messageRowDiv.setStatus(0);setTimeout(function(){if(msg&&msg.attachment&&msg.attachment.retry){msg.attachment.retry();}},1000);});}}};if(msg.attachment.progress!==undefined&&msg.attachment.progress!==null)messageRowDiv.setProgress(msg.attachment.progress);if(msg.attachment.status!==undefined&&msg.attachment.status!==null)messageRowDiv.setStatus(msg.attachment.status);}else{initFancybox();}}
var messageWrapperDiv=document.createElement("div");messageWrapperDiv.className="d-flex flex-row px-3 py-2";messageDiv.appendChild(messageWrapperDiv);var messageContentDiv=document.createElement("span");messageContentDiv.className="chat-message-content w-100 h-auto";messageContentDiv.style.wordBreak="break-word";messageContentDiv.innerText=msg.message;messageWrapperDiv.appendChild(messageContentDiv);try{messageContentDiv.innerHTML=messageContentDiv.innerHTML.replace(/((?:(http|https|Http|Https|rtsp|Rtsp):\/\/(?:(?:[a-zA-Z0-9\$\-\_\.\+\!\*\'\(\)\,\;\?\&\=]|(?:\%[a-fA-F0-9]{2})){1,64}(?:\:(?:[a-zA-Z0-9\$\-\_\.\+\!\*\'\(\)\,\;\?\&\=]|(?:\%[a-fA-F0-9]{2})){1,25})?\@)?)?((?:(?:[a-zA-Z0-9][a-zA-Z0-9\-]{0,64}\.)+(?:(?:aero|arpa|asia|a[cdefgilmnoqrstuwxz])|(?:biz|b[abdefghijmnorstvwyz])|(?:cat|com|coop|c[acdfghiklmnoruvxyz])|d[ejkmoz]|(?:edu|e[cegrstu])|f[ijkmor]|(?:gov|g[abdefghilmnpqrstuwy])|h[kmnrtu]|(?:info|int|i[delmnoqrst])|(?:jobs|j[emop])|k[eghimnrwyz]|l[abcikrstuvy]|(?:mil|mobi|museum|m[acdghklmnopqrstuvwxyz])|(?:name|net|n[acefgilopruz])|(?:org|om)|(?:pro|p[aefghklmnrstwy])|qa|r[eouw]|s[abcdeghijklmnortuvyz]|(?:tel|travel|t[cdfghjklmnoprtvwz])|u[agkmsyz]|v[aceginu]|w[fs]|y[etu]|z[amw]))|(?:(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9])\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9]|0)\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9]|0)\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[0-9])))(?:\:\d{1,5})?)(\/(?:(?:[a-zA-Z0-9\;\/\?\:\@\&\=\#\~\-\.\+\!\*\'\(\)\,\_])|(?:\%[a-fA-F0-9]{2}))*)?(?:\b|$)/gi,function(url){return'<a href="'+(url.indexOf("//")<0?"//"+url:url)+'" target="_blank">'+url+'</a>';});}catch(e){}
var messageTimeDiv=document.createElement("span");messageTimeDiv.className="chat-message-time align-self-end ml-3";messageTimeDiv.style.fontSize="0.75rem";messageTimeDiv.style.opacity="0.5";messageTimeDiv.innerText=moment(msg.time).local().format("LT");messageWrapperDiv.appendChild(messageTimeDiv);if(internalMessage){messageStatusDiv=document.createElement("i");messageStatusDiv.className="align-self-end ml-1"+
(msg.everyone?" fas fa-globe":msg.status?((msg.status==1)?" fas fa-check":(msg.status==2)?" fas fa-check-double pb-1":(msg.status==3)?" fas fa-check-double pb-1 text-primary":""):" far fa-clock");messageStatusDiv.style.fontSize="0.75rem";messageStatusDiv.style.opacity=(msg.status&&msg.status==3)?"1.0":"0.5";messageWrapperDiv.appendChild(messageStatusDiv);msg.itemStatus=messageStatusDiv;}
if(top&&section.div)$(messageRowDiv).insertAfter(section.div);else this.chat.activeConvDiv.appendChild(messageRowDiv);if(this.waitingMessages[msg.id]){this.waitingMessages[msg.id].element=messageRowDiv;}
return messageRowDiv;};HTMLChatContainer.prototype.createSection=function(date,top){var section=this.getSectionByDate(date);if(section==null){section={date:date,messages:[]};if(this.active){section.div=this.designSection(section.date,top);}
if(top&&this.sections.length>1)this.sections.unshift(section);else this.sections.push(section);this.sections.sort(function(a,b){return a.date.diff(b.date);});}
return section;};HTMLChatContainer.prototype.getSectionByDate=function(date){if(this.sections&&this.sections.length>0){for(var i=0;i<this.sections.length;i++){if(this.sections[i].date.isSame(date,'day'))return this.sections[i];}}
return null;};HTMLChatContainer.prototype.getMessageById=function(id){if(this.sections&&this.sections.length>0){for(var i=0;i<this.sections.length;i++){var section=this.sections[i];if(section.messages&&section.messages.length>0){for(var j=0;j<section.messages.length;j++){if(section.messages[j].id==id)return section.messages[j];}}}}
return null;};HTMLChatContainer.prototype.setMessageStatus=function(id,status){var message=this.getMessageById(id);if(message){message.status=(!message.status||status>message.status)?status:message.status;if(message.itemStatus){message.itemStatus.className="align-self-end ml-1"+
((status==1)?" fas fa-check":(status==2)?" fas fa-check-double pb-1":(status==3)?" fas fa-check-double pb-1 text-primary":"");if(status==3)message.itemStatus.style.opacity="1.0";}}};HTMLChatContainer.prototype.getTotalMessages=function(){var total=0;if(this.sections&&this.sections.length>0){for(var i=0;i<this.sections.length;i++){var section=this.sections[i];if(section.messages&&section.messages.length>0){total+=section.messages.length;}}}
return total;};HTMLChatContainer.prototype.getTopSection=function(){var topSection=null;if(this.sections&&this.sections.length>0){for(var i=0;i<this.sections.length;i++){var section=this.sections[i];if(topSection==null||section.date.isBefore(topSection.date)){topSection=section;}}}
return topSection;};HTMLChatContainer.prototype.getTopMessage=function(){var topMessage=null;var topSection=this.getTopSection();if(topSection.messages&&topSection.messages.length>0){for(var j=0;j<topSection.messages.length;j++){if(topMessage==null||moment(topSection.messages[j].time).local().isBefore(moment(topMessage.time).local())){topMessage=topSection.messages[j];}}}
return topMessage;};HTMLChatContainer.prototype.getHistoryMessages=function(force,handler){var hasHandler=(handler&&typeof handler==="function");if(!hasHandler){if(this.isSendToEveryone||this.inRequest){if(!this.inRequest){this.removePreloader();}
return;}
this.historyRequested=true;}
var totalMessages=this.getTotalMessages();if(force||!this.historyHasReachedEnd&&(this.chat.activeConvDiv.scrollTop==0||totalMessages<this.chat.loadedMessagesAmount)){var baseURL=this.chat.getRequestURL()+"&type=m&req="+URLEncode(this.data.id,'GET')+"&reqType="+URLEncode(this.data.type,'GET');if(totalMessages>0&&this.olderMessage)baseURL+="&message="+URLEncode(this.olderMessage.id,'GET')+"&direction=0";if(!hasHandler){this.inRequest=true;this.createPreloader();this.removeLoadHistoryButton();}
var object=this;$.get(baseURL,function(response){if(response&&response.messages&&Array.isArray(response.messages)&&response.messages.length>0){if(hasHandler){handler(response.messages);}else{var oldScrollHeight=object.chat.activeConvDiv.scrollHeight;var isScrollOnBottom=(object.chat.activeConvDiv.scrollHeight-
object.chat.activeConvDiv.scrollTop)<=10;for(var i=0;i<response.messages.length;i++){object.handleMessage(response.messages[i],true);}
if(object.active){if(totalMessages==0||isScrollOnBottom)object.scrollToBottom();else{object.setActive(true);object.chat.activeConvDiv.scrollTop=object.chat.activeConvDiv.scrollHeight-oldScrollHeight;}
if(object.chat.activeConvDiv.clientHeight>=object.chat.activeConvDiv.scrollHeight){object.getHistoryMessages(true,function(messages){if(messages&&messages.length>0){object.createLoadHistoryButton();}});}}}}else if(!hasHandler){this.historyHasReachedEnd=true;}
if(!hasHandler){object.inRequest=false;object.removePreloader();}}).fail(function(){if(!hasHandler){object.inRequest=false;object.removePreloader();}});}else if(!hasHandler){this.removePreloader();}};HTMLChatContainer.prototype.setTotalUnreadMessages=function(total){this.unreadMessages=(total<=0)?0:total;this.hasUnreadMessages=(total>0);if(this.itemLastBadge){this.itemLastBadge.innerText=(total>0)?total.toString():"";this.itemLastBadge.className=(total>0)?this.itemLastBadgeClass:"d-none";if(total>0)this.itemLastBadge.style.display=null;}};HTMLChatContainer.prototype.isUser=function(){return this.data&&this.data.type==0;};HTMLChatContainer.prototype.isGroup=function(){return this.data&&this.data.type==1;};HTMLChatContainer.prototype.groupContainsUser=function(userId){return this.data&&this.data.users&&this.data.users.length>0&&this.data.users.indexOf(userId)>=0;};HTMLChatContainer.prototype.groupIsUserAdmin=function(userId){return this.data&&this.data.admins&&this.data.admins.length>0&&this.data.admins.indexOf(userId)>=0;};HTMLChatContainer.prototype.groupIsCurrentUserAdmin=function(){return this.chat&&this.chat.user&&this.chat.user.data&&this.groupIsUserAdmin(this.chat.user.data.id);};HTMLChatContainer.prototype.enqueueFiles=function(files){if(!this.chat||!this.chat.allowSendMedia)return false;if(files&&files.length>0){if(!this.selectedMedias)this.selectedMedias=[];for(var i=0;i<files.length;i++){this.enqueueMedia({file:files[i],description:""},false);}
this.designMediaView();}};HTMLChatContainer.prototype.enqueueMedia=function(media,design){if(!this.chat||!this.chat.allowSendMedia)return false;if(media){if(!this.selectedMedias)this.selectedMedias=[];this.selectedMedias.push(media);if(design!==false)this.designMediaView();}};HTMLChatContainer.prototype.dequeueFile=function(file){if(this.selectedMedias&&this.selectedMedias.length>0)
this.selectedMedias.splice(this.selectedMedias.indexOf(file),1);if(this.selectedPreviewMedia&&this.selectedPreviewMedia==file){this.selectedPreviewMedia=null;this.selectedPreviewMediaElem=null;}
this.designMediaView();};HTMLChatContainer.prototype.sendEnqueuedFiles=function(){if(this.selectedMedias&&this.selectedMedias.length>0){for(var i=0;i<this.selectedMedias.length;i++){this.sendFile(this.selectedMedias[i]);}}
this.clearEnqueuedFiles();};HTMLChatContainer.prototype.sendFile=function(media){var object=this;var message=media.id?this.waitingMessages[media.id]?this.waitingMessages[media.id]:null:null;if(!message){if(!media.id)media.id=this.chat.getUniqueId();message={};message.body={type:"message",id:media.id,message:media.description,from:this.chat.user.data.id,time:moment.utc().toISOString(),attachment:{url:media.url,name:media.file?media.file.name:media.name,size:media.file?media.file.size:null,mimeType:media.file?media.file.type:media.mimeType,inProgress:media.file?true:false,retry:media.file?function(){if(message.element){message.element.setProgress(0);message.element.setStatus(0);}
object.sendFile(media);}:null}};if(media.serverName){message.body.attachment.serverName=media.serverName;}
if(this.isGroup())message.body.group=this.data.id;else message.body.destination=this.data.id;message.element=this.handleMessage(message.body,false);}
if(media.file&&(!message.body.attachment.serverName||message.body.attachment.serverName.length===0)){message.formData=new FormData();message.formData.append("upload",media.file);message.xhr=new XMLHttpRequest();message.xhr.open("POST",this.chat.getFileUploadURL(),true);message.xhr.addEventListener("load",function(e){try{if(message.xhr&&(message.xhr.readyState===4||message.xhr.status===200)&&message.xhr.responseText&&message.xhr.responseText.length>0){if(message.xhr.responseText.indexOf("Exception:")>=0){new HTMLMessage().showErrorMessage(getLocaleMessage("ERROR.OPERATION_ERROR"),null,null,message.xhr.responseText);failCallback();}else{var responseJson=JSON.parse(message.xhr.responseText.trim());if(responseJson&&responseJson.name&&responseJson.name.length>0){if(object.chat&&object.chat.AoEnviarMidia!==undefined&&object.chat.AoEnviarMidia!==null){var removeExtension=function(filename){try{var lastDotPosition=filename.lastIndexOf(".");if(lastDotPosition===-1)return filename;return filename.substr(0,lastDotPosition);}catch(e){}
return filename;};object.chat.AoEnviarMidia.call($mainform(),responseJson.path,removeExtension(responseJson.name),media.file.type,media.file.name);}
message.body.attachment.serverName=responseJson.name;if(message.element)message.element.setStatus(1);message.body.attachment.url=null;message.body.attachment.retry=null;message.body.attachment.inProgress=false;if(media&&(media.type=="video"||media.type=="image")&&message.element){var url="chat/upload/"+responseJson.name;if(media.type=="video"){var videoElement=message.element.getElementsByTagName("video");if(videoElement&&videoElement.length>0){videoElement[0].src=url;}}else if(media.type=="image"){var imageElement=message.element.getElementsByTagName("img");if(imageElement&&imageElement.length>0){imageElement[0].src=url;}}
var linkElements=message.element.getElementsByTagName("a");if(linkElements&&linkElements.length>0){for(var i=0;i<linkElements.length;i++){if(linkElements[i].isAttachmentLink){linkElements[i].href=url;try{$(linkElements[i]).unbind("click.fb");$(linkElements[i]).unbind("click.fb-start");$(linkElements[i]).fancybox({closeExisting:true,keyboard:true,arrows:true,protect:true});}catch(e){}}}}}
object.chat.socket.send(JSON.stringify(message.body));return;}}}}catch(e){}
if(message.element)message.element.setStatus(-1);});if(message.xhr.upload){message.xhr.upload.addEventListener("progress",function(e){if(e.lengthComputable){if(message.element)message.element.setProgress(Math.floor((e.loaded/e.total)*100));}else{if(message.element)message.element.setProgress(-1);}},false);}else{if(message.element)message.element.setProgress(-1);}
message.xhr.addEventListener("error",function(){if(message.element)message.element.setStatus(-1);});message.element.setProgress(0);message.element.setStatus(0);message.xhr.send(message.formData);this.waitingMessages[media.id]=message;}else{this.chat.socket.send(JSON.stringify(message.body));}};HTMLChatContainer.prototype.clearEnqueuedFiles=function(){this.selectedMedias=null;this.selectedPreviewMedia=null;this.selectedPreviewMediaElem=null;this.destroyMediaView();};HTMLChatContainer.prototype.designMediaView=function(){var object=this;if(this.selectedMedias&&this.selectedMedias.length>0){if(this.isDetailsOpen){this.toggleDetails();}
if(!this.mediaViewDiv){this.mediaViewDiv=document.createElement("div");this.mediaViewDiv.className="chat-layout-view-media position-relative w-100 bg-white d-flex flex-fill flex-column overflow-hidden";this.chat.rightColumn.appendChild(this.mediaViewDiv);var mediaViewHeaderDiv=document.createElement("div");mediaViewHeaderDiv.className="chat-view-header d-flex flex-row flex-nowrap w-100 bg-light border-bottom";this.mediaViewDiv.appendChild(mediaViewHeaderDiv);var mediaViewTitle=document.createElement("h6");mediaViewTitle.className="chat-view-title mb-0 flex-fill p-3";mediaViewTitle.innerText=getLocaleMessage("LABEL.SEND_FILES");mediaViewHeaderDiv.appendChild(mediaViewTitle);var closeMediaViewButton=document.createElement("button");closeMediaViewButton.type="button";closeMediaViewButton.className="chat-view-close btn btn-light rounded-0 d-flex align-items-center justify-content-center px-3 border-left";closeMediaViewButton.title=getLocaleMessage("LABEL.CANCEL");closeMediaViewButton.setAttribute("data-toggle","tooltip");mediaViewHeaderDiv.appendChild(closeMediaViewButton);var closeMediaViewButtonIcon=document.createElement("i");closeMediaViewButtonIcon.className="fas fa-times";closeMediaViewButton.appendChild(closeMediaViewButtonIcon);bootstrapInitTooltip(closeMediaViewButton);closeMediaViewButton.addEventListener("click",function(){bootstrapCloseTooltip(closeMediaViewButton);object.clearEnqueuedFiles();});this.mediaViewTopDiv=document.createElement("div");this.mediaViewTopDiv.className="position-relative d-flex flex-fill bg-white overflow-hidden";this.mediaViewDiv.appendChild(this.mediaViewTopDiv);this.mediaViewTextDiv=document.createElement("div");this.mediaViewTextDiv.className="position-relative d-flex bg-light border-top";this.mediaViewDiv.appendChild(this.mediaViewTextDiv);this.mediaViewTextInput=document.createElement("textarea");this.mediaViewTextInput.className="chat-view-input form-control-plaintext px-3 py-2";this.mediaViewTextInput.placeholder=getLocaleMessage("INFO.CHAT_TYPE_MEDIA_DESCRIPTION")+"...";this.mediaViewTextInput.style.outline="0";this.mediaViewTextDiv.appendChild(this.mediaViewTextInput);this.mediaViewTextInput.addEventListener("input",function(){if(object.selectedPreviewMedia){object.selectedPreviewMedia.description=object.mediaViewTextInput.value;}});this.mediaViewTextInput.addEventListener("change",function(){if(object.selectedPreviewMedia){object.selectedPreviewMedia.description=object.mediaViewTextInput.value;}});this.mediaViewBottomDiv=document.createElement("div");this.mediaViewBottomDiv.className="position-relative d-flex flex-row flex-nowrap align-items-center px-3 py-2 bg-light border-top";this.mediaViewDiv.appendChild(this.mediaViewBottomDiv);this.mediaViewListDiv=document.createElement("div");this.mediaViewListDiv.className="d-flex flex-row flex-fill flex-nowrap overflow-auto mr-2 border-right";this.mediaViewBottomDiv.appendChild(this.mediaViewListDiv);this.mediaViewSendButton=document.createElement("button");this.mediaViewSendButton.type="button";this.mediaViewSendButton.className="chat-view-send btn btn-light btn-lg rounded-circle shadow m-3 d-flex align-items-center justify-content-center";this.mediaViewSendButton.style.width="3.5rem";this.mediaViewSendButton.style.height="3.5rem";this.mediaViewSendButton.title=getLocaleMessage("LABEL.SEND");this.mediaViewSendButton.setAttribute("data-toggle","tooltip");this.mediaViewBottomDiv.appendChild(this.mediaViewSendButton);var mediaViewSendButtonIcon=document.createElement("i");mediaViewSendButtonIcon.className="fas fa-paper-plane my-1 my-sm-2";this.mediaViewSendButton.appendChild(mediaViewSendButtonIcon);this.mediaViewSendButton.addEventListener("click",function(){bootstrapCloseTooltip(object.mediaViewSendButton);object.sendEnqueuedFiles();});}else{if(!this.selectedPreviewMedia)
this.mediaViewTopDiv.innerHTML="";this.mediaViewListDiv.innerHTML="";}
var lastIsMediaViewOpen=this.isMediaViewOpen;this.isMediaViewOpen=true;var selectMediaItem=function(media,mediaElement){if(object.selectedPreviewMedia==media)return;object.mediaViewTopDiv.innerHTML="";if(object.selectedPreviewMedia&&object.selectedPreviewMediaElem){if(object.selectedPreviewMediaElem.classList.contains("border")){object.selectedPreviewMediaElem.classList.remove("border");}}
object.selectedPreviewMedia=media;object.selectedPreviewMediaElem=mediaElement;if(!mediaElement.classList.contains("border")){mediaElement.classList.add("border");}
object.mediaViewTextInput.value=media.description;var wrapperDiv=document.createElement("div");wrapperDiv.className="d-flex flex-fill align-items-center justify-content-center";object.mediaViewTopDiv.appendChild(wrapperDiv);if(media.type=="image"){wrapperDiv.style.backgroundImage="url('"+media.url+"')";wrapperDiv.style.backgroundRepeat="no-repeat";wrapperDiv.style.backgroundSize="auto 100%";wrapperDiv.style.backgroundPosition="center center";}else if(media.type=="video"){var video=document.createElement("video");video.className="flex-fill mw-100 mh-100";video.autoplay=true;video.muted=false;video.controls=true;video.src=media.url;video.type=media.file.type;video.style.outline="0";wrapperDiv.appendChild(video);}else{var objectElem=document.createElement("object");objectElem.className="w-100 h-100";objectElem.type=media.file.type;objectElem.data=media.url;wrapperDiv.appendChild(objectElem);}};var designMediaItem=function(media){var mediaItemLink=document.createElement("a");mediaItemLink.href="#";mediaItemLink.className="chat-view-media-item position-relative d-flex align-items-center text-decoration-none p-2 rounded";object.mediaViewListDiv.appendChild(mediaItemLink);if(object.selectedPreviewMedia==media){mediaItemLink.classList.add("border");object.selectedPreviewMediaElem=mediaItemLink;}
var buttonWrapperDiv=document.createElement("div");buttonWrapperDiv.className="position-absolute d-flex justify-content-end p-2";buttonWrapperDiv.style.top="0px";buttonWrapperDiv.style.left="0px";buttonWrapperDiv.style.right="0px";buttonWrapperDiv.style.zIndex="10";buttonWrapperDiv.style.pointerEvents="none";mediaItemLink.appendChild(buttonWrapperDiv);var removeItemButton=document.createElement("button");removeItemButton.type="button";removeItemButton.className="chat-view-media-remove btn btn-light p-1 m-1 d-flex align-items-center justify-content-center";removeItemButton.title=getLocaleMessage("LABEL.REMOVE");removeItemButton.setAttribute("data-toggle","tooltip");buttonWrapperDiv.appendChild(removeItemButton);var removeItemButtonIcon=document.createElement("i");removeItemButtonIcon.className="fas fa-times";removeItemButtonIcon.style.pointerEvents="all";removeItemButtonIcon.style.fontSize="0.8rem";removeItemButtonIcon.style.lineHeight="0.7rem";removeItemButton.appendChild(removeItemButtonIcon);bootstrapInitTooltip(removeItemButton);removeItemButton.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();bootstrapCloseTooltip(removeItemButton);object.dequeueFile(media);});if(media.file){if(!media.name)media.name=media.file.name;if(!media.mimeType)media.mimeType=media.file.type;if(!media.type)media.type=media.file.type.toLowerCase().split('/')[0];if(!media.url)media.url=window.URL.createObjectURL(media.file);}
if(media.type=="image"){var img=document.createElement("img");img.className="rounded overflow-hidden";img.src=media.url;img.alt=media.name;img.style.maxHeight="4rem";img.style.maxWidth="4rem";img.style.minWidth="4rem";mediaItemLink.appendChild(img);}else if(media.type=="video"){var video=document.createElement("video");video.autoplay=true;video.muted=true;video.controls=false;video.src=media.url;video.type=media.mimeType;video.addEventListener("loadeddata",function(){var canvas=document.createElement("canvas");var canvasContext=canvas.getContext("2d");canvasContext.drawImage(video,0,0,video.videoWidth,video.videoHeight);var img=document.createElement("img");img.className="rounded overflow-hidden";img.src=canvas.toDataURL("image/png");img.alt=media.name;img.style.maxHeight="4rem";img.style.maxWidth="4rem";img.style.minWidth="4rem";mediaItemLink.appendChild(img);});}else{var mediaWrapperDiv=document.createElement("div");mediaWrapperDiv.className="d-flex flex-column align-items-center justify-content-center p-2 bg-light text-muted border rounded";mediaWrapperDiv.style.width="4rem";mediaWrapperDiv.style.height="4rem";mediaItemLink.appendChild(mediaWrapperDiv);var mediaFileIcon=document.createElement("i");mediaFileIcon.style.fontSize="1.5rem";mediaFileIcon.className="mb-1 "+object.getFileIcon(media.mimeType);mediaWrapperDiv.appendChild(mediaFileIcon);var mediaFileText=document.createElement("span");mediaFileText.className="text-truncate text-center mw-100";mediaFileText.innerText=media.name;mediaWrapperDiv.appendChild(mediaFileText);}
mediaItemLink.addEventListener("click",function(e){e.preventDefault();selectMediaItem(media,mediaItemLink);});return mediaItemLink;};for(var i=0;i<this.selectedMedias.length;i++){var element=designMediaItem(this.selectedMedias[i]);if((!this.selectedPreviewMedia&&(!lastIsMediaViewOpen&&i==0||lastIsMediaViewOpen&&i>=this.selectedMedias.length-1))||(this.selectedPreviewMedia==this.selectedMedias[i])){this.selectedPreviewMedia=null;selectMediaItem(this.selectedMedias[i],element);}}
var addNewItemLink=document.createElement("a");addNewItemLink.href="#";addNewItemLink.className="chat-view-media-add-item position-relative d-flex align-items-center text-decoration-none p-2 rounded";this.mediaViewListDiv.appendChild(addNewItemLink);var addNewItemWrapperDiv=document.createElement("div");addNewItemWrapperDiv.className="d-flex flex-column align-items-center justify-content-center p-2 bg-light text-muted border rounded";addNewItemWrapperDiv.style.width="4rem";addNewItemWrapperDiv.style.height="4rem";addNewItemWrapperDiv.style.setProperty("border-style","dashed","important");addNewItemLink.appendChild(addNewItemWrapperDiv);var addNewItemIcon=document.createElement("i");addNewItemIcon.className="fas fa-plus";addNewItemIcon.style.fontSize="1.5rem";addNewItemWrapperDiv.appendChild(addNewItemIcon);addNewItemLink.addEventListener("click",function(){var fileInput=object.chat.createMediaFileInput("*");fileInput.click();});this.chat.activeConvDiv.style.setProperty("display","none","important");this.chat.activeConvBottomDiv.style.setProperty("display","none","important");}else{this.destroyMediaView();}};HTMLChatContainer.prototype.getFileIcon=function(mimeType){if(mimeType=="application/pdf"){return"fas fa-file-pdf";}else if(mimeType=="text/html"||mimeType=="text/css"||mimeType=="application/json"||mimeType=="application/xml"||mimeType=="application/javascript"||mimeType=="application/typescript"){return"fas fa-file-code";}else if(mimeType=="text/csv"){return"fas fa-file-csv";}else if(mimeType=="application/msword"){return"fas fa-file-word";}else if(mimeType=="application/vnd.ms-powerpoint"){return"fas fa-file-powerpoint";}else if(mimeType=="application/zip"||mimeType=="application/x-rar-compressed"||mimeType=="application/x-7z-compressed"){return"fas fa-file-archive";}else{var attachmentType=mimeType.toLowerCase().split('/')[0];if(attachmentType=="image")return"fas fa-image";else if(attachmentType=="video")return"fas fa-video";else if(attachmentType=="audio")return"fas fa-volume-up";}
return"fas fa-file";};HTMLChatContainer.prototype.destroyMediaView=function(){if(this.mediaViewDiv){this.chat.rightColumn.removeChild(this.mediaViewDiv);this.mediaViewDiv=null;this.mediaViewTopDiv=null;this.mediaViewBottomDiv=null;this.mediaViewListDiv=null;this.mediaViewSendButton=null;this.mediaViewTextDiv=null;this.mediaViewTextInput=null;}
this.chat.activeConvDiv.style.display=null;this.chat.activeConvBottomDiv.style.display=null;this.isMediaViewOpen=false;};function HTMLIntegration(sys,formID,code,posX,posY,width,height,description,value,showValue){this.create(sys,formID,code,posX,posY,width,height,description,value);this.skipCache=false;}
HTMLIntegration.inherits(HTMLElementBase);HTMLIntegration.prototype.name='HTMLIntegration';HTMLIntegration.prototype.tabable=false;HTMLIntegration.prototype.designComponent=function(doc){if(this.Posicionamento){switch(this.Posicionamento){case"A":{if(!d.n.responsive||this.AlinhamentoH&&this.AlinhamentoH!=="N"||this.AlinhamentoV&&this.AlinhamentoV!=="N"){this.divClass="position-absolute";this.div.className=this.divClass;}
break;}
case"R":{this.divClass="position-relative";this.div.className=this.divClass;this.div.style.left=null;this.div.style.top=null;break;}
case"C":{this.divClass="position-relative w-100 h-100 mb-0";this.div.className=this.divClass;this.div.style.left=null;this.div.style.top=null;this.fullscreen=true;break;}}}
if(this.Iframe&&this.Iframe.length&&this.Iframe.length>0&&this.Iframe.toLowerCase()==="true"){this.pageFrame=document.createElement("iframe");this.pageFrame.className="border-0 w-100 h-100";this.pageFrame.src="tmp/"+this.sys+"/"+this.formID+"/"+this.code+".html"+
(this.skipCache?"?hash="+new Date().getTime():"");this.div.appendChild(this.pageFrame);var object=this;this.pageFrame.addEventListener("load",function(){object.afterLoad();});}else{if(this.libraries&&this.libraries.length>0){for(var i=0;i<this.libraries.length;i++){this.designLibrary(this.libraries[i]);}}}};HTMLIntegration.prototype.afterInit=function(){this.callMethod(HTMLElementBase,"afterInit",[]);if(this.fullscreen){if(this.tab&&this.tab.div){this.tab.div.style.padding="0";if(this.tab.showTabButtons)this.tab.div.style.minHeight="calc(100vh - "+this.tab.div.offsetTop+"px)";else this.tab.div.style.minHeight="100vh";}}
if(this.AlinhamentoV){switch(this.AlinhamentoV){case"N":{break;}
case"T":{this.div.style.top="0px";this.div.style.bottom=null;break;}
case"C":{var tabHeight=d.t?d.t.height:this.doc.offsetHeight;this.div.style.top=((((tabHeight/2)-(this.height/2))*100)/tabHeight)+"%";this.div.style.bottom=null;break;}
case"R":{this.div.style.top=null;this.div.style.bottom="0px";break;}}}
if(this.AlinhamentoH){switch(this.AlinhamentoH){case"N":{break;}
case"E":{this.div.style.left="0px";break;}
case"C":{var tabWidth=d.t?d.t.width:this.doc.offsetWidth;this.div.style.left=((((tabWidth/2)-(this.width/2))*100)/tabWidth)+"%";break;}
case"D":{var tabWidth=d.t?d.t.width:this.doc.offsetWidth;var value=tabWidth-this.width;var layWidth=parseInt(document.getElementById("lay").style.width);if(value>layWidth)value=layWidth;var percent=((value*100)/layWidth);this.div.style.left=percent+"%";if(d.n.responsive){this.div.style.width=(100-percent)+"%";}
break;}}}};HTMLIntegration.prototype.designLibrary=function(lib){if(lib!=null&&lib.length>0){if(lib.toLowerCase().trim().endsWith(".css")||lib.startsWith("fonte:")){var head=document.getElementsByTagName("head")[0];var link=document.createElement("link");link.type="text/css";link.href=lib.startsWith('fonte:')?lib.replace('fonte:',''):lib;head.appendChild(link);}else{var script=document.createElement("script");script.type="text/javascript";script.src=lib;document.body.appendChild(script);}}};HTMLIntegration.prototype.inner=function(html,css,js){if(html&&html.length>0&&this.div){this.div.innerHTML=html;}
if(css&&css.length>0){var head=document.getElementsByTagName("head")[0];var styleTag=document.createElement("style");styleTag.type="text/css";styleTag.innerHTML=css;head.appendChild(styleTag);}
if(js&&js.length>0){var scriptTag=document.createElement("script");scriptTag.type="text/javascript";scriptTag.innerHTML=js;document.body.appendChild(scriptTag);}};HTMLIntegration.prototype.assignEvents=function(events){if(events&&events.length>0){for(var i=0;i<events.length;i++){let refEvent=events[i];let elem=document.getElementById(refEvent.element);if(elem){let params=(refEvent.params&&refEvent.params.length&&refEvent.params.length>0)?refEvent.params:[];let flow=refEvent.flow;let action=refEvent.event;elem.addEventListener(action,function(){ebfFlowExecute(flow,params);},false)}}}};HTMLIntegration.prototype.afterLoad=function(){if(this.DepoisDeCarregar)this.DepoisDeCarregar.call(this);};HTMLIntegration.prototype.getElementById=function(id){try{if(id){if(this.pageFrame)return this.pageFrame.contentDocument.getElementById(id);else return document.getElementById(id);}
return null;}catch(e){handleException(getLocaleMessage('ERROR.OPERATION_ERROR'));return;}};function HTMLPlayer(sys,formID,code,posX,posY,width,height,description,value,showValue){this.create(sys,formID,code,posX,posY,width,height,description,value);this.mediaSources=[];this.activeMediaIndex=0;}
HTMLPlayer.inherits(HTMLElementBase);HTMLPlayer.prototype.name='HTMLPlayer';HTMLPlayer.prototype.tabable=true;HTMLPlayer.prototype.setEnabled=function(v){this.callMethod(HTMLElementBase,"setEnabled",[v]);if(this.mediaElement){if(!this.enabled&&!this.mediaElement.paused)this.pause();else if(this.enabled&&this.mediaElement.paused&&this.autoPlay)this.play();}};HTMLPlayer.prototype.play=function(){if(this.mediaElement)this.mediaElement.play();};HTMLPlayer.prototype.pause=function(){if(this.mediaElement)this.mediaElement.pause();};HTMLPlayer.prototype.isPlaying=function(){return this.mediaElement&&!this.mediaElement.paused;};HTMLPlayer.prototype.getPlayingMediaURL=function(){return this.isPlaying()?this.mediaSources[this.activeMediaIndex].url:null;};HTMLPlayer.prototype.getPlayingMediaDescription=function(){return this.isPlaying()?this.mediaSources[this.activeMediaIndex].description:null;};HTMLPlayer.prototype.getPlaylist=function(){return this.mediaSources;};HTMLPlayer.prototype.addMediaToPlaylist=function(url,description){var source={url:url,description:description};this.mediaSources.push(source);if(this.mediaSources.length==1)this.setSource(source);};HTMLPlayer.prototype.clearPlaylist=function(){this.mediaSources=[];if(this.mediaElement){this.mediaElement.innerHTML="";this.mediaElement.src=null;this.mediaElement.load();}};HTMLPlayer.prototype.designComponent=function(doc){this.mediaElement=document.createElement("video");this.mediaElement.className="w-100 h-100";this.mediaElement.controls=(this.controles&&this.controles.length&&this.controles.toLowerCase()==="true");if(!(this.allowDownload.toLowerCase()==="true"))
this.mediaElement.controlsList="nodownload";this.autoPlay=(this.autoPlay&&this.autoPlay.length&&this.autoPlay.toLowerCase()==="true");this.mediaElement.autoplay=this.autoPlay;this.mediaElement.muted=(this.mudo&&this.mudo.length&&this.mudo.toLowerCase()==="true");this.mediaElement.defaultMuted=this.mediaElement.muted;if(this.volume&&this.volume.length&&this.volume.length>0){this.volume=parseInt(this.volume);this.mediaElement.volume=this.volume/100;}
if(this.Valores&&this.Valores.length&&this.Valores.length>0){if(this.Valores.indexOf("\n")){var urls=this.Valores.split("\n");var descriptions=this.Lista.split("\n");for(var i=0;i<urls.length;i++){if(urls[i].length>0){this.addMediaToPlaylist(urls[i],descriptions[i]);}}}else{this.addMediaToPlaylist(this.Valores,this.Lista);}}
if(this.playbackRate&&this.playbackRate.length&&this.playbackRate.length>0){this.playbackRate=parseInt(this.playbackRate);this.mediaElement.playbackRate=this.playbackRate/100;}
if(this.loop&&this.loop.length&&this.loop.toLowerCase()==="true"){if(this.mediaSources.length>1){this.mediaElement.loop=false;}else{this.mediaElement.loop=true;}
this.loop=true;}else{this.mediaElement.loop=false;this.loop=false;}
this.div.appendChild(this.mediaElement);this.attachEvent(this.mediaElement,"playing",this.mediaStarted);this.attachEvent(this.mediaElement,"ended",this.mediaEnded);this.attachEvent(this.mediaElement,"pause",this.mediaPaused);this.attachEvent(this.mediaElement,"error",this.mediaError);this.activeMediaIndex=0;if(this.mediaSources&&this.mediaSources.length>0){this.setSource(this.mediaSources[this.activeMediaIndex]);}};HTMLPlayer.prototype.setSource=function(source){this.mediaElement.innerHTML="";if(source){if(source.description&&source.description.length>0){var descriptionLowercase=source.description.trim().toLowerCase();if(descriptionLowercase.endsWith(".vtt")||descriptionLowercase.endsWith(".srt")){var subtitles=document.createElement("track");subtitles.setAttribute("kind","subtitles");subtitles.setAttribute("src",source.description);this.mediaElement.appendChild(subtitles);this.mediaElement.src=null;this.mediaElement.load();}}
this.mediaElement.src=source.url;if(this.autoPlay&&this.enabled)this.mediaElement.play();if(this.playbackRate)this.mediaElement.playbackRate=this.playbackRate/100;}else{this.mediaElement.src=null;this.mediaElement.load();}};HTMLPlayer.prototype.mediaStarted=function(e){if(this.AoIniciarReproducao){this.AoIniciarReproducao.call(this,this.mediaSources[this.activeMediaIndex].url,this.mediaSources[this.activeMediaIndex].description);}};HTMLPlayer.prototype.mediaEnded=function(e){if(this.AoFinalizarReproducao){if(this.AoFinalizarReproducao.call(this,this.mediaSources[this.activeMediaIndex].url,this.mediaSources[this.activeMediaIndex].description)===false){return;}}
if(this.mediaSources&&this.mediaSources.length>1){if(this.loop){this.activeMediaIndex=(++this.activeMediaIndex)%this.mediaSources.length;}else if(this.activeMediaIndex<this.mediaSources.length-1){this.activeMediaIndex++;}
this.setSource(this.mediaSources[this.activeMediaIndex],true);}};HTMLPlayer.prototype.mediaPaused=function(e){if(this.AoPausar){if(this.AoPausar.call(this,this.mediaSources[this.activeMediaIndex].url,this.mediaSources[this.activeMediaIndex].description)===false){this.mediaElement.play();}}};HTMLPlayer.prototype.mediaError=function(e){if(this.AoOcorrerErro){this.AoOcorrerErro.call(this,this.mediaSources[this.activeMediaIndex].url,this.mediaSources[this.activeMediaIndex].description);}};function HTMLRssFeed(sys,formID,code,posX,posY,width,height,description,value,showValue){this.create(sys,formID,code,posX,posY,width,height,description,value);this.feedItems=[];this.animationCurrentIndex=0;this.targetScroll=0;}
HTMLRssFeed.inherits(HTMLElementBase);HTMLRssFeed.prototype.name='HTMLRssFeed';HTMLRssFeed.prototype.tabable=true;HTMLRssFeed.prototype.pubDateFormats=['ddd, DD MMM YYYY HH:mm:ss ZZ','ddd, DD MMM YY HH:mm:ss ZZ'];HTMLRssFeed.prototype.setUrl=function(url,charset){this.url=url;if(charset)this.Charset=charset;this.updateData();};HTMLRssFeed.prototype.designComponent=function(doc){this.divClass=this.div.className;if(this.ExibirImagens&&this.ExibirImagens.length){this.showImages=(this.ExibirImagens.toLowerCase()=="true");this.ExibirImagens=null;}else this.showImages=true;if(this.TamanhoDasImagens&&this.TamanhoDasImagens.length){this.imagesSize=this.TamanhoDasImagens.trim();if(this.TamanhoDasImagens.indexOf("%")==-1&&this.TamanhoDasImagens.indexOf("px")==-1&&this.TamanhoDasImagens.indexOf("pt")==-1&&this.TamanhoDasImagens.indexOf("rem")==-1&&this.TamanhoDasImagens.indexOf("vw")==-1&&this.TamanhoDasImagens.indexOf("vh")==-1){this.imagesSize+="%";}
this.TamanhoDasImagens=null;}else this.imagesSize="25%";if(this.ExibirTitulos&&this.ExibirTitulos.length){this.showTitles=(this.ExibirTitulos.toLowerCase()=="true");this.ExibirTitulos=null;}else this.showTitles=true;if(this.ExibirDescricoes&&this.ExibirDescricoes.length){this.showDescriptions=(this.ExibirDescricoes.toLowerCase()=="true");this.ExibirDescricoes=null;}else this.showDescriptions=true;if(this.TamanhoMaxDescricao&&this.TamanhoMaxDescricao.length){this.maxDescriptionSize=parseInt(this.TamanhoMaxDescricao);this.TamanhoMaxDescricao=null;}else this.maxDescriptionSize=0;if(this.ExibirDataDePublicacao&&this.ExibirDataDePublicacao.length){this.showPubDates=(this.ExibirDataDePublicacao.toLowerCase()=="true");this.ExibirDataDePublicacao=null;}else this.showPubDates=true;if(this.novaaba&&this.novaaba.length){this.linksInNewTab=(this.novaaba.toLowerCase()=="true");this.novaaba=null;}else this.linksInNewTab=true;if(this.Estilo){switch(this.Estilo){case 0:case"0":this.style=0;break;case 1:case"1":this.style=1;break;default:this.style=0;break;}
this.Estilo=null;}else this.style=0;if(this.ModoDeExibicao){switch(this.ModoDeExibicao){case 0:case"0":this.viewMode=0;break;case 1:case"1":this.viewMode=1;break;case 2:case"2":this.viewMode=2;break;default:this.viewMode=0;break;}
this.ModoDeExibicao=null;}else this.viewMode=0;if(this.TamanhoMaxItens&&this.TamanhoMaxItens.length){this.itemsSize=this.TamanhoMaxItens.trim();if(this.TamanhoMaxItens.indexOf("%")==-1&&this.TamanhoMaxItens.indexOf("px")==-1&&this.TamanhoMaxItens.indexOf("pt")==-1&&this.TamanhoMaxItens.indexOf("rem")==-1&&this.TamanhoMaxItens.indexOf("vw")==-1&&this.TamanhoMaxItens.indexOf("vh")==-1){this.itemsSize+="%";}
this.TamanhoMaxItens=null;}else this.itemsSize="100%";if(this.tempo&&this.tempo.length){this.animationTime=parseInt(this.tempo);this.tempo=null;}else this.animationTime=0;if(this.qtditem&&this.qtditem.length){this.animationItemAmount=parseInt(this.qtditem);this.qtditem=null;}else this.animationItemAmount=0;webrun.include("assets/moment.min.js");var definedLocale=resources_locale.toLowerCase();if(definedLocale=='en_us')this.locale='en';else if(definedLocale=='pt_br')this.locale='pt-br';else if(definedLocale=='es_es')this.locale='es';else if(definedLocale=='fr_fr')this.locale='fr';else this.locale='en';moment.locale(this.locale);this.scrollDiv=document.createElement("div");switch(this.viewMode){case 0:this.scrollDivClass="position-relative w-100 h-100 overflow-hidden";break;case 1:this.scrollDivClass="position-relative w-100 h-100 overflow-auto";break;default:this.scrollDivClass="position-relative w-100 h-auto";break;}
if(!this.itemsSize||this.itemsSize!="100%"){this.scrollDivClass+=" d-flex flex-row flex-wrap";}
this.scrollDiv.className=this.scrollDivClass;this.div.appendChild(this.scrollDiv);this.preloader=document.createElement("div");this.preloader.className="d-none";this.preloaderClass="spinner-border text-primary";this.preloader.setAttribute("role","status");this.div.appendChild(this.preloader);var preloaderSpan=document.createElement("span");preloaderSpan.className="sr-only";preloaderSpan.innerHTML=getLocaleMessage("LABEL.LOADING")+"...";this.preloader.appendChild(preloaderSpan);this.showPreloader();};HTMLRssFeed.prototype.onFormLoadAction=function(){this.updateData();};HTMLRssFeed.prototype.afterInit=function(){this.callMethod(HTMLElementBase,"afterInit",[]);if(this.tab){var object=this;this.tab.addShownListener(function(tabPane){$(object.scrollDiv).stop();object.targetScroll=(object.feedItems&&object.feedItems.length>0&&object.animationCurrentIndex>=0&&object.animationCurrentIndex<object.feedItems.length)?object.feedItems[object.animationCurrentIndex].div.offsetTop:0;object.scrollDiv.scrollTop=object.targetScroll;});}};HTMLRssFeed.prototype.getRequestURL=function(){return getAbsolutContextPath()+"componentData.do?action=componentData&sys="+URLEncode(this.sys,'GET')+"&formID="+URLEncode(this.formID,'GET')+"&comID="+URLEncode(this.code,'GET');};HTMLRssFeed.prototype.updateData=function(){this.showPreloader();this.feedItems=[];this.scrollDiv.innerHTML="";this.stopAnimation();var object=this;$.ajax({url:this.getRequestURL(),type:"POST",data:{url:this.url,charset:this.Charset},dataType:"xml",success:function(data){if(data&&data.documentElement){$(data).find("item").each(function(){object.feedItems.push(object.designItem($(this)));});object.hidePreloader();if(object.viewMode==0){object.startAnimation();}}else{object.hidePreloader();}},error:function(){object.hidePreloader();}});};HTMLRssFeed.prototype.showPreloader=function(){if(this.scrollDiv)this.scrollDiv.className="d-none";if(this.preloader)this.preloader.className=this.preloaderClass;if(this.div)this.div.className=this.divClass+" d-flex align-items-center justify-content-center";};HTMLRssFeed.prototype.hidePreloader=function(){if(this.scrollDiv)this.scrollDiv.className=this.scrollDivClass;if(this.preloader)this.preloader.className="d-none";if(this.div)this.div.className=this.divClass;};HTMLRssFeed.prototype.stopAnimation=function(){if(this.animationInterval){clearInterval(this.animationInterval);this.animationInterval=null;}};HTMLRssFeed.prototype.startAnimation=function(){if(this.animationTime>0){var object=this;this.animationInterval=setInterval(function(){object.animationTick();},(this.animationTime*1000)+((this.animationTime*1000)/3));this.animationOldIndex=0;this.animationCurrentIndex=-this.animationItemAmount;this.animationTick();}};HTMLRssFeed.prototype.animationTick=function(){if(!this.enabled)return;this.animationOldIndex=this.animationCurrentIndex;this.animationCurrentIndex=(this.animationCurrentIndex+this.animationItemAmount)%this.feedItems.length;this.targetScroll=this.feedItems[this.animationCurrentIndex].div.offsetTop;if(this.animationOldIndex>this.animationCurrentIndex){this.animationOldIndex=0;this.animationCurrentIndex=0;this.targetScroll=0;}
$(this.scrollDiv).animate({scrollTop:this.targetScroll},(this.animationTime*1000)/3);};HTMLRssFeed.prototype.getTextValue=function(html){if(!html||html.length==0)return"";var tmp=document.createElement("div");tmp.innerHTML=html;return(tmp.textContent||tmp.innerText||$(tmp).text());};HTMLRssFeed.prototype.truncateWithEllipses=function(text,max){if(!text||text.length==0)return"";return text.substr(0,max-1)+(text.length>max?'&hellip;':'');};HTMLRssFeed.prototype.designItem=function(element){var mediaDiv=document.createElement("div");mediaDiv.className=((this.style==1)?"card":"media")+" position-relative mb-3"+
((!this.itemsSize||this.itemsSize!="100%")?" mr-3":"");if(this.itemsSize&&this.itemsSize!="100%")mediaDiv.style.maxWidth=this.itemsSize;this.scrollDiv.appendChild(mediaDiv);if(this.showImages){var elementMedia=element.find("media\\:content");if(elementMedia&&elementMedia.attr("url")){var mediaImage=document.createElement("img");mediaImage.className=(this.style==1)?"card-img-top":"mr-3";if(this.style==0&&this.imagesSize)mediaImage.style.maxWidth=this.imagesSize;mediaImage.src=elementMedia.attr("url");mediaDiv.appendChild(mediaImage);}}
var mediaBody=document.createElement("div");mediaBody.className=(this.style==1)?"card-body":"media-body";mediaDiv.appendChild(mediaBody);if(this.showTitles){var elementTitle=element.find("title");if(elementTitle){var newsTitle=document.createElement("h5");newsTitle.className=(this.style==1)?"card-title":"mt-0";newsTitle.innerHTML=this.getTextValue(elementTitle.text());mediaBody.appendChild(newsTitle);}}
if(this.showDescriptions){var elementDescription=element.find("description");if(elementDescription){var newsDescription=document.createElement("p");newsDescription.className=(this.style==1)?"card-text":"mb-0";var descriptionContent=this.getTextValue(elementDescription.text());if(this.maxDescriptionSize>0){descriptionContent=this.truncateWithEllipses(descriptionContent,this.maxDescriptionSize);}
newsDescription.innerHTML=descriptionContent;mediaBody.appendChild(newsDescription);}}
if(this.showPubDates){var elementDate=element.find("pubDate");if(elementDate){var newsTime=document.createElement("small");newsTime.className="text-muted mt-2";try{var momentDate=moment(elementDate.text(),this.pubDateFormats);if(momentDate.isValid()){newsTime.innerHTML=momentDate.local().fromNow();}else{momentDate=moment(Date.parse(elementDate.text()));if(momentDate.isValid())newsTime.innerHTML=momentDate.local().fromNow();else newsTime.innerHTML=elementDate.text();}}
catch(e){newsTime.innerHTML=elementDate.text();}
mediaBody.appendChild(newsTime);}}
var elementLink=element.find("link");if(elementLink){var newsLink=document.createElement("a");newsLink.className="stretched-link";newsLink.href=elementLink.text();if(this.linksInNewTab)newsLink.setAttribute("target","_blank");mediaBody.appendChild(newsLink);}
return{div:mediaDiv,divClass:mediaDiv.className};};function HTMLQuery(sys,formID,code,posX,posY,width,height,description,value,showValue){this.create(sys,formID,code,posX,posY,width,height,description,value);this.offset=0;this.reachEnd=false;this.connectionError=true;this.searched=false;this.columns=[];}
HTMLQuery.inherits(HTMLElementBase);HTMLQuery.prototype.name='HTMLQuery';HTMLQuery.prototype.tabable=true;HTMLQuery.prototype.setEnabled=function(v){this.enabled=v;if(this.div&&this.divClass){this.div.className=v?this.divClass:this.divClass+" disabled";}};HTMLQuery.prototype.getRequestURL=function(){return getAbsolutContextPath()+"componentData.do?action=componentData&sys="+URLEncode(this.sys,'GET')+"&formID="+URLEncode(this.formID,'GET')+"&comID="+URLEncode(this.code,'GET');};HTMLQuery.prototype.formatColumn=function(value,row){if(value===undefined||value===null||value.length==0)return"-";if(!row.context)return value;value=stringToHTMLString(value);var searchLowerCase=row.context.searchInput.value.toLowerCase();var valueLowerCase=value.toLowerCase();var searchIndex=valueLowerCase.indexOf(searchLowerCase);return searchIndex!=-1?value.substring(0,searchIndex)+"<b>"+
value.substring(searchIndex,searchIndex+searchLowerCase.length)+"</b>"+
value.substring(searchIndex+searchLowerCase.length,valueLowerCase.length):value;};HTMLQuery.prototype.designComponent=function(doc){var object=this;this.divClass=this.div.className;this.limit=(this.LimiteRegistros&&this.LimiteRegistros.length&&this.LimiteRegistros.length>0)?parseInt(this.LimiteRegistros):10;if(!document.getElementById("jquery-resizableColumns-css")){var head=document.getElementsByTagName('head')[0];var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='assets/jquery.resizableColumns.min.css';link.id='jquery-resizableColumns-css';head.appendChild(link);}
webrun.include("assets/jquery.resizableColumns.min.js");if(!document.getElementById("bstrap-table-css")){var head=document.getElementsByTagName('head')[0];var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='components/grid/bootstrap-table.min.css';link.id='bstrap-table-css';head.appendChild(link);}
webrun.include("components/grid/bootstrap-table.min.js");webrun.include("components/grid/bootstrap-table-locale-all.min.js");if(!document.getElementById("bstrap-table-sticky-css")){var head=document.getElementsByTagName('head')[0];var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='components/grid/extensions/sticky-header/bootstrap-table-sticky-header.css';link.id='bstrap-table-sticky-css';head.appendChild(link);}
webrun.include("components/grid/extensions/resizable/bootstrap-table-resizable.min.js");webrun.include("components/grid/extensions/sticky-header/bootstrap-table-sticky-header.min.js");this.contentDiv=document.createElement("div");this.contentDivClass="position-relative w-100 h-100";this.contentDiv.className="d-none";this.div.appendChild(this.contentDiv);this.preloader=document.createElement("div");this.preloader.className="d-none";this.preloaderClass="spinner-border text-primary";this.preloader.setAttribute("role","status");this.div.appendChild(this.preloader);var preloaderSpan=document.createElement("span");preloaderSpan.className="sr-only";preloaderSpan.innerHTML=getLocaleMessage("LABEL.LOADING")+"...";this.preloader.appendChild(preloaderSpan);this.inlineForm=document.createElement("div");this.inlineForm.className="form-inline";this.contentDiv.appendChild(this.inlineForm);this.searchInputGroup=document.createElement("div");this.searchInputGroup.className="input-group mb-2 mr-sm-3";this.inlineForm.appendChild(this.searchInputGroup);this.searchInput=document.createElement("input");this.searchInput.className="form-control";this.searchInput.type="text";this.searchInput.placeholder=getLocaleMessage('LABEL.CHAT_SEARCH');this.searchInputGroup.appendChild(this.searchInput);this.searchInput.onkeydown=function(e){if(e.key==='Enter'||e.which===13){e.preventDefault();object.searchAction();}};this.searchButtonDiv=document.createElement("div");this.searchButtonDiv.className="input-group-append";this.searchInputGroup.appendChild(this.searchButtonDiv);this.searchButton=document.createElement("button");this.searchButton.type="button";this.searchButton.className="btn btn-secondary";this.searchButton.title=getLocaleMessage('LABEL.SEARCH');this.searchButton.setAttribute("data-toggle","tooltip");this.searchButtonDiv.appendChild(this.searchButton);var searchButtonIcon=document.createElement("i");searchButtonIcon.className="fas fa-search";this.searchButton.appendChild(searchButtonIcon);this.attachEvent(this.searchButton,"click",this.searchAction);var pageButtonsGroup=document.createElement("div");pageButtonsGroup.className="btn-group mb-2 mr-3";pageButtonsGroup.setAttribute("role","group");this.inlineForm.appendChild(pageButtonsGroup);this.firstPageButton=document.createElement("button");this.firstPageButton.type="button";this.firstPageButton.className="btn btn-secondary";this.firstPageButton.title=getLocaleMessage('LABEL.FIRST_RECORD');this.firstPageButton.setAttribute("data-toggle","tooltip");pageButtonsGroup.appendChild(this.firstPageButton);var firstPageButtonIcon=document.createElement("i");firstPageButtonIcon.className="fas fa-angle-double-left";this.firstPageButton.appendChild(firstPageButtonIcon);this.attachEvent(this.firstPageButton,"click",this.firstPageAction);this.previousPageButton=document.createElement("button");this.previousPageButton.type="button";this.previousPageButton.className="btn btn-secondary";this.previousPageButton.title=getLocaleMessage('LABEL.PREVIOUS_RECORD');this.previousPageButton.setAttribute("data-toggle","tooltip");pageButtonsGroup.appendChild(this.previousPageButton);var previousPageButtonIcon=document.createElement("i");previousPageButtonIcon.className="fas fa-chevron-left";this.previousPageButton.appendChild(previousPageButtonIcon);this.attachEvent(this.previousPageButton,"click",this.previousPageAction);this.nextPageButton=document.createElement("button");this.nextPageButton.type="button";this.nextPageButton.className="btn btn-secondary";this.nextPageButton.title=getLocaleMessage('LABEL.NEXT_RECORD');this.nextPageButton.setAttribute("data-toggle","tooltip");pageButtonsGroup.appendChild(this.nextPageButton);var nextPageButtonIcon=document.createElement("i");nextPageButtonIcon.className="fas fa-chevron-right";this.nextPageButton.appendChild(nextPageButtonIcon);this.attachEvent(this.nextPageButton,"click",this.nextPageAction);this.lastPageButton=document.createElement("button");this.lastPageButton.type="button";this.lastPageButton.className="btn btn-secondary";this.lastPageButton.title=getLocaleMessage('LABEL.LAST_RECORD');this.lastPageButton.setAttribute("data-toggle","tooltip");pageButtonsGroup.appendChild(this.lastPageButton);var lastPageButtonIcon=document.createElement("i");lastPageButtonIcon.className="fas fa-angle-double-right";this.lastPageButton.appendChild(lastPageButtonIcon);this.refreshButton=document.createElement("button");this.refreshButton.type="button";this.refreshButtonClass="btn btn-secondary mb-2";this.refreshButton.className="d-none";this.refreshButton.title=getLocaleMessage('LABEL.REFRESH');this.refreshButton.setAttribute("data-toggle","tooltip");this.inlineForm.appendChild(this.refreshButton);var refreshButtonIcon=document.createElement("i");refreshButtonIcon.className="fas fa-sync-all";this.refreshButton.appendChild(refreshButtonIcon);this.attachEvent(this.refreshButton,"click",this.refreshAction);this.updateData();};HTMLQuery.prototype.showPreloader=function(){if(this.contentDiv)this.contentDiv.className="d-none";if(this.preloader)this.preloader.className=this.preloaderClass;if(this.div)this.div.className=this.divClass+" d-flex align-items-center justify-content-center";};HTMLQuery.prototype.hidePreloader=function(){if(this.contentDiv)this.contentDiv.className=this.contentDivClass;if(this.preloader)this.preloader.className="d-none";if(this.div)this.div.className=this.divClass;};HTMLQuery.prototype.checkServerResponse=function(response){if(response&&response.success==="0"){interactionError(safeGetLocaleMessage("ERROR.OPERATION_ERROR"),null,null,null,response.details?response.details:null);return false;}
return true;};HTMLQuery.prototype.updateData=function(){if(this.tableBase){$(this.tableBase).bootstrapTable("destroy");this.contentDiv.removeChild(this.tableBase);this.tableBase=null;}
this.offset=0;var object=this;this.sendRequest("params",null,function(response){if(response&&response.length>0){response=JSON.parse(response);if(object.checkServerResponse(response)){object.tableBase=document.createElement("table");object.tableBase.className="table table-bordered table-hover";object.contentDiv.appendChild(object.tableBase);var tableHeader=document.createElement("thead");object.tableBase.appendChild(tableHeader);var tableHeaderTr=document.createElement("tr");tableHeader.appendChild(tableHeaderTr);if(response.fields){object.columns=response.fields;for(var i=0;i<response.fields.length;i++){var tableColumn=document.createElement("th");tableColumn.innerHTML=stringToHTMLString(response.fields[i]);tableColumn.setAttribute("data-formatter","d.c_"+object.code+".formatColumn")
tableHeaderTr.appendChild(tableColumn);}}else{object.columns=[];}
$(object.tableBase).bootstrapTable({resizable:true,stickyHeader:true,locale:resources_locale,search:false,sortable:false,showColumns:false,showToggle:false,showRefresh:false,showFullscreen:false,virtualScroll:true,pageSize:object.limit,onPreBody:function(data){for(var i=0;i<data.length;i++){data[i].context=object;}},onClickRow:function(row){if(object.columns&&object.columns.length>0){var json={};for(var i=0;i<object.columns.length;i++){json[object.columns[i]]=row[i];}
object.filterForm(row.form,json);}}});}}
object.connectionError=false;object.updateLayout();},function(){object.columns=[];object.connectionError=true;object.updateLayout();});};HTMLQuery.prototype.updateLayout=function(){this.searchInput.disabled=this.connectionError;this.searchButton.disabled=this.connectionError;this.firstPageButton.disabled=!this.searched||this.connectionError||(this.offset==0);this.previousPageButton.disabled=!this.searched||this.connectionError||(this.offset==0);this.nextPageButton.disabled=!this.searched||this.connectionError||this.reachEnd;this.lastPageButton.disabled=true;this.refreshButton.className=this.connectionError?this.refreshButtonClass:"d-none";this.refreshButton.disabled=!this.connectionError;if(this.searchButton.disabled)bootstrapCloseTooltip(this.searchButton);if(this.firstPageButton.disabled)bootstrapCloseTooltip(this.firstPageButton);if(this.previousPageButton.disabled)bootstrapCloseTooltip(this.previousPageButton);if(this.nextPageButton.disabled)bootstrapCloseTooltip(this.nextPageButton);if(this.lastPageButton.disabled)bootstrapCloseTooltip(this.lastPageButton);if(this.refreshButton.disabled)bootstrapCloseTooltip(this.refreshButton);};HTMLQuery.prototype.searchAction=function(){var object=this;bootstrapCloseTooltip(this.searchButton);this.searched=false;if(this.lastSearch!=this.searchInput.value){this.lastSearch=this.searchInput.value;this.offset=0;}
this.sendRequest("",{query:this.searchInput.value,order:"asc",limit:this.limit,offset:this.offset},function(response){var hasResults=false;if(response&&response.length>0){try{response=JSON.parse(response);if(object.checkServerResponse(response)&&response.data&&response.hasResults){hasResults=true;object.searched=true;object.reachEnd=(response.data.length<object.limit);$(object.tableBase).bootstrapTable("load",response.data);}}catch(e){}}
if(!hasResults){$(object.tableBase).bootstrapTable("removeAll");object.reachEnd=true;object.offset=0;}
object.updateLayout();},function(){object.connectionError=true;object.updateLayout();});};HTMLQuery.prototype.filterForm=function(form,filters){var object=this;this.sendRequest("filter",{target:form,filters:JSON.stringify(filters)},function(response){if(response&&response.length>0){try{if(response.indexOf('"success"')!==-1){response=JSON.parse(response);object.checkServerResponse(response);}}catch(e){}
try{if(response.toLowerCase().indexOf("openform")!=-1){eval(response);}}catch(e){}}
object.updateLayout();},function(){object.updateLayout();});};HTMLQuery.prototype.nextPageAction=function(){bootstrapCloseTooltip(this.nextPageButton);this.offset+=this.limit;this.searchAction();};HTMLQuery.prototype.previousPageAction=function(){bootstrapCloseTooltip(this.previousPageButton);this.offset-=this.limit;this.searchAction();};HTMLQuery.prototype.firstPageAction=function(){bootstrapCloseTooltip(this.firstPageButton);this.offset=0;this.searchAction();};HTMLQuery.prototype.refreshAction=function(){bootstrapCloseTooltip(this.refreshButton);if(!this.connectionError)return false;this.updateData();};HTMLQuery.prototype.sendRequest=function(type,params,cbSuccess,cbError){var object=this;this.showPreloader();var xhr=new XMLHttpRequest();xhr.open("POST","componentData.do?action=componentData&sys="+URLEncode(this.sys,'GET')+"&formID="+URLEncode(this.formID,'GET')+"&comID="+URLEncode(this.code,'GET')+"&type="+type,true);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.onload=function(e){object.hidePreloader();if(xhr.readyState===4||xhr.status===200){if(cbSuccess)cbSuccess(xhr.responseText);}};xhr.onerror=function(e){object.hidePreloader();if(cbError)cbError(e);interactionError(safeGetLocaleMessage("ERROR.CONNECTION_FAIL"));};var data=null;if(params){data="";var keys=Object.keys(params);for(var i=0;i<keys.length;i++){data+=keys[i]+"="+URLEncode(params[keys[i]]);if(i<keys.length)data+="&";}}
xhr.send(data);};